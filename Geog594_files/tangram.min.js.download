/*! v4.10.112 - 2017-12-11 */
!function(){var a=("undefined"==typeof self||!("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope))&&("undefined"!=typeof module&&module.exports||"undefined"!=typeof window);if(a)var b=arguments.callee.toString(),c="undefined"!=typeof document&&void 0!==document.currentScript?document.currentScript.src:"",d="";!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Tangram=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(){if(h.length)throw h.shift()}function d(a){var b;b=g.length?g.pop():new e,b.task=a,f(b)}function e(){this.task=null}var f=a("./raw"),g=[],h=[],i=f.makeRequestCallFromTimer(c);b.exports=d,e.prototype.call=function(){try{this.task.call()}catch(a){d.onerror?d.onerror(a):(h.push(a),i())}finally{this.task=null,g[g.length]=this}}},{"./raw":2}],2:[function(a,b){(function(a){"use strict";function c(a){h.length||(g(),i=!0),h[h.length]=a}function d(){for(;j<h.length;){var a=j;if(j+=1,h[a].call(),j>k){for(var b=0,c=h.length-j;c>b;b++)h[b]=h[b+j];h.length-=j,j=0}}h.length=0,j=0,i=!1}function e(a){var b=1,c=new m(a),d=document.createTextNode("");return c.observe(d,{characterData:!0}),function(){b=-b,d.data=b}}function f(a){return function(){function b(){clearTimeout(c),clearInterval(d),a()}var c=setTimeout(b,0),d=setInterval(b,50)}}b.exports=c;var g,h=[],i=!1,j=0,k=1024,l="undefined"!=typeof a?a:self,m=l.MutationObserver||l.WebKitMutationObserver;g="function"==typeof m?e(d):f(d),c.requestFlush=g,c.makeRequestCallFromTimer=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(a,b,c){"use strict";function d(a){var b=a.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===a[b-2]?2:"="===a[b-1]?1:0}function e(a){return 3*a.length/4-d(a)}function f(a){var b,c,e,f,g,h=a.length;f=d(a),g=new l(3*h/4-f),c=f>0?h-4:h;var i=0;for(b=0;c>b;b+=4)e=k[a.charCodeAt(b)]<<18|k[a.charCodeAt(b+1)]<<12|k[a.charCodeAt(b+2)]<<6|k[a.charCodeAt(b+3)],g[i++]=e>>16&255,g[i++]=e>>8&255,g[i++]=255&e;return 2===f?(e=k[a.charCodeAt(b)]<<2|k[a.charCodeAt(b+1)]>>4,g[i++]=255&e):1===f&&(e=k[a.charCodeAt(b)]<<10|k[a.charCodeAt(b+1)]<<4|k[a.charCodeAt(b+2)]>>2,g[i++]=e>>8&255,g[i++]=255&e),g}function g(a){return j[a>>18&63]+j[a>>12&63]+j[a>>6&63]+j[63&a]}function h(a,b,c){for(var d,e=[],f=b;c>f;f+=3)d=(a[f]<<16)+(a[f+1]<<8)+a[f+2],e.push(g(d));return e.join("")}function i(a){for(var b,c=a.length,d=c%3,e="",f=[],g=16383,i=0,k=c-d;k>i;i+=g)f.push(h(a,i,i+g>k?k:i+g));return 1===d?(b=a[c-1],e+=j[b>>2],e+=j[b<<4&63],e+="=="):2===d&&(b=(a[c-2]<<8)+a[c-1],e+=j[b>>10],e+=j[b>>4&63],e+=j[b<<2&63],e+="="),f.push(e),f.join("")}c.byteLength=e,c.toByteArray=f,c.fromByteArray=i;for(var j=[],k=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=m.length;o>n;++n)j[n]=m[n],k[m.charCodeAt(n)]=n;k["-".charCodeAt(0)]=62,k["_".charCodeAt(0)]=63},{}],4:[function(){},{}],5:[function(a,b,c){"use strict";function d(){try{var a=new Uint8Array(1);return a.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===a.foo()}catch(a){return!1}}function e(a){if(a>Z)throw new RangeError("Invalid typed array length");var b=new Uint8Array(a);return b.__proto__=f.prototype,b}function f(a,b,c){if("number"==typeof a){if("string"==typeof b)throw new Error("If encoding is specified then the first argument must be a string");return j(a)}return g(a,b,c)}function g(a,b,c){if("number"==typeof a)throw new TypeError('"value" argument must not be a number');return U(a)?m(a,b,c):"string"==typeof a?k(a,b):n(a)}function h(a){if("number"!=typeof a)throw new TypeError('"size" argument must be a number');if(0>a)throw new RangeError('"size" argument must not be negative')}function i(a,b,c){return h(a),0>=a?e(a):void 0!==b?"string"==typeof c?e(a).fill(b,c):e(a).fill(b):e(a)}function j(a){return h(a),e(0>a?0:0|o(a))}function k(a,b){if(("string"!=typeof b||""===b)&&(b="utf8"),!f.isEncoding(b))throw new TypeError('"encoding" must be a valid string encoding');var c=0|q(a,b),d=e(c),g=d.write(a,b);return g!==c&&(d=d.slice(0,g)),d}function l(a){for(var b=a.length<0?0:0|o(a.length),c=e(b),d=0;b>d;d+=1)c[d]=255&a[d];return c}function m(a,b,c){if(0>b||a.byteLength<b)throw new RangeError("'offset' is out of bounds");if(a.byteLength<b+(c||0))throw new RangeError("'length' is out of bounds");var d;return d=void 0===b&&void 0===c?new Uint8Array(a):void 0===c?new Uint8Array(a,b):new Uint8Array(a,b,c),d.__proto__=f.prototype,d}function n(a){if(f.isBuffer(a)){var b=0|o(a.length),c=e(b);return 0===c.length?c:(a.copy(c,0,0,b),c)}if(a){if(V(a)||"length"in a)return"number"!=typeof a.length||W(a.length)?e(0):l(a);if("Buffer"===a.type&&Array.isArray(a.data))return l(a.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function o(a){if(a>=Z)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Z.toString(16)+" bytes");return 0|a}function p(a){return+a!=a&&(a=0),f.alloc(+a)}function q(a,b){if(f.isBuffer(a))return a.length;if(V(a)||U(a))return a.byteLength;"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":case void 0:return P(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return S(a).length;default:if(d)return P(a).length;b=(""+b).toLowerCase(),d=!0}}function r(a,b,c){var d=!1;if((void 0===b||0>b)&&(b=0),b>this.length)return"";if((void 0===c||c>this.length)&&(c=this.length),0>=c)return"";if(c>>>=0,b>>>=0,b>=c)return"";for(a||(a="utf8");;)switch(a){case"hex":return G(this,b,c);case"utf8":case"utf-8":return C(this,b,c);case"ascii":return E(this,b,c);case"latin1":case"binary":return F(this,b,c);case"base64":return B(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function s(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function t(a,b,c,d,e){if(0===a.length)return-1;if("string"==typeof c?(d=c,c=0):c>2147483647?c=2147483647:-2147483648>c&&(c=-2147483648),c=+c,W(c)&&(c=e?0:a.length-1),0>c&&(c=a.length+c),c>=a.length){if(e)return-1;c=a.length-1}else if(0>c){if(!e)return-1;c=0}if("string"==typeof b&&(b=f.from(b,d)),f.isBuffer(b))return 0===b.length?-1:u(a,b,c,d,e);if("number"==typeof b)return b&=255,"function"==typeof Uint8Array.prototype.indexOf?e?Uint8Array.prototype.indexOf.call(a,b,c):Uint8Array.prototype.lastIndexOf.call(a,b,c):u(a,[b],c,d,e);throw new TypeError("val must be string, number or Buffer")}function u(a,b,c,d,e){function f(a,b){return 1===g?a[b]:a.readUInt16BE(b*g)}var g=1,h=a.length,i=b.length;if(void 0!==d&&(d=String(d).toLowerCase(),"ucs2"===d||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(a.length<2||b.length<2)return-1;g=2,h/=2,i/=2,c/=2}var j;if(e){var k=-1;for(j=c;h>j;j++)if(f(a,j)===f(b,-1===k?0:j-k)){if(-1===k&&(k=j),j-k+1===i)return k*g}else-1!==k&&(j-=j-k),k=-1}else for(c+i>h&&(c=h-i),j=c;j>=0;j--){for(var l=!0,m=0;i>m;m++)if(f(a,j+m)!==f(b,m)){l=!1;break}if(l)return j}return-1}function v(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;if(f%2!==0)throw new TypeError("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;d>g;++g){var h=parseInt(b.substr(2*g,2),16);if(W(h))return g;a[c+g]=h}return g}function w(a,b,c,d){return T(P(b,a.length-c),a,c,d)}function x(a,b,c,d){return T(Q(b),a,c,d)}function y(a,b,c,d){return x(a,b,c,d)}function z(a,b,c,d){return T(S(b),a,c,d)}function A(a,b,c,d){return T(R(b,a.length-c),a,c,d)}function B(a,b,c){return X.fromByteArray(0===b&&c===a.length?a:a.slice(b,c))}function C(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;c>e;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(c>=e+h){var i,j,k,l;switch(h){case 1:128>f&&(g=f);break;case 2:i=a[e+1],128===(192&i)&&(l=(31&f)<<6|63&i,l>127&&(g=l));break;case 3:i=a[e+1],j=a[e+2],128===(192&i)&&128===(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j,l>2047&&(55296>l||l>57343)&&(g=l));break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128===(192&i)&&128===(192&j)&&128===(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k,l>65535&&1114112>l&&(g=l))}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return D(d)}function D(a){var b=a.length;if($>=b)return String.fromCharCode.apply(String,a);for(var c="",d=0;b>d;)c+=String.fromCharCode.apply(String,a.slice(d,d+=$));return c}function E(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;++e)d+=String.fromCharCode(127&a[e]);return d}function F(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;++e)d+=String.fromCharCode(a[e]);return d}function G(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;++f)e+=O(a[f]);return e}function H(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function I(a,b,c){if(a%1!==0||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function J(a,b,c,d,e,g){if(!f.isBuffer(a))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>e||g>b)throw new RangeError('"value" argument is out of bounds');if(c+d>a.length)throw new RangeError("Index out of range")}function K(a,b,c,d){if(c+d>a.length)throw new RangeError("Index out of range");if(0>c)throw new RangeError("Index out of range")}function L(a,b,c,d,e){return b=+b,c>>>=0,e||K(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),Y.write(a,b,c,d,23,4),c+4}function M(a,b,c,d,e){return b=+b,c>>>=0,e||K(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),Y.write(a,b,c,d,52,8),c+8}function N(a){if(a=a.trim().replace(_,""),a.length<2)return"";for(;a.length%4!==0;)a+="=";return a}function O(a){return 16>a?"0"+a.toString(16):a.toString(16)}function P(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;d>g;++g){if(c=a.charCodeAt(g),c>55295&&57344>c){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(56320>c){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,128>c){if((b-=1)<0)break;f.push(c)}else if(2048>c){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(65536>c){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(1114112>c))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function Q(a){for(var b=[],c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));return b}function R(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);++g)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function S(a){return X.toByteArray(N(a))}function T(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);++e)b[e+c]=a[e];return e}function U(a){return a instanceof ArrayBuffer||null!=a&&null!=a.constructor&&"ArrayBuffer"===a.constructor.name&&"number"==typeof a.byteLength}function V(a){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(a)}function W(a){return a!==a}var X=a("base64-js"),Y=a("ieee754");c.Buffer=f,c.SlowBuffer=p,c.INSPECT_MAX_BYTES=50;var Z=2147483647;c.kMaxLength=Z,f.TYPED_ARRAY_SUPPORT=d(),f.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),f.poolSize=8192,f.from=function(a,b,c){return g(a,b,c)},f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,f.alloc=function(a,b,c){return i(a,b,c)},f.allocUnsafe=function(a){return j(a)},f.allocUnsafeSlow=function(a){return j(a)},f.isBuffer=function(a){return null!=a&&a._isBuffer===!0},f.compare=function(a,b){if(!f.isBuffer(a)||!f.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,g=Math.min(c,d);g>e;++e)if(a[e]!==b[e]){c=a[e],d=b[e];break}return d>c?-1:c>d?1:0},f.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(a,b){if(!Array.isArray(a))throw new TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return f.alloc(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;++c)b+=a[c].length;var d=f.allocUnsafe(b),e=0;for(c=0;c<a.length;++c){var g=a[c];if(!f.isBuffer(g))throw new TypeError('"list" argument must be an Array of Buffers');g.copy(d,e),e+=g.length}return d},f.byteLength=q,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var a=this.length;if(a%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var b=0;a>b;b+=2)s(this,b,b+1);return this},f.prototype.swap32=function(){var a=this.length;if(a%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;a>b;b+=4)s(this,b,b+3),s(this,b+1,b+2);return this},f.prototype.swap64=function(){var a=this.length;if(a%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;a>b;b+=8)s(this,b,b+7),s(this,b+1,b+6),s(this,b+2,b+5),s(this,b+3,b+4);return this},f.prototype.toString=function(){var a=this.length;return 0===a?"":0===arguments.length?C(this,0,a):r.apply(this,arguments)},f.prototype.equals=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a||0===f.compare(this,a)},f.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},f.prototype.compare=function(a,b,c,d,e){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");if(void 0===b&&(b=0),void 0===c&&(c=a?a.length:0),void 0===d&&(d=0),void 0===e&&(e=this.length),0>b||c>a.length||0>d||e>this.length)throw new RangeError("out of range index");if(d>=e&&b>=c)return 0;if(d>=e)return-1;if(b>=c)return 1;if(b>>>=0,c>>>=0,d>>>=0,e>>>=0,this===a)return 0;for(var g=e-d,h=c-b,i=Math.min(g,h),j=this.slice(d,e),k=a.slice(b,c),l=0;i>l;++l)if(j[l]!==k[l]){g=j[l],h=k[l];break}return h>g?-1:g>h?1:0},f.prototype.includes=function(a,b,c){return-1!==this.indexOf(a,b,c)},f.prototype.indexOf=function(a,b,c){return t(this,a,b,c,!0)},f.prototype.lastIndexOf=function(a,b,c){return t(this,a,b,c,!1)},f.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else{if(!isFinite(b))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");b>>>=0,isFinite(c)?(c>>>=0,void 0===d&&(d="utf8")):(d=c,c=void 0)}var e=this.length-b;if((void 0===c||c>e)&&(c=e),a.length>0&&(0>c||0>b)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");d||(d="utf8");for(var f=!1;;)switch(d){case"hex":return v(this,a,b,c);case"utf8":case"utf-8":return w(this,a,b,c);case"ascii":return x(this,a,b,c);case"latin1":case"binary":return y(this,a,b,c);case"base64":return z(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,a,b,c);default:if(f)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),f=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;f.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a);var d=this.subarray(a,b);return d.__proto__=f.prototype,d},f.prototype.readUIntLE=function(a,b,c){a>>>=0,b>>>=0,c||I(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},f.prototype.readUIntBE=function(a,b,c){a>>>=0,b>>>=0,c||I(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},f.prototype.readUInt8=function(a,b){return a>>>=0,b||I(a,1,this.length),this[a]},f.prototype.readUInt16LE=function(a,b){return a>>>=0,b||I(a,2,this.length),this[a]|this[a+1]<<8},f.prototype.readUInt16BE=function(a,b){return a>>>=0,b||I(a,2,this.length),this[a]<<8|this[a+1]},f.prototype.readUInt32LE=function(a,b){return a>>>=0,b||I(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},f.prototype.readUInt32BE=function(a,b){return a>>>=0,b||I(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},f.prototype.readIntLE=function(a,b,c){a>>>=0,b>>>=0,c||I(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},f.prototype.readIntBE=function(a,b,c){a>>>=0,b>>>=0,c||I(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},f.prototype.readInt8=function(a,b){return a>>>=0,b||I(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},f.prototype.readInt16LE=function(a,b){a>>>=0,b||I(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt16BE=function(a,b){a>>>=0,b||I(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt32LE=function(a,b){return a>>>=0,b||I(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},f.prototype.readInt32BE=function(a,b){return a>>>=0,b||I(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},f.prototype.readFloatLE=function(a,b){return a>>>=0,b||I(a,4,this.length),Y.read(this,a,!0,23,4)},f.prototype.readFloatBE=function(a,b){return a>>>=0,b||I(a,4,this.length),Y.read(this,a,!1,23,4)},f.prototype.readDoubleLE=function(a,b){return a>>>=0,b||I(a,8,this.length),Y.read(this,a,!0,52,8)},f.prototype.readDoubleBE=function(a,b){return a>>>=0,b||I(a,8,this.length),Y.read(this,a,!1,52,8)},f.prototype.writeUIntLE=function(a,b,c,d){if(a=+a,b>>>=0,c>>>=0,!d){var e=Math.pow(2,8*c)-1;J(this,a,b,c,e,0)}var f=1,g=0;for(this[b]=255&a;++g<c&&(f*=256);)this[b+g]=a/f&255;return b+c},f.prototype.writeUIntBE=function(a,b,c,d){if(a=+a,b>>>=0,c>>>=0,!d){var e=Math.pow(2,8*c)-1;J(this,a,b,c,e,0)}var f=c-1,g=1;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=a/g&255;return b+c},f.prototype.writeUInt8=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,1,255,0),this[b]=255&a,b+1},f.prototype.writeUInt16LE=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,2,65535,0),this[b]=255&a,this[b+1]=a>>>8,b+2},f.prototype.writeUInt16BE=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,2,65535,0),this[b]=a>>>8,this[b+1]=255&a,b+2},f.prototype.writeUInt32LE=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,4,4294967295,0),this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a,b+4},f.prototype.writeUInt32BE=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,4,4294967295,0),this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a,b+4},f.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b>>>=0,!d){var e=Math.pow(2,8*c-1);J(this,a,b,c,e-1,-e)}var f=0,g=1,h=0;for(this[b]=255&a;++f<c&&(g*=256);)0>a&&0===h&&0!==this[b+f-1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b>>>=0,!d){var e=Math.pow(2,8*c-1);J(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0;for(this[b+f]=255&a;--f>=0&&(g*=256);)0>a&&0===h&&0!==this[b+f+1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeInt8=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,1,127,-128),0>a&&(a=255+a+1),this[b]=255&a,b+1},f.prototype.writeInt16LE=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,2,32767,-32768),this[b]=255&a,this[b+1]=a>>>8,b+2},f.prototype.writeInt16BE=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,2,32767,-32768),this[b]=a>>>8,this[b+1]=255&a,b+2},f.prototype.writeInt32LE=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,4,2147483647,-2147483648),this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24,b+4},f.prototype.writeInt32BE=function(a,b,c){return a=+a,b>>>=0,c||J(this,a,b,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a,b+4},f.prototype.writeFloatLE=function(a,b,c){return L(this,a,b,!0,c)},f.prototype.writeFloatBE=function(a,b,c){return L(this,a,b,!1,c)},f.prototype.writeDoubleLE=function(a,b,c){return M(this,a,b,!0,c)},f.prototype.writeDoubleBE=function(a,b,c){return M(this,a,b,!1,c)},f.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&c>d&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(0>b)throw new RangeError("targetStart out of bounds");if(0>c||c>=this.length)throw new RangeError("sourceStart out of bounds");if(0>d)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,f=d-c;if(this===a&&b>c&&d>b)for(e=f-1;e>=0;--e)a[e+b]=this[e+c];else if(1e3>f)for(e=0;f>e;++e)a[e+b]=this[e+c];else Uint8Array.prototype.set.call(a,this.subarray(c,c+f),b);return f},f.prototype.fill=function(a,b,c,d){if("string"==typeof a){if("string"==typeof b?(d=b,b=0,c=this.length):"string"==typeof c&&(d=c,c=this.length),1===a.length){var e=a.charCodeAt(0);256>e&&(a=e)}if(void 0!==d&&"string"!=typeof d)throw new TypeError("encoding must be a string");if("string"==typeof d&&!f.isEncoding(d))throw new TypeError("Unknown encoding: "+d)}else"number"==typeof a&&(a&=255);if(0>b||this.length<b||this.length<c)throw new RangeError("Out of range index");if(b>=c)return this;b>>>=0,c=void 0===c?this.length:c>>>0,a||(a=0);var g;if("number"==typeof a)for(g=b;c>g;++g)this[g]=a;else{var h=f.isBuffer(a)?a:new f(a,d),i=h.length;for(g=0;c-b>g;++g)this[g+b]=h[g%i]}return this};var _=/[^+\/0-9A-Za-z-_]/g},{"base64-js":3,ieee754:93}],6:[function(a,b){a("../modules/es6.object.to-string"),a("../modules/es6.string.iterator"),a("../modules/web.dom.iterable"),a("../modules/es6.promise"),b.exports=a("../modules/_core").Promise},{"../modules/_core":14,"../modules/es6.object.to-string":66,"../modules/es6.promise":67,"../modules/es6.string.iterator":68,"../modules/web.dom.iterable":69}],7:[function(a,b){b.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},{}],8:[function(a,b){var c=a("./_wks")("unscopables"),d=Array.prototype;void 0==d[c]&&a("./_hide")(d,c,{}),b.exports=function(a){d[c][a]=!0}},{"./_hide":25,"./_wks":63}],9:[function(a,b){b.exports=function(a,b,c,d){if(!(a instanceof b)||void 0!==d&&d in a)throw TypeError(c+": incorrect invocation!");return a}},{}],10:[function(a,b){var c=a("./_is-object");b.exports=function(a){if(!c(a))throw TypeError(a+" is not an object!");return a}},{"./_is-object":31}],11:[function(a,b){var c=a("./_to-iobject"),d=a("./_to-length"),e=a("./_to-index");b.exports=function(a){return function(b,f,g){var h,i=c(b),j=d(i.length),k=e(g,j);if(a&&f!=f){for(;j>k;)if(h=i[k++],h!=h)return!0}else for(;j>k;k++)if((a||k in i)&&i[k]===f)return a||k||0;return!a&&-1}}},{"./_to-index":56,"./_to-iobject":58,"./_to-length":59}],12:[function(a,b){var c=a("./_cof"),d=a("./_wks")("toStringTag"),e="Arguments"==c(function(){return arguments}()),f=function(a,b){try{return a[b]}catch(a){}};b.exports=function(a){var b,g,h;return void 0===a?"Undefined":null===a?"Null":"string"==typeof(g=f(b=Object(a),d))?g:e?c(b):"Object"==(h=c(b))&&"function"==typeof b.callee?"Arguments":h}},{"./_cof":13,"./_wks":63}],13:[function(a,b){var c={}.toString;b.exports=function(a){return c.call(a).slice(8,-1)}},{}],14:[function(a,b){var c=b.exports={version:"2.4.0"};"number"==typeof __e&&(__e=c)},{}],15:[function(a,b){var c=a("./_a-function");b.exports=function(a,b,d){if(c(a),void 0===b)return a;switch(d){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{"./_a-function":7}],16:[function(a,b){b.exports=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a}},{}],17:[function(a,b){b.exports=!a("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":21}],18:[function(a,b){var c=a("./_is-object"),d=a("./_global").document,e=c(d)&&c(d.createElement);b.exports=function(a){return e?d.createElement(a):{}}},{"./_global":23,"./_is-object":31}],19:[function(a,b){b.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],20:[function(a,b){var c=a("./_global"),d=a("./_core"),e=a("./_hide"),f=a("./_redefine"),g=a("./_ctx"),h="prototype",i=function(a,b,j){var k,l,m,n,o=a&i.F,p=a&i.G,q=a&i.S,r=a&i.P,s=a&i.B,t=p?c:q?c[b]||(c[b]={}):(c[b]||{})[h],u=p?d:d[b]||(d[b]={}),v=u[h]||(u[h]={});p&&(j=b);for(k in j)l=!o&&t&&void 0!==t[k],m=(l?t:j)[k],n=s&&l?g(m,c):r&&"function"==typeof m?g(Function.call,m):m,t&&f(t,k,m,a&i.U),u[k]!=m&&e(u,k,n),r&&v[k]!=m&&(v[k]=m)};c.core=d,i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{"./_core":14,"./_ctx":15,"./_global":23,"./_hide":25,"./_redefine":48}],21:[function(a,b){b.exports=function(a){try{return!!a()}catch(a){return!0}}},{}],22:[function(a,b,c){var d=a("./_ctx"),e=a("./_iter-call"),f=a("./_is-array-iter"),g=a("./_an-object"),h=a("./_to-length"),i=a("./core.get-iterator-method"),j={},k={},c=b.exports=function(a,b,c,l,m){var n,o,p,q,r=m?function(){return a}:i(a),s=d(c,l,b?2:1),t=0;if("function"!=typeof r)throw TypeError(a+" is not iterable!");if(f(r)){for(n=h(a.length);n>t;t++)if(q=b?s(g(o=a[t])[0],o[1]):s(a[t]),q===j||q===k)return q}else for(p=r.call(a);!(o=p.next()).done;)if(q=e(p,s,o.value,b),q===j||q===k)return q};c.BREAK=j,c.RETURN=k},{"./_an-object":10,"./_ctx":15,"./_is-array-iter":30,"./_iter-call":32,"./_to-length":59,"./core.get-iterator-method":64}],23:[function(a,b){var c=b.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=c)},{}],24:[function(a,b){var c={}.hasOwnProperty;b.exports=function(a,b){return c.call(a,b)}},{}],25:[function(a,b){var c=a("./_object-dp"),d=a("./_property-desc");b.exports=a("./_descriptors")?function(a,b,e){return c.f(a,b,d(1,e))}:function(a,b,c){return a[b]=c,a}},{"./_descriptors":17,"./_object-dp":41,"./_property-desc":46}],26:[function(a,b){b.exports=a("./_global").document&&document.documentElement},{"./_global":23}],27:[function(a,b){b.exports=!a("./_descriptors")&&!a("./_fails")(function(){return 7!=Object.defineProperty(a("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":17,"./_dom-create":18,"./_fails":21}],28:[function(a,b){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],29:[function(a,b){var c=a("./_cof");b.exports=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==c(a)?a.split(""):Object(a)}},{"./_cof":13}],30:[function(a,b){var c=a("./_iterators"),d=a("./_wks")("iterator"),e=Array.prototype;b.exports=function(a){return void 0!==a&&(c.Array===a||e[d]===a)}},{"./_iterators":37,"./_wks":63}],31:[function(a,b){b.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},{}],32:[function(a,b){var c=a("./_an-object");b.exports=function(a,b,d,e){try{return e?b(c(d)[0],d[1]):b(d)}catch(b){var f=a.return;throw void 0!==f&&c(f.call(a)),b}}},{"./_an-object":10}],33:[function(a,b){"use strict";var c=a("./_object-create"),d=a("./_property-desc"),e=a("./_set-to-string-tag"),f={};a("./_hide")(f,a("./_wks")("iterator"),function(){return this}),b.exports=function(a,b,g){a.prototype=c(f,{next:d(1,g)}),e(a,b+" Iterator")}},{"./_hide":25,"./_object-create":40,"./_property-desc":46,"./_set-to-string-tag":50,"./_wks":63}],34:[function(a,b){"use strict";var c=a("./_library"),d=a("./_export"),e=a("./_redefine"),f=a("./_hide"),g=a("./_has"),h=a("./_iterators"),i=a("./_iter-create"),j=a("./_set-to-string-tag"),k=a("./_object-gpo"),l=a("./_wks")("iterator"),m=!([].keys&&"next"in[].keys()),n="@@iterator",o="keys",p="values",q=function(){return this};b.exports=function(a,b,r,s,t,u,v){i(r,b,s);var w,x,y,z=function(a){if(!m&&a in D)return D[a];switch(a){case o:return function(){return new r(this,a)};case p:return function(){return new r(this,a)}}return function(){return new r(this,a)}},A=b+" Iterator",B=t==p,C=!1,D=a.prototype,E=D[l]||D[n]||t&&D[t],F=E||z(t),G=t?B?z("entries"):F:void 0,H="Array"==b?D.entries||E:E;if(H&&(y=k(H.call(new a)),y!==Object.prototype&&(j(y,A,!0),c||g(y,l)||f(y,l,q))),B&&E&&E.name!==p&&(C=!0,F=function(){return E.call(this)}),c&&!v||!m&&!C&&D[l]||f(D,l,F),h[b]=F,h[A]=q,t)if(w={values:B?F:z(p),keys:u?F:z(o),entries:G},v)for(x in w)x in D||e(D,x,w[x]);else d(d.P+d.F*(m||C),b,w);return w}},{"./_export":20,"./_has":24,"./_hide":25,"./_iter-create":33,"./_iterators":37,"./_library":38,"./_object-gpo":43,"./_redefine":48,"./_set-to-string-tag":50,"./_wks":63}],35:[function(a,b){var c=a("./_wks")("iterator"),d=!1;try{var e=[7][c]();e.return=function(){d=!0},Array.from(e,function(){throw 2})}catch(a){}b.exports=function(a,b){if(!b&&!d)return!1;var e=!1;try{var f=[7],g=f[c]();g.next=function(){return{done:e=!0}},f[c]=function(){return g},a(f)}catch(a){}return e}},{"./_wks":63}],36:[function(a,b){b.exports=function(a,b){return{value:b,done:!!a}}},{}],37:[function(a,b){b.exports={}},{}],38:[function(a,b){b.exports=!1},{}],39:[function(a,b){var c=a("./_global"),d=a("./_task").set,e=c.MutationObserver||c.WebKitMutationObserver,f=c.process,g=c.Promise,h="process"==a("./_cof")(f);b.exports=function(){var a,b,i,j=function(){var c,d;for(h&&(c=f.domain)&&c.exit();a;){d=a.fn,a=a.next;try{d()}catch(c){throw a?i():b=void 0,c}}b=void 0,c&&c.enter()};if(h)i=function(){f.nextTick(j)};else if(e){var k=!0,l=document.createTextNode("");new e(j).observe(l,{characterData:!0}),i=function(){l.data=k=!k}}else if(g&&g.resolve){var m=g.resolve();i=function(){m.then(j)}}else i=function(){d.call(c,j)};return function(c){var d={fn:c,next:void 0};b&&(b.next=d),a||(a=d,i()),b=d}}},{"./_cof":13,"./_global":23,"./_task":55}],40:[function(a,b){var c=a("./_an-object"),d=a("./_object-dps"),e=a("./_enum-bug-keys"),f=a("./_shared-key")("IE_PROTO"),g=function(){},h="prototype",i=function(){var b,c=a("./_dom-create")("iframe"),d=e.length,f="<",g=">";for(c.style.display="none",a("./_html").appendChild(c),c.src="javascript:",b=c.contentWindow.document,b.open(),b.write(f+"script"+g+"document.F=Object"+f+"/script"+g),b.close(),i=b.F;d--;)delete i[h][e[d]];return i()};b.exports=Object.create||function(a,b){var e;return null!==a?(g[h]=c(a),e=new g,g[h]=null,e[f]=a):e=i(),void 0===b?e:d(e,b)}},{"./_an-object":10,"./_dom-create":18,"./_enum-bug-keys":19,"./_html":26,"./_object-dps":42,"./_shared-key":51}],41:[function(a,b,c){var d=a("./_an-object"),e=a("./_ie8-dom-define"),f=a("./_to-primitive"),g=Object.defineProperty;c.f=a("./_descriptors")?Object.defineProperty:function(a,b,c){if(d(a),
b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a}},{"./_an-object":10,"./_descriptors":17,"./_ie8-dom-define":27,"./_to-primitive":61}],42:[function(a,b){var c=a("./_object-dp"),d=a("./_an-object"),e=a("./_object-keys");b.exports=a("./_descriptors")?Object.defineProperties:function(a,b){d(a);for(var f,g=e(b),h=g.length,i=0;h>i;)c.f(a,f=g[i++],b[f]);return a}},{"./_an-object":10,"./_descriptors":17,"./_object-dp":41,"./_object-keys":45}],43:[function(a,b){var c=a("./_has"),d=a("./_to-object"),e=a("./_shared-key")("IE_PROTO"),f=Object.prototype;b.exports=Object.getPrototypeOf||function(a){return a=d(a),c(a,e)?a[e]:"function"==typeof a.constructor&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?f:null}},{"./_has":24,"./_shared-key":51,"./_to-object":60}],44:[function(a,b){var c=a("./_has"),d=a("./_to-iobject"),e=a("./_array-includes")(!1),f=a("./_shared-key")("IE_PROTO");b.exports=function(a,b){var g,h=d(a),i=0,j=[];for(g in h)g!=f&&c(h,g)&&j.push(g);for(;b.length>i;)c(h,g=b[i++])&&(~e(j,g)||j.push(g));return j}},{"./_array-includes":11,"./_has":24,"./_shared-key":51,"./_to-iobject":58}],45:[function(a,b){var c=a("./_object-keys-internal"),d=a("./_enum-bug-keys");b.exports=Object.keys||function(a){return c(a,d)}},{"./_enum-bug-keys":19,"./_object-keys-internal":44}],46:[function(a,b){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],47:[function(a,b){var c=a("./_redefine");b.exports=function(a,b,d){for(var e in b)c(a,e,b[e],d);return a}},{"./_redefine":48}],48:[function(a,b){var c=a("./_global"),d=a("./_hide"),e=a("./_has"),f=a("./_uid")("src"),g="toString",h=Function[g],i=(""+h).split(g);a("./_core").inspectSource=function(a){return h.call(a)},(b.exports=function(a,b,g,h){var j="function"==typeof g;j&&(e(g,"name")||d(g,"name",b)),a[b]!==g&&(j&&(e(g,f)||d(g,f,a[b]?""+a[b]:i.join(String(b)))),a===c?a[b]=g:h?a[b]?a[b]=g:d(a,b,g):(delete a[b],d(a,b,g)))})(Function.prototype,g,function(){return"function"==typeof this&&this[f]||h.call(this)})},{"./_core":14,"./_global":23,"./_has":24,"./_hide":25,"./_uid":62}],49:[function(a,b){"use strict";var c=a("./_global"),d=a("./_object-dp"),e=a("./_descriptors"),f=a("./_wks")("species");b.exports=function(a){var b=c[a];e&&b&&!b[f]&&d.f(b,f,{configurable:!0,get:function(){return this}})}},{"./_descriptors":17,"./_global":23,"./_object-dp":41,"./_wks":63}],50:[function(a,b){var c=a("./_object-dp").f,d=a("./_has"),e=a("./_wks")("toStringTag");b.exports=function(a,b,f){a&&!d(a=f?a:a.prototype,e)&&c(a,e,{configurable:!0,value:b})}},{"./_has":24,"./_object-dp":41,"./_wks":63}],51:[function(a,b){var c=a("./_shared")("keys"),d=a("./_uid");b.exports=function(a){return c[a]||(c[a]=d(a))}},{"./_shared":52,"./_uid":62}],52:[function(a,b){var c=a("./_global"),d="__core-js_shared__",e=c[d]||(c[d]={});b.exports=function(a){return e[a]||(e[a]={})}},{"./_global":23}],53:[function(a,b){var c=a("./_an-object"),d=a("./_a-function"),e=a("./_wks")("species");b.exports=function(a,b){var f,g=c(a).constructor;return void 0===g||void 0==(f=c(g)[e])?b:d(f)}},{"./_a-function":7,"./_an-object":10,"./_wks":63}],54:[function(a,b){var c=a("./_to-integer"),d=a("./_defined");b.exports=function(a){return function(b,e){var f,g,h=String(d(b)),i=c(e),j=h.length;return 0>i||i>=j?a?"":void 0:(f=h.charCodeAt(i),55296>f||f>56319||i+1===j||(g=h.charCodeAt(i+1))<56320||g>57343?a?h.charAt(i):f:a?h.slice(i,i+2):(f-55296<<10)+(g-56320)+65536)}}},{"./_defined":16,"./_to-integer":57}],55:[function(a,b){var c,d,e,f=a("./_ctx"),g=a("./_invoke"),h=a("./_html"),i=a("./_dom-create"),j=a("./_global"),k=j.process,l=j.setImmediate,m=j.clearImmediate,n=j.MessageChannel,o=0,p={},q="onreadystatechange",r=function(){var a=+this;if(p.hasOwnProperty(a)){var b=p[a];delete p[a],b()}},s=function(a){r.call(a.data)};l&&m||(l=function(a){for(var b=[],d=1;arguments.length>d;)b.push(arguments[d++]);return p[++o]=function(){g("function"==typeof a?a:Function(a),b)},c(o),o},m=function(a){delete p[a]},"process"==a("./_cof")(k)?c=function(a){k.nextTick(f(r,a,1))}:n?(d=new n,e=d.port2,d.port1.onmessage=s,c=f(e.postMessage,e,1)):j.addEventListener&&"function"==typeof postMessage&&!j.importScripts?(c=function(a){j.postMessage(a+"","*")},j.addEventListener("message",s,!1)):c=q in i("script")?function(a){h.appendChild(i("script"))[q]=function(){h.removeChild(this),r.call(a)}}:function(a){setTimeout(f(r,a,1),0)}),b.exports={set:l,clear:m}},{"./_cof":13,"./_ctx":15,"./_dom-create":18,"./_global":23,"./_html":26,"./_invoke":28}],56:[function(a,b){var c=a("./_to-integer"),d=Math.max,e=Math.min;b.exports=function(a,b){return a=c(a),0>a?d(a+b,0):e(a,b)}},{"./_to-integer":57}],57:[function(a,b){var c=Math.ceil,d=Math.floor;b.exports=function(a){return isNaN(a=+a)?0:(a>0?d:c)(a)}},{}],58:[function(a,b){var c=a("./_iobject"),d=a("./_defined");b.exports=function(a){return c(d(a))}},{"./_defined":16,"./_iobject":29}],59:[function(a,b){var c=a("./_to-integer"),d=Math.min;b.exports=function(a){return a>0?d(c(a),9007199254740991):0}},{"./_to-integer":57}],60:[function(a,b){var c=a("./_defined");b.exports=function(a){return Object(c(a))}},{"./_defined":16}],61:[function(a,b){var c=a("./_is-object");b.exports=function(a,b){if(!c(a))return a;var d,e;if(b&&"function"==typeof(d=a.toString)&&!c(e=d.call(a)))return e;if("function"==typeof(d=a.valueOf)&&!c(e=d.call(a)))return e;if(!b&&"function"==typeof(d=a.toString)&&!c(e=d.call(a)))return e;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":31}],62:[function(a,b){var c=0,d=Math.random();b.exports=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++c+d).toString(36))}},{}],63:[function(a,b){var c=a("./_shared")("wks"),d=a("./_uid"),e=a("./_global").Symbol,f="function"==typeof e,g=b.exports=function(a){return c[a]||(c[a]=f&&e[a]||(f?e:d)("Symbol."+a))};g.store=c},{"./_global":23,"./_shared":52,"./_uid":62}],64:[function(a,b){var c=a("./_classof"),d=a("./_wks")("iterator"),e=a("./_iterators");b.exports=a("./_core").getIteratorMethod=function(a){return void 0!=a?a[d]||a["@@iterator"]||e[c(a)]:void 0}},{"./_classof":12,"./_core":14,"./_iterators":37,"./_wks":63}],65:[function(a,b){"use strict";var c=a("./_add-to-unscopables"),d=a("./_iter-step"),e=a("./_iterators"),f=a("./_to-iobject");b.exports=a("./_iter-define")(Array,"Array",function(a,b){this._t=f(a),this._i=0,this._k=b},function(){var a=this._t,b=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,d(1)):"keys"==b?d(0,c):"values"==b?d(0,a[c]):d(0,[c,a[c]])},"values"),e.Arguments=e.Array,c("keys"),c("values"),c("entries")},{"./_add-to-unscopables":8,"./_iter-define":34,"./_iter-step":36,"./_iterators":37,"./_to-iobject":58}],66:[function(a){"use strict";var b=a("./_classof"),c={};c[a("./_wks")("toStringTag")]="z",c+""!="[object z]"&&a("./_redefine")(Object.prototype,"toString",function(){return"[object "+b(this)+"]"},!0)},{"./_classof":12,"./_redefine":48,"./_wks":63}],67:[function(a){"use strict";var b,c,d,e=a("./_library"),f=a("./_global"),g=a("./_ctx"),h=a("./_classof"),i=a("./_export"),j=a("./_is-object"),k=a("./_a-function"),l=a("./_an-instance"),m=a("./_for-of"),n=a("./_species-constructor"),o=a("./_task").set,p=a("./_microtask")(),q="Promise",r=f.TypeError,s=f.process,t=f[q],s=f.process,u="process"==h(s),v=function(){},w=!!function(){try{var b=t.resolve(1),c=(b.constructor={})[a("./_wks")("species")]=function(a){a(v,v)};return(u||"function"==typeof PromiseRejectionEvent)&&b.then(v)instanceof c}catch(a){}}(),x=function(a,b){return a===b||a===t&&b===d},y=function(a){var b;return!(!j(a)||"function"!=typeof(b=a.then))&&b},z=function(a){return x(t,a)?new A(a):new c(a)},A=c=function(a){var b,c;this.promise=new a(function(a,d){if(void 0!==b||void 0!==c)throw r("Bad Promise constructor");b=a,c=d}),this.resolve=k(b),this.reject=k(c)},B=function(a){try{a()}catch(a){return{error:a}}},C=function(a,b){if(!a._n){a._n=!0;var c=a._c;p(function(){for(var d=a._v,e=1==a._s,f=0,g=function(b){var c,f,g=e?b.ok:b.fail,h=b.resolve,i=b.reject,j=b.domain;try{g?(e||(2==a._h&&F(a),a._h=1),g===!0?c=d:(j&&j.enter(),c=g(d),j&&j.exit()),c===b.promise?i(r("Promise-chain cycle")):(f=y(c))?f.call(c,h,i):h(c)):i(d)}catch(a){i(a)}};c.length>f;)g(c[f++]);a._c=[],a._n=!1,b&&!a._h&&D(a)})}},D=function(a){o.call(f,function(){var b,c,d,e=a._v;if(E(a)&&(b=B(function(){u?s.emit("unhandledRejection",e,a):(c=f.onunhandledrejection)?c({promise:a,reason:e}):(d=f.console)&&d.error&&d.error("Unhandled promise rejection",e)}),a._h=u||E(a)?2:1),a._a=void 0,b)throw b.error})},E=function(a){if(1==a._h)return!1;for(var b,c=a._a||a._c,d=0;c.length>d;)if(b=c[d++],b.fail||!E(b.promise))return!1;return!0},F=function(a){o.call(f,function(){var b;u?s.emit("rejectionHandled",a):(b=f.onrejectionhandled)&&b({promise:a,reason:a._v})})},G=function(a){var b=this;b._d||(b._d=!0,b=b._w||b,b._v=a,b._s=2,b._a||(b._a=b._c.slice()),C(b,!0))},H=function(a){var b,c=this;if(!c._d){c._d=!0,c=c._w||c;try{if(c===a)throw r("Promise can't be resolved itself");(b=y(a))?p(function(){var d={_w:c,_d:!1};try{b.call(a,g(H,d,1),g(G,d,1))}catch(a){G.call(d,a)}}):(c._v=a,c._s=1,C(c,!1))}catch(a){G.call({_w:c,_d:!1},a)}}};w||(t=function(a){l(this,t,q,"_h"),k(a),b.call(this);try{a(g(H,this,1),g(G,this,1))}catch(a){G.call(this,a)}},b=function(){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},b.prototype=a("./_redefine-all")(t.prototype,{then:function(a,b){var c=z(n(this,t));return c.ok="function"!=typeof a||a,c.fail="function"==typeof b&&b,c.domain=u?s.domain:void 0,this._c.push(c),this._a&&this._a.push(c),this._s&&C(this,!1),c.promise},catch:function(a){return this.then(void 0,a)}}),A=function(){var a=new b;this.promise=a,this.resolve=g(H,a,1),this.reject=g(G,a,1)}),i(i.G+i.W+i.F*!w,{Promise:t}),a("./_set-to-string-tag")(t,q),a("./_set-species")(q),d=a("./_core")[q],i(i.S+i.F*!w,q,{reject:function(a){var b=z(this),c=b.reject;return c(a),b.promise}}),i(i.S+i.F*(e||!w),q,{resolve:function(a){if(a instanceof t&&x(a.constructor,this))return a;var b=z(this),c=b.resolve;return c(a),b.promise}}),i(i.S+i.F*!(w&&a("./_iter-detect")(function(a){t.all(a).catch(v)})),q,{all:function(a){var b=this,c=z(b),d=c.resolve,e=c.reject,f=B(function(){var c=[],f=0,g=1;m(a,!1,function(a){var h=f++,i=!1;c.push(void 0),g++,b.resolve(a).then(function(a){i||(i=!0,c[h]=a,--g||d(c))},e)}),--g||d(c)});return f&&e(f.error),c.promise},race:function(a){var b=this,c=z(b),d=c.reject,e=B(function(){m(a,!1,function(a){b.resolve(a).then(c.resolve,d)})});return e&&d(e.error),c.promise}})},{"./_a-function":7,"./_an-instance":9,"./_classof":12,"./_core":14,"./_ctx":15,"./_export":20,"./_for-of":22,"./_global":23,"./_is-object":31,"./_iter-detect":35,"./_library":38,"./_microtask":39,"./_redefine-all":47,"./_set-species":49,"./_set-to-string-tag":50,"./_species-constructor":53,"./_task":55,"./_wks":63}],68:[function(a){"use strict";var b=a("./_string-at")(!0);a("./_iter-define")(String,"String",function(a){this._t=String(a),this._i=0},function(){var a,c=this._t,d=this._i;return d>=c.length?{value:void 0,done:!0}:(a=b(c,d),this._i+=a.length,{value:a,done:!1})})},{"./_iter-define":34,"./_string-at":54}],69:[function(a){for(var b=a("./es6.array.iterator"),c=a("./_redefine"),d=a("./_global"),e=a("./_hide"),f=a("./_iterators"),g=a("./_wks"),h=g("iterator"),i=g("toStringTag"),j=f.Array,k=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],l=0;5>l;l++){var m,n=k[l],o=d[n],p=o&&o.prototype;if(p){p[h]||e(p,h,j),p[i]||e(p,i,n),f[n]=j;for(m in b)p[m]||c(p,m,b[m],!0)}}},{"./_global":23,"./_hide":25,"./_iterators":37,"./_redefine":48,"./_wks":63,"./es6.array.iterator":65}],70:[function(a,b,c){(function(a){function b(a){return Array.isArray?Array.isArray(a):"[object Array]"===q(a)}function d(a){return"boolean"==typeof a}function e(a){return null===a}function f(a){return null==a}function g(a){return"number"==typeof a}function h(a){return"string"==typeof a}function i(a){return"symbol"==typeof a}function j(a){return void 0===a}function k(a){return"[object RegExp]"===q(a)}function l(a){return"object"==typeof a&&null!==a}function m(a){return"[object Date]"===q(a)}function n(a){return"[object Error]"===q(a)||a instanceof Error}function o(a){return"function"==typeof a}function p(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function q(a){return Object.prototype.toString.call(a)}c.isArray=b,c.isBoolean=d,c.isNull=e,c.isNullOrUndefined=f,c.isNumber=g,c.isString=h,c.isSymbol=i,c.isUndefined=j,c.isRegExp=k,c.isObject=l,c.isDate=m,c.isError=n,c.isFunction=o,c.isPrimitive=p,c.isBuffer=a.isBuffer}).call(this,{isBuffer:a("../../is-buffer/index.js")})},{"../../is-buffer/index.js":95}],71:[function(a,b,c){function d(a){return a=Math.round(a),0>a?0:a>255?255:a}function e(a){return 0>a?0:a>1?1:a}function f(a){return d("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function g(a){return e("%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))}function h(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a}function i(a){var b=a.replace(/ /g,"").toLowerCase();if(b in j)return j[b].slice();if("#"===b[0]){if(4===b.length){var c=parseInt(b.substr(1),16);return c>=0&&4095>=c?[(3840&c)>>4|(3840&c)>>8,240&c|(240&c)>>4,15&c|(15&c)<<4,1]:null}if(7===b.length){var c=parseInt(b.substr(1),16);return c>=0&&16777215>=c?[(16711680&c)>>16,(65280&c)>>8,255&c,1]:null}return null}var e=b.indexOf("("),i=b.indexOf(")");if(-1!==e&&i+1===b.length){var k=b.substr(0,e),l=b.substr(e+1,i-(e+1)).split(","),m=1;switch(k){case"rgba":if(4!==l.length)return null;m=g(l.pop());case"rgb":return 3!==l.length?null:[f(l[0]),f(l[1]),f(l[2]),m];case"hsla":if(4!==l.length)return null;m=g(l.pop());case"hsl":if(3!==l.length)return null;var n=(parseFloat(l[0])%360+360)%360/360,o=g(l[1]),p=g(l[2]),q=.5>=p?p*(o+1):p+o-p*o,r=2*p-q;return[d(255*h(r,q,n+1/3)),d(255*h(r,q,n)),d(255*h(r,q,n-1/3)),m];default:return null}}return null}var j={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{c.parseCSSColor=i}catch(a){}},{}],72:[function(a,b){"use strict";function c(a,b,c){c=c||2;var e=b&&b.length,g=e?b[0]*c:a.length,h=d(a,0,g,c,!0),i=[];if(!h)return i;var j,l,m,n,o,p,q;if(e&&(h=k(a,b,h,c)),a.length>80*c){j=m=a[0],l=n=a[1];for(var r=c;g>r;r+=c)o=a[r],p=a[r+1],j>o&&(j=o),l>p&&(l=p),o>m&&(m=o),p>n&&(n=p);q=Math.max(m-j,n-l)}return f(h,i,c,j,l,q),i}function d(a,b,c,d,e){var f,g;if(e===E(a,b,c,d)>0)for(f=b;c>f;f+=d)g=B(f,a[f],a[f+1],g);else for(f=c-d;f>=b;f-=d)g=B(f,a[f],a[f+1],g);return g&&v(g,g.next)&&(C(g),g=g.next),g}function e(a,b){if(!a)return a;b||(b=a);var c,d=a;do if(c=!1,d.steiner||!v(d,d.next)&&0!==u(d.prev,d,d.next))d=d.next;else{if(C(d),d=b=d.prev,d===d.next)return null;c=!0}while(c||d!==b);return b}function f(a,b,c,d,k,l,m){if(a){!m&&l&&o(a,d,k,l);for(var n,p,q=a;a.prev!==a.next;)if(n=a.prev,p=a.next,l?h(a,d,k,l):g(a))b.push(n.i/c),b.push(a.i/c),b.push(p.i/c),C(a),a=p.next,q=p.next;else if(a=p,a===q){m?1===m?(a=i(a,b,c),f(a,b,c,d,k,l,2)):2===m&&j(a,b,c,d,k,l):f(e(a),b,c,d,k,l,1);break}}}function g(a){var b=a.prev,c=a,d=a.next;if(u(b,c,d)>=0)return!1;for(var e=a.next.next;e!==a.prev;){if(s(b.x,b.y,c.x,c.y,d.x,d.y,e.x,e.y)&&u(e.prev,e,e.next)>=0)return!1;e=e.next}return!0}function h(a,b,c,d){var e=a.prev,f=a,g=a.next;if(u(e,f,g)>=0)return!1;for(var h=e.x<f.x?e.x<g.x?e.x:g.x:f.x<g.x?f.x:g.x,i=e.y<f.y?e.y<g.y?e.y:g.y:f.y<g.y?f.y:g.y,j=e.x>f.x?e.x>g.x?e.x:g.x:f.x>g.x?f.x:g.x,k=e.y>f.y?e.y>g.y?e.y:g.y:f.y>g.y?f.y:g.y,l=q(h,i,b,c,d),m=q(j,k,b,c,d),n=a.nextZ;n&&n.z<=m;){if(n!==a.prev&&n!==a.next&&s(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&u(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(n=a.prevZ;n&&n.z>=l;){if(n!==a.prev&&n!==a.next&&s(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&u(n.prev,n,n.next)>=0)return!1;n=n.prevZ}return!0}function i(a,b,c){var d=a;do{var e=d.prev,f=d.next.next;!v(e,f)&&w(e,d,d.next,f)&&y(e,f)&&y(f,e)&&(b.push(e.i/c),b.push(d.i/c),b.push(f.i/c),C(d),C(d.next),d=a=f),d=d.next}while(d!==a);return d}function j(a,b,c,d,g,h){var i=a;do{for(var j=i.next.next;j!==i.prev;){if(i.i!==j.i&&t(i,j)){var k=A(i,j);return i=e(i,i.next),k=e(k,k.next),f(i,b,c,d,g,h),void f(k,b,c,d,g,h)}j=j.next}i=i.next}while(i!==a)}function k(a,b,c,f){var g,h,i,j,k,n=[];for(g=0,h=b.length;h>g;g++)i=b[g]*f,j=h-1>g?b[g+1]*f:a.length,k=d(a,i,j,f,!1),k===k.next&&(k.steiner=!0),n.push(r(k));for(n.sort(l),g=0;g<n.length;g++)m(n[g],c),c=e(c,c.next);return c}function l(a,b){return a.x-b.x}function m(a,b){if(b=n(a,b)){var c=A(b,a);e(c,c.next)}}function n(a,b){var c,d=b,e=a.x,f=a.y,g=-1/0;do{if(f<=d.y&&f>=d.next.y){var h=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(e>=h&&h>g){if(g=h,h===e){if(f===d.y)return d;if(f===d.next.y)return d.next}c=d.x<d.next.x?d:d.next}}d=d.next}while(d!==b);if(!c)return null;if(e===g)return c.prev;var i,j=c,k=c.x,l=c.y,m=1/0;for(d=c.next;d!==j;)e>=d.x&&d.x>=k&&s(l>f?e:g,f,k,l,l>f?g:e,f,d.x,d.y)&&(i=Math.abs(f-d.y)/(e-d.x),(m>i||i===m&&d.x>c.x)&&y(d,a)&&(c=d,m=i)),d=d.next;return c}function o(a,b,c,d){var e=a;do null===e.z&&(e.z=q(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==a);e.prevZ.nextZ=null,e.prevZ=null,p(e)}function p(a){var b,c,d,e,f,g,h,i,j=1;do{for(c=a,a=null,f=null,g=0;c;){for(g++,d=c,h=0,b=0;j>b&&(h++,d=d.nextZ);b++);for(i=j;h>0||i>0&&d;)0===h?(e=d,d=d.nextZ,i--):0!==i&&d?c.z<=d.z?(e=c,c=c.nextZ,h--):(e=d,d=d.nextZ,i--):(e=c,c=c.nextZ,h--),f?f.nextZ=e:a=e,e.prevZ=f,f=e;c=d}f.nextZ=null,j*=2}while(g>1);return a}function q(a,b,c,d,e){return a=32767*(a-c)/e,b=32767*(b-d)/e,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1}function r(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function s(a,b,c,d,e,f,g,h){return(e-g)*(b-h)-(a-g)*(f-h)>=0&&(a-g)*(d-h)-(c-g)*(b-h)>=0&&(c-g)*(f-h)-(e-g)*(d-h)>=0}function t(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!x(a,b)&&y(a,b)&&y(b,a)&&z(a,b)}function u(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function v(a,b){return a.x===b.x&&a.y===b.y}function w(a,b,c,d){return!!(v(a,b)&&v(c,d)||v(a,d)&&v(c,b))||u(a,b,c)>0!=u(a,b,d)>0&&u(c,d,a)>0!=u(c,d,b)>0}function x(a,b){var c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&w(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1}function y(a,b){return u(a.prev,a,a.next)<0?u(a,b,a.next)>=0&&u(a,a.prev,b)>=0:u(a,b,a.prev)<0||u(a,a.next,b)<0}function z(a,b){var c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;do c.y>f!=c.next.y>f&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==a);return d}function A(a,b){var c=new D(a.i,a.x,a.y),d=new D(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function B(a,b,c,d){var e=new D(a,b,c);return d?(e.next=d.next,e.prev=d,d.next.prev=e,d.next=e):(e.prev=e,e.next=e),e}function C(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function D(a,b,c){this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(a,b,c,d){for(var e=0,f=b,g=c-d;c>f;f+=d)e+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;return e}b.exports=c,c.deviation=function(a,b,c,d){var e=b&&b.length,f=e?b[0]*c:a.length,g=Math.abs(E(a,0,f,c));if(e)for(var h=0,i=b.length;i>h;h++){var j=b[h]*c,k=i-1>h?b[h+1]*c:a.length;g-=Math.abs(E(a,j,k,c))}var l=0;for(h=0;h<d.length;h+=3){var m=d[h]*c,n=d[h+1]*c,o=d[h+2]*c;l+=Math.abs((a[m]-a[o])*(a[n+1]-a[m+1])-(a[m]-a[n])*(a[o+1]-a[m+1]))}return 0===g&&0===l?0:Math.abs((l-g)/g)},c.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var f=0;f<a[e].length;f++)for(var g=0;b>g;g++)c.vertices.push(a[e][f][g]);e>0&&(d+=a[e-1].length,c.holes.push(d))}return c}},{}],73:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),c.apply(this,h)}else if(f(c))for(h=Array.prototype.slice.call(arguments,1),j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h);return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned&&(e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(d(b))return 1;if(b)return b.length}return 0},c.listenerCount=function(a,b){return a.listenerCount(b)}},{}],74:[function(a,b){!function(){function a(a,b){document.addEventListener?a.addEventListener("scroll",b,!1):a.attachEvent("scroll",b)}function c(a){document.body?a():document.addEventListener?document.addEventListener("DOMContentLoaded",function b(){document.removeEventListener("DOMContentLoaded",b),a()}):document.attachEvent("onreadystatechange",function b(){("interactive"==document.readyState||"complete"==document.readyState)&&(document.detachEvent("onreadystatechange",b),a())})}function d(a){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(a)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function e(a,b){a.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+b+";"}function f(a){var b=a.a.offsetWidth,c=b+100;return a.f.style.width=c+"px",a.c.scrollLeft=c,a.b.scrollLeft=a.b.scrollWidth+100,a.g!==b&&(a.g=b,!0)}function g(b,c){function d(){var a=e;f(a)&&a.a.parentNode&&c(a.g)}var e=b;a(b.b,d),a(b.c,d),f(b)}function h(a,b){var c=b||{};this.family=a,this.style=c.style||"normal",this.weight=c.weight||"normal",this.stretch=c.stretch||"normal"}function i(){if(null===m){var a=document.createElement("div");try{a.style.font="condensed 100px sans-serif"}catch(a){}m=""!==a.style.font}return m}function j(a,b){return[a.style,a.weight,i()?a.stretch:"","100px",b].join(" ")}var k=null,l=null,m=null,n=null;h.prototype.load=function(a,b){var f=this,h=a||"BESbswy",i=0,m=b||3e3,o=(new Date).getTime();return new Promise(function(a,b){var p;if(null===n&&(n=!!document.fonts),(p=n)&&(null===l&&(l=/OS X.*Version\/10\..*Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),p=!l),p){p=new Promise(function(a,b){function c(){(new Date).getTime()-o>=m?b():document.fonts.load(j(f,'"'+f.family+'"'),h).then(function(b){1<=b.length?a():setTimeout(c,25)},function(){b()})}c()});var q=new Promise(function(a,b){i=setTimeout(b,m)});Promise.race([q,p]).then(function(){clearTimeout(i),a(f)},function(){b(f)})}else c(function(){function c(){var b;(b=-1!=r&&-1!=s||-1!=r&&-1!=t||-1!=s&&-1!=t)&&((b=r!=s&&r!=t&&s!=t)||(null===k&&(b=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),k=!!b&&(536>parseInt(b[1],10)||536===parseInt(b[1],10)&&11>=parseInt(b[2],10))),b=k&&(r==u&&s==u&&t==u||r==v&&s==v&&t==v||r==w&&s==w&&t==w)),b=!b),b&&(x.parentNode&&x.parentNode.removeChild(x),clearTimeout(i),a(f))}function l(){if((new Date).getTime()-o>=m)x.parentNode&&x.parentNode.removeChild(x),b(f);else{var a=document.hidden;(!0===a||void 0===a)&&(r=n.a.offsetWidth,s=p.a.offsetWidth,t=q.a.offsetWidth,c()),i=setTimeout(l,50)}}var n=new d(h),p=new d(h),q=new d(h),r=-1,s=-1,t=-1,u=-1,v=-1,w=-1,x=document.createElement("div");x.dir="ltr",e(n,j(f,"sans-serif")),e(p,j(f,"serif")),e(q,j(f,"monospace")),x.appendChild(n.a),x.appendChild(p.a),x.appendChild(q.a),document.body.appendChild(x),u=n.a.offsetWidth,v=p.a.offsetWidth,w=q.a.offsetWidth,l(),g(n,function(a){r=a,c()}),e(n,j(f,'"'+f.family+'",sans-serif')),g(p,function(a){s=a,c()}),e(p,j(f,'"'+f.family+'",serif')),g(q,function(a){t=a,c()}),e(q,j(f,'"'+f.family+'",monospace'))})})},"undefined"!=typeof b?b.exports=h:(window.FontFaceObserver=h,window.FontFaceObserver.prototype.load=h.prototype.load)}()},{}],75:[function(a,b){"use strict";function c(a,b,c,f,h,i,j,k){if(c/=b,f/=b,j>=c&&f>=k)return a;if(j>f||c>k)return null;for(var l=[],m=0;m<a.length;m++){var n,o,p=a[m],q=p.geometry,r=p.type;if(n=p.min[h],o=p.max[h],n>=c&&f>=o)l.push(p);else if(!(n>f||c>o)){var s=1===r?d(q,c,f,h):e(q,c,f,h,i,3===r);s.length&&l.push(g(p.tags,r,s,p.id))}}return l.length?l:null}function d(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=g[d];h>=b&&c>=h&&e.push(g)}return e}function e(a,b,c,d,e,g){for(var h=[],i=0;i<a.length;i++){var j,k,l,m=0,n=0,o=null,p=a[i],q=p.area,r=p.dist,s=p.outer,t=p.length,u=[];for(k=0;t-1>k;k++)j=o||p[k],o=p[k+1],m=n||j[d],n=o[d],b>m?n>c?(u.push(e(j,o,b),e(j,o,c)),g||(u=f(h,u,q,r,s))):n>=b&&u.push(e(j,o,b)):m>c?b>n?(u.push(e(j,o,c),e(j,o,b)),
g||(u=f(h,u,q,r,s))):c>=n&&u.push(e(j,o,c)):(u.push(j),b>n?(u.push(e(j,o,b)),g||(u=f(h,u,q,r,s))):n>c&&(u.push(e(j,o,c)),g||(u=f(h,u,q,r,s))));j=p[t-1],m=j[d],m>=b&&c>=m&&u.push(j),l=u[u.length-1],g&&l&&(u[0][0]!==l[0]||u[0][1]!==l[1])&&u.push(u[0]),f(h,u,q,r,s)}return h}function f(a,b,c,d,e){return b.length&&(b.area=c,b.dist=d,void 0!==e&&(b.outer=e),a.push(b)),[]}b.exports=c;var g=a("./feature")},{"./feature":77}],76:[function(a,b){"use strict";function c(a,b){var c=[];if("FeatureCollection"===a.type)for(var e=0;e<a.features.length;e++)d(c,a.features[e],b);else"Feature"===a.type?d(c,a,b):d(c,{geometry:a},b);return c}function d(a,b,c){if(null!==b.geometry){var g,h,j,k,l=b.geometry,m=l.type,n=l.coordinates,o=b.properties,p=b.id;if("Point"===m)a.push(i(o,1,[f(n)],p));else if("MultiPoint"===m)a.push(i(o,1,e(n),p));else if("LineString"===m)a.push(i(o,2,[e(n,c)],p));else if("MultiLineString"===m||"Polygon"===m){for(j=[],g=0;g<n.length;g++)k=e(n[g],c),"Polygon"===m&&(k.outer=0===g),j.push(k);a.push(i(o,"Polygon"===m?3:2,j,p))}else if("MultiPolygon"===m){for(j=[],g=0;g<n.length;g++)for(h=0;h<n[g].length;h++)k=e(n[g][h],c),k.outer=0===h,j.push(k);a.push(i(o,3,j,p))}else{if("GeometryCollection"!==m)throw new Error("Input data is not a valid GeoJSON object.");for(g=0;g<l.geometries.length;g++)d(a,{geometry:l.geometries[g],properties:o},c)}}}function e(a,b){for(var c=[],d=0;d<a.length;d++)c.push(f(a[d]));return b&&(h(c,b),g(c)),c}function f(a){var b=Math.sin(a[1]*Math.PI/180),c=a[0]/360+.5,d=.5-.25*Math.log((1+b)/(1-b))/Math.PI;return d=0>d?0:d>1?1:d,[c,d,0]}function g(a){for(var b,c,d=0,e=0,f=0;f<a.length-1;f++)b=c||a[f],c=a[f+1],d+=b[0]*c[1]-c[0]*b[1],e+=Math.abs(c[0]-b[0])+Math.abs(c[1]-b[1]);a.area=Math.abs(d/2),a.dist=e}b.exports=c;var h=a("./simplify"),i=a("./feature")},{"./feature":77,"./simplify":79}],77:[function(a,b){"use strict";function c(a,b,c,e){var f={id:e||null,type:b,geometry:c,tags:a||null,min:[1/0,1/0],max:[-1/0,-1/0]};return d(f),f}function d(a){var b=a.geometry,c=a.min,d=a.max;if(1===a.type)e(c,d,b);else for(var f=0;f<b.length;f++)e(c,d,b[f]);return a}function e(a,b,c){for(var d,e=0;e<c.length;e++)d=c[e],a[0]=Math.min(d[0],a[0]),b[0]=Math.max(d[0],b[0]),a[1]=Math.min(d[1],a[1]),b[1]=Math.max(d[1],b[1])}b.exports=c},{}],78:[function(a,b){"use strict";function c(a,b){return new d(a,b)}function d(a,b){b=this.options=h(Object.create(this.options),b);var c=b.debug;c&&console.time("preprocess data");var d=1<<b.maxZoom,e=j(a,b.tolerance/(d*b.extent));this.tiles={},this.tileCoords=[],c&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",b.indexMaxZoom,b.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),e=m(e,b.buffer/b.extent,f),e.length&&this.splitTile(e,0,0,0),c&&(e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function e(a,b,c){return 32*((1<<a)*c+b)+a}function f(a,b,c){return[c,(c-a[0])*(b[1]-a[1])/(b[0]-a[0])+a[1],1]}function g(a,b,c){return[(c-a[1])*(b[0]-a[0])/(b[1]-a[1])+a[0],c,1]}function h(a,b){for(var c in b)a[c]=b[c];return a}function i(a,b,c){var d=a.source;if(1!==d.length)return!1;var e=d[0];if(3!==e.type||e.geometry.length>1)return!1;var f=e.geometry[0].length;if(5!==f)return!1;for(var g=0;f>g;g++){var h=k.point(e.geometry[0][g],b,a.z2,a.x,a.y);if(h[0]!==-c&&h[0]!==b+c||h[1]!==-c&&h[1]!==b+c)return!1}return!0}b.exports=c;var j=a("./convert"),k=a("./transform"),l=a("./clip"),m=a("./wrap"),n=a("./tile");d.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},d.prototype.splitTile=function(a,b,c,d,h,j,k){for(var m=[a,b,c,d],o=this.options,p=o.debug,q=null;m.length;){d=m.pop(),c=m.pop(),b=m.pop(),a=m.pop();var r=1<<b,s=e(b,c,d),t=this.tiles[s],u=b===o.maxZoom?0:o.tolerance/(r*o.extent);if(!t&&(p>1&&console.time("creation"),t=this.tiles[s]=n(a,r,c,d,u,b===o.maxZoom),this.tileCoords.push({z:b,x:c,y:d}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",b,c,d,t.numFeatures,t.numPoints,t.numSimplified),console.timeEnd("creation"));var v="z"+b;this.stats[v]=(this.stats[v]||0)+1,this.total++}if(t.source=a,h){if(b===o.maxZoom||b===h)continue;var w=1<<h-b;if(c!==Math.floor(j/w)||d!==Math.floor(k/w))continue}else if(b===o.indexMaxZoom||t.numPoints<=o.indexMaxPoints)continue;if(o.solidChildren||!i(t,o.extent,o.buffer)){t.source=null,p>1&&console.time("clipping");var x,y,z,A,B,C,D=.5*o.buffer/o.extent,E=.5-D,F=.5+D,G=1+D;x=y=z=A=null,B=l(a,r,c-D,c+F,0,f,t.min[0],t.max[0]),C=l(a,r,c+E,c+G,0,f,t.min[0],t.max[0]),B&&(x=l(B,r,d-D,d+F,1,g,t.min[1],t.max[1]),y=l(B,r,d+E,d+G,1,g,t.min[1],t.max[1])),C&&(z=l(C,r,d-D,d+F,1,g,t.min[1],t.max[1]),A=l(C,r,d+E,d+G,1,g,t.min[1],t.max[1])),p>1&&console.timeEnd("clipping"),a.length&&(m.push(x||[],b+1,2*c,2*d),m.push(y||[],b+1,2*c,2*d+1),m.push(z||[],b+1,2*c+1,2*d),m.push(A||[],b+1,2*c+1,2*d+1))}else h&&(q=b)}return q},d.prototype.getTile=function(a,b,c){var d=this.options,f=d.extent,g=d.debug,h=1<<a;b=(b%h+h)%h;var j=e(a,b,c);if(this.tiles[j])return k.tile(this.tiles[j],f);g>1&&console.log("drilling down to z%d-%d-%d",a,b,c);for(var l,m=a,n=b,o=c;!l&&m>0;)m--,n=Math.floor(n/2),o=Math.floor(o/2),l=this.tiles[e(m,n,o)];if(!l||!l.source)return null;if(g>1&&console.log("found parent tile z%d-%d-%d",m,n,o),i(l,f,d.buffer))return k.tile(l,f);g>1&&console.time("drilling down");var p=this.splitTile(l.source,m,n,o,a,b,c);if(g>1&&console.timeEnd("drilling down"),null!==p){var q=1<<a-p;j=e(p,Math.floor(b/q),Math.floor(c/q))}return this.tiles[j]?k.tile(this.tiles[j],f):null}},{"./clip":75,"./convert":76,"./tile":80,"./transform":81,"./wrap":82}],79:[function(a,b){"use strict";function c(a,b){var c,e,f,g,h=b*b,i=a.length,j=0,k=i-1,l=[];for(a[j][2]=1,a[k][2]=1;k;){for(e=0,c=j+1;k>c;c++)f=d(a[c],a[j],a[k]),f>e&&(g=c,e=f);e>h?(a[g][2]=e,l.push(j),l.push(g),j=g):(k=l.pop(),j=l.pop())}}function d(a,b,c){var d=b[0],e=b[1],f=c[0],g=c[1],h=a[0],i=a[1],j=f-d,k=g-e;if(0!==j||0!==k){var l=((h-d)*j+(i-e)*k)/(j*j+k*k);l>1?(d=f,e=g):l>0&&(d+=j*l,e+=k*l)}return j=h-d,k=i-e,j*j+k*k}b.exports=c},{}],80:[function(a,b){"use strict";function c(a,b,c,e,f,g){for(var h={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:c,y:e,z2:b,transformed:!1,min:[2,1],max:[-1,0]},i=0;i<a.length;i++){h.numFeatures++,d(h,a[i],f,g);var j=a[i].min,k=a[i].max;j[0]<h.min[0]&&(h.min[0]=j[0]),j[1]<h.min[1]&&(h.min[1]=j[1]),k[0]>h.max[0]&&(h.max[0]=k[0]),k[1]>h.max[1]&&(h.max[1]=k[1])}return h}function d(a,b,c,d){var f,g,h,i,j=b.geometry,k=b.type,l=[],m=c*c;if(1===k)for(f=0;f<j.length;f++)l.push(j[f]),a.numPoints++,a.numSimplified++;else for(f=0;f<j.length;f++)if(h=j[f],d||!(2===k&&h.dist<c||3===k&&h.area<m)){var n=[];for(g=0;g<h.length;g++)i=h[g],(d||i[2]>m)&&(n.push(i),a.numSimplified++),a.numPoints++;3===k&&e(n,h.outer),l.push(n)}else a.numPoints+=h.length;if(l.length){var o={geometry:l,type:k,tags:b.tags||null};null!==b.id&&(o.id=b.id),a.features.push(o)}}function e(a,b){var c=f(a);0>c===b&&a.reverse()}function f(a){for(var b,c,d=0,e=0,f=a.length,g=f-1;f>e;g=e++)b=a[e],c=a[g],d+=(c[0]-b[0])*(b[1]+c[1]);return d}b.exports=c},{}],81:[function(a,b,c){"use strict";function d(a,b){if(a.transformed)return a;var c,d,f,g=a.z2,h=a.x,i=a.y;for(c=0;c<a.features.length;c++){var j=a.features[c],k=j.geometry,l=j.type;if(1===l)for(d=0;d<k.length;d++)k[d]=e(k[d],b,g,h,i);else for(d=0;d<k.length;d++){var m=k[d];for(f=0;f<m.length;f++)m[f]=e(m[f],b,g,h,i)}}return a.transformed=!0,a}function e(a,b,c,d,e){var f=Math.round(b*(a[0]*c-d)),g=Math.round(b*(a[1]*c-e));return[f,g]}c.tile=d,c.point=e},{}],82:[function(a,b){"use strict";function c(a,b,c){var e=a,g=f(a,1,-1-b,b,0,c,-1,2),h=f(a,1,1-b,2+b,0,c,-1,2);return(g||h)&&(e=f(a,1,-b,1+b,0,c,-1,2)||[],g&&(e=d(g,1).concat(e)),h&&(e=e.concat(d(h,-1)))),e}function d(a,b){for(var c=[],d=0;d<a.length;d++){var f,h=a[d],i=h.type;if(1===i)f=e(h.geometry,b);else{f=[];for(var j=0;j<h.geometry.length;j++)f.push(e(h.geometry[j],b))}c.push(g(h.tags,i,f,h.id))}return c}function e(a,b){var c=[];c.area=a.area,c.dist=a.dist;for(var d=0;d<a.length;d++)c.push([a[d][0]+b,a[d][1],a[d][2]]);return c}var f=a("./clip"),g=a("./feature");b.exports=c},{"./clip":75,"./feature":77}],83:[function(a,b){function c(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null}b.exports=c},{}],84:[function(a,b){function c(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null}b.exports=c},{}],85:[function(a,b){function c(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a}b.exports=c},{}],86:[function(a,b){function c(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}b.exports=c},{}],87:[function(a,b){function c(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p=b[0],q=b[1],r=b[2],s=e[0],t=e[1],u=e[2],v=c[0],w=c[1],x=c[2];return Math.abs(p-v)<1e-6&&Math.abs(q-w)<1e-6&&Math.abs(r-x)<1e-6?d(a):(l=p-v,m=q-w,n=r-x,o=1/Math.sqrt(l*l+m*m+n*n),l*=o,m*=o,n*=o,f=t*n-u*m,g=u*l-s*n,h=s*m-t*l,o=Math.sqrt(f*f+g*g+h*h),o?(o=1/o,f*=o,g*=o,h*=o):(f=0,g=0,h=0),i=m*h-n*g,j=n*f-l*h,k=l*g-m*f,o=Math.sqrt(i*i+j*j+k*k),o?(o=1/o,i*=o,j*=o,k*=o):(i=0,j=0,k=0),a[0]=f,a[1]=i,a[2]=l,a[3]=0,a[4]=g,a[5]=j,a[6]=m,a[7]=0,a[8]=h,a[9]=k,a[10]=n,a[11]=0,a[12]=-(f*p+g*q+h*r),a[13]=-(i*p+j*q+k*r),a[14]=-(l*p+m*q+n*r),a[15]=1,a)}var d=a("./identity");b.exports=c},{"./identity":86}],88:[function(a,b){function c(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a}b.exports=c},{}],89:[function(a,b){function c(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a}b.exports=c},{}],90:[function(a,b){function c(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a}b.exports=c},{}],91:[function(a,b){function c(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a}b.exports=c},{}],92:[function(a,b){function c(a){a=String(a);for(var b,c=[];b=a.match(/ERROR\:([^\n]+)/);){a=a.slice(b.index+1);var d=b[1].trim(),e=d.split(":"),f=e.slice(2).join(":").trim(),g=parseInt(e[0],10),d=parseInt(e[1],10);c.push({message:f,file:g,line:d})}return c}b.exports=c},{}],93:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||1/0===b?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],94:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],95:[function(a,b){function c(a){return!!a.constructor&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}function d(a){return"function"==typeof a.readFloatLE&&"function"==typeof a.slice&&c(a.slice(0,0))}b.exports=function(a){return null!=a&&(c(a)||d(a)||!!a._isBuffer)}},{}],96:[function(a,b){var c={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==c.call(a)}},{}],97:[function(a,b){"use strict";var c=a("./lib/js-yaml.js");b.exports=c},{"./lib/js-yaml.js":98}],98:[function(a,b){"use strict";function c(a){return function(){throw new Error("Function "+a+" is deprecated and cannot be used.")}}var d=a("./js-yaml/loader");b.exports.Type=a("./js-yaml/type"),b.exports.Schema=a("./js-yaml/schema"),b.exports.FAILSAFE_SCHEMA=a("./js-yaml/schema/failsafe"),b.exports.JSON_SCHEMA=a("./js-yaml/schema/json"),b.exports.CORE_SCHEMA=a("./js-yaml/schema/core"),b.exports.DEFAULT_SAFE_SCHEMA=a("./js-yaml/schema/default_safe"),b.exports.DEFAULT_FULL_SCHEMA=a("./js-yaml/schema/default_full"),b.exports.load=d.load,b.exports.loadAll=d.loadAll,b.exports.safeLoad=d.safeLoad,b.exports.safeLoadAll=d.safeLoadAll,b.exports.YAMLException=a("./js-yaml/exception"),b.exports.MINIMAL_SCHEMA=a("./js-yaml/schema/failsafe"),b.exports.SAFE_SCHEMA=a("./js-yaml/schema/default_safe"),b.exports.DEFAULT_SCHEMA=a("./js-yaml/schema/default_full"),b.exports.scan=c("scan"),b.exports.parse=c("parse"),b.exports.compose=c("compose"),b.exports.addConstructor=c("addConstructor")},{"./js-yaml/exception":100,"./js-yaml/loader":101,"./js-yaml/schema":103,"./js-yaml/schema/core":104,"./js-yaml/schema/default_full":105,"./js-yaml/schema/default_safe":106,"./js-yaml/schema/failsafe":107,"./js-yaml/schema/json":108,"./js-yaml/type":109}],99:[function(a,b){"use strict";function c(a){return"undefined"==typeof a||null===a}function d(a){return"object"==typeof a&&null!==a}function e(a){return Array.isArray(a)?a:c(a)?[]:[a]}function f(a,b){var c,d,e,f;if(b)for(f=Object.keys(b),c=0,d=f.length;d>c;c+=1)e=f[c],a[e]=b[e];return a}function g(a,b){var c,d="";for(c=0;b>c;c+=1)d+=a;return d}function h(a){return 0===a&&Number.NEGATIVE_INFINITY===1/a}b.exports.isNothing=c,b.exports.isObject=d,b.exports.toArray=e,b.exports.repeat=g,b.exports.isNegativeZero=h,b.exports.extend=f},{}],100:[function(a,b){"use strict";function c(a,b){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||"",this.name="YAMLException",this.reason=a,this.mark=b,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c.prototype.toString=function(a){var b=this.name+": ";return b+=this.reason||"(unknown reason)",!a&&this.mark&&(b+=" "+this.mark.toString()),b},b.exports=c},{}],101:[function(a,b){"use strict";function c(a){return 10===a||13===a}function d(a){return 9===a||32===a}function e(a){return 9===a||32===a||10===a||13===a}function f(a){return 44===a||91===a||93===a||123===a||125===a}function g(a){var b;return a>=48&&57>=a?a-48:(b=32|a,b>=97&&102>=b?b-97+10:-1)}function h(a){return 120===a?2:117===a?4:85===a?8:0}function i(a){return a>=48&&57>=a?a-48:-1}function j(a){return 48===a?"\0":97===a?"":98===a?"\b":116===a?"\t":9===a?"\t":110===a?"\n":118===a?"\v":102===a?"\f":114===a?"\r":101===a?"":32===a?" ":34===a?'"':47===a?"/":92===a?"\\":78===a?"":95===a?"":76===a?"\u2028":80===a?"\u2029":""}function k(a){return 65535>=a?String.fromCharCode(a):String.fromCharCode((a-65536>>10)+55296,(a-65536&1023)+56320)}function l(a,b){this.input=a,this.filename=b.filename||null,this.schema=b.schema||R,this.onWarning=b.onWarning||null,this.legacy=b.legacy||!1,this.json=b.json||!1,this.listener=b.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=a.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function m(a,b){return new O(b,new P(a.filename,a.input,a.position,a.line,a.position-a.lineStart))}function n(a,b){throw m(a,b)}function o(a,b){a.onWarning&&a.onWarning.call(null,m(a,b))}function p(a,b,c,d){var e,f,g,h;if(c>b){if(h=a.input.slice(b,c),d)for(e=0,f=h.length;f>e;e+=1)g=h.charCodeAt(e),9===g||g>=32&&1114111>=g||n(a,"expected valid JSON character");else $.test(h)&&n(a,"the stream contains non-printable characters");a.result+=h}}function q(a,b,c,d){var e,f,g,h;for(N.isObject(c)||n(a,"cannot merge mappings; the provided source object is unacceptable"),e=Object.keys(c),g=0,h=e.length;h>g;g+=1)f=e[g],S.call(b,f)||(b[f]=c[f],d[f]=!0)}function r(a,b,c,d,e,f){var g,h;if(e=String(e),null===b&&(b={}),"tag:yaml.org,2002:merge"===d)if(Array.isArray(f))for(g=0,h=f.length;h>g;g+=1)q(a,b,f[g],c);else q(a,b,f,c);else a.json||S.call(c,e)||!S.call(b,e)||n(a,"duplicated mapping key"),b[e]=f,delete c[e];return b}function s(a){var b;b=a.input.charCodeAt(a.position),10===b?a.position++:13===b?(a.position++,10===a.input.charCodeAt(a.position)&&a.position++):n(a,"a line break is expected"),a.line+=1,a.lineStart=a.position}function t(a,b,e){for(var f=0,g=a.input.charCodeAt(a.position);0!==g;){for(;d(g);)g=a.input.charCodeAt(++a.position);if(b&&35===g)do g=a.input.charCodeAt(++a.position);while(10!==g&&13!==g&&0!==g);if(!c(g))break;for(s(a),g=a.input.charCodeAt(a.position),f++,a.lineIndent=0;32===g;)a.lineIndent++,g=a.input.charCodeAt(++a.position)}return-1!==e&&0!==f&&a.lineIndent<e&&o(a,"deficient indentation"),f}function u(a){var b,c=a.position;return b=a.input.charCodeAt(c),!(45!==b&&46!==b||b!==a.input.charCodeAt(c+1)||b!==a.input.charCodeAt(c+2)||(c+=3,b=a.input.charCodeAt(c),0!==b&&!e(b)))}function v(a,b){1===b?a.result+=" ":b>1&&(a.result+=N.repeat("\n",b-1))}function w(a,b,g){var h,i,j,k,l,m,n,o,q,r=a.kind,s=a.result;if(q=a.input.charCodeAt(a.position),e(q)||f(q)||35===q||38===q||42===q||33===q||124===q||62===q||39===q||34===q||37===q||64===q||96===q)return!1;if((63===q||45===q)&&(i=a.input.charCodeAt(a.position+1),e(i)||g&&f(i)))return!1;for(a.kind="scalar",a.result="",j=k=a.position,l=!1;0!==q;){if(58===q){if(i=a.input.charCodeAt(a.position+1),e(i)||g&&f(i))break}else if(35===q){if(h=a.input.charCodeAt(a.position-1),e(h))break}else{if(a.position===a.lineStart&&u(a)||g&&f(q))break;if(c(q)){if(m=a.line,n=a.lineStart,o=a.lineIndent,t(a,!1,-1),a.lineIndent>=b){l=!0,q=a.input.charCodeAt(a.position);continue}a.position=k,a.line=m,a.lineStart=n,a.lineIndent=o;break}}l&&(p(a,j,k,!1),v(a,a.line-m),j=k=a.position,l=!1),d(q)||(k=a.position+1),q=a.input.charCodeAt(++a.position)}return p(a,j,k,!1),!!a.result||(a.kind=r,a.result=s,!1)}function x(a,b){var d,e,f;if(d=a.input.charCodeAt(a.position),39!==d)return!1;for(a.kind="scalar",a.result="",a.position++,e=f=a.position;0!==(d=a.input.charCodeAt(a.position));)if(39===d){if(p(a,e,a.position,!0),d=a.input.charCodeAt(++a.position),39!==d)return!0;e=f=a.position,a.position++}else c(d)?(p(a,e,f,!0),v(a,t(a,!1,b)),e=f=a.position):a.position===a.lineStart&&u(a)?n(a,"unexpected end of the document within a single quoted scalar"):(a.position++,f=a.position);n(a,"unexpected end of the stream within a single quoted scalar")}function y(a,b){var d,e,f,i,j,l;if(l=a.input.charCodeAt(a.position),34!==l)return!1;for(a.kind="scalar",a.result="",a.position++,d=e=a.position;0!==(l=a.input.charCodeAt(a.position));){if(34===l)return p(a,d,a.position,!0),a.position++,!0;if(92===l){if(p(a,d,a.position,!0),l=a.input.charCodeAt(++a.position),c(l))t(a,!1,b);else if(256>l&&da[l])a.result+=ea[l],a.position++;else if((j=h(l))>0){for(f=j,i=0;f>0;f--)l=a.input.charCodeAt(++a.position),(j=g(l))>=0?i=(i<<4)+j:n(a,"expected hexadecimal character");a.result+=k(i),a.position++}else n(a,"unknown escape sequence");d=e=a.position}else c(l)?(p(a,d,e,!0),v(a,t(a,!1,b)),d=e=a.position):a.position===a.lineStart&&u(a)?n(a,"unexpected end of the document within a double quoted scalar"):(a.position++,e=a.position)}n(a,"unexpected end of the stream within a double quoted scalar")}function z(a,b){var c,d,f,g,h,i,j,k,l,m,o,p=!0,q=a.tag,s=a.anchor,u={};if(o=a.input.charCodeAt(a.position),91===o)g=93,j=!1,d=[];else{if(123!==o)return!1;g=125,j=!0,d={}}for(null!==a.anchor&&(a.anchorMap[a.anchor]=d),o=a.input.charCodeAt(++a.position);0!==o;){if(t(a,!0,b),o=a.input.charCodeAt(a.position),o===g)return a.position++,a.tag=q,a.anchor=s,a.kind=j?"mapping":"sequence",a.result=d,!0;p||n(a,"missed comma between flow collection entries"),l=k=m=null,h=i=!1,63===o&&(f=a.input.charCodeAt(a.position+1),e(f)&&(h=i=!0,a.position++,t(a,!0,b))),c=a.line,G(a,b,T,!1,!0),l=a.tag,k=a.result,t(a,!0,b),o=a.input.charCodeAt(a.position),!i&&a.line!==c||58!==o||(h=!0,o=a.input.charCodeAt(++a.position),t(a,!0,b),G(a,b,T,!1,!0),m=a.result),j?r(a,d,u,l,k,m):d.push(h?r(a,null,u,l,k,m):k),t(a,!0,b),o=a.input.charCodeAt(a.position),44===o?(p=!0,o=a.input.charCodeAt(++a.position)):p=!1}n(a,"unexpected end of the stream within a flow collection")}function A(a,b){var e,f,g,h,j=X,k=!1,l=b,m=0,o=!1;if(h=a.input.charCodeAt(a.position),124===h)f=!1;else{if(62!==h)return!1;f=!0}for(a.kind="scalar",a.result="";0!==h;)if(h=a.input.charCodeAt(++a.position),43===h||45===h)X===j?j=43===h?Z:Y:n(a,"repeat of a chomping mode identifier");else{if(!((g=i(h))>=0))break;0===g?n(a,"bad explicit indentation width of a block scalar; it cannot be less than one"):k?n(a,"repeat of an indentation width identifier"):(l=b+g-1,k=!0)}if(d(h)){do h=a.input.charCodeAt(++a.position);while(d(h));if(35===h)do h=a.input.charCodeAt(++a.position);while(!c(h)&&0!==h)}for(;0!==h;){for(s(a),a.lineIndent=0,h=a.input.charCodeAt(a.position);(!k||a.lineIndent<l)&&32===h;)a.lineIndent++,h=a.input.charCodeAt(++a.position);if(!k&&a.lineIndent>l&&(l=a.lineIndent),c(h))m++;else{if(a.lineIndent<l){j===Z?a.result+=N.repeat("\n",m):j===X&&k&&(a.result+="\n");break}for(f?d(h)?(o=!0,a.result+=N.repeat("\n",m+1)):o?(o=!1,a.result+=N.repeat("\n",m+1)):0===m?k&&(a.result+=" "):a.result+=N.repeat("\n",m):a.result+=k?N.repeat("\n",m+1):N.repeat("\n",m),k=!0,m=0,e=a.position;!c(h)&&0!==h;)h=a.input.charCodeAt(++a.position);p(a,e,a.position,!1)}}return!0}function B(a,b){var c,d,f,g=a.tag,h=a.anchor,i=[],j=!1;for(null!==a.anchor&&(a.anchorMap[a.anchor]=i),f=a.input.charCodeAt(a.position);0!==f&&45===f&&(d=a.input.charCodeAt(a.position+1),e(d));)if(j=!0,a.position++,t(a,!0,-1)&&a.lineIndent<=b)i.push(null),f=a.input.charCodeAt(a.position);else if(c=a.line,G(a,b,V,!1,!0),i.push(a.result),t(a,!0,-1),f=a.input.charCodeAt(a.position),(a.line===c||a.lineIndent>b)&&0!==f)n(a,"bad indentation of a sequence entry");else if(a.lineIndent<b)break;return!!j&&(a.tag=g,a.anchor=h,a.kind="sequence",a.result=i,!0)}function C(a,b,c){var f,g,h,i,j=a.tag,k=a.anchor,l={},m={},o=null,p=null,q=null,s=!1,u=!1;for(null!==a.anchor&&(a.anchorMap[a.anchor]=l),i=a.input.charCodeAt(a.position);0!==i;){if(f=a.input.charCodeAt(a.position+1),h=a.line,63!==i&&58!==i||!e(f)){if(!G(a,c,U,!1,!0))break;if(a.line===h){for(i=a.input.charCodeAt(a.position);d(i);)i=a.input.charCodeAt(++a.position);if(58===i)i=a.input.charCodeAt(++a.position),e(i)||n(a,"a whitespace character is expected after the key-value separator within a block mapping"),s&&(r(a,l,m,o,p,null),o=p=q=null),u=!0,s=!1,g=!1,o=a.tag,p=a.result;else{if(!u)return a.tag=j,a.anchor=k,!0;n(a,"can not read an implicit mapping pair; a colon is missed")}}else{if(!u)return a.tag=j,a.anchor=k,!0;n(a,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===i?(s&&(r(a,l,m,o,p,null),o=p=q=null),u=!0,s=!0,g=!0):s?(s=!1,g=!0):n(a,"incomplete explicit mapping pair; a key node is missed"),a.position+=1,i=f;if((a.line===h||a.lineIndent>b)&&(G(a,b,W,!0,g)&&(s?p=a.result:q=a.result),s||(r(a,l,m,o,p,q),o=p=q=null),t(a,!0,-1),i=a.input.charCodeAt(a.position)),a.lineIndent>b&&0!==i)n(a,"bad indentation of a mapping entry");else if(a.lineIndent<b)break}return s&&r(a,l,m,o,p,null),u&&(a.tag=j,a.anchor=k,a.kind="mapping",a.result=l),u}function D(a){var b,c,d,f,g=!1,h=!1;if(f=a.input.charCodeAt(a.position),33!==f)return!1;if(null!==a.tag&&n(a,"duplication of a tag property"),f=a.input.charCodeAt(++a.position),60===f?(g=!0,f=a.input.charCodeAt(++a.position)):33===f?(h=!0,c="!!",f=a.input.charCodeAt(++a.position)):c="!",b=a.position,g){do f=a.input.charCodeAt(++a.position);while(0!==f&&62!==f);a.position<a.length?(d=a.input.slice(b,a.position),f=a.input.charCodeAt(++a.position)):n(a,"unexpected end of the stream within a verbatim tag")}else{for(;0!==f&&!e(f);)33===f&&(h?n(a,"tag suffix cannot contain exclamation marks"):(c=a.input.slice(b-1,a.position+1),ba.test(c)||n(a,"named tag handle cannot contain such characters"),h=!0,b=a.position+1)),f=a.input.charCodeAt(++a.position);d=a.input.slice(b,a.position),aa.test(d)&&n(a,"tag suffix cannot contain flow indicator characters")}return d&&!ca.test(d)&&n(a,"tag name cannot contain such characters: "+d),g?a.tag=d:S.call(a.tagMap,c)?a.tag=a.tagMap[c]+d:"!"===c?a.tag="!"+d:"!!"===c?a.tag="tag:yaml.org,2002:"+d:n(a,'undeclared tag handle "'+c+'"'),!0}function E(a){var b,c;if(c=a.input.charCodeAt(a.position),38!==c)return!1;for(null!==a.anchor&&n(a,"duplication of an anchor property"),c=a.input.charCodeAt(++a.position),b=a.position;0!==c&&!e(c)&&!f(c);)c=a.input.charCodeAt(++a.position);return a.position===b&&n(a,"name of an anchor node must contain at least one character"),a.anchor=a.input.slice(b,a.position),!0}function F(a){var b,c,d;if(d=a.input.charCodeAt(a.position),42!==d)return!1;for(d=a.input.charCodeAt(++a.position),b=a.position;0!==d&&!e(d)&&!f(d);)d=a.input.charCodeAt(++a.position);return a.position===b&&n(a,"name of an alias node must contain at least one character"),c=a.input.slice(b,a.position),a.anchorMap.hasOwnProperty(c)||n(a,'unidentified alias "'+c+'"'),a.result=a.anchorMap[c],t(a,!0,-1),!0}function G(a,b,c,d,e){var f,g,h,i,j,k,l,m,o=1,p=!1,q=!1;if(null!==a.listener&&a.listener("open",a),a.tag=null,a.anchor=null,a.kind=null,a.result=null,f=g=h=W===c||V===c,d&&t(a,!0,-1)&&(p=!0,a.lineIndent>b?o=1:a.lineIndent===b?o=0:a.lineIndent<b&&(o=-1)),1===o)for(;D(a)||E(a);)t(a,!0,-1)?(p=!0,h=f,a.lineIndent>b?o=1:a.lineIndent===b?o=0:a.lineIndent<b&&(o=-1)):h=!1;if(h&&(h=p||e),(1===o||W===c)&&(l=T===c||U===c?b:b+1,m=a.position-a.lineStart,1===o?h&&(B(a,m)||C(a,m,l))||z(a,l)?q=!0:(g&&A(a,l)||x(a,l)||y(a,l)?q=!0:F(a)?(q=!0,(null!==a.tag||null!==a.anchor)&&n(a,"alias node should not have any properties")):w(a,l,T===c)&&(q=!0,null===a.tag&&(a.tag="?")),null!==a.anchor&&(a.anchorMap[a.anchor]=a.result)):0===o&&(q=h&&B(a,m))),null!==a.tag&&"!"!==a.tag)if("?"===a.tag){for(i=0,j=a.implicitTypes.length;j>i;i+=1)if(k=a.implicitTypes[i],k.resolve(a.result)){a.result=k.construct(a.result),a.tag=k.tag,null!==a.anchor&&(a.anchorMap[a.anchor]=a.result);break}}else S.call(a.typeMap,a.tag)?(k=a.typeMap[a.tag],null!==a.result&&k.kind!==a.kind&&n(a,"unacceptable node kind for !<"+a.tag+'> tag; it should be "'+k.kind+'", not "'+a.kind+'"'),k.resolve(a.result)?(a.result=k.construct(a.result),null!==a.anchor&&(a.anchorMap[a.anchor]=a.result)):n(a,"cannot resolve a node with !<"+a.tag+"> explicit tag")):n(a,"unknown tag !<"+a.tag+">");return null!==a.listener&&a.listener("close",a),null!==a.tag||null!==a.anchor||q}function H(a){var b,f,g,h,i=a.position,j=!1;for(a.version=null,a.checkLineBreaks=a.legacy,a.tagMap={},a.anchorMap={};0!==(h=a.input.charCodeAt(a.position))&&(t(a,!0,-1),h=a.input.charCodeAt(a.position),!(a.lineIndent>0||37!==h));){for(j=!0,h=a.input.charCodeAt(++a.position),b=a.position;0!==h&&!e(h);)h=a.input.charCodeAt(++a.position);for(f=a.input.slice(b,a.position),g=[],f.length<1&&n(a,"directive name must not be less than one character in length");0!==h;){for(;d(h);)h=a.input.charCodeAt(++a.position);if(35===h){do h=a.input.charCodeAt(++a.position);while(0!==h&&!c(h));break}if(c(h))break;for(b=a.position;0!==h&&!e(h);)h=a.input.charCodeAt(++a.position);g.push(a.input.slice(b,a.position))}0!==h&&s(a),S.call(ga,f)?ga[f](a,f,g):o(a,'unknown document directive "'+f+'"')}return t(a,!0,-1),0===a.lineIndent&&45===a.input.charCodeAt(a.position)&&45===a.input.charCodeAt(a.position+1)&&45===a.input.charCodeAt(a.position+2)?(a.position+=3,t(a,!0,-1)):j&&n(a,"directives end mark is expected"),G(a,a.lineIndent-1,W,!1,!0),t(a,!0,-1),a.checkLineBreaks&&_.test(a.input.slice(i,a.position))&&o(a,"non-ASCII line breaks are interpreted as content"),a.documents.push(a.result),a.position===a.lineStart&&u(a)?void(46===a.input.charCodeAt(a.position)&&(a.position+=3,t(a,!0,-1))):void(a.position<a.length-1&&n(a,"end of the stream or a document separator is expected"))}function I(a,b){a=String(a),b=b||{},0!==a.length&&(10!==a.charCodeAt(a.length-1)&&13!==a.charCodeAt(a.length-1)&&(a+="\n"),65279===a.charCodeAt(0)&&(a=a.slice(1)));var c=new l(a,b);for(c.input+="\0";32===c.input.charCodeAt(c.position);)c.lineIndent+=1,c.position+=1;for(;c.position<c.length-1;)H(c);return c.documents}function J(a,b,c){var d,e,f=I(a,c);for(d=0,e=f.length;e>d;d+=1)b(f[d])}function K(a,b){var c=I(a,b);if(0!==c.length){if(1===c.length)return c[0];throw new O("expected a single document in the stream, but found more")}}function L(a,b,c){J(a,b,N.extend({schema:Q},c))}function M(a,b){return K(a,N.extend({schema:Q},b))}for(var N=a("./common"),O=a("./exception"),P=a("./mark"),Q=a("./schema/default_safe"),R=a("./schema/default_full"),S=Object.prototype.hasOwnProperty,T=1,U=2,V=3,W=4,X=1,Y=2,Z=3,$=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,_=/[\x85\u2028\u2029]/,aa=/[,\[\]\{\}]/,ba=/^(?:!|!!|![a-z\-]+!)$/i,ca=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i,da=new Array(256),ea=new Array(256),fa=0;256>fa;fa++)da[fa]=j(fa)?1:0,ea[fa]=j(fa);var ga={YAML:function(a,b,c){var d,e,f;null!==a.version&&n(a,"duplication of %YAML directive"),1!==c.length&&n(a,"YAML directive accepts exactly one argument"),d=/^([0-9]+)\.([0-9]+)$/.exec(c[0]),null===d&&n(a,"ill-formed argument of the YAML directive"),e=parseInt(d[1],10),f=parseInt(d[2],10),1!==e&&n(a,"unacceptable YAML version of the document"),a.version=c[0],a.checkLineBreaks=2>f,1!==f&&2!==f&&o(a,"unsupported YAML version of the document")},TAG:function(a,b,c){var d,e;2!==c.length&&n(a,"TAG directive accepts exactly two arguments"),d=c[0],e=c[1],ba.test(d)||n(a,"ill-formed tag handle (first argument) of the TAG directive"),S.call(a.tagMap,d)&&n(a,'there is a previously declared suffix for "'+d+'" tag handle'),ca.test(e)||n(a,"ill-formed tag prefix (second argument) of the TAG directive"),
a.tagMap[d]=e}};b.exports.loadAll=J,b.exports.load=K,b.exports.safeLoadAll=L,b.exports.safeLoad=M},{"./common":99,"./exception":100,"./mark":102,"./schema/default_full":105,"./schema/default_safe":106}],102:[function(a,b){"use strict";function c(a,b,c,d,e){this.name=a,this.buffer=b,this.position=c,this.line=d,this.column=e}var d=a("./common");c.prototype.getSnippet=function(a,b){var c,e,f,g,h;if(!this.buffer)return null;for(a=a||4,b=b||75,c="",e=this.position;e>0&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(e-1));)if(e-=1,this.position-e>b/2-1){c=" ... ",e+=5;break}for(f="",g=this.position;g<this.buffer.length&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(g));)if(g+=1,g-this.position>b/2-1){f=" ... ",g-=5;break}return h=this.buffer.slice(e,g),d.repeat(" ",a)+c+h+f+"\n"+d.repeat(" ",a+this.position-e+c.length)+"^"},c.prototype.toString=function(a){var b,c="";return this.name&&(c+='in "'+this.name+'" '),c+="at line "+(this.line+1)+", column "+(this.column+1),a||(b=this.getSnippet(),b&&(c+=":\n"+b)),c},b.exports=c},{"./common":99}],103:[function(a,b){"use strict";function c(a,b,d){var e=[];return a.include.forEach(function(a){d=c(a,b,d)}),a[b].forEach(function(a){d.forEach(function(b,c){b.tag===a.tag&&e.push(c)}),d.push(a)}),d.filter(function(a,b){return-1===e.indexOf(b)})}function d(){function a(a){d[a.tag]=a}var b,c,d={};for(b=0,c=arguments.length;c>b;b+=1)arguments[b].forEach(a);return d}function e(a){this.include=a.include||[],this.implicit=a.implicit||[],this.explicit=a.explicit||[],this.implicit.forEach(function(a){if(a.loadKind&&"scalar"!==a.loadKind)throw new g("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=c(this,"implicit",[]),this.compiledExplicit=c(this,"explicit",[]),this.compiledTypeMap=d(this.compiledImplicit,this.compiledExplicit)}var f=a("./common"),g=a("./exception"),h=a("./type");e.DEFAULT=null,e.create=function(){var a,b;switch(arguments.length){case 1:a=e.DEFAULT,b=arguments[0];break;case 2:a=arguments[0],b=arguments[1];break;default:throw new g("Wrong number of arguments for Schema.create function")}if(a=f.toArray(a),b=f.toArray(b),!a.every(function(a){return a instanceof e}))throw new g("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!b.every(function(a){return a instanceof h}))throw new g("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new e({include:a,explicit:b})},b.exports=e},{"./common":99,"./exception":100,"./type":109}],104:[function(a,b){"use strict";var c=a("../schema");b.exports=new c({include:[a("./json")]})},{"../schema":103,"./json":108}],105:[function(a,b){"use strict";var c=a("../schema");b.exports=c.DEFAULT=new c({include:[a("./default_safe")],explicit:[a("../type/js/undefined"),a("../type/js/regexp"),a("../type/js/function")]})},{"../schema":103,"../type/js/function":114,"../type/js/regexp":115,"../type/js/undefined":116,"./default_safe":106}],106:[function(a,b){"use strict";var c=a("../schema");b.exports=new c({include:[a("./core")],implicit:[a("../type/timestamp"),a("../type/merge")],explicit:[a("../type/binary"),a("../type/omap"),a("../type/pairs"),a("../type/set")]})},{"../schema":103,"../type/binary":110,"../type/merge":118,"../type/omap":120,"../type/pairs":121,"../type/set":123,"../type/timestamp":125,"./core":104}],107:[function(a,b){"use strict";var c=a("../schema");b.exports=new c({explicit:[a("../type/str"),a("../type/seq"),a("../type/map")]})},{"../schema":103,"../type/map":117,"../type/seq":122,"../type/str":124}],108:[function(a,b){"use strict";var c=a("../schema");b.exports=new c({include:[a("./failsafe")],implicit:[a("../type/null"),a("../type/bool"),a("../type/int"),a("../type/float")]})},{"../schema":103,"../type/bool":111,"../type/float":112,"../type/int":113,"../type/null":119,"./failsafe":107}],109:[function(a,b){"use strict";function c(a){var b={};return null!==a&&Object.keys(a).forEach(function(c){a[c].forEach(function(a){b[String(a)]=c})}),b}function d(a,b){if(b=b||{},Object.keys(b).forEach(function(b){if(-1===f.indexOf(b))throw new e('Unknown option "'+b+'" is met in definition of "'+a+'" YAML type.')}),this.tag=a,this.kind=b.kind||null,this.resolve=b.resolve||function(){return!0},this.construct=b.construct||function(a){return a},this.instanceOf=b.instanceOf||null,this.predicate=b.predicate||null,this.represent=b.represent||null,this.defaultStyle=b.defaultStyle||null,this.styleAliases=c(b.styleAliases||null),-1===g.indexOf(this.kind))throw new e('Unknown kind "'+this.kind+'" is specified for "'+a+'" YAML type.')}var e=a("./exception"),f=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],g=["scalar","sequence","mapping"];b.exports=d},{"./exception":100}],110:[function(a,b){"use strict";function c(a){if(null===a)return!1;var b,c,d=0,e=a.length,f=i;for(c=0;e>c;c++)if(b=f.indexOf(a.charAt(c)),!(b>64)){if(0>b)return!1;d+=6}return d%8===0}function d(a){var b,c,d=a.replace(/[\r\n=]/g,""),e=d.length,f=i,h=0,j=[];for(b=0;e>b;b++)b%4===0&&b&&(j.push(h>>16&255),j.push(h>>8&255),j.push(255&h)),h=h<<6|f.indexOf(d.charAt(b));return c=e%4*6,0===c?(j.push(h>>16&255),j.push(h>>8&255),j.push(255&h)):18===c?(j.push(h>>10&255),j.push(h>>2&255)):12===c&&j.push(h>>4&255),g?new g(j):j}function e(a){var b,c,d="",e=0,f=a.length,g=i;for(b=0;f>b;b++)b%3===0&&b&&(d+=g[e>>18&63],d+=g[e>>12&63],d+=g[e>>6&63],d+=g[63&e]),e=(e<<8)+a[b];return c=f%3,0===c?(d+=g[e>>18&63],d+=g[e>>12&63],d+=g[e>>6&63],d+=g[63&e]):2===c?(d+=g[e>>10&63],d+=g[e>>4&63],d+=g[e<<2&63],d+=g[64]):1===c&&(d+=g[e>>2&63],d+=g[e<<4&63],d+=g[64],d+=g[64]),d}function f(a){return g&&g.isBuffer(a)}var g=a("buffer").Buffer,h=a("../type"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";b.exports=new h("tag:yaml.org,2002:binary",{kind:"scalar",resolve:c,construct:d,predicate:f,represent:e})},{"../type":109,buffer:4}],111:[function(a,b){"use strict";function c(a){if(null===a)return!1;var b=a.length;return 4===b&&("true"===a||"True"===a||"TRUE"===a)||5===b&&("false"===a||"False"===a||"FALSE"===a)}function d(a){return"true"===a||"True"===a||"TRUE"===a}function e(a){return"[object Boolean]"===Object.prototype.toString.call(a)}var f=a("../type");b.exports=new f("tag:yaml.org,2002:bool",{kind:"scalar",resolve:c,construct:d,predicate:e,represent:{lowercase:function(a){return a?"true":"false"},uppercase:function(a){return a?"TRUE":"FALSE"},camelcase:function(a){return a?"True":"False"}},defaultStyle:"lowercase"})},{"../type":109}],112:[function(a,b){"use strict";function c(a){return null!==a&&!!i.test(a)}function d(a){var b,c,d,e;return b=a.replace(/_/g,"").toLowerCase(),c="-"===b[0]?-1:1,e=[],"+-".indexOf(b[0])>=0&&(b=b.slice(1)),".inf"===b?1===c?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===b?NaN:b.indexOf(":")>=0?(b.split(":").forEach(function(a){e.unshift(parseFloat(a,10))}),b=0,d=1,e.forEach(function(a){b+=a*d,d*=60}),c*b):c*parseFloat(b,10)}function e(a,b){var c;if(isNaN(a))switch(b){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===a)switch(b){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===a)switch(b){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(g.isNegativeZero(a))return"-0.0";return c=a.toString(10),j.test(c)?c.replace("e",".e"):c}function f(a){return"[object Number]"===Object.prototype.toString.call(a)&&(a%1!==0||g.isNegativeZero(a))}var g=a("../common"),h=a("../type"),i=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?|\\.[0-9_]+(?:[eE][-+][0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),j=/^[-+]?[0-9]+e/;b.exports=new h("tag:yaml.org,2002:float",{kind:"scalar",resolve:c,construct:d,predicate:f,represent:e,defaultStyle:"lowercase"})},{"../common":99,"../type":109}],113:[function(a,b){"use strict";function c(a){return a>=48&&57>=a||a>=65&&70>=a||a>=97&&102>=a}function d(a){return a>=48&&55>=a}function e(a){return a>=48&&57>=a}function f(a){if(null===a)return!1;var b,f=a.length,g=0,h=!1;if(!f)return!1;if(b=a[g],("-"===b||"+"===b)&&(b=a[++g]),"0"===b){if(g+1===f)return!0;if(b=a[++g],"b"===b){for(g++;f>g;g++)if(b=a[g],"_"!==b){if("0"!==b&&"1"!==b)return!1;h=!0}return h}if("x"===b){for(g++;f>g;g++)if(b=a[g],"_"!==b){if(!c(a.charCodeAt(g)))return!1;h=!0}return h}for(;f>g;g++)if(b=a[g],"_"!==b){if(!d(a.charCodeAt(g)))return!1;h=!0}return h}for(;f>g;g++)if(b=a[g],"_"!==b){if(":"===b)break;if(!e(a.charCodeAt(g)))return!1;h=!0}return!!h&&(":"!==b||/^(:[0-5]?[0-9])+$/.test(a.slice(g)))}function g(a){var b,c,d=a,e=1,f=[];return-1!==d.indexOf("_")&&(d=d.replace(/_/g,"")),b=d[0],("-"===b||"+"===b)&&("-"===b&&(e=-1),d=d.slice(1),b=d[0]),"0"===d?0:"0"===b?"b"===d[1]?e*parseInt(d.slice(2),2):"x"===d[1]?e*parseInt(d,16):e*parseInt(d,8):-1!==d.indexOf(":")?(d.split(":").forEach(function(a){f.unshift(parseInt(a,10))}),d=0,c=1,f.forEach(function(a){d+=a*c,c*=60}),e*d):e*parseInt(d,10)}function h(a){return"[object Number]"===Object.prototype.toString.call(a)&&a%1===0&&!i.isNegativeZero(a)}var i=a("../common"),j=a("../type");b.exports=new j("tag:yaml.org,2002:int",{kind:"scalar",resolve:f,construct:g,predicate:h,represent:{binary:function(a){return"0b"+a.toString(2)},octal:function(a){return"0"+a.toString(8)},decimal:function(a){return a.toString(10)},hexadecimal:function(a){return"0x"+a.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},{"../common":99,"../type":109}],114:[function(a,b){"use strict";function c(a){if(null===a)return!1;try{var b="("+a+")",c=g.parse(b,{range:!0});return"Program"===c.type&&1===c.body.length&&"ExpressionStatement"===c.body[0].type&&"FunctionExpression"===c.body[0].expression.type}catch(a){return!1}}function d(a){var b,c="("+a+")",d=g.parse(c,{range:!0}),e=[];if("Program"!==d.type||1!==d.body.length||"ExpressionStatement"!==d.body[0].type||"FunctionExpression"!==d.body[0].expression.type)throw new Error("Failed to resolve function");return d.body[0].expression.params.forEach(function(a){e.push(a.name)}),b=d.body[0].expression.body.range,new Function(e,c.slice(b[0]+1,b[1]-1))}function e(a){return a.toString()}function f(a){return"[object Function]"===Object.prototype.toString.call(a)}var g;try{var h=a;g=h("esprima")}catch(a){"undefined"!=typeof window&&(g=window.esprima)}var i=a("../../type");b.exports=new i("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:c,construct:d,predicate:f,represent:e})},{"../../type":109}],115:[function(a,b){"use strict";function c(a){if(null===a)return!1;if(0===a.length)return!1;var b=a,c=/\/([gim]*)$/.exec(a),d="";if("/"===b[0]){if(c&&(d=c[1]),d.length>3)return!1;if("/"!==b[b.length-d.length-1])return!1}return!0}function d(a){var b=a,c=/\/([gim]*)$/.exec(a),d="";return"/"===b[0]&&(c&&(d=c[1]),b=b.slice(1,b.length-d.length-1)),new RegExp(b,d)}function e(a){var b="/"+a.source+"/";return a.global&&(b+="g"),a.multiline&&(b+="m"),a.ignoreCase&&(b+="i"),b}function f(a){return"[object RegExp]"===Object.prototype.toString.call(a)}var g=a("../../type");b.exports=new g("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:c,construct:d,predicate:f,represent:e})},{"../../type":109}],116:[function(a,b){"use strict";function c(){return!0}function d(){}function e(){return""}function f(a){return"undefined"==typeof a}var g=a("../../type");b.exports=new g("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:c,construct:d,predicate:f,represent:e})},{"../../type":109}],117:[function(a,b){"use strict";var c=a("../type");b.exports=new c("tag:yaml.org,2002:map",{kind:"mapping",construct:function(a){return null!==a?a:{}}})},{"../type":109}],118:[function(a,b){"use strict";function c(a){return"<<"===a||null===a}var d=a("../type");b.exports=new d("tag:yaml.org,2002:merge",{kind:"scalar",resolve:c})},{"../type":109}],119:[function(a,b){"use strict";function c(a){if(null===a)return!0;var b=a.length;return 1===b&&"~"===a||4===b&&("null"===a||"Null"===a||"NULL"===a)}function d(){return null}function e(a){return null===a}var f=a("../type");b.exports=new f("tag:yaml.org,2002:null",{kind:"scalar",resolve:c,construct:d,predicate:e,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},{"../type":109}],120:[function(a,b){"use strict";function c(a){if(null===a)return!0;var b,c,d,e,h,i=[],j=a;for(b=0,c=j.length;c>b;b+=1){if(d=j[b],h=!1,"[object Object]"!==g.call(d))return!1;for(e in d)if(f.call(d,e)){if(h)return!1;h=!0}if(!h)return!1;if(-1!==i.indexOf(e))return!1;i.push(e)}return!0}function d(a){return null!==a?a:[]}var e=a("../type"),f=Object.prototype.hasOwnProperty,g=Object.prototype.toString;b.exports=new e("tag:yaml.org,2002:omap",{kind:"sequence",resolve:c,construct:d})},{"../type":109}],121:[function(a,b){"use strict";function c(a){if(null===a)return!0;var b,c,d,e,g,h=a;for(g=new Array(h.length),b=0,c=h.length;c>b;b+=1){if(d=h[b],"[object Object]"!==f.call(d))return!1;if(e=Object.keys(d),1!==e.length)return!1;g[b]=[e[0],d[e[0]]]}return!0}function d(a){if(null===a)return[];var b,c,d,e,f,g=a;for(f=new Array(g.length),b=0,c=g.length;c>b;b+=1)d=g[b],e=Object.keys(d),f[b]=[e[0],d[e[0]]];return f}var e=a("../type"),f=Object.prototype.toString;b.exports=new e("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:c,construct:d})},{"../type":109}],122:[function(a,b){"use strict";var c=a("../type");b.exports=new c("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(a){return null!==a?a:[]}})},{"../type":109}],123:[function(a,b){"use strict";function c(a){if(null===a)return!0;var b,c=a;for(b in c)if(f.call(c,b)&&null!==c[b])return!1;return!0}function d(a){return null!==a?a:{}}var e=a("../type"),f=Object.prototype.hasOwnProperty;b.exports=new e("tag:yaml.org,2002:set",{kind:"mapping",resolve:c,construct:d})},{"../type":109}],124:[function(a,b){"use strict";var c=a("../type");b.exports=new c("tag:yaml.org,2002:str",{kind:"scalar",construct:function(a){return null!==a?a:""}})},{"../type":109}],125:[function(a,b){"use strict";function c(a){return null!==a&&null!==g.exec(a)}function d(a){var b,c,d,e,f,h,i,j,k,l,m=0,n=null;if(b=g.exec(a),null===b)throw new Error("Date resolve error");if(c=+b[1],d=+b[2]-1,e=+b[3],!b[4])return new Date(Date.UTC(c,d,e));if(f=+b[4],h=+b[5],i=+b[6],b[7]){for(m=b[7].slice(0,3);m.length<3;)m+="0";m=+m}return b[9]&&(j=+b[10],k=+(b[11]||0),n=6e4*(60*j+k),"-"===b[9]&&(n=-n)),l=new Date(Date.UTC(c,d,e,f,h,i,m)),n&&l.setTime(l.getTime()-n),l}function e(a){return a.toISOString()}var f=a("../type"),g=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?)?$");b.exports=new f("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:c,construct:d,instanceOf:Date,represent:e})},{"../type":109}],126:[function(a,b,c){"use strict";var d=(a("./utils"),a("./support")),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.decode=function(a){var b,c,f,g,h,i,j,k=0,l=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");var m=3*a.length/4;a.charAt(a.length-1)===e.charAt(64)&&m--,a.charAt(a.length-2)===e.charAt(64)&&m--;var n;for(n=d.uint8array?new Uint8Array(m):new Array(m);k<a.length;)g=e.indexOf(a.charAt(k++)),h=e.indexOf(a.charAt(k++)),i=e.indexOf(a.charAt(k++)),j=e.indexOf(a.charAt(k++)),b=g<<2|h>>4,c=(15&h)<<4|i>>2,f=(3&i)<<6|j,n[l++]=b,64!==i&&(n[l++]=c),64!==j&&(n[l++]=f);return n}},{"./support":152,"./utils":154}],127:[function(a,b){"use strict";function c(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}var d=a("./external"),e=a("./stream/DataWorker"),f=a("./stream/DataLengthProbe"),g=a("./stream/Crc32Probe"),f=a("./stream/DataLengthProbe");c.prototype={getContentWorker:function(){var a=new e(d.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new f("data_length")),b=this;return a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),a},getCompressedWorker:function(){return new e(d.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(a,b,c){return a.pipe(new g).pipe(new f("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new f("compressedSize")).withStreamInfo("compression",b)},b.exports=c},{"./external":131,"./stream/Crc32Probe":147,"./stream/DataLengthProbe":148,"./stream/DataWorker":149}],128:[function(a,b,c){"use strict";var d=a("./stream/GenericWorker");c.STORE={magic:"\0\0",uncompressWorker:function(){return new d("STORE decompression")}},c.DEFLATE=a("./flate")},{"./flate":132,"./stream/GenericWorker":150}],129:[function(a,b){"use strict";function c(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function d(a,b,c,d){var e=g,f=d+c;a^=-1;for(var h=d;f>h;h++)a=a>>>8^e[255&(a^b[h])];return-1^a}function e(a,b,c,d){var e=g,f=d+c;a^=-1;for(var h=d;f>h;h++)a=a>>>8^e[255&(a^b.charCodeAt(h))];return-1^a}var f=a("./utils"),g=c();b.exports=function(a,b){if("undefined"==typeof a||!a.length)return 0;var c="string"!==f.getTypeOf(a);return c?d(0|b,a,a.length,0):e(0|b,a,a.length,0)}},{"./utils":154}],130:[function(a,b,c){"use strict";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],131:[function(a,b){"use strict";b.exports={Promise:window.Promise}},{}],132:[function(a,b,c){"use strict";function d(a,b){h.call(this,"FlateWorker/"+a),this._pako=new f[a]({raw:!0,level:b.level||-1}),this.meta={};var c=this;this._pako.onData=function(a){c.push({data:a,meta:c.meta})}}var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,f=a("pako"),g=a("./utils"),h=a("./stream/GenericWorker"),i=e?"uint8array":"array";c.magic="\b\0",g.inherits(d,h),d.prototype.processChunk=function(a){this.meta=a.meta,this._pako.push(g.transformTo(i,a.data),!1)},d.prototype.flush=function(){h.prototype.flush.call(this),this._pako.push([],!0)},d.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},c.compressWorker=function(a){return new d("Deflate",a)},c.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":150,"./utils":154,pako:165}],133:[function(a,b){"use strict";function c(){if(!(this instanceof c))return new c;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var a=new c;for(var b in this)"function"!=typeof this[b]&&(a[b]=this[b]);return a}}c.prototype=a("./object"),c.prototype.loadAsync=a("./load"),c.support=a("./support"),c.defaults=a("./defaults"),c.loadAsync=function(a,b){return(new c).loadAsync(a,b)},c.external=a("./external"),b.exports=c},{"./defaults":130,"./external":131,"./load":134,"./object":138,"./support":152}],134:[function(a,b){"use strict";function c(a){return new e.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new h);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var d=a("./utils"),e=a("./external"),f=a("./utf8"),d=a("./utils"),g=a("./zipEntries"),h=a("./stream/Crc32Probe"),i=a("./nodejsUtils");b.exports=function(a,b){var h=this;return b=d.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:f.utf8decode}),i.isNode&&i.isStream(a)?e.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):d.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new g(b);return c.load(a),c}).then(function(a){var d=[e.Promise.resolve(a)],f=a.files;if(b.checkCRC32)for(var g=0;g<f.length;g++)d.push(c(f[g]));return e.Promise.all(d)}).then(function(a){for(var c=a.shift(),d=c.files,e=0;e<d.length;e++){var f=d[e];h.file(f.fileNameStr,f.decompressed,{binary:!0,optimizedBinaryString:!0,date:f.date,dir:f.dir,comment:f.fileCommentStr.length?f.fileCommentStr:null,unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions,createFolders:b.createFolders})}return c.zipComment.length&&(h.comment=c.zipComment),h})}},{"./external":131,"./nodejsUtils":137,"./stream/Crc32Probe":147,"./utf8":153,"./utils":154,"./zipEntries":155}],135:[function(a,b){"use strict";function c(a,b){e.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(b)}var d=a("../utils"),e=a("../stream/GenericWorker");d.inherits(c,e),c.prototype._bindStream=function(a){var b=this;this._stream=a,a.pause(),a.on("data",function(a){b.push({data:a,meta:{percent:0}})}).on("error",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},c.prototype.pause=function(){return!!e.prototype.pause.call(this)&&(this._stream.pause(),!0)},c.prototype.resume=function(){return!!e.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},b.exports=c},{"../stream/GenericWorker":150,"../utils":154}],136:[function(a,b){"use strict";function c(a,b,c){d.call(this,b),this._helper=a;var e=this;a.on("data",function(a,b){e.push(a)||e._helper.pause(),c&&c(b)}).on("error",function(a){e.emit("error",a)}).on("end",function(){e.push(null)})}var d=a("readable-stream").Readable,e=a("util");e.inherits(c,d),c.prototype._read=function(){this._helper.resume()},b.exports=c},{"readable-stream":163,util:191}],137:[function(a,b){(function(a){"use strict";b.exports={isNode:"undefined"!=typeof a,newBuffer:function(b,c){return new a(b,c)},isBuffer:function(b){return a.isBuffer(b)},isStream:function(a){return a&&"function"==typeof a.on&&"function"==typeof a.pause&&"function"==typeof a.resume}}}).call(this,a("buffer").Buffer)},{buffer:5}],138:[function(a,b){"use strict";function c(a){return"[object RegExp]"===Object.prototype.toString.call(a)}var d=a("./utils"),e=a("./stream/GenericWorker"),f=a("./defaults"),g=a("./compressedObject"),h=a("./zipObject"),i=a("./nodejsUtils"),j=a("./nodejs/NodejsStreamInputAdapter"),k=function(a,b,c){var k,o=d.getTypeOf(b);c=d.extend(c||{},f),c.date=c.date||new Date,null!==c.compression&&(c.compression=c.compression.toUpperCase()),"string"==typeof c.unixPermissions&&(c.unixPermissions=parseInt(c.unixPermissions,8)),c.unixPermissions&&16384&c.unixPermissions&&(c.dir=!0),c.dosPermissions&&16&c.dosPermissions&&(c.dir=!0),c.dir&&(a=m(a)),c.createFolders&&(k=l(a))&&n.call(this,k,!0);var p="string"===o&&c.binary===!1&&c.base64===!1;c.binary=!p;var q=b instanceof g&&0===b.uncompressedSize;(q||c.dir||!b||0===b.length)&&(c.base64=!1,c.binary=!0,b="",c.compression="STORE",o="string");var r=null;r=b instanceof g||b instanceof e?b:i.isNode&&i.isStream(b)?new j(a,b):d.prepareContent(a,b,c.binary,c.optimizedBinaryString,c.base64);var s=new h(a,r,c);this.files[a]=s},l=function(a){"/"===a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},m=function(a){return"/"!==a.slice(-1)&&(a+="/"),a},n=function(a,b){return b="undefined"!=typeof b?b:f.createFolders,a=m(a),this.files[a]||k.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},o={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],c=b.slice(this.root.length,b.length),c&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=[];return this.forEach(function(c,d){a(c,d)&&b.push(d)}),b},file:function(a,b,d){if(1===arguments.length){if(c(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}var f=this.files[this.root+a];return f&&!f.dir?f:null}return a=this.root+a,k.call(this,a,b,d),this},folder:function(a){if(!a)return this;if(c(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,d=n.call(this,b),e=this.clone();return e.root=d.name,e}};b.exports=o},{"./compressedObject":127,"./defaults":130,"./nodejs/NodejsStreamInputAdapter":135,"./nodejsUtils":137,"./stream/GenericWorker":150,"./utils":154,"./zipObject":157}],139:[function(a,b){"use strict";function c(a){d.call(this,a);for(var b=0;b<this.data.length;b++)a[b]=255&a[b]}var d=a("./DataReader"),e=a("../utils");e.inherits(c,d),c.prototype.byteAt=function(a){return this.data[this.zero+a]},c.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f-this.zero;return-1},c.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.readData(4);return b===f[0]&&c===f[1]&&d===f[2]&&e===f[3]},c.prototype.readData=function(a){if(this.checkOffset(a),0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=c},{"../utils":154,"./DataReader":140}],140:[function(a,b){"use strict";function c(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}var d=a("../utils");c.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||0>a)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return d.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},b.exports=c},{"../utils":154}],141:[function(a,b){"use strict";function c(a){d.call(this,a)}var d=a("./Uint8ArrayReader"),e=a("../utils");e.inherits(c,d),c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=c},{"../utils":154,"./Uint8ArrayReader":143}],142:[function(a,b){"use strict";function c(a){d.call(this,a)}var d=a("./DataReader"),e=a("../utils");e.inherits(c,d),c.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},c.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},c.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b},c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=c},{"../utils":154,"./DataReader":140}],143:[function(a,b){"use strict";function c(a){d.call(this,a)}var d=a("./ArrayReader"),e=a("../utils");e.inherits(c,d),c.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=c},{"../utils":154,"./ArrayReader":139}],144:[function(a,b){"use strict";var c=a("../utils"),d=a("../support"),e=a("./ArrayReader"),f=a("./StringReader"),g=a("./NodeBufferReader"),h=a("./Uint8ArrayReader");b.exports=function(a){var b=c.getTypeOf(a);return c.checkSupport(b),"string"!==b||d.uint8array?"nodebuffer"===b?new g(a):d.uint8array?new h(c.transformTo("uint8array",a)):new e(c.transformTo("array",a)):new f(a)}},{"../support":152,"../utils":154,"./ArrayReader":139,"./NodeBufferReader":141,"./StringReader":142,"./Uint8ArrayReader":143}],145:[function(a,b,c){"use strict";c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\b"},{}],146:[function(a,b){"use strict";function c(a){d.call(this,"ConvertWorker to "+a),this.destType=a}var d=a("./GenericWorker"),e=a("../utils");e.inherits(c,d),c.prototype.processChunk=function(a){this.push({data:e.transformTo(this.destType,a.data),meta:a.meta})},b.exports=c},{"../utils":154,"./GenericWorker":150}],147:[function(a,b){"use strict";function c(){d.call(this,"Crc32Probe")}var d=a("./GenericWorker"),e=a("../crc32"),f=a("../utils");f.inherits(c,d),c.prototype.processChunk=function(a){this.streamInfo.crc32=e(a.data,this.streamInfo.crc32||0),this.push(a)},b.exports=c},{"../crc32":129,"../utils":154,"./GenericWorker":150}],148:[function(a,b){"use strict";function c(a){e.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}var d=a("../utils"),e=a("./GenericWorker");d.inherits(c,e),c.prototype.processChunk=function(a){if(a){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+a.data.length}e.prototype.processChunk.call(this,a)},b.exports=c},{"../utils":154,"./GenericWorker":150}],149:[function(a,b){"use strict";function c(a){e.call(this,"DataWorker");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=d.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var d=a("../utils"),e=a("./GenericWorker"),f=16384;d.inherits(c,e),c.prototype.cleanUp=function(){e.prototype.cleanUp.call(this),this.data=null},c.prototype.resume=function(){return!!e.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,d.delay(this._tickAndRepeat,[],this)),!0)},c.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(d.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},c.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=f,b=null,c=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case"string":b=this.data.substring(this.index,c);break;case"uint8array":b=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":b=this.data.slice(this.index,c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})},b.exports=c},{"../utils":154,"./GenericWorker":150}],150:[function(a,b){"use strict";function c(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}c.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,b){return this._listeners[a].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){
if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.end()}),a.on("error",function(a){b.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){return this.extraStreamInfo[a]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},b.exports=c},{}],151:[function(a,b){(function(c){"use strict";function d(a,b,c){switch(a){case"blob":return h.newBlob(h.transformTo("arraybuffer",b),c);case"base64":return k.encode(b);default:return h.transformTo(a,b)}}function e(a,b){var d,e=0,f=null,g=0;for(d=0;d<b.length;d++)g+=b[d].length;switch(a){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":for(f=new Uint8Array(g),d=0;d<b.length;d++)f.set(b[d],e),e+=b[d].length;return f;case"nodebuffer":return c.concat(b);default:throw new Error("concat : unsupported type '"+a+"'")}}function f(a,b){return new m.Promise(function(c,f){var g=[],h=a._internalType,i=a._outputType,j=a._mimeType;a.on("data",function(a,c){g.push(a),b&&b(c)}).on("error",function(a){g=[],f(a)}).on("end",function(){try{var a=d(i,e(h,g),j);c(a)}catch(a){f(a)}g=[]}).resume()})}function g(a,b,c){var d=b;switch(b){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=b,this._mimeType=c,h.checkSupport(d),this._worker=a.pipe(new i(d)),a.lock()}catch(a){this._worker=new j("error"),this._worker.error(a)}}var h=a("../utils"),i=a("./ConvertWorker"),j=a("./GenericWorker"),k=a("../base64"),l=a("../nodejs/NodejsStreamOutputAdapter"),m=a("../external");g.prototype={accumulate:function(a){return f(this,a)},on:function(a,b){var c=this;return"data"===a?this._worker.on(a,function(a){b.call(c,a.data,a.meta)}):this._worker.on(a,function(){h.delay(b,arguments,c)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(a){if(h.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},a)}},b.exports=g}).call(this,a("buffer").Buffer)},{"../base64":126,"../external":131,"../nodejs/NodejsStreamOutputAdapter":136,"../utils":154,"./ConvertWorker":146,"./GenericWorker":150,buffer:5}],152:[function(a,b,c){(function(b){"use strict";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,c.nodebuffer="undefined"!=typeof b,c.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=0===new Blob([d],{type:"application/zip"}).size}catch(a){try{var e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,f=new e;f.append(d),c.blob=0===f.getBlob("application/zip").size}catch(a){c.blob=!1}}}c.nodestream=!!a("./nodejs/NodejsStreamOutputAdapter").prototype}).call(this,a("buffer").Buffer)},{"./nodejs/NodejsStreamOutputAdapter":136,buffer:5}],153:[function(a,b,c){"use strict";function d(){i.call(this,"utf-8 decode"),this.leftOver=null}function e(){i.call(this,"utf-8 encode")}for(var f=a("./utils"),g=a("./support"),h=a("./nodejsUtils"),i=a("./stream/GenericWorker"),j=new Array(256),k=0;256>k;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1;var l=function(a){var b,c,d,e,f,h=a.length,i=0;for(e=0;h>e;e++)c=a.charCodeAt(e),55296===(64512&c)&&h>e+1&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),i+=128>c?1:2048>c?2:65536>c?3:4;for(b=g.uint8array?new Uint8Array(i):new Array(i),f=0,e=0;i>f;e++)c=a.charCodeAt(e),55296===(64512&c)&&h>e+1&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),128>c?b[f++]=c:2048>c?(b[f++]=192|c>>>6,b[f++]=128|63&c):65536>c?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},m=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return 0>c?b:0===c?b:c+j[a[c]]>b?c:b},n=function(a){var b,c,d,e,g=a.length,h=new Array(2*g);for(c=0,b=0;g>b;)if(d=a[b++],128>d)h[c++]=d;else if(e=j[d],e>4)h[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;e>1&&g>b;)d=d<<6|63&a[b++],e--;e>1?h[c++]=65533:65536>d?h[c++]=d:(d-=65536,h[c++]=55296|d>>10&1023,h[c++]=56320|1023&d)}return h.length!==c&&(h.subarray?h=h.subarray(0,c):h.length=c),f.applyFromCharCode(h)};c.utf8encode=function(a){return g.nodebuffer?h.newBuffer(a,"utf-8"):l(a)},c.utf8decode=function(a){return g.nodebuffer?f.transformTo("nodebuffer",a).toString("utf-8"):(a=f.transformTo(g.uint8array?"uint8array":"array",a),n(a))},f.inherits(d,i),d.prototype.processChunk=function(a){var b=f.transformTo(g.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(g.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length),b.set(this.leftOver,0),b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e=m(b),h=b;e!==b.length&&(g.uint8array?(h=b.subarray(0,e),this.leftOver=b.subarray(e,b.length)):(h=b.slice(0,e),this.leftOver=b.slice(e,b.length))),this.push({data:c.utf8decode(h),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=d,f.inherits(e,i),e.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})},c.Utf8EncodeWorker=e},{"./nodejsUtils":137,"./stream/GenericWorker":150,"./support":152,"./utils":154}],154:[function(a,b,c){"use strict";function d(a){var b=null;return b=i.uint8array?new Uint8Array(a.length):new Array(a.length),f(a,b)}function e(a){return a}function f(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function g(a){var b=65536,d=c.getTypeOf(a),e=!0;if("uint8array"===d?e=n.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=n.applyCanBeUsed.nodebuffer),e)for(;b>1;)try{return n.stringifyByChunk(a,d,b)}catch(a){b=Math.floor(b/2)}return n.stringifyByChar(a)}function h(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b}var i=a("./support"),j=a("./base64"),k=a("./nodejsUtils"),l=a("asap"),m=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(c){try{var d=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,e=new d;return e.append(a),e.getBlob(b)}catch(a){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(c>=f)return String.fromCharCode.apply(null,a);for(;f>e;)d.push("array"===b||"nodebuffer"===b?String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f))):String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(a){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,k.newBuffer(1)).length}catch(a){return!1}}()}};c.applyFromCharCode=g;var o={};o.string={string:e,array:function(a){return f(a,new Array(a.length))},arraybuffer:function(a){return o.string.uint8array(a).buffer},uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:function(a){return f(a,k.newBuffer(a.length))}},o.array={string:g,array:e,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(a)}},o.arraybuffer={string:function(a){return g(new Uint8Array(a))},array:function(a){return h(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBuffer(new Uint8Array(a))}},o.uint8array={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return k.newBuffer(a)}},o.nodebuffer={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return o.nodebuffer.uint8array(a).buffer},uint8array:function(a){return h(a,new Uint8Array(a.length))},nodebuffer:e},c.transformTo=function(a,b){if(b||(b=""),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=o[d][a](b);return e},c.getTypeOf=function(a){return"string"==typeof a?"string":"[object Array]"===Object.prototype.toString.call(a)?"array":i.nodebuffer&&k.isBuffer(a)?"nodebuffer":i.uint8array&&a instanceof Uint8Array?"uint8array":i.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(a){var b=i[a.toLowerCase()];if(!b)throw new Error(a+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d="";for(c=0;c<(a||"").length;c++)b=a.charCodeAt(c),d+="\\x"+(16>b?"0":"")+b.toString(16).toUpperCase();return d},c.delay=function(a,b,c){l(function(){a.apply(c||null,b||[])})},c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},c.extend=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&"undefined"==typeof c[b]&&(c[b]=arguments[a][b]);return c},c.prepareContent=function(a,b,e,f,g){var h=null;return h=i.blob&&b instanceof Blob&&"undefined"!=typeof FileReader?new m.Promise(function(a,c){var d=new FileReader;d.onload=function(b){a(b.target.result)},d.onerror=function(a){c(a.target.error)},d.readAsArrayBuffer(b)}):m.Promise.resolve(b),h.then(function(b){var h=c.getTypeOf(b);return h?("arraybuffer"===h?b=c.transformTo("uint8array",b):"string"===h&&(g?b=j.decode(b):e&&f!==!0&&(b=d(b))),b):m.Promise.reject(new Error("The data of '"+a+"' is in an unsupported format !"))})}},{"./base64":126,"./external":131,"./nodejsUtils":137,"./support":152,asap:1}],155:[function(a,b){"use strict";function c(a){this.files=[],this.loadOptions=a}var d=a("./reader/readerFor"),e=a("./utils"),f=a("./signature"),g=a("./zipEntry"),h=(a("./utf8"),a("./support"));c.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug : unexpected signature ("+e.pretty(b)+", expected "+e.pretty(a)+")")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4),e=d===b;return this.reader.setIndex(c),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),b=h.uint8array?"uint8array":"array",c=e.transformTo(b,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;d>e;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(f.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(f.CENTRAL_FILE_HEADER);)a=new g({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(f.CENTRAL_DIRECTORY_END);if(0>a){var b=!this.isSignature(0,f.LOCAL_FILE_HEADER);throw new Error(b?"Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html":"Corrupted zip : can't find end of central directory")}this.reader.setIndex(a);var c=a;if(this.checkSignature(f.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===e.MAX_VALUE_16BITS||this.diskWithCentralDirStart===e.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===e.MAX_VALUE_16BITS||this.centralDirRecords===e.MAX_VALUE_16BITS||this.centralDirSize===e.MAX_VALUE_32BITS||this.centralDirOffset===e.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR),0>a)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(a),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,f.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var g=c-d;if(g>0)this.isSignature(c,f.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(0>g)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(a){this.reader=d(a)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=c},{"./reader/readerFor":144,"./signature":145,"./support":152,"./utf8":153,"./utils":154,"./zipEntry":156}],156:[function(a,b){"use strict";function c(a,b){this.options=a,this.loadOptions=b}var d=a("./reader/readerFor"),e=a("./utils"),f=a("./compressedObject"),g=a("./crc32"),h=a("./utf8"),i=a("./compressions"),j=a("./support"),k=0,l=3,m=function(a){for(var b in i)if(i.hasOwnProperty(b)&&i[b].magic===a)return i[b];return null};c.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(c),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(b=m(this.compressionMethod),null===b)throw new Error("Corrupted zip : compression "+e.pretty(this.compressionMethod)+" unknown (inner file : "+e.transformTo("string",this.fileName)+")");this.decompressed=new f(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var b=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(b),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a===k&&(this.dosPermissions=63&this.externalFileAttributes),a===l&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var a=d(this.extraFields[1].value);this.uncompressedSize===e.MAX_VALUE_32BITS&&(this.uncompressedSize=a.readInt(8)),this.compressedSize===e.MAX_VALUE_32BITS&&(this.compressedSize=a.readInt(8)),this.localHeaderOffset===e.MAX_VALUE_32BITS&&(this.localHeaderOffset=a.readInt(8)),this.diskNumberStart===e.MAX_VALUE_32BITS&&(this.diskNumberStart=a.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index<e;)b=a.readInt(2),c=a.readInt(2),d=a.readData(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){var a=j.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(null!==b)this.fileNameStr=b;else{var c=e.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var d=this.findExtraFieldUnicodeComment();if(null!==d)this.fileCommentStr=d;else{var f=e.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(f)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=d(a.value);return 1!==b.readInt(1)?null:g(this.fileName)!==b.readInt(4)?null:h.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=d(a.value);return 1!==b.readInt(1)?null:g(this.fileComment)!==b.readInt(4)?null:h.utf8decode(b.readData(a.length-5))}return null}},b.exports=c},{"./compressedObject":127,"./compressions":128,"./crc32":129,"./reader/readerFor":144,"./support":152,"./utf8":153,"./utils":154}],157:[function(a,b){"use strict";var c=a("./stream/StreamHelper"),d=a("./stream/DataWorker"),e=a("./utf8"),f=a("./compressedObject"),g=a("./stream/GenericWorker"),h=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};h.prototype={internalStream:function(a){var b=a.toLowerCase(),d="string"===b||"text"===b;("binarystring"===b||"text"===b)&&(b="string");var f=this._decompressWorker(),g=!this._dataBinary;return g&&!d&&(f=f.pipe(new e.Utf8EncodeWorker)),!g&&d&&(f=f.pipe(new e.Utf8DecodeWorker)),new c(f,b,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof g?this._data:new d(this._data)}};for(var i=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],j=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},k=0;k<i.length;k++)h.prototype[i[k]]=j;b.exports=h},{"./compressedObject":127,"./stream/DataWorker":149,"./stream/GenericWorker":150,"./stream/StreamHelper":151,"./utf8":153}],158:[function(a,b){"use strict";function c(a){return this instanceof c?(i.call(this,a),j.call(this,a),a&&a.readable===!1&&(this.readable=!1),a&&a.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,a&&a.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",d)):new c(a)}function d(){this.allowHalfOpen||this._writableState.ended||g(e,this)}function e(a){a.end()}var f=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b};b.exports=c;var g=a("process-nextick-args"),h=a("core-util-is");h.inherits=a("inherits");var i=a("./_stream_readable"),j=a("./_stream_writable");h.inherits(c,i);for(var k=f(j.prototype),l=0;l<k.length;l++){var m=k[l];c.prototype[m]||(c.prototype[m]=j.prototype[m])}},{"./_stream_readable":160,"./_stream_writable":162,"core-util-is":70,inherits:94,"process-nextick-args":184}],159:[function(a,b){"use strict";function c(a){return this instanceof c?void d.call(this,a):new c(a)}b.exports=c;var d=a("./_stream_transform"),e=a("core-util-is");e.inherits=a("inherits"),e.inherits(c,d),c.prototype._transform=function(a,b,c){c(null,a)}},{"./_stream_transform":161,"core-util-is":70,inherits:94}],160:[function(a,b){(function(c){"use strict";function d(b,c){I=I||a("./_stream_duplex"),b=b||{},this.objectMode=!!b.objectMode,c instanceof I&&(this.objectMode=this.objectMode||!!b.readableObjectMode);var d=b.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=b.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(H||(H=a("string_decoder/").StringDecoder),this.decoder=new H(b.encoding),this.encoding=b.encoding)}function e(b){return I=I||a("./_stream_duplex"),this instanceof e?(this._readableState=new d(b,this),this.readable=!0,b&&"function"==typeof b.read&&(this._read=b.read),void C.call(this)):new e(b)}function f(a,b,c,d,e){var f=j(b,c);if(f)a.emit("error",f);else if(null===c)b.reading=!1,k(a,b);else if(b.objectMode||c&&c.length>0)if(b.ended&&!e){var h=new Error("stream.push() after EOF");a.emit("error",h)}else if(b.endEmitted&&e){var h=new Error("stream.unshift() after end event");a.emit("error",h)}else{var i;!b.decoder||e||d||(c=b.decoder.write(c),i=!b.objectMode&&0===c.length),e||(b.reading=!1),i||(b.flowing&&0===b.length&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,e?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&l(a))),n(a,b)}else e||(b.reading=!1);return g(b)}function g(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function h(a){return a>=J?a=J:(a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++),a}function i(a,b){return 0===b.length&&b.ended?0:b.objectMode?0===a?0:1:null===a||isNaN(a)?b.flowing&&b.buffer.length?b.buffer[0].length:b.length:0>=a?0:(a>b.highWaterMark&&(b.highWaterMark=h(a)),a>b.length?b.ended?b.length:(b.needReadable=!0,0):a)}function j(a,b){var c=null;return B.isBuffer(b)||"string"==typeof b||null===b||void 0===b||a.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c}function k(a,b){if(!b.ended){if(b.decoder){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,l(a)}}function l(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(G("emitReadable",b.flowing),b.emittedReadable=!0,b.sync?z(m,a):m(a))}function m(a){G("emit readable"),a.emit("readable"),t(a)}function n(a,b){b.readingMore||(b.readingMore=!0,z(o,a,b))}function o(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(G("maybeReadMore read 0"),a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function p(a){return function(){var b=a._readableState;G("pipeOnDrain",b.awaitDrain),b.awaitDrain&&b.awaitDrain--,0===b.awaitDrain&&D(a,"data")&&(b.flowing=!0,t(a))}}function q(a){G("readable nexttick read 0"),a.read(0)}function r(a,b){b.resumeScheduled||(b.resumeScheduled=!0,z(s,a,b))}function s(a,b){b.reading||(G("resume read 0"),a.read(0)),b.resumeScheduled=!1,a.emit("resume"),t(a),b.flowing&&!b.reading&&a.read(0)}function t(a){var b=a._readableState;if(G("flow",b.flowing),b.flowing)do var c=a.read();while(null!==c&&b.flowing)}function u(a,b){var c,d=b.buffer,e=b.length,f=!!b.decoder,g=!!b.objectMode;if(0===d.length)return null;if(0===e)c=null;else if(g)c=d.shift();else if(!a||a>=e)c=f?d.join(""):1===d.length?d[0]:B.concat(d,e),d.length=0;else if(a<d[0].length){var h=d[0];c=h.slice(0,a),d[0]=h.slice(a)}else if(a===d[0].length)c=d.shift();else{c=f?"":new B(a);for(var i=0,j=0,k=d.length;k>j&&a>i;j++){var h=d[0],l=Math.min(a-i,h.length);f?c+=h.slice(0,l):h.copy(c,i,0,l),l<h.length?d[0]=h.slice(l):d.shift(),i+=l}}return c}function v(a){var b=a._readableState;if(b.length>0)throw new Error("endReadable called on non-empty stream");b.endEmitted||(b.ended=!0,z(w,b,a))}function w(a,b){a.endEmitted||0!==a.length||(a.endEmitted=!0,b.readable=!1,b.emit("end"))}function x(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}function y(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}b.exports=e;var z=a("process-nextick-args"),A=a("isarray"),B=a("buffer").Buffer;e.ReadableState=d;var C,D=(a("events"),function(a,b){return a.listeners(b).length});!function(){try{C=a("stream")}catch(a){}finally{C||(C=a("events").EventEmitter)}}();var B=a("buffer").Buffer,E=a("core-util-is");E.inherits=a("inherits");var F=a("util"),G=void 0;G=F&&F.debuglog?F.debuglog("stream"):function(){};var H;E.inherits(e,C);var I,I;e.prototype.push=function(a,b){var c=this._readableState;return c.objectMode||"string"!=typeof a||(b=b||c.defaultEncoding,b!==c.encoding&&(a=new B(a,b),b="")),f(this,c,a,b,!1)},e.prototype.unshift=function(a){var b=this._readableState;return f(this,b,a,"",!0)},e.prototype.isPaused=function(){return this._readableState.flowing===!1},e.prototype.setEncoding=function(b){return H||(H=a("string_decoder/").StringDecoder),this._readableState.decoder=new H(b),this._readableState.encoding=b,this};var J=8388608;e.prototype.read=function(a){G("read",a);var b=this._readableState,c=a;if(("number"!=typeof a||a>0)&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return G("read: emitReadable",b.length,b.ended),0===b.length&&b.ended?v(this):l(this),null;if(a=i(a,b),0===a&&b.ended)return 0===b.length&&v(this),null;var d=b.needReadable;G("need readable",d),(0===b.length||b.length-a<b.highWaterMark)&&(d=!0,G("length less than watermark",d)),(b.ended||b.reading)&&(d=!1,G("reading or ended",d)),d&&(G("do read"),b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1),d&&!b.reading&&(a=i(c,b));var e;return e=a>0?u(a,b):null,null===e&&(b.needReadable=!0,a=0),b.length-=a,0!==b.length||b.ended||(b.needReadable=!0),c!==a&&b.ended&&0===b.length&&v(this),null!==e&&this.emit("data",e),e},e.prototype._read=function(){this.emit("error",new Error("not implemented"))},e.prototype.pipe=function(a,b){function d(a){G("onunpipe"),a===l&&f()}function e(){G("onend"),a.end()}function f(){G("cleanup"),a.removeListener("close",i),a.removeListener("finish",j),a.removeListener("drain",q),a.removeListener("error",h),a.removeListener("unpipe",d),l.removeListener("end",e),l.removeListener("end",f),l.removeListener("data",g),r=!0,!m.awaitDrain||a._writableState&&!a._writableState.needDrain||q()}function g(b){G("ondata");var c=a.write(b);!1===c&&(1!==m.pipesCount||m.pipes[0]!==a||1!==l.listenerCount("data")||r||(G("false write response, pause",l._readableState.awaitDrain),l._readableState.awaitDrain++),l.pause())}function h(b){G("onerror",b),k(),a.removeListener("error",h),0===D(a,"error")&&a.emit("error",b)}function i(){a.removeListener("finish",j),k()}function j(){G("onfinish"),a.removeListener("close",i),k()}function k(){G("unpipe"),l.unpipe(a)}var l=this,m=this._readableState;switch(m.pipesCount){case 0:m.pipes=a;break;case 1:m.pipes=[m.pipes,a];break;default:m.pipes.push(a)}m.pipesCount+=1,G("pipe count=%d opts=%j",m.pipesCount,b);var n=(!b||b.end!==!1)&&a!==c.stdout&&a!==c.stderr,o=n?e:f;m.endEmitted?z(o):l.once("end",o),a.on("unpipe",d);var q=p(l);a.on("drain",q);var r=!1;return l.on("data",g),a._events&&a._events.error?A(a._events.error)?a._events.error.unshift(h):a._events.error=[h,a._events.error]:a.on("error",h),a.once("close",i),a.once("finish",j),a.emit("pipe",l),m.flowing||(G("pipe resume"),l.resume()),a},e.prototype.unpipe=function(a){var b=this._readableState;if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,a&&a.emit("unpipe",this),this);if(!a){var c=b.pipes,d=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var e=0;d>e;e++)c[e].emit("unpipe",this);return this}var f=y(b.pipes,a);return-1===f?this:(b.pipes.splice(f,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this),this)},e.prototype.on=function(a,b){var c=C.prototype.on.call(this,a,b);if("data"===a&&!1!==this._readableState.flowing&&this.resume(),"readable"===a&&!this._readableState.endEmitted){var d=this._readableState;d.readableListening||(d.readableListening=!0,d.emittedReadable=!1,d.needReadable=!0,d.reading?d.length&&l(this,d):z(q,this))}return c},e.prototype.addListener=e.prototype.on,e.prototype.resume=function(){var a=this._readableState;return a.flowing||(G("resume"),a.flowing=!0,r(this,a)),this},e.prototype.pause=function(){return G("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(G("pause"),this._readableState.flowing=!1,this.emit("pause")),this},e.prototype.wrap=function(a){var b=this._readableState,c=!1,d=this;a.on("end",function(){if(G("wrapped end"),b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)}),a.on("data",function(e){if(G("wrapped data"),b.decoder&&(e=b.decoder.write(e)),(!b.objectMode||null!==e&&void 0!==e)&&(b.objectMode||e&&e.length)){var f=d.push(e);f||(c=!0,a.pause())}});for(var e in a)void 0===this[e]&&"function"==typeof a[e]&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));var f=["error","close","destroy","pause","resume"];return x(f,function(b){a.on(b,d.emit.bind(d,b))}),d._read=function(b){G("wrapped _read",b),c&&(c=!1,a.resume())},d},e._fromList=u}).call(this,a("_process"))},{"./_stream_duplex":158,_process:185,buffer:5,"core-util-is":70,events:73,inherits:94,isarray:96,"process-nextick-args":184,"string_decoder/":164,util:4}],161:[function(a,b){"use strict";function c(a){this.afterTransform=function(b,c){return d(a,b,c)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function d(a,b,c){var d=a._transformState;d.transforming=!1;var e=d.writecb;if(!e)return a.emit("error",new Error("no writecb in Transform class"));d.writechunk=null,d.writecb=null,null!==c&&void 0!==c&&a.push(c),e(b);var f=a._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&a._read(f.highWaterMark);
}function e(a){if(!(this instanceof e))return new e(a);g.call(this,a),this._transformState=new c(this);var b=this;this._readableState.needReadable=!0,this._readableState.sync=!1,a&&("function"==typeof a.transform&&(this._transform=a.transform),"function"==typeof a.flush&&(this._flush=a.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(a){f(b,a)}):f(b)})}function f(a,b){if(b)return a.emit("error",b);var c=a._writableState,d=a._transformState;if(c.length)throw new Error("calling transform done when ws.length != 0");if(d.transforming)throw new Error("calling transform done when still transforming");return a.push(null)}b.exports=e;var g=a("./_stream_duplex"),h=a("core-util-is");h.inherits=a("inherits"),h.inherits(e,g),e.prototype.push=function(a,b){return this._transformState.needTransform=!1,g.prototype.push.call(this,a,b)},e.prototype._transform=function(){throw new Error("not implemented")},e.prototype._write=function(a,b,c){var d=this._transformState;if(d.writecb=c,d.writechunk=a,d.writeencoding=b,!d.transforming){var e=this._readableState;(d.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}},e.prototype._read=function(){var a=this._transformState;null!==a.writechunk&&a.writecb&&!a.transforming?(a.transforming=!0,this._transform(a.writechunk,a.writeencoding,a.afterTransform)):a.needTransform=!0}},{"./_stream_duplex":158,"core-util-is":70,inherits:94}],162:[function(a,b){(function(c){"use strict";function d(){}function e(a,b,c){this.chunk=a,this.encoding=b,this.callback=c,this.next=null}function f(b,c){D=D||a("./_stream_duplex"),b=b||{},this.objectMode=!!b.objectMode,c instanceof D&&(this.objectMode=this.objectMode||!!b.writableObjectMode);var d=b.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var f=b.decodeStrings===!1;this.decodeStrings=!f,this.defaultEncoding=b.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){o(c,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new w(this),this.corkedRequestsFree.next=new w(this)}function g(b){return D=D||a("./_stream_duplex"),this instanceof g||this instanceof D?(this._writableState=new f(b,this),this.writable=!0,b&&("function"==typeof b.write&&(this._write=b.write),"function"==typeof b.writev&&(this._writev=b.writev)),void B.call(this)):new g(b)}function h(a,b){var c=new Error("write after end");a.emit("error",c),x(b,c)}function i(a,b,c,d){var e=!0;if(!z.isBuffer(c)&&"string"!=typeof c&&null!==c&&void 0!==c&&!b.objectMode){var f=new TypeError("Invalid non-string/buffer chunk");a.emit("error",f),x(d,f),e=!1}return e}function j(a,b,c){return a.objectMode||a.decodeStrings===!1||"string"!=typeof b||(b=new z(b,c)),b}function k(a,b,c,d,f){c=j(b,c,d),z.isBuffer(c)&&(d="buffer");var g=b.objectMode?1:c.length;b.length+=g;var h=b.length<b.highWaterMark;if(h||(b.needDrain=!0),b.writing||b.corked){var i=b.lastBufferedRequest;b.lastBufferedRequest=new e(c,d,f),i?i.next=b.lastBufferedRequest:b.bufferedRequest=b.lastBufferedRequest,b.bufferedRequestCount+=1}else l(a,b,!1,g,c,d,f);return h}function l(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function m(a,b,c,d,e){--b.pendingcb,c?x(e,d):e(d),a._writableState.errorEmitted=!0,a.emit("error",d)}function n(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function o(a,b){var c=a._writableState,d=c.sync,e=c.writecb;if(n(c),b)m(a,c,d,b,e);else{var f=s(c);f||c.corked||c.bufferProcessing||!c.bufferedRequest||r(a,c),d?y(p,a,c,f,e):p(a,c,f,e)}}function p(a,b,c,d){c||q(a,b),b.pendingcb--,d(),u(a,b)}function q(a,b){0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function r(a,b){b.bufferProcessing=!0;var c=b.bufferedRequest;if(a._writev&&c&&c.next){var d=b.bufferedRequestCount,e=new Array(d),f=b.corkedRequestsFree;f.entry=c;for(var g=0;c;)e[g]=c,c=c.next,g+=1;l(a,b,!0,b.length,e,"",f.finish),b.pendingcb++,b.lastBufferedRequest=null,b.corkedRequestsFree=f.next,f.next=null}else{for(;c;){var h=c.chunk,i=c.encoding,j=c.callback,k=b.objectMode?1:h.length;if(l(a,b,!1,k,h,i,j),c=c.next,b.writing)break}null===c&&(b.lastBufferedRequest=null)}b.bufferedRequestCount=0,b.bufferedRequest=c,b.bufferProcessing=!1}function s(a){return a.ending&&0===a.length&&null===a.bufferedRequest&&!a.finished&&!a.writing}function t(a,b){b.prefinished||(b.prefinished=!0,a.emit("prefinish"))}function u(a,b){var c=s(b);return c&&(0===b.pendingcb?(t(a,b),b.finished=!0,a.emit("finish")):t(a,b)),c}function v(a,b,c){b.ending=!0,u(a,b),c&&(b.finished?x(c):a.once("finish",c)),b.ended=!0,a.writable=!1}function w(a){var b=this;this.next=null,this.entry=null,this.finish=function(c){var d=b.entry;for(b.entry=null;d;){var e=d.callback;a.pendingcb--,e(c),d=d.next}a.corkedRequestsFree?a.corkedRequestsFree.next=b:a.corkedRequestsFree=b}}b.exports=g;var x=a("process-nextick-args"),y=!c.browser&&["v0.10","v0.9."].indexOf(c.version.slice(0,5))>-1?setImmediate:x,z=a("buffer").Buffer;g.WritableState=f;var A=a("core-util-is");A.inherits=a("inherits");var B,C={deprecate:a("util-deprecate")};!function(){try{B=a("stream")}catch(a){}finally{B||(B=a("events").EventEmitter)}}();var z=a("buffer").Buffer;A.inherits(g,B);var D;f.prototype.getBuffer=function(){for(var a=this.bufferedRequest,b=[];a;)b.push(a),a=a.next;return b},function(){try{Object.defineProperty(f.prototype,"buffer",{get:C.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(a){}}();var D;g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},g.prototype.write=function(a,b,c){var e=this._writableState,f=!1;return"function"==typeof b&&(c=b,b=null),z.isBuffer(a)?b="buffer":b||(b=e.defaultEncoding),"function"!=typeof c&&(c=d),e.ended?h(this,c):i(this,e,a,c)&&(e.pendingcb++,f=k(this,e,a,b,c)),f},g.prototype.cork=function(){var a=this._writableState;a.corked++},g.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,a.writing||a.corked||a.finished||a.bufferProcessing||!a.bufferedRequest||r(this,a))},g.prototype.setDefaultEncoding=function(a){if("string"==typeof a&&(a=a.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((a+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+a);this._writableState.defaultEncoding=a},g.prototype._write=function(a,b,c){c(new Error("not implemented"))},g.prototype._writev=null,g.prototype.end=function(a,b,c){var d=this._writableState;"function"==typeof a?(c=a,a=null,b=null):"function"==typeof b&&(c=b,b=null),null!==a&&void 0!==a&&this.write(a,b),d.corked&&(d.corked=1,this.uncork()),d.ending||d.finished||v(this,d,c)}}).call(this,a("_process"))},{"./_stream_duplex":158,_process:185,buffer:5,"core-util-is":70,events:73,inherits:94,"process-nextick-args":184,"util-deprecate":188}],163:[function(a,b,c){var d=function(){try{return a("stream")}catch(a){}}();c=b.exports=a("./lib/_stream_readable.js"),c.Stream=d||c,c.Readable=c,c.Writable=a("./lib/_stream_writable.js"),c.Duplex=a("./lib/_stream_duplex.js"),c.Transform=a("./lib/_stream_transform.js"),c.PassThrough=a("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":158,"./lib/_stream_passthrough.js":159,"./lib/_stream_readable.js":160,"./lib/_stream_transform.js":161,"./lib/_stream_writable.js":162}],164:[function(a,b,c){function d(a){if(a&&!i(a))throw new Error("Unknown encoding: "+a)}function e(a){return a.toString(this.encoding)}function f(a){this.charReceived=a.length%2,this.charLength=this.charReceived?2:0}function g(a){this.charReceived=a.length%3,this.charLength=this.charReceived?3:0}var h=a("buffer").Buffer,i=h.isEncoding||function(a){switch(a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},j=c.StringDecoder=function(a){switch(this.encoding=(a||"utf8").toLowerCase().replace(/[-_]/,""),d(a),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=f;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=g;break;default:return void(this.write=e)}this.charBuffer=new h(6),this.charReceived=0,this.charLength=0};j.prototype.write=function(a){for(var b="";this.charLength;){var c=a.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:a.length;if(a.copy(this.charBuffer,this.charReceived,0,c),this.charReceived+=c,this.charReceived<this.charLength)return"";a=a.slice(c,a.length),b=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var d=b.charCodeAt(b.length-1);if(!(d>=55296&&56319>=d)){if(this.charReceived=this.charLength=0,0===a.length)return b;break}this.charLength+=this.surrogateSize,b=""}this.detectIncompleteChar(a);var e=a.length;this.charLength&&(a.copy(this.charBuffer,0,a.length-this.charReceived,e),e-=this.charReceived),b+=a.toString(this.encoding,0,e);var e=b.length-1,d=b.charCodeAt(e);if(d>=55296&&56319>=d){var f=this.surrogateSize;return this.charLength+=f,this.charReceived+=f,this.charBuffer.copy(this.charBuffer,f,0,f),a.copy(this.charBuffer,0,0,f),b.substring(0,e)}return b},j.prototype.detectIncompleteChar=function(a){for(var b=a.length>=3?3:a.length;b>0;b--){var c=a[a.length-b];if(1==b&&c>>5==6){this.charLength=2;break}if(2>=b&&c>>4==14){this.charLength=3;break}if(3>=b&&c>>3==30){this.charLength=4;break}}this.charReceived=b},j.prototype.end=function(a){var b="";if(a&&a.length&&(b=this.write(a)),this.charReceived){var c=this.charReceived,d=this.charBuffer,e=this.encoding;b+=d.slice(0,c).toString(e)}return b}},{buffer:5}],165:[function(a,b){"use strict";var c=a("./lib/utils/common").assign,d=a("./lib/deflate"),e=a("./lib/inflate"),f=a("./lib/zlib/constants"),g={};c(g,d,e,f),b.exports=g},{"./lib/deflate":166,"./lib/inflate":167,"./lib/utils/common":168,"./lib/zlib/constants":171}],166:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:s,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==p)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e="string"==typeof b.dictionary?j.string2buf(b.dictionary):"[object ArrayBuffer]"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,c=h.deflateSetDictionary(this.strm,e),c!==p)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=a("./zlib/deflate"),i=a("./utils/common"),j=a("./utils/strings"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=Object.prototype.toString,n=0,o=4,p=0,q=1,r=2,s=-1,t=0,u=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?o:n,e.input="string"==typeof a?j.string2buf(a):"[object ArrayBuffer]"===m.call(a)?new Uint8Array(a):a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),c=h.deflate(e,d),c!==q&&c!==p)return this.onEnd(c),this.ended=!0,!1;(0===e.avail_out||0===e.avail_in&&(d===o||d===r))&&this.onData("string"===this.options.to?j.buf2binstring(i.shrinkBuf(e.output,e.next_out)):i.shrinkBuf(e.output,e.next_out))}while((e.avail_in>0||0===e.avail_out)&&c!==q);return d===o?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===p):d!==r||(this.onEnd(p),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===p&&(this.result="string"===this.options.to?this.chunks.join(""):i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=d,c.deflate=e,c.deflateRaw=f,c.gzip=g},{"./utils/common":168,"./utils/strings":169,"./zlib/deflate":173,"./zlib/messages":178,"./zlib/zstream":180}],167:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=a("./zlib/inflate"),h=a("./utils/common"),i=a("./utils/strings"),j=a("./zlib/constants"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=a("./zlib/gzheader"),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?j.Z_FINISH:j.Z_NO_FLUSH,m.input="string"==typeof a?i.binstring2buf(a):"[object ArrayBuffer]"===n.call(a)?new Uint8Array(a):a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l="string"==typeof p?i.string2buf(p):"[object ArrayBuffer]"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&q===!0&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0===m.avail_out||c===j.Z_STREAM_END||0===m.avail_in&&(d===j.Z_FINISH||d===j.Z_SYNC_FLUSH))&&("string"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=d,c.inflate=e,c.inflateRaw=f,c.ungzip=e},{"./utils/common":168,"./utils/strings":169,"./zlib/constants":171,"./zlib/gzheader":174,"./zlib/inflate":176,"./zlib/messages":178,"./zlib/zstream":180}],168:[function(a,b,c){"use strict";function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var e in c)d(c,e)&&(a[e]=c[e])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var f={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;c>b;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;c>b;b++)f=a[b],g.set(f,e),e+=f.length;return g}},g={arraySet:function(a,b,c,d,e){for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,f)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,g))},c.setTyped(e)},{}],169:[function(a,b,c){"use strict";function d(a,b){if(65537>b&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;b>d;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(a){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){g=!1}for(var h=new e.Buf8(256),i=0;256>i;i++)h[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;h[254]=h[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;h>f;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=128>c?1:2048>c?2:65536>c?3:4;for(b=new e.Buf8(i),g=0,f=0;i>g;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),128>c?b[g++]=c:2048>c?(b[g++]=192|c>>>6,b[g++]=128|63&c):65536>c?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;d>c;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,i=b||a.length,j=new Array(2*i);for(e=0,c=0;i>c;)if(f=a[c++],128>f)j[e++]=f;else if(g=h[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&i>c;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:65536>f?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return 0>c?b:0===c?b:c+h[a[c]]>b?c:b}},{"./common":168}],170:[function(a,b){"use strict";function c(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0}b.exports=c},{}],171:[function(a,b){"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],172:[function(a,b){"use strict";function c(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function d(a,b,c,d){var f=e,g=d+c;a^=-1;for(var h=d;g>h;h++)a=a>>>8^f[255&(a^b[h])];return-1^a}var e=c();b.exports=d},{}],173:[function(a,b,c){"use strict";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-la?a.strstart-(a.w_size-la):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ka,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&m>f);if(d=ka-(m-f),f=m-ka,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-la)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ja)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ja-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ja)););}while(a.lookahead<la&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return ua;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return ua;if(a.strstart-a.block_start>=a.w_size-la&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?ua:ua}function o(a,b){for(var c,d;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c)),a.match_length>=ja)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ja),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ja){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function p(a,b){for(var c,d,e;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ja-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ja&&a.strstart-a.match_start>4096)&&(a.match_length=ja-1)),a.prev_length>=ja&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ja,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ja),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=ja-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return ua}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ua}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ka){if(m(a),a.lookahead<=ka&&b===J)return ua;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ja&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ka;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&f>e);a.match_length=ka-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ja?(c=F._tr_tally(a,1,a.match_length-ja),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return ua;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ja-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*ha),this.dyn_dtree=new E.Buf16(2*(2*fa+1)),this.bl_tree=new E.Buf16(2*(2*ga+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ia+1),this.heap=new E.Buf16(2*ea+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ea+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?na:sa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),0>e?(h=0,e=-e):e>15&&(h=2,e-=16),1>f||f>_||c!==$||8>e||e>15||0>b||b>9||0>g||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ja-1)/ja),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||0>b)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ta&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===na)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=oa):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,ya),h.status=sa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ma),m+=31-m%31,h.status=sa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===oa)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=pa)}else h.status=pa;if(h.status===pa)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=qa)}else h.status=qa;if(h.status===qa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=ra)}else h.status=ra;if(h.status===ra&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=sa)):h.status=sa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ta&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ta){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if((o===wa||o===xa)&&(h.status=ta),o===ua||o===wa)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===va&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status,b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra&&b!==sa&&b!==ta?d(a,Q):(a.state=null,b===sa?d(a,R):O)):Q;
}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,g=c.wrap,2===g||1===g&&c.status!==na||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ja;){d=c.strstart,e=c.lookahead-(ja-1);do c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ja-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++;while(--e);c.strstart=d,c.lookahead=ja-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ja-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=a("../utils/common"),F=a("./trees"),G=a("./adler32"),H=a("./crc32"),I=a("./messages"),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=29,da=256,ea=da+1+ca,fa=30,ga=19,ha=2*ea+1,ia=15,ja=3,ka=258,la=ka+ja+1,ma=32,na=42,oa=69,pa=73,qa=91,ra=103,sa=113,ta=666,ua=1,va=2,wa=3,xa=4,ya=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],c.deflateInit=z,c.deflateInit2=y,c.deflateReset=w,c.deflateResetKeep=v,c.deflateSetHeader=x,c.deflate=A,c.deflateEnd=B,c.deflateSetDictionary=C,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":168,"./adler32":170,"./crc32":172,"./messages":178,"./trees":179}],174:[function(a,b){"use strict";function c(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=c},{}],175:[function(a,b){"use strict";var c=30,d=12;b.exports=function(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;e=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=e.dmax,l=e.wsize,m=e.whave,n=e.wnext,o=e.window,p=e.hold,q=e.bits,r=e.lencode,s=e.distcode,t=(1<<e.lenbits)-1,u=(1<<e.distbits)-1;a:do{15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){e.mode=d;break a}a.msg="invalid literal/length code",e.mode=c;break a}x=65535&v,w&=15,w&&(w>q&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",e.mode=c;break a}if(y=65535&v,w&=15,w>q&&(p+=B[f++]<<q,q+=8,w>q&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",e.mode=c;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&e.sane){a.msg="invalid distance too far back",e.mode=c;break a}if(z=0,A=o,0===n){if(z+=l-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(w>n){if(z+=l+n-w,w-=n,x>w){x-=w;do C[h++]=o[z++];while(--w);if(z=0,x>n){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(g>f&&j>h);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=g>f?5+(g-f):5-(f-g),a.avail_out=j>h?257+(j-h):257-(h-j),e.hold=p,e.bits=q}},{}],176:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,0>b?(c=0,b=-b):(c=(b>>4)+1,48>b&&(b&=15)),b&&(8>b||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,sa)}function k(a){if(ta){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;144>b;)a.lens[b++]=8;for(;256>b;)a.lens[b++]=9;for(;280>b;)a.lens[b++]=7;for(;288>b;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;32>b;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),ta=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=ma;break}if((15&m)!==K){a.msg="unknown compression method",c.mode=ma;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg="unknown compression method",c.mode=ma;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&i>q);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&i>q);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg="invalid block type",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;14>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(16>sa)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=ta+qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg="invalid literal/length code",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=ta+qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[r++];while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;32>n;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e,f=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,d=t(d,b,f,0),d!==c.check)?H:(e=l(a,b,f,f))?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=a("../utils/common"),t=a("./adler32"),u=a("./crc32"),v=a("./inffast"),w=a("./inftrees"),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=ra,ta=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateSetDictionary=p,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":168,"./adler32":170,"./crc32":172,"./inffast":175,"./inftrees":177}],177:[function(a,b){"use strict";var c=a("../utils/common"),d=15,e=852,f=592,g=0,h=1,i=2,j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,n,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new c.Buf16(d+1),Q=new c.Buf16(d+1),R=null,S=0;for(D=0;d>=D;D++)P[D]=0;for(E=0;o>E;E++)P[b[n+E]]++;for(H=C,G=d;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;G>F&&0===P[F];F++);for(F>H&&(H=F),K=1,D=1;d>=D;D++)if(K<<=1,K-=P[D],0>K)return-1;if(K>0&&(a===g||1!==G))return-1;for(Q[1]=0,D=1;d>D;D++)Q[D+1]=Q[D]+P[D];for(E=0;o>E;E++)0!==b[n+E]&&(r[Q[b[n+E]]++]=E);if(a===g?(N=R=r,y=19):a===h?(N=j,O-=257,R=k,S-=257,y=256):(N=l,R=m,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===h&&L>e||a===i&&L>f)return 1;for(;;){z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[n+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;G>I+J&&(K-=P[I+J],!(0>=K));)I++,K<<=1;if(L+=1<<I,a===h&&L>e||a===i&&L>f)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":168}],178:[function(a,b){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],179:[function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return 256>a?ia[a]:ia[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>X-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>X-a.bi_valid,a.bi_valid+=c-X):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;W>=f;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,c=a.heap_max+1;V>c;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(W+1),g=0;for(d=1;W>=d;d++)f[d]=g=g+c[d-1]<<1;for(e=0;b>=e;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(W+1);for(c=0,d=0;Q-1>d;d++)for(ka[d]=c,a=0;a<1<<ba[d];a++)ja[c++]=d;for(ja[c-1]=d,f=0,d=0;16>d;d++)for(la[d]=f,a=0;a<1<<ca[d];a++)ia[f++]=d;for(f>>=7;T>d;d++)for(la[d]=f<<7,a=0;a<1<<ca[d]-7;a++)ia[256+f++]=d;for(b=0;W>=b;b++)g[b]=0;for(a=0;143>=a;)ga[2*a+1]=8,a++,g[8]++;for(;255>=a;)ga[2*a+1]=9,a++,g[9]++;for(;279>=a;)ga[2*a+1]=7,a++,g[7]++;for(;287>=a;)ga[2*a+1]=8,a++,g[8]++;for(n(ga,S+1,g),a=0;T>a;a++)ha[2*a+1]=5,ha[2*a]=k(a,5);ma=new e(ga,ba,R+1,S,W),na=new e(ha,ca,0,T,W),oa=new e(new Array(0),da,0,U,Y)}function p(a){var b;for(b=0;S>b;b++)a.dyn_ltree[2*b]=0;for(b=0;T>b;b++)a.dyn_dtree[2*b]=0;for(b=0;U>b;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*Z]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ja[e],j(a,f+R+1,b),h=ba[f],0!==h&&(e-=ka[f],i(a,e,h)),d--,f=g(d),j(a,f,c),h=ca[f],0!==h&&(d-=la[f],i(a,d,h)));while(k<a.last_lit);j(a,Z,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=V,c=0;i>c;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=2>j?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;c>=d;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(j>h?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*$]++):10>=h?a.bl_tree[2*_]++:a.bl_tree[2*aa]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;c>=d;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(l>h){do j(a,e,a.bl_tree);while(0!==--h)}else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,$,a.bl_tree),i(a,h-3,2)):10>=h?(j(a,_,a.bl_tree),i(a,h-3,3)):(j(a,aa,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=U-1;b>=3&&0===a.bl_tree[2*ea[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;d>e;e++)i(a,a.bl_tree[2*ea[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;31>=b;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;R>b;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){pa||(o(),pa=!0),a.l_desc=new f(a.dyn_ltree,ma),a.d_desc=new f(a.dyn_dtree,na),a.bl_desc=new f(a.bl_tree,oa),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,Z,ga),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,e>=f&&(e=f)):e=f=c+5,e>=c+4&&-1!==b?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,ga,ha)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ja[c]+R+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=a("../utils/common"),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=3,P=258,Q=29,R=256,S=R+1+Q,T=30,U=19,V=2*S+1,W=15,X=16,Y=7,Z=256,$=16,_=17,aa=18,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],da=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ea=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=512,ga=new Array(2*(S+2));d(ga);var ha=new Array(2*T);d(ha);var ia=new Array(fa);d(ia);var ja=new Array(P-O+1);d(ja);var ka=new Array(Q);d(ka);var la=new Array(T);d(la);var ma,na,oa,pa=!1;c._tr_init=B,c._tr_stored_block=C,c._tr_flush_block=E,c._tr_tally=F,c._tr_align=D},{"../utils/common":168}],180:[function(a,b){"use strict";function c(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=c},{}],181:[function(a,b){"use strict";function c(a){var b;a&&a.length&&(b=a,a=b.length);var c=new Uint8Array(a||0);return b&&c.set(b),c.readUInt32LE=e.readUInt32LE,c.writeUInt32LE=e.writeUInt32LE,c.readInt32LE=e.readInt32LE,c.writeInt32LE=e.writeInt32LE,c.readFloatLE=e.readFloatLE,c.writeFloatLE=e.writeFloatLE,c.readDoubleLE=e.readDoubleLE,c.writeDoubleLE=e.writeDoubleLE,c.toString=e.toString,c.write=e.write,c.slice=e.slice,c.copy=e.copy,c._isBuffer=!0,c}function d(a){for(var b,c,d=a.length,e=[],f=0;d>f;f++){if(b=a.charCodeAt(f),b>55295&&57344>b){if(!c){b>56319||f+1===d?e.push(239,191,189):c=b;continue}if(56320>b){e.push(239,191,189),c=b;continue}b=c-55296<<10|b-56320|65536,c=null}else c&&(e.push(239,191,189),c=null);128>b?e.push(b):2048>b?e.push(b>>6|192,63&b|128):65536>b?e.push(b>>12|224,b>>6&63|128,63&b|128):e.push(b>>18|240,b>>12&63|128,b>>6&63|128,63&b|128)}return e}b.exports=c;var e,f,g,h=a("ieee754");e={readUInt32LE:function(a){return(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},writeUInt32LE:function(a,b){this[b]=a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24},readInt32LE:function(a){return(this[a]|this[a+1]<<8|this[a+2]<<16)+(this[a+3]<<24)},readFloatLE:function(a){return h.read(this,a,!0,23,4)},readDoubleLE:function(a){return h.read(this,a,!0,52,8)},writeFloatLE:function(a,b){return h.write(this,a,b,!0,23,4)},writeDoubleLE:function(a,b){return h.write(this,a,b,!0,52,8)},toString:function(a,b,c){var d="",e="";b=b||0,c=Math.min(this.length,c||this.length);for(var f=b;c>f;f++){var g=this[f];127>=g?(d+=decodeURIComponent(e)+String.fromCharCode(g),e=""):e+="%"+g.toString(16)}return d+=decodeURIComponent(e)},write:function(a,b){for(var c=a===f?g:d(a),e=0;e<c.length;e++)this[b+e]=c[e]},slice:function(a,b){return this.subarray(a,b)},copy:function(a,b){b=b||0;for(var c=0;c<this.length;c++)a[b+c]=this[c]}},e.writeInt32LE=e.writeUInt32LE,c.byteLength=function(a){return f=a,g=d(a),g.length},c.isBuffer=function(a){return!(!a||!a._isBuffer)}},{ieee754:93}],182:[function(a,b){(function(c){"use strict";function d(a){this.buf=q.isBuffer(a)?a:new q(a||0),this.pos=0,this.length=this.buf.length}function e(a,b){var c,d=b.buf;if(c=d[b.pos++],a+=268435456*(127&c),128>c)return a;if(c=d[b.pos++],a+=34359738368*(127&c),128>c)return a;if(c=d[b.pos++],a+=4398046511104*(127&c),128>c)return a;if(c=d[b.pos++],a+=562949953421312*(127&c),128>c)return a;if(c=d[b.pos++],a+=72057594037927940*(127&c),128>c)return a;if(c=d[b.pos++],a+=0x8000000000000000*(127&c),128>c)return a;throw new Error("Expected varint not more than 10 bytes")}function f(a,b){b.realloc(10);for(var c=b.pos+10;a>=1;){if(b.pos>=c)throw new Error("Given varint doesn't fit into 10 bytes");var d=255&a;b.buf[b.pos++]=d|(a>=128?128:0),a/=128}}function g(a,b,c){var d=16383>=b?1:2097151>=b?2:268435455>=b?3:Math.ceil(Math.log(b)/(7*Math.LN2));c.realloc(d);for(var e=c.pos-1;e>=a;e--)c.buf[e+d]=c.buf[e]}function h(a,b){for(var c=0;c<a.length;c++)b.writeVarint(a[c])}function i(a,b){for(var c=0;c<a.length;c++)b.writeSVarint(a[c])}function j(a,b){for(var c=0;c<a.length;c++)b.writeFloat(a[c])}function k(a,b){for(var c=0;c<a.length;c++)b.writeDouble(a[c])}function l(a,b){for(var c=0;c<a.length;c++)b.writeBoolean(a[c])}function m(a,b){for(var c=0;c<a.length;c++)b.writeFixed32(a[c])}function n(a,b){for(var c=0;c<a.length;c++)b.writeSFixed32(a[c])}function o(a,b){for(var c=0;c<a.length;c++)b.writeFixed64(a[c])}function p(a,b){for(var c=0;c<a.length;c++)b.writeSFixed64(a[c])}b.exports=d;var q=c.Buffer||a("./buffer");d.Varint=0,d.Fixed64=1,d.Bytes=2,d.Fixed32=5;var r=4294967296,s=1/r,t=Math.pow(2,63);d.prototype={destroy:function(){this.buf=null},readFields:function(a,b,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),e=d>>3,f=this.pos;a(e,b,this),this.pos===f&&this.skip(d)}return b},readMessage:function(a,b){return this.readFields(a,b,this.readVarint()+this.pos)},readFixed32:function(){var a=this.buf.readUInt32LE(this.pos);return this.pos+=4,a},readSFixed32:function(){var a=this.buf.readInt32LE(this.pos);return this.pos+=4,a},readFixed64:function(){var a=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*r;return this.pos+=8,a},readSFixed64:function(){var a=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*r;return this.pos+=8,a},readFloat:function(){var a=this.buf.readFloatLE(this.pos);return this.pos+=4,a},readDouble:function(){var a=this.buf.readDoubleLE(this.pos);return this.pos+=8,a},readVarint:function(){var a,b,c=this.buf;return b=c[this.pos++],a=127&b,128>b?a:(b=c[this.pos++],a|=(127&b)<<7,128>b?a:(b=c[this.pos++],a|=(127&b)<<14,128>b?a:(b=c[this.pos++],a|=(127&b)<<21,128>b?a:e(a,this))))},readVarint64:function(){var a=this.pos,b=this.readVarint();if(t>b)return b;for(var c=this.pos-2;255===this.buf[c];)c--;a>c&&(c=a),b=0;for(var d=0;c-a+1>d;d++){var e=127&~this.buf[a+d];b+=4>d?e<<7*d:e*Math.pow(2,7*d)}return-b-1},readSVarint:function(){var a=this.readVarint();return a%2===1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,b=this.buf.toString("utf8",this.pos,a);return this.pos=a,b},readBytes:function(){var a=this.readVarint()+this.pos,b=this.buf.slice(this.pos,a);return this.pos=a,b},readPackedVarint:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readVarint());return b},readPackedSVarint:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readSVarint());return b},readPackedBoolean:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readBoolean());return b},readPackedFloat:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readFloat());return b},readPackedDouble:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readDouble());return b},readPackedFixed32:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readFixed32());return b},readPackedSFixed32:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readSFixed32());return b},readPackedFixed64:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readFixed64());return b},readPackedSFixed64:function(){for(var a=this.readVarint()+this.pos,b=[];this.pos<a;)b.push(this.readSFixed64());return b},skip:function(a){var b=7&a;if(b===d.Varint)for(;this.buf[this.pos++]>127;);else if(b===d.Bytes)this.pos=this.readVarint()+this.pos;else if(b===d.Fixed32)this.pos+=4;else{if(b!==d.Fixed64)throw new Error("Unimplemented type: "+b);this.pos+=8}},writeTag:function(a,b){this.writeVarint(a<<3|b)},realloc:function(a){for(var b=this.length||16;b<this.pos+a;)b*=2;if(b!==this.length){var c=new q(b);this.buf.copy(c),this.buf=c,this.length=b}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(a){this.realloc(4),this.buf.writeUInt32LE(a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),this.buf.writeInt32LE(a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),this.buf.writeInt32LE(-1&a,this.pos),this.buf.writeUInt32LE(Math.floor(a*s),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),this.buf.writeInt32LE(-1&a,this.pos),this.buf.writeInt32LE(Math.floor(a*s),this.pos+4),this.pos+=8},writeVarint:function(a){return a=+a,a>268435455?void f(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),void(127>=a||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),127>=a||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),127>=a||(this.buf[this.pos++]=a>>>7&127)))))},writeSVarint:function(a){this.writeVarint(0>a?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){
a=String(a);var b=q.byteLength(a);this.writeVarint(b),this.realloc(b),this.buf.write(a,this.pos),this.pos+=b},writeFloat:function(a){this.realloc(4),this.buf.writeFloatLE(a,this.pos),this.pos+=4},writeDouble:function(a){this.realloc(8),this.buf.writeDoubleLE(a,this.pos),this.pos+=8},writeBytes:function(a){var b=a.length;this.writeVarint(b),this.realloc(b);for(var c=0;b>c;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,b){this.pos++;var c=this.pos;a(b,this);var d=this.pos-c;d>=128&&g(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,b,c){this.writeTag(a,d.Bytes),this.writeRawMessage(b,c)},writePackedVarint:function(a,b){this.writeMessage(a,h,b)},writePackedSVarint:function(a,b){this.writeMessage(a,i,b)},writePackedBoolean:function(a,b){this.writeMessage(a,l,b)},writePackedFloat:function(a,b){this.writeMessage(a,j,b)},writePackedDouble:function(a,b){this.writeMessage(a,k,b)},writePackedFixed32:function(a,b){this.writeMessage(a,m,b)},writePackedSFixed32:function(a,b){this.writeMessage(a,n,b)},writePackedFixed64:function(a,b){this.writeMessage(a,o,b)},writePackedSFixed64:function(a,b){this.writeMessage(a,p,b)},writeBytesField:function(a,b){this.writeTag(a,d.Bytes),this.writeBytes(b)},writeFixed32Field:function(a,b){this.writeTag(a,d.Fixed32),this.writeFixed32(b)},writeSFixed32Field:function(a,b){this.writeTag(a,d.Fixed32),this.writeSFixed32(b)},writeFixed64Field:function(a,b){this.writeTag(a,d.Fixed64),this.writeFixed64(b)},writeSFixed64Field:function(a,b){this.writeTag(a,d.Fixed64),this.writeSFixed64(b)},writeVarintField:function(a,b){this.writeTag(a,d.Varint),this.writeVarint(b)},writeSVarintField:function(a,b){this.writeTag(a,d.Varint),this.writeSVarint(b)},writeStringField:function(a,b){this.writeTag(a,d.Bytes),this.writeString(b)},writeFloatField:function(a,b){this.writeTag(a,d.Fixed32),this.writeFloat(b)},writeDoubleField:function(a,b){this.writeTag(a,d.Fixed64),this.writeDouble(b)},writeBooleanField:function(a,b){this.writeVarintField(a,Boolean(b))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":181}],183:[function(a,b){"use strict";function c(a,b){this.x=a,this.y=b}b.exports=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var b=a.x-this.x,c=a.y-this.y;return b*b+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,b){return Math.atan2(this.x*b-this.y*a,this.x*a+this.y*b)},_matMult:function(a){var b=a[0]*this.x+a[1]*this.y,c=a[2]*this.x+a[3]*this.y;return this.x=b,this.y=c,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=b*this.x-c*this.y,e=c*this.x+b*this.y;return this.x=d,this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(a){return a instanceof c?a:Array.isArray(a)?new c(a[0],a[1]):a}},{}],184:[function(a,b){(function(a){"use strict";function c(b,c,d,e){if("function"!=typeof b)throw new TypeError('"callback" argument must be a function');var f,g,h=arguments.length;switch(h){case 0:case 1:return a.nextTick(b);case 2:return a.nextTick(function(){b.call(null,c)});case 3:return a.nextTick(function(){b.call(null,c,d)});case 4:return a.nextTick(function(){b.call(null,c,d,e)});default:for(f=new Array(h-1),g=0;g<f.length;)f[g++]=arguments[g];return a.nextTick(function(){b.apply(null,f)})}}b.exports=!a.version||0===a.version.indexOf("v0.")||0===a.version.indexOf("v1.")&&0!==a.version.indexOf("v1.8.")?c:a.nextTick}).call(this,a("_process"))},{_process:185}],185:[function(a,b){function c(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function e(a){if(k===setTimeout)return setTimeout(a,0);if((k===c||!k)&&setTimeout)return k=setTimeout,setTimeout(a,0);try{return k(a,0)}catch(b){try{return k.call(null,a,0)}catch(b){return k.call(this,a,0)}}}function f(a){if(l===clearTimeout)return clearTimeout(a);if((l===d||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(a);try{return l(a)}catch(b){try{return l.call(null,a)}catch(b){return l.call(this,a)}}}function g(){p&&n&&(p=!1,n.length?o=n.concat(o):q=-1,o.length&&h())}function h(){if(!p){var a=e(g);p=!0;for(var b=o.length;b;){for(n=o,o=[];++q<b;)n&&n[q].run();q=-1,b=o.length}n=null,p=!1,f(a)}}function i(a,b){this.fun=a,this.array=b}function j(){}var k,l,m=b.exports={};!function(){try{k="function"==typeof setTimeout?setTimeout:c}catch(a){k=c}try{l="function"==typeof clearTimeout?clearTimeout:d}catch(a){l=d}}();var n,o=[],p=!1,q=-1;m.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];o.push(new i(a,b)),1!==o.length||p||e(h)},i.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=j,m.addListener=j,m.once=j,m.off=j,m.removeListener=j,m.removeAllListeners=j,m.emit=j,m.prependListener=j,m.prependOnceListener=j,m.listeners=function(){return[]},m.binding=function(){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},{}],186:[function(a,b){"use stric";var c="\\/\\*",d="\\/\\*(?!\\*?\\!)",e="(.|[\\r\\n]|\\n)*?\\*\\/\\n?\\n?",f=/(^|[^\S\n])(?:\/\/)([\s\S]+?)$/gm,g=/(^|[^\S\n])(?:\/\/[^!])([\s\S]+?)$/gm,h=b.exports=function(a,b){return a?h.block(h.line(a,b),b):""};h.block=function(a,b){b=b||{};var f=new RegExp(c+e,"gm");return b.safe&&(f=new RegExp(d+e,"gm")),a?a.replace(f,""):""},h.line=function(a,b){b=b||{};var c=f;return b.safe&&(c=g),a?a.replace(c,""):""}},{}],187:[function(b,c,d){!function(b,e){"object"==typeof d&&"undefined"!=typeof c?e(d):"function"==typeof a&&a.amd?a(["exports"],e):e(b.topojson=b.topojson||{})}(this,function(a){"use strict";function b(a,b){var d=b.id,e=b.bbox,f=null==b.properties?{}:b.properties,g=c(a,b);return null==d&&null==e?{type:"Feature",properties:f,geometry:g}:null==e?{type:"Feature",id:d,properties:f,geometry:g}:{type:"Feature",id:d,bbox:e,properties:f,geometry:g}}function c(a,b){function c(a,b){b.length&&b.pop();for(var c=l[0>a?~a:a],e=0,f=c.length;f>e;++e)b.push(k(c[e].slice(),e));0>a&&d(b,f)}function e(a){return k(a.slice())}function g(a){for(var b=[],d=0,e=a.length;e>d;++d)c(a[d],b);return b.length<2&&b.push(b[0].slice()),b}function h(a){for(var b=g(a);b.length<4;)b.push(b[0].slice());return b}function i(a){return a.map(h)}function j(a){var b,c=a.type;switch(c){case"GeometryCollection":return{type:c,geometries:a.geometries.map(j)};case"Point":b=e(a.coordinates);break;case"MultiPoint":b=a.coordinates.map(e);break;case"LineString":b=g(a.arcs);break;case"MultiLineString":b=a.arcs.map(g);break;case"Polygon":b=i(a.arcs);break;case"MultiPolygon":b=a.arcs.map(i);break;default:return null}return{type:c,coordinates:b}}var k=f(a),l=a.arcs;return j(b)}var d=function(a,b){for(var c,d=a.length,e=d-b;e<--d;)c=a[e],a[e++]=a[d],a[d]=c},e=function(a){return a},f=function(a){if(null==(b=a.transform))return e;var b,c,d,f=b.scale[0],g=b.scale[1],h=b.translate[0],i=b.translate[1];return function(a,b){return b||(c=d=0),a[0]=(c+=a[0])*f+h,a[1]=(d+=a[1])*g+i,a}},g=function(a,c){return"GeometryCollection"===c.type?{type:"FeatureCollection",features:c.geometries.map(function(c){return b(a,c)})}:b(a,c)};a.feature=g,Object.defineProperty(a,"__esModule",{value:!0})})},{}],188:[function(a,b){(function(a){function c(a,b){function c(){if(!e){if(d("throwDeprecation"))throw new Error(b);d("traceDeprecation")?console.trace(b):console.warn(b),e=!0}return a.apply(this,arguments)}if(d("noDeprecation"))return a;var e=!1;return c}function d(b){try{if(!a.localStorage)return!1}catch(a){return!1}var c=a.localStorage[b];return null!=c&&"true"===String(c).toLowerCase()}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],189:[function(a,b,c){arguments[4][94][0].apply(c,arguments)},{dup:94}],190:[function(a,b){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],191:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a){return a}function h(a){var b={};return a.forEach(function(a){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)f.push(F(b,String(g))?m(a,b,c,d,String(g),!0):"");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":190,_process:185,inherits:189}],192:[function(a,b){b.exports.VectorTile=a("./lib/vectortile.js"),b.exports.VectorTileFeature=a("./lib/vectortilefeature.js"),b.exports.VectorTileLayer=a("./lib/vectortilelayer.js")},{"./lib/vectortile.js":193,"./lib/vectortilefeature.js":194,"./lib/vectortilelayer.js":195}],193:[function(a,b){"use strict";function c(a,b){this.layers=a.readFields(d,{},b)}function d(a,b,c){if(3===a){var d=new e(c,c.readVarint()+c.pos);d.length&&(b[d.name]=d)}}var e=a("./vectortilelayer");b.exports=c},{"./vectortilelayer":195}],194:[function(a,b){"use strict";function c(a,b,c,e,f){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=e,this._values=f,a.readFields(d,this,b)}function d(a,b,c){1==a?b.id=c.readVarint():2==a?e(c,b):3==a?b.type=c.readVarint():4==a&&(b._geometry=c.pos)}function e(a,b){for(var c=a.readVarint()+a.pos;a.pos<c;){var d=b._keys[a.readVarint()],e=b._values[a.readVarint()];b.properties[d]=e}}function f(a){var b=a.length;if(1>=b)return[a];for(var c,d,e=[],f=0;b>f;f++){var h=g(a[f]);0!==h&&(void 0===d&&(d=0>h),d===0>h?(c&&e.push(c),c=[a[f]]):c.push(a[f]))}return c&&e.push(c),e}function g(a){for(var b,c,d=0,e=0,f=a.length,g=f-1;f>e;g=e++)b=a[e],c=a[g],d+=(c.x-b.x)*(b.y+c.y);return d}var h=a("point-geometry");b.exports=c,c.types=["Unknown","Point","LineString","Polygon"],c.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var b,c=a.readVarint()+a.pos,d=1,e=0,f=0,g=0,i=[];a.pos<c;){if(!e){var j=a.readVarint();d=7&j,e=j>>3}if(e--,1===d||2===d)f+=a.readSVarint(),g+=a.readSVarint(),1===d&&(b&&i.push(b),b=[]),b.push(new h(f,g));else{if(7!==d)throw new Error("unknown command "+d);b&&b.push(b[0].clone())}}return b&&i.push(b),i},c.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var b=a.readVarint()+a.pos,c=1,d=0,e=0,f=0,g=1/0,h=-1/0,i=1/0,j=-1/0;a.pos<b;){if(!d){var k=a.readVarint();c=7&k,d=k>>3}if(d--,1===c||2===c)e+=a.readSVarint(),f+=a.readSVarint(),g>e&&(g=e),e>h&&(h=e),i>f&&(i=f),f>j&&(j=f);else if(7!==c)throw new Error("unknown command "+c)}return[g,i,h,j]},c.prototype.toGeoJSON=function(a,b,d){function e(a){for(var b=0;b<a.length;b++){var c=a[b],d=180-360*(c.y+k)/i;a[b]=[360*(c.x+j)/i-180,360/Math.PI*Math.atan(Math.exp(d*Math.PI/180))-90]}}var g,h,i=this.extent*Math.pow(2,d),j=this.extent*a,k=this.extent*b,l=this.loadGeometry(),m=c.types[this.type];switch(this.type){case 1:var n=[];for(g=0;g<l.length;g++)n[g]=l[g][0];l=n,e(l);break;case 2:for(g=0;g<l.length;g++)e(l[g]);break;case 3:for(l=f(l),g=0;g<l.length;g++)for(h=0;h<l[g].length;h++)e(l[g][h])}1===l.length?l=l[0]:m="Multi"+m;var o={type:"Feature",geometry:{type:m,coordinates:l},properties:this.properties};return"id"in this&&(o.id=this.id),o}},{"point-geometry":183}],195:[function(a,b){"use strict";function c(a,b){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(d,this,b),this.length=this._features.length}function d(a,b,c){15===a?b.version=c.readVarint():1===a?b.name=c.readString():5===a?b.extent=c.readVarint():2===a?b._features.push(c.pos):3===a?b._keys.push(c.readString()):4===a&&b._values.push(e(c))}function e(a){for(var b=null,c=a.readVarint()+a.pos;a.pos<c;){var d=a.readVarint()>>3;b=1===d?a.readString():2===d?a.readFloat():3===d?a.readDouble():4===d?a.readVarint64():5===d?a.readVarint():6===d?a.readSVarint():7===d?a.readBoolean():null}return b}var f=a("./vectortilefeature.js");b.exports=c,c.prototype.feature=function(a){if(0>a||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var b=this._pbf.readVarint()+this._pbf.pos;return new f(this._pbf,b,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":194}],196:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c){var d=i[0],e=i[1];return a[0]<=d.x+c&&b[0]<=d.x+c||a[0]>=e.x-c&&b[0]>=e.x-c||a[1]>=d.y-c&&b[1]>=d.y-c||a[1]<=e.y+c&&b[1]<=e.y+c}function f(a,b){b=b||0;var c=i[0],d=i[1];return a[0]<=c.x+b||a[0]>=d.x-b||a[1]>=c.y-b||a[1]<=d.y+b}Object.defineProperty(c,"__esModule",{value:!0}),c.default_uvs=c.tile_bounds=void 0,c.outsideTile=e,c.isCoordOutsideTile=f;var g=a("../geo"),h=d(g),i=c.tile_bounds=[{x:0,y:0},{x:h.default.tile_scale,y:-h.default.tile_scale}];c.default_uvs=[0,0,1,1]},{"../geo":201}],197:[function(a,b,c){"use strict";function d(a,b,c,d,g){var h=d.texcoord_index,i=d.position_index,j=d.shape_index,k=d.offset_index,l=d.offsets_index,m=d.pre_angles_index,n=d.angles_index,o=g.quad,p=g.quad_normalize,q=g.offset,r=g.offsets,s=g.pre_angles,t=g.angle,u=g.angles,v=g.curve,w=g.texcoord_scale,x=g.texcoord_normalize,y=g.pre_angles_normalize,z=g.angles_normalize,A=g.offsets_normalize;p=p||1;var B=o[0]/2*p,C=o[1]/2*p,D=[[-B,-C],[B,-C],[B,C],[-B,C]],E=b.vertex_elements,F=b.vertex_count,G=void 0;if(h){x=x||1;var H=w||f.default_uvs,I=e(H,4),J=I[0],K=I[1],L=I[2],M=I[3];G=[[J,K],[L,K],[L,M],[J,M]]}for(var N=0,O=a.length,P=0;O>P;P++){for(var Q=a[P],R=0;4>R;R++)h&&(c[h+0]=G[R][0]*x,c[h+1]=G[R][1]*x),c[i+0]=Q[0],c[i+1]=Q[1],c[j+0]=D[R][0],c[j+1]=D[R][1],c[j+2]=t,c[k+0]=q[0],c[k+1]=q[1],v&&(c[m+0]=y*s[0],c[m+1]=y*s[1],c[m+2]=y*s[2],c[m+3]=y*s[3],c[n+0]=z*u[0],c[n+1]=z*u[1],c[n+2]=z*u[2],c[n+3]=z*u[3],c[l+0]=A*r[0],c[l+1]=A*r[1],c[l+2]=A*r[2],c[l+3]=A*r[3]),b.addVertex(c);E.push(F+0),E.push(F+1),E.push(F+2),E.push(F+2),E.push(F+3),E.push(F+0),F+=4,N+=2}return N}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();c.buildQuadsForPoints=d;var f=a("./common")},{"./common":196}],198:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c,d){var e=d.texcoord_index,f=d.texcoord_scale,i=d.texcoord_normalize,k=b.vertex_elements;if(e){i=i||1;var l=f||m.default_uvs,n=h(l,4),p=n[0],q=n[1],r=n[2],s=n[3]}for(var t=0,u=a.length,v=0;u>v;v++){var w=b.vertex_count,x=a[v];if(e)var y=j.default.findBoundingBox(x),z=h(y,4),A=z[0],B=z[1],C=z[2],D=z[3],E=C-A,F=D-B,G=(r-p)/E,H=(s-q)/F;for(var I=0;I<x.length;I++)for(var J=x[I],K=0;K<J.length;K++){var L=J[K];c[0]=L[0],c[1]=L[1],e&&(c[e+0]=((L[0]-A)*G+p)*i,c[e+1]=((L[1]-B)*H+q)*i),b.addVertex(c)}for(var M=g(o.default.flatten(x)),N=0;N<M.length;N++)k.push(w+M[N]);t+=M.length/3}return t}function f(a,b,c,d,f,g,i,j,k){var n=k.remove_tile_edges,o=k.tile_edge_tolerance,q=k.texcoord_index,r=k.texcoord_scale,s=k.texcoord_normalize,t=k.winding,u=b+(d||0),v=b+c;g[2]=v;var w=e(a,f,g,{texcoord_index:q,texcoord_scale:r,texcoord_normalize:s}),x=f.vertex_elements,y=f.vertex_count;if(q){s=s||1;var z=r||m.default_uvs,A=h(z,4),B=A[0],C=A[1],D=A[2],E=A[3],F=[[B,E],[B,C],[D,C],[D,E]]}for(var G=a.length,H=0;G>H;H++)for(var I=a[H],J=0;J<I.length;J++)for(var K=I[J],L=0;L<K.length-1;L++)if(!n||!m.outsideTile(K[L],K[L+1],o)){var M=void 0,N=void 0;"CCW"===t?(M=L,N=L+1):(M=L+1,N=L);var O=[[K[N][0],K[N][1],v],[K[N][0],K[N][1],u],[K[M][0],K[M][1],u],[K[M][0],K[M][1],v]],P=l.default.normalize([K[N][0]-K[M][0],K[N][1]-K[M][1],0]),Q=l.default.cross(p,P);g[i+0]=Q[0]*j,g[i+1]=Q[1]*j,g[i+2]=Q[2]*j;for(var R=0;R<O.length;R++)g[0]=O[R][0],g[1]=O[R][1],g[2]=O[R][2],q&&(g[q+0]=F[R][0]*s,g[q+1]=F[R][1]*s),f.addVertex(g);x.push(y+0),x.push(y+1),x.push(y+2),x.push(y+2),x.push(y+3),x.push(y+0),y+=4,w+=2}return w}function g(a){return o.default(a.vertices,a.holes,a.dimensions)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();c.buildPolygons=e,c.buildExtrudedPolygons=f,c.triangulatePolygon=g;var i=a("../geo"),j=d(i),k=a("../vector"),l=d(k),m=a("./common"),n=a("earcut"),o=d(n),p=[0,0,1]},{"../geo":201,"../vector":272,"./common":196,earcut:72}],199:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c,d,e){var g=e.closed_polygon,h=e.remove_tile_edges,i=e.tile_edge_tolerance,j=e.texcoord_index,k=(e.texcoord_scale,e.texcoord_width),l=e.texcoord_ratio,m=e.texcoord_normalize,n=e.scaling_index,o=e.scaling_normalize,p=e.join,q=e.cap,r=e.miter_limit,s=q?B[q]:B.butt,t=p?C[p]:C.miter;if(t===C.miter){r=r||D.MITER_LIMIT;var u=r*r}var v;j&&(m=m||D.TEXCOORD_NORMALIZE,l=l||D.TEXCOORD_RATIO,v=1/(k*l*E));for(var w={closed_polygon:g,remove_tile_edges:h,tile_edge_tolerance:i,miter_len_sq:u,join_type:t,cap_type:s,vertex_data:c,vertex_template:d,half_width:b/2,scaling_index:n,scaling_normalize:o,v_scale:v,texcoord_index:j,texcoord_width:k,texcoord_normalize:m,geom_count:0},x=[],y=0;y<a.length;y++)f(a[y],w,x);for(var z=0;z<x.length;z++)f(x[z],w,x);return w.geom_count}function f(a,b,c){if(!(a.length<2)){var d=b.join_type,e=b.cap_type,f=b.closed_polygon,k=b.remove_tile_edges,p=b.tile_edge_tolerance,q=b.v_scale,r=b.miter_len_sq;if(f&&d===C.miter){var t=g(a);if(0!==t){var v=u(a,t);return void c.push(v)}}var x,y,A,D,E=0,F=0,G=a.length-1,H=0;for(x=a[F],y=a[F+1];w.default.isEqual(x,y);)if(F++,x=y,y=a[F+1],H++,F===a.length-1)return;for(;w.default.isEqual(a[G],a[G-1]);)if(G--,H++,0===G)return;if(!(a.length<2+H)){if(D=w.default.normalize(w.default.perp(x,y)),k&&z.outsideTile(x,y,p)){var I=h(a,F,p);return void(I&&c.push(I))}f?(A=w.default.normalize(w.default.perp(a[G-1],x)),i(x,A,D,d,b)):(z.isCoordOutsideTile(x)||(s(x,E,D,e,!0,b),e!==B.butt&&(E+=.5*q*b.texcoord_width)),o(x,D,[1,E],b),o(x,w.default.neg(D),[0,E],b)),E+=q*w.default.length(w.default.sub(y,x));for(var J=F+1;G>J;J++){var K=J,L=J+1;if(x=a[K],y=a[L],!w.default.isEqual(x,y)){if(k&&z.outsideTile(x,y,p)){o(x,D,[1,E],b),o(x,w.default.neg(D),[0,E],b),n(1,b);var M=h(a,K+1,p);return void(M&&c.push(M))}A=D,D=w.default.normalize(w.default.perp(x,y)),d===C.miter?l(E,x,A,D,r,!1,b):m(d,E,x,A,D,!1,b),E+=q*w.default.length(w.default.sub(y,x))}}x=y,A=D,f?(D=w.default.normalize(w.default.perp(x,a[1])),j(x,A,D,d,E,b)):(o(x,A,[1,E],b),o(x,w.default.neg(A),[0,E],b),n(1,b),z.isCoordOutsideTile(x)||s(x,E,A,e,!1,b))}}}function g(a){if(z.isCoordOutsideTile(a[0]))return 0;for(var b=0;b<a.length;b++){var c=a[a.length-1-b];if(z.isCoordOutsideTile(c))return a.length-1-b}return 0}function h(a,b,c){for(var d=b;a[d+1]&&z.outsideTile(a[d],a[d+1],c);)d++;return a.length-d>=2&&a.slice(d)}function i(a,b,c,d,e){if(void 0===d||z.isCoordOutsideTile(a))o(a,c,[1,0],e),o(a,w.default.neg(c),[0,0],e);else{var f=0;d===C.miter?l(f,a,b,c,e.miter_len_sq,!0,e):m(d,f,a,b,c,!0,e)}}function j(a,b,c,d,e,f){if(z.isCoordOutsideTile(a))o(a,b,[1,e],f),o(a,w.default.neg(b),[0,e],f),n(1,f);else{var g=k(b,c);d===C.miter&&w.default.lengthSq(g)>f.miter_len_sq&&(d=C.bevel),d===C.miter?(o(a,g,[1,e],f),o(a,w.default.neg(g),[0,e],f),n(1,f)):(o(a,b,[1,e],f),o(a,w.default.neg(b),[0,e],f),n(1,f))}}function k(a,b){var c=w.default.normalize(w.default.add(a,b)),d=2/(1+Math.abs(w.default.dot(a,c)));return w.default.mult(c,d*d)}function l(a,b,c,d,e,f,g){var h=k(c,d);w.default.lengthSq(h)>e?m(C.bevel,a,b,c,d,f,g):(o(b,h,[1,a],g),o(b,w.default.neg(h),[0,a],g),f||n(1,g))}function m(a,b,c,d,e,f,g){var h=k(d,e),i=e[0]*d[1]-e[1]*d[0]>0;i?(o(c,h,[1,b],g),o(c,w.default.neg(d),[0,b],g),f||n(1,g),a===C.bevel?r(c,w.default.neg(d),h,w.default.neg(e),[0,b],[1,b],[0,b],g):a===C.round&&q(c,w.default.neg(d),h,w.default.neg(e),[0,b],[1,b],[0,b],!1,g),o(c,h,[1,b],g),o(c,w.default.neg(e),[0,b],g)):(o(c,d,[1,b],g),o(c,w.default.neg(h),[0,b],g),f||n(1,g),a===C.bevel?r(c,d,w.default.neg(h),e,[1,b],[0,b],[1,b],g):a===C.round&&q(c,d,w.default.neg(h),e,[1,b],[0,b],[1,b],!1,g),o(c,e,[1,b],g),o(c,w.default.neg(h),[0,b],g))}function n(a,b){for(var c=b.vertex_data.vertex_elements,d=b.vertex_data.vertex_count,e=d-2*a-2,f=0;a>f;f++)c.push(e+2*f+2),c.push(e+2*f+1),c.push(e+2*f+0),c.push(e+2*f+2),c.push(e+2*f+3),c.push(e+2*f+1),b.geom_count+=2}function o(a,b,c,d){var e=d.vertex_template,f=d.vertex_data;p(e,a,c,b,d),f.addVertex(e)}function p(a,b,c,d,e){a[0]=b[0],a[1]=b[1],e.texcoord_index&&c&&(a[e.texcoord_index+0]=c[0]*e.texcoord_normalize,a[e.texcoord_index+1]=c[1]*e.texcoord_normalize),e.scaling_index&&(a[e.scaling_index+0]=d[0]*e.scaling_normalize,a[e.scaling_index+1]=d[1]*e.scaling_normalize,a[e.scaling_index+2]=e.half_width)}function q(a,b,c,d,e,f,g,h,i){for(var j=b[0]*d[1]-b[1]*d[0],k=w.default.dot(b,d),l=Math.atan2(j,k);l>=Math.PI;)l-=2*Math.PI;var m=t(l,i.half_width);if(!(1>m)){var n=i.vertex_data.vertex_count,p=i.vertex_data.vertex_elements;o(a,c,f,i),o(a,b,e,i);var q=b;if(void 0!==i.texcoord_index){var r;if(h){r=[];var s=w.default.sub(e,f)}else{r=w.default.set(e);var u=w.default.div(w.default.sub(g,e),m)}}for(var v=l/m,x=0;m>x;x++)q=w.default.rot(q,v),void 0!==i.texcoord_index&&(h?(s=w.default.rot(s,v),r[0]=s[0]+f[0],r[1]=s[1]*i.texcoord_width*i.v_scale+f[1]):r=w.default.add(r,u)),o(a,q,r,i),p.push(n+x+(j>0?2:1)),p.push(n),p.push(n+x+(j>0?1:2))}}function r(a,b,c,d,e,f,g,h){var i=h.vertex_data.vertex_count;o(a,c,f,h),o(a,b,e,h),o(a,d,g,h);var j=b[0]*d[1]-b[1]*d[0]>0,k=h.vertex_data.vertex_elements;j?(k.push(i+2),k.push(i+0),k.push(i+1)):(k.push(i+1),k.push(i+0),k.push(i+2))}function s(a,b,c,d,e,f){var g=w.default.neg(c);switch(d){case B.square:var h;e?(h=[c[1],-c[0]],o(a,w.default.add(c,h),[1,b],f),o(a,w.default.add(g,h),[0,b],f),b+=.5*f.texcoord_width*f.v_scale,o(a,c,[1,b],f),o(a,g,[0,b],f)):(h=[-c[1],c[0]],o(a,c,[1,b],f),o(a,g,[0,b],f),b+=.5*f.texcoord_width*f.v_scale,o(a,w.default.add(c,h),[1,b],f),o(a,w.default.add(g,h),[0,b],f)),n(1,f);break;case B.round:var i,j,k,l,m;e?(i=c,j=g,void 0!==f.texcoord_index&&(b+=.5*f.texcoord_width*f.v_scale,k=[1,b],l=[0,b],m=[.5,b])):(i=g,j=c,void 0!==f.texcoord_index&&(k=[0,b],l=[1,b],m=[.5,b])),q(a,i,A,j,k,m,l,!0,f);break;case B.butt:return}}function t(a,b){0>a&&(a=-a);var c=b>2*D.MIN_FAN_WIDTH?Math.log2(b/D.MIN_FAN_WIDTH):1;return Math.ceil(a/Math.PI*c)}function u(a,b){for(var c=[],d=0;d<a.length;d++){var e=(d+b)%a.length;0!==e&&c.push(a[e])}return c.push(c[0]),c}Object.defineProperty(c,"__esModule",{value:!0}),c.buildPolylines=e;var v=a("../vector"),w=d(v),x=a("../geo"),y=d(x),z=a("./common"),A=[0,0],B={butt:0,square:1,round:2},C={miter:0,bevel:1,round:2},D={MITER_LIMIT:3,TEXCOORD_NORMALIZE:1,TEXCOORD_RATIO:1,MIN_FAN_WIDTH:5},E=y.default.tile_scale},{"../geo":201,"../vector":272,"./common":196}],200:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=a("./utils/utils"),k=d(j),l=a("./gl/shader_program"),m=d(l),n=a("./utils/gl-matrix"),o=function(){function a(b,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};g(this,a),this.view=c,this.position=d.position,this.zoom=d.zoom}return i(a,[{key:"update",value:function(){}},{key:"setupProgram",value:function(){}},{key:"updateView",value:function(){if(this.position||this.zoom){var a={};this.position&&(a={lng:this.position[0],lat:this.position[1],
zoom:this.position[2]}),this.zoom&&(a.zoom=this.zoom),this.view.setView(a)}}},{key:"setupMatrices",value:function(a,b){n.mat4.multiply(a.model_view32,this.view_matrix,a.model),b.uniform("Matrix4fv","u_modelView",a.model_view32),n.mat3.normalFromMat4(a.normal32,a.model_view32),n.mat3.invert(a.inverse_normal32,a.normal32),b.uniform("Matrix3fv","u_normalMatrix",a.normal32),b.uniform("Matrix3fv","u_inverseNormalMatrix",a.inverse_normal32)}}],[{key:"create",value:function(a,b,c){switch(c.type){case"isometric":return new q(a,b,c);case"flat":return new r(a,b,c);case"perspective":default:return new p(a,b,c)}}}]),a}();c.default=o;var p=function(a){function b(a,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};g(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d));return f.type="perspective",f.focal_length=d.focal_length,f.fov=d.fov,f.focal_length||f.fov||(f.focal_length=[[16,2],[17,2.5],[18,3],[19,4],[20,6]]),f.vanishing_point=d.vanishing_point||[0,0],f.vanishing_point=f.vanishing_point.map(parseFloat),f.vanishing_point_skew=[],f.position_meters=null,f.view_matrix=new Float64Array(16),f.projection_matrix=new Float32Array(16),m.default.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_vanishing_point;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n            }"),f}return f(b,a),i(b,[{key:"constrainCamera",value:function(a){var b=a.view_height,c=a.height,d=a.focal_length,e=a.fov;return c?(d=2*c/b,e=2*Math.atan(1/d)):(d?e=2*Math.atan(1/d):e&&(e=e*Math.PI/180,d=1/Math.tan(e/2)),c=b/2*d),{view_height:b,height:c,focal_length:d,fov:e}}},{key:"updateMatrices",value:function(){var a=this.view.size.css.height*this.view.meters_per_pixel,b=this.constrainCamera({view_height:a,focal_length:k.default.interpolate(this.view.zoom,this.focal_length),fov:k.default.interpolate(this.view.zoom,this.fov)}),c=b.height,d=b.fov,e=[this.view.center.meters.x,this.view.center.meters.y,c];this.position_meters=e,n.mat4.lookAt(this.view_matrix,n.vec3.fromValues(e[0],e[1],0),n.vec3.fromValues(e[0],e[1],-1),n.vec3.fromValues(0,1,0)),n.mat4.perspective(this.projection_matrix,d,this.view.aspect,1,2*c),this.vanishing_point_skew[0]=this.vanishing_point[0]/this.view.size.css.width,this.vanishing_point_skew[1]=this.vanishing_point[1]/this.view.size.css.height,this.projection_matrix[8]=2*-this.vanishing_point_skew[0],this.projection_matrix[9]=2*-this.vanishing_point_skew[1],n.mat4.translate(this.projection_matrix,this.projection_matrix,n.vec3.fromValues(a/2*this.view.aspect*2*-this.vanishing_point_skew[0],a/2*2*-this.vanishing_point_skew[1],0)),n.mat4.translate(this.projection_matrix,this.projection_matrix,n.vec3.fromValues(0,0,-c))}},{key:"update",value:function(){h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"update",this).call(this),this.updateMatrices()}},{key:"setupProgram",value:function(a){a.uniform("Matrix4fv","u_projection",this.projection_matrix),a.uniform("3f","u_eye",[0,0,this.position_meters[2]]),a.uniform("2fv","u_vanishing_point",this.vanishing_point_skew)}}]),b}(o),q=function(a){function b(a,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};g(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d));return f.type="isometric",f.axis=d.axis||{x:0,y:1},2===f.axis.length&&(f.axis={x:f.axis[0],y:f.axis[1]}),f.position_meters=null,f.viewport_height=null,f.view_matrix=new Float64Array(16),f.projection_matrix=new Float32Array(16),m.default.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_vanishing_point;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n                // position.xy += position.z * u_isometric_axis;\n\n                // Reverse z for depth buffer so up is negative,\n                // and scale down values so objects higher than one screen height will not get clipped\n                // pull forward slightly to avoid going past far clipping plane\n                position.z = -position.z / 100. + 1. - 0.001;\n            }"),f}return f(b,a),i(b,[{key:"update",value:function(){h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"update",this).call(this),this.viewport_height=this.view.size.css.height*this.view.meters_per_pixel;var a=[this.view.center.meters.x,this.view.center.meters.y,this.viewport_height];this.position_meters=a,n.mat4.identity(this.view_matrix),n.mat4.translate(this.view_matrix,this.view_matrix,n.vec3.fromValues(-a[0],-a[1],0)),n.mat4.identity(this.projection_matrix),this.projection_matrix[8]=this.axis.x/this.view.aspect,this.projection_matrix[9]=this.axis.y,n.mat4.scale(this.projection_matrix,this.projection_matrix,n.vec3.fromValues(2/this.view.size.meters.x,2/this.view.size.meters.y,2/this.view.size.meters.y))}},{key:"setupProgram",value:function(a){a.uniform("Matrix4fv","u_projection",this.projection_matrix),a.uniform("3fv","u_eye",[0,0,this.viewport_height]),a.uniform("2fv","u_vanishing_point",[0,0])}}]),b}(o),r=function(a){function b(a,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};g(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d));return f.type="flat",f}return f(b,a),i(b,[{key:"update",value:function(){this.axis.x=0,this.axis.y=0,h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"update",this).call(this)}}]),b}(q)},{"./gl/shader_program":207,"./utils/gl-matrix":257,"./utils/utils":269}],201:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();c.default=d={},d.default_source_max_zoom=18,d.default_view_max_zoom=20,d.tile_size=256,d.half_circumference_meters=20037508.342789244,d.circumference_meters=2*d.half_circumference_meters,d.min_zoom_meters_per_pixel=d.circumference_meters/d.tile_size;var f=[];d.metersPerPixel=function(a){return f[a]=f[a]||d.min_zoom_meters_per_pixel/Math.pow(2,a),f[a]};var g=[];d.metersPerTile=function(a){return g[a]=g[a]||d.circumference_meters/Math.pow(2,a),g[a]},d.tile_scale=4096,d.units_per_pixel=d.tile_scale/d.tile_size,d.height_scale=16;var h=[];d.unitsPerMeter=function(a){return h[a]=h[a]||d.tile_scale/(d.tile_size*d.metersPerPixel(a)),h[a]},d.metersForTile=function(a){return{x:a.x*d.circumference_meters/Math.pow(2,a.z)-d.half_circumference_meters,y:-(a.y*d.circumference_meters/Math.pow(2,a.z)-d.half_circumference_meters)}},d.tileForMeters=function(a,b){var c=e(a,2),f=c[0],g=c[1];return{x:Math.floor((f+d.half_circumference_meters)/(d.circumference_meters/Math.pow(2,b))),y:Math.floor((-g+d.half_circumference_meters)/(d.circumference_meters/Math.pow(2,b))),z:b}},d.wrapTile=function(a){var b=a.x,c=a.y,d=a.z,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:!0,y:!1},f=(1<<d)-1;return e.x&&(b&=f),e.y&&(c&=f),{x:b,y:c,z:d}},d.metersToLatLng=function(a){var b=e(a,2),c=b[0],f=b[1];return c/=d.half_circumference_meters,f/=d.half_circumference_meters,f=(2*Math.atan(Math.exp(f*Math.PI))-Math.PI/2)/Math.PI,c*=180,f*=180,[c,f]},d.latLngToMeters=function(a){var b=e(a,2),c=b[0],f=b[1];return f=Math.log(Math.tan(f*Math.PI/360+Math.PI/4))/Math.PI,f*=d.half_circumference_meters,c*=d.half_circumference_meters/180,[c,f]},d.tileSpaceToLatlng=function(a,b,c){var f=d.unitsPerMeter(b);return d.transformGeometry(a,function(a){a[0]=a[0]/f+c.x,a[1]=a[1]/f+c.y;var b=d.metersToLatLng(a),g=e(b,2),h=g[0],i=g[1];a[0]=h,a[1]=i}),a},d.copyGeometry=function(a){if(null!=a){var b={type:a.type};return"Point"===a.type?b.coordinates=[a.coordinates[0],a.coordinates[1]]:"LineString"===a.type||"MultiPoint"===a.type?b.coordinates=a.coordinates.map(function(a){return[a[0],a[1]]}):"Polygon"===a.type||"MultiLineString"===a.type?b.coordinates=a.coordinates.map(function(a){return a.map(function(a){return[a[0],a[1]]})}):"MultiPolygon"===a.type&&(b.coordinates=a.coordinates.map(function(a){return a.map(function(a){return a.map(function(a){return[a[0],a[1]]})})})),b}},d.transformGeometry=function(a,b){null!=a&&("Point"===a.type?b(a.coordinates):"LineString"===a.type||"MultiPoint"===a.type?a.coordinates.forEach(b):"Polygon"===a.type||"MultiLineString"===a.type?a.coordinates.forEach(function(a){return a.forEach(b)}):"MultiPolygon"===a.type&&a.coordinates.forEach(function(a){a.forEach(function(a){return a.forEach(b)})}))},d.boxIntersect=function(a,b){return!(b.sw.x>a.ne.x||b.ne.x<a.sw.x||b.sw.y>a.ne.y||b.ne.y<a.sw.y)},d.findBoundingBox=function(a){for(var b=1/0,c=-1/0,d=1/0,e=-1/0,f=a[0].length,g=0;f>g;g++){var h=a[0][g];h[0]<b&&(b=h[0]),h[1]<d&&(d=h[1]),h[0]>c&&(c=h[0]),h[1]>e&&(e=h[1])}return[b,d,c,e]},d.geometryType=function(a){return"Polygon"===a||"MultiPolygon"===a?"polygon":"LineString"===a||"MultiLineString"===a?"line":"Point"===a||"MultiPoint"===a?"point":void 0},d.centroid=function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(a&&0!==a.length){var c=0,d=0,e=0,f=a[0],g=f.length,h=void 0;b&&(h=f[0],f=f.map(function(a){return[a[0]-h[0],a[1]-h[1]]}));for(var i=0,j=g-1;g>i;j=i,i++){var k=f[i],l=f[j],m=k[1]*l[0]-l[1]*k[0];c+=(k[0]+l[0])*m,d+=(k[1]+l[1])*m,e+=3*m}var n=[c/e,d/e];return b&&(n[0]+=h[0],n[1]+=h[1]),n}},d.multiCentroid=function(a){for(var b=a.length,c=[0,0],e=0;e<a.length;e++){var f=d.centroid(a[e]);c[0]+=f[0],c[1]+=f[1]}return c[0]/=b,c[1]/=b,c},d.signedPolygonRingAreaSum=function(a){for(var b=0,c=a.length,d=0;c-1>d;d++){var e=a[d],f=a[d+1];b+=e[0]*f[1]-f[0]*e[1]}return b+=a[c-1][0]*a[0][1]-a[0][0]*a[c-1][1]},d.polygonRingArea=function(a){return Math.abs(d.signedPolygonRingAreaSum(a))/2},d.polygonArea=function(a){return a?d.polygonRingArea(a[0]):void 0},d.multiPolygonArea=function(a){for(var b=0,c=0;c<a.length;c++)b+=d.polygonArea(a[c]);return b},d.ringWinding=function(a){var b=d.signedPolygonRingAreaSum(a);return b>0?"CW":0>b?"CCW":void 0}},{}],202:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d;c.default=d={},d.BYTE=5120,d.UNSIGNED_BYTE=5121,d.SHORT=5122,d.UNSIGNED_SHORT=5123,d.INT=5124,d.UNSIGNED_INT=5125,d.FLOAT=5126},{}],203:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d;c.default=d={};var e=0;d.getContext=function(a,b){var c=!1;null==a&&(a=document.createElement("canvas"),a.style.position="absolute",a.style.top=0,a.style.left=0,a.style.zIndex=-1,document.body.appendChild(a),c=!0);var f=a.getContext("webgl",b)||a.getContext("experimental-webgl",b);if(!f)throw new Error("Couldn't create WebGL context.");return f._tangram_id=e++,c?(d.resize(f,window.innerWidth,window.innerHeight,b.device_pixel_ratio),window.addEventListener("resize",function(){d.resize(f,window.innerWidth,window.innerHeight,b.device_pixel_ratio)})):d.resize(f,parseFloat(a.style.width),parseFloat(a.style.height),b.device_pixel_ratio),f},d.resize=function(a,b,c,d){d=d||window.devicePixelRatio||1,a.canvas.style.width=b+"px",a.canvas.style.height=c+"px",a.canvas.width=Math.round(b*d),a.canvas.height=Math.round(c*d),a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,a.canvas.width,a.canvas.height)}},{}],204:[function(a,b,c){"use strict";function d(a,b){var c=e.filter(function(b){return b[0]===a})[0];return c=c&&c[1],c||(e.push([a,{}]),c=e[e.length-1][1]),c[b]||(c[b]=a.getExtension(b)),c[b]}Object.defineProperty(c,"__esModule",{value:!0}),c.default=d;var e=[]},{}],205:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}Object.defineProperty(c,"__esModule",{value:!0});var e={};c.default=e,e.parseUniforms=function(a){var b=[];for(var c in a){var d,e=c,f=a[c];if("number"==typeof f)b.push({type:"float",method:"1f",name:c,value:f,key:e,uniforms:a});else if(Array.isArray(f)){if("number"==typeof f[0])f.length>=2&&f.length<=4?b.push({type:"vec"+f.length,method:f.length+"fv",name:c,value:f,key:e,uniforms:a}):f.length>4&&b.push({type:"float[]",method:"1fv",name:c+"[0]",value:f,key:e,uniforms:a});else if("string"==typeof f[0])for(d=0;d<f.length;d++)b.push({type:"sampler2D",method:"1i",name:c+"["+d+"]",value:f[d],key:d,uniforms:f});else if(Array.isArray(f[0])&&"number"==typeof f[0][0]&&f[0].length>=2&&f[0].length<=4)for(d=0;d<f.length;d++)b.push({type:"vec"+f[0].length,method:f[d].length+"fv",name:c+"["+d+"]",value:f[d],key:d,uniforms:f})}else"boolean"==typeof f?b.push({type:"bool",method:"1i",name:c,value:f,key:e,uniforms:a}):"string"==typeof f&&b.push({type:"sampler2D",method:"1i",name:c,value:f,key:e,uniforms:a})}return b},e.defineVariable=function(a,b){var c,d;if("number"==typeof b)c="float";else if(Array.isArray(b))"number"==typeof b[0]?b.length>=2&&b.length<=4?c="vec"+b.length:(c="float",d=b.length):"string"==typeof b[0]&&(c="sampler2D",d=b.length);else if("boolean"==typeof b)c="bool";else{if("string"!=typeof b)return;c="sampler2D"}var e="";return e+=c+" "+a,d&&(e+="["+d+"]"),e+=";\n"},e.defineUniform=function(a,b){var c=e.defineVariable(a,b);if(c)return"uniform "+c},e.isUniformDefined=function(a,b){var c=new RegExp("uniform[^;]+(?:{[\\s\\S]*})?[^;]*\\b"+a+"\\b","g");return!!b.match(c)},e.isSymbolReferenced=function(a,b){var c=new RegExp("\\b"+a+"\\b","g");return b.search(c)>=0},e.expandVec3=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=void 0;if(Array.isArray(a)){if(2!==a.length)return a;c=[].concat(d(a),[b]).map(parseFloat)}else c=[a,a,a].map(parseFloat);return c&&c.every(function(a){return"number"==typeof a&&!isNaN(a)})?c:void 0},e.expandVec4=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=void 0;if(Array.isArray(a)){if(3!==a.length)return a;c=[].concat(d(a),[b]).map(parseFloat)}else c=[a,a,a,b].map(parseFloat);return c&&c.every(function(a){return"number"==typeof a&&!isNaN(a)})?c:void 0}},{}],206:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c.RenderState=function(){function a(b,c){d(this,a),c(b),this.value=b,this.setup=c}return e(a,[{key:"set",value:function(a){JSON.stringify(this.value)!==JSON.stringify(a)&&(this.setup(a),this.value=a)}}]),a}(),g=function a(b){d(this,a),this.defaults={},this.defaults.culling=!0,this.defaults.culling_face=b.BACK,this.defaults.blending=!1,this.defaults.blending_src=b.ONE_MINUS_SRC_ALPHA,this.defaults.blending_dst=b.ONE_MINUS_SRC_ALPHA,this.defaults.blending_src_alpha=b.ONE,this.defaults.blending_dst_alpha=b.ONE_MINUS_SRC_ALPHA,this.defaults.depth_write=!0,this.defaults.depth_test=!0,b.depthFunc(b.LESS),this.culling=new f({cull:this.defaults.culling,face:this.defaults.culling_face},function(a){a.cull?(b.enable(b.CULL_FACE),b.cullFace(a.face)):b.disable(b.CULL_FACE)}),this.blending=new f({blend:this.defaults.blending,src:this.defaults.blending_src,dst:this.defaults.blending_dst,src_alpha:this.defaults.blending_src_alpha,dst_alpha:this.defaults.blending_dst_alpha},function(a){a.blend?(b.enable(b.BLEND),a.src_alpha&&a.dst_alpha?b.blendFuncSeparate(a.src,a.dst,a.src_alpha,a.dst_alpha):b.blendFunc(a.src,a.dst)):b.disable(b.BLEND)}),this.depth_write=new f({depth_write:this.defaults.depth_write},function(a){b.depthMask(a.depth_write)}),this.depth_test=new f({depth_test:this.defaults.depth_test},function(a){a.depth_test?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST)})};c.default=g},{}],207:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../utils/log"),i=d(h),j=a("./glsl"),k=d(j),l=a("./texture"),m=d(l),n=a("./extensions"),o=d(n),p=a("../utils/hash"),q=d(p),r=a("strip-comments"),s=d(r),t=a("gl-shader-errors"),u=d(t),v=/^\s*#pragma.*$/gm,w=/\\\s*\n/gm,x=function(){function a(b,c,d,e){f(this,a),e=e||{},this.gl=b,this.program=null,this.compiled=!1,this.compiling=!1,this.error=null,this.defines=Object.assign({},e.defines||{}),this.blocks=Object.assign({},e.blocks||{}),this.block_scopes=Object.assign({},e.block_scopes||{}),this.extensions=e.extensions||[],this.dependent_uniforms=e.uniforms,this.uniforms={},this.attribs={},this.vertex_source=c,this.fragment_source=d,this.id=a.id++,this.name=e.name}return g(a,[{key:"destroy",value:function(){this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.uniforms={},this.attribs={},this.compiled=!1}},{key:"use",value:function(){this.compiled&&(a.current!==this&&this.gl.useProgram(this.program),a.current=this)}},{key:"compile",value:function(){var b=this;if(this.compiling)throw new Error("ShaderProgram.compile(): skipping for "+this.id+" ("+this.name+") because already compiling");this.compiling=!0,this.compiled=!1,this.error=null,this.computed_vertex_source=this.vertex_source,this.computed_fragment_source=this.fragment_source;var c,d=this.checkExtensions(),e=this.buildDefineList(),f=this.buildShaderBlockList();for(var g in f){var h=f[g];if(h&&(!Array.isArray(h)||0!==h.length)){c=new RegExp("^\\s*#pragma\\s+tangram:\\s+"+g+"\\s*$","m");var i=this.computed_vertex_source.match(c),j=this.computed_fragment_source.match(c);if(null!=i||null!=j){var k="";h.forEach(function(a){var b=a.scope+", "+a.key+", "+a.num;k+="\n// tangram-block-start: "+b+"\n",k+=a.source,k+="\n// tangram-block-end: "+b+"\n"}),null!=i&&(this.computed_vertex_source=this.computed_vertex_source.replace(c,k)),null!=j&&(this.computed_fragment_source=this.computed_fragment_source.replace(c,k)),e["TANGRAM_BLOCK_"+g.replace(/[\s-]+/g,"_").toUpperCase()]=!0}}}this.computed_vertex_source=this.computed_vertex_source.replace(v,""),this.computed_fragment_source=this.computed_fragment_source.replace(v,""),this.ensureUniforms(this.dependent_uniforms);var l="",m=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT);l=m&&m.precision>0?"precision highp float;\n":"precision mediump float;\n",e.TANGRAM_VERTEX_SHADER=!0,e.TANGRAM_FRAGMENT_SHADER=!1,this.computed_vertex_source=l+a.buildDefineString(e)+this.computed_vertex_source,e.TANGRAM_VERTEX_SHADER=!1,e.TANGRAM_FRAGMENT_SHADER=!0,this.computed_fragment_source=a.buildExtensionString(d)+l+a.buildDefineString(e)+this.computed_fragment_source,this.computed_vertex_source=this.computed_vertex_source.replace(w,""),this.computed_fragment_source=this.computed_fragment_source.replace(w,"");try{this.program=a.updateProgram(this.gl,this.program,this.computed_vertex_source,this.computed_fragment_source),this.compiled=!0,this.compiling=!1}catch(a){throw this.program=null,this.compiled=!1,this.compiling=!1,this.error=a,("vertex"===a.type||"fragment"===a.type)&&(this.shader_errors=a.errors,this.shader_errors.forEach(function(c){c.type=a.type,c.block=b.block(a.type,c.line)})),a}this.computed_vertex_source=null,this.computed_fragment_source=null,this.use(),this.refreshUniforms(),this.refreshAttributes()}},{key:"buildDefineList",value:function(){var b,c={};for(b in a.defines)c[b]=a.defines[b];for(b in this.defines)c[b]=this.defines[b];return c}},{key:"buildShaderBlockList",value:function(){var b=void 0,c={};for(b in a.blocks)if(c[b]=[],Array.isArray(a.blocks[b])){var d;(d=c[b]).push.apply(d,e(a.blocks[b].map(function(a,c){return{key:b,source:a,num:c,scope:"ShaderProgram"}})))}else c[b]=[{key:b,source:a.blocks[b],num:0,scope:"ShaderProgram"}];for(b in this.blocks)if(c[b]=c[b]||[],Array.isArray(this.blocks[b]))for(var f=this.block_scopes&&this.block_scopes[b]||[],g=null,h=0,i=0;i<this.blocks[b].length;i++)f[i]!==g&&(g=f[i],h=0),c[b].push({key:b,source:this.blocks[b][i],num:h,scope:g||this.name}),h++;else c[b].push({key:b,source:this.blocks[b],num:0,scope:this.name});return c}},{key:"ensureUniforms",value:function(a){if(a){var b,c=s.default(this.computed_vertex_source),d=s.default(this.computed_fragment_source),e=[],f=[];for(var g in a){var h=k.default.isUniformDefined(g,c),j=k.default.isUniformDefined(g,d);if(!h||!j){if(b=k.default.defineUniform(g,a[g]),!b)continue;h||(i.default("trace","Program "+this.name+": "+g+" not defined in vertex shader, injecting: '"+b+"'"),e.push(b)),j||(i.default("trace","Program "+this.name+": "+g+" not defined in fragment shader, injecting: '"+b+"'"),f.push(b))}}e.length>0&&(this.computed_vertex_source=e.join("\n")+this.computed_vertex_source),f.length>0&&(this.computed_fragment_source=f.join("\n")+this.computed_fragment_source)}}},{key:"setUniforms",value:function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.compiled){b&&(this.texture_unit=0);for(var c=k.default.parseUniforms(a),d=0;d<c.length;d++){var e=c[d];"sampler2D"===e.type?this.setTextureUniform(e.name,e.value):this.uniform(e.method,e.name,e.value)}}}},{key:"saveUniforms",value:function(a){var b=a||this.uniforms;for(var c in b){var d=this.uniforms[c];d&&(d.saved_value=d.value)}this.saved_texture_unit=this.texture_unit||0}},{key:"restoreUniforms",value:function(a){var b=a||this.uniforms;for(var c in b){var d=this.uniforms[c];d&&d.saved_value&&(d.value=d.saved_value,this.updateUniform(d))}this.texture_unit=this.saved_texture_unit||0}},{key:"setTextureUniform",value:function(a,b){var c=m.default.textures[b];return null==c?void i.default("warn","Cannot find texture '"+b+"'"):(c.bind(this.texture_unit),this.uniform("1i",a,this.texture_unit),void this.texture_unit++)}},{key:"uniform",value:function a(b,c,d){if(this.compiled){this.uniforms[c]=this.uniforms[c]||{};var a=this.uniforms[c];a.name=c,void 0===a.location&&(a.location=this.gl.getUniformLocation(this.program,c)),a.method=b,a.value=d,this.updateUniform(a)}}},{key:"updateUniform",value:function(a){this.compiled&&a&&null!=a.location&&(this.use(),this.commitUniform(a))}},{key:"commitUniform",value:function(a){var b=a.location,c=a.value;switch(a.method){case"1i":this.gl.uniform1i(b,c);break;case"1f":this.gl.uniform1f(b,c);break;case"2f":this.gl.uniform2f(b,c[0],c[1]);break;case"3f":this.gl.uniform3f(b,c[0],c[1],c[2]);break;case"4f":this.gl.uniform4f(b,c[0],c[1],c[2],c[3]);break;case"1iv":this.gl.uniform1iv(b,c);break;case"3iv":this.gl.uniform3iv(b,c);break;case"1fv":this.gl.uniform1fv(b,c);break;case"2fv":this.gl.uniform2fv(b,c);break;case"3fv":this.gl.uniform3fv(b,c);break;case"4fv":this.gl.uniform4fv(b,c);break;case"Matrix3fv":this.gl.uniformMatrix3fv(b,!1,c);break;case"Matrix4fv":this.gl.uniformMatrix4fv(b,!1,c)}}},{key:"refreshUniforms",value:function(){if(this.compiled)for(var a in this.uniforms){var b=this.uniforms[a];b.location=this.gl.getUniformLocation(this.program,a),this.updateUniform(b)}}},{key:"refreshAttributes",value:function(){this.attribs={}}},{key:"attribute",value:function(a){if(this.compiled){var b=this.attribs[a]=this.attribs[a]||{};return null!=b.location?b:(b.name=a,b.location=this.gl.getAttribLocation(this.program,a),b)}}},{key:"source",value:function(a){return"vertex"===a?this.computed_vertex_source:"fragment"===a?this.computed_fragment_source:void 0}},{key:"lines",value:function(a){var b=this.source(a);return b?b.split("\n"):[]}},{key:"line",value:function(a,b){var c=this.lines(a);return c?c[b]:void 0}},{key:"block",value:function a(b,c){for(var d=this.lines(b),a=void 0,e=0;c>e&&e<d.length;e++){var f=d[e],g=f.match(/\/\/ tangram-block-start: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/);g&&g.length>1?a={scope:g[1],name:g[2],num:g[3]}:(g=f.match(/\/\/ tangram-block-end: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/),g&&g.length>1&&(a=null)),a&&(a.line=null==a.line?-1:a.line+1,a.source=f)}return a}},{key:"checkExtensions",value:function(){var a=this,b=[];return this.extensions.forEach(function(c){var d=o.default(a.gl,c),e="TANGRAM_EXTENSION_"+c;a.defines[e]=null!=d,d?b.push(c):i.default("debug","Could not enable extension '"+c+"'")}),b}}]),a}();c.default=x,x.id=0,x.current=null,x.defines={},x.blocks={},x.reset=function(){x.programs_by_source={},x.shaders_by_source={}},x.reset(),x.buildDefineString=function(a){var b="";for(var c in a)null!=a[c]&&a[c]!==!1&&(b+="boolean"==typeof a[c]&&a[c]===!0?"#define "+c+"\n":"number"==typeof a[c]&&Math.floor(a[c])===a[c]?"#define "+c+" "+a[c].toFixed(1)+"\n":"#define "+c+" "+a[c]+"\n");return b},x.buildExtensionString=function(a){a=a||[];var b="";return a.forEach(function(a){b+="#ifdef GL_"+a+"\n#extension GL_"+a+" : enable\n#endif\n"}),b},x.addBlock=function(a){var b;x.blocks[a]=x.blocks[a]||[];for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];(b=x.blocks[a]).push.apply(b,d)},x.removeBlock=function(a){x.blocks[a]=[]},x.replaceBlock=function(a){x.removeBlock(a);for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];x.addBlock.apply(x,[a].concat(c))},x.updateProgram=function(a,b,c,d){var e=q.default(a._tangram_id+"::"+c+"::"+d);if(x.programs_by_source[e])return i.default("trace","Reusing identical source GL program object"),x.programs_by_source[e];var f=x.createShader(a,c,a.VERTEX_SHADER),g=x.createShader(a,d,a.FRAGMENT_SHADER);if(a.useProgram(null),null!=b)for(var h=a.getAttachedShaders(b),j=0;j<h.length;j++)a.detachShader(b,h[j]);else b=a.createProgram();if(null==f||null==g)return b;if(a.attachShader(b,f),a.attachShader(b,g),a.linkProgram(b),!a.getProgramParameter(b,a.LINK_STATUS)){var k=new Error("WebGL program error:\n            VALIDATE_STATUS: "+a.getProgramParameter(b,a.VALIDATE_STATUS)+"\n            ERROR: "+a.getError()+"\n            --- Vertex Shader ---\n            "+c+"\n            --- Fragment Shader ---\n            "+d);throw Object.assign(new Error(k),{type:"program"})}return x.programs_by_source[e]=b,b},x.createShader=function(a,b,c){var d=q.default(a._tangram_id+"::"+b);if(x.shaders_by_source[d])return i.default("trace","Reusing identical source GL shader object"),x.shaders_by_source[d];var e=a.createShader(c);if(a.shaderSource(e,b),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS)){var f=c===a.VERTEX_SHADER?"vertex":"fragment",g=a.getShaderInfoLog(e),h=u.default(g);throw Object.assign(new Error(g),{type:f,errors:h})}return x.shaders_by_source[d]=e,e}},{"../utils/hash":258,"../utils/log":259,"./extensions":204,"./glsl":205,"./texture":208,"gl-shader-errors":92,"strip-comments":186}],208:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../utils/log"),h=d(g),i=a("../utils/utils"),j=d(i),k=a("../utils/subscribe"),l=d(k),m=a("../utils/worker_broker"),n=d(m),o=function(){function a(b,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e(this,a),d=a.sliceOptions(d),this.gl=b,this.texture=b.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=c,this.retain_count=0,this.config_type=null,this.loading=null,this.loaded=!1,this.filtering=d.filtering,this.sprites=d.sprites,this.texcoords={},this.sizes={},this.setData(1,1,new Uint8Array([0,0,0,255]),{filtering:"nearest"}),a.textures[this.name]&&(this.retain_count=a.textures[this.name].retain_count,a.textures[this.name].retain_count=0,a.textures[this.name].destroy()),a.textures[this.name]=this,a.texture_configs[this.name]=JSON.stringify(Object.assign({name:c},d)),this.load(d),h.default("trace","creating Texture "+this.name)}return f(a,[{key:"destroy",value:function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=b.force;return this.retain_count>0&&!c?void h.default("error","Texture '"+this.name+"': destroying texture with retain count of '"+this.retain_count+"'"):void(this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,delete a.textures[this.name],delete a.texture_configs[this.name],this.valid=!1,h.default("trace","destroying Texture "+this.name)))}},{key:"retain",value:function(){this.retain_count++}},{key:"release",value:function(){this.retain_count<=0&&h.default("error","Texture '"+this.name+"': releasing texture with retain count of '"+this.retain_count+"'"),this.retain_count--,this.retain_count<=0&&this.destroy()}},{key:"bind",value:function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.valid&&(a.activeUnit!==b&&(this.gl.activeTexture(this.gl.TEXTURE0+b),a.activeUnit=b,a.boundTexture=null),a.boundTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),a.boundTexture=this.texture))}},{key:"load",value:function(a){var b=this;return a?(this.loading=null,"string"==typeof a.url?(this.config_type="url",this.setUrl(a.url,a)):a.element?(this.config_type="element",this.setElement(a.element,a)):a.data&&a.width&&a.height&&(this.config_type="data",this.setData(a.width,a.height,a.data,a)),this.loading=this.loading&&this.loading.then(function(){return b.calculateSprites(),b})||Promise.resolve(this),this.loading):this.loading||Promise.resolve(this)}},{key:"setUrl",value:function(b){var c=this,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.valid?(this.url=b,this.loading=new Promise(function(b){var e=new Image;e.onload=function(){try{c.setElement(e,d)}catch(b){c.loaded=!1,h.default("warn","Texture '"+c.name+"': failed to load url: '"+c.url+"'",b,d),a.trigger("warning",{message:"Failed to load texture from "+c.url,error:b,texture:d})}c.loaded=!0,b(c)},e.onerror=function(e){c.loaded=!1,h.default("warn","Texture '"+c.name+"': failed to load url: '"+c.url+"'",e,d),a.trigger("warning",{message:"Failed to load texture from "+c.url,error:e,texture:d}),b(c)},j.default.isSafari()&&"data:"===c.url.slice(0,5)||(e.crossOrigin="anonymous"),e.src=c.url}),this.loading):void 0}},{key:"setData",value:function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.width=a,this.height=b,Array.isArray(c)&&(c=new Uint8Array(c)),this.update(c,d),this.setFiltering(d),this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(b,c){var d=b;if("string"==typeof b&&(b=document.querySelector(b)),b instanceof HTMLCanvasElement||b instanceof HTMLImageElement||b instanceof HTMLVideoElement)this.update(b,c),this.setFiltering(c);else{this.loaded=!1;var e="the 'element' parameter (`element: "+JSON.stringify(d)+"`) must be a CSS ";e+="selector string, or a <canvas>, <image> or <video> object",h.default("warn","Texture '"+this.name+"': "+e,c),a.trigger("warning",{message:"Failed to load texture because "+e,texture:c})}return this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.valid&&(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,c.UNPACK_FLIP_Y_WEBGL!==!1),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),
b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement||b instanceof HTMLImageElement&&b.complete?(this.width=b.width,this.height=b.height,this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b)):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,b),a.trigger("update",this))}},{key:"setFiltering",value:function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.valid){b.filtering=b.filtering||"linear";var c=this.gl;this.bind(),j.default.isPowerOf2(this.width)&&j.default.isPowerOf2(this.height)?(this.power_of_2=!0,c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,b.TEXTURE_WRAP_S||b.repeat&&c.REPEAT||c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,b.TEXTURE_WRAP_T||b.repeat&&c.REPEAT||c.CLAMP_TO_EDGE),"mipmap"===b.filtering?(this.filtering="mipmap",c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.generateMipmap(c.TEXTURE_2D)):"linear"===b.filtering?(this.filtering="linear",c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR)):"nearest"===b.filtering&&(this.filtering="nearest",c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST))):(this.power_of_2=!1,c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),"nearest"===b.filtering?(this.filtering="nearest",c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST)):(this.filtering="linear",c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR))),a.trigger("update",this)}}},{key:"calculateSprites",value:function(){if(this.sprites)for(var b in this.sprites){var c=this.sprites[b];this.texcoords[b]=a.getTexcoordsForSprite([c[0],c[1]],[c[2],c[3]],[this.width,this.height]),this.sizes[b]=[c[2],c[3]]}}}]),a}();c.default=o,o.create=function(a,b,c){return new o(a,b,c)},o.retain=function(a){o.textures[a]&&o.textures[a].retain()},o.release=function(a){o.textures[a]&&o.textures[a].release()},o.destroy=function(a){var b=Object.keys(o.textures);b.forEach(function(b){var c=o.textures[b];c.gl===a&&c.destroy({force:!0})})},o.getSpriteInfo=function(a,b){var c=o.textures[a];return c&&{size:c.sizes[b],texcoords:c.texcoords[b]}},o.getTexcoordsForSprite=function(a,b,c){var d=c[1]-a[1]-b[1];return[a[0]/c[0],d/c[1],(b[0]+a[0])/c[0],(b[1]+d)/c[1]]},o.createFromObject=function(a,b){var c=[];if(b)for(var d in b){var e=b[d];if(o.changed(d,e)){var f=o.create(a,d,e);c.push(f.loading)}}return Promise.all(c)},o.default="__default",o.createDefault=function(a){return o.create(a,o.default)},o.sliceOptions=function(a){return{filtering:a.filtering,sprites:a.sprites,url:a.url,element:a.element,data:a.data,width:a.width,height:a.height,repeat:a.repeat,TEXTURE_WRAP_S:a.TEXTURE_WRAP_S,TEXTURE_WRAP_T:a.TEXTURE_WRAP_T,UNPACK_FLIP_Y_WEBGL:a.UNPACK_FLIP_Y_WEBGL,UNPACK_PREMULTIPLY_ALPHA_WEBGL:a.UNPACK_PREMULTIPLY_ALPHA_WEBGL}},o.changed=function(a,b){var c=o.textures[a];if(c){if("element"===c.config_type||null!=b.element)return!0;if(b=o.sliceOptions(b),o.texture_configs[a]===JSON.stringify(Object.assign({name:a},b)))return!1}return!0},o.getInfo=function(a){if(a||(a=Object.keys(o.textures)),Array.isArray(a))return Promise.all(a.map(function(a){return o.getInfo(a)}));var b=o.textures[a];if(b){var c=b.loading||Promise.resolve(b);return c.then(function(){return{name:b.name,width:b.width,height:b.height,sprites:b.sprites,texcoords:b.texcoords,sizes:b.sizes,filtering:b.filtering,power_of_2:b.power_of_2,valid:b.valid}})}return Promise.resolve(null)},o.syncTexturesToWorker=function(a){return n.default.postMessage("Texture.getInfo",a).then(function(a){return a.forEach(function(a){o.textures[a.name]=a}),o.textures})},o.getMaxTextureSize=function(a){return a.getParameter(a.MAX_TEXTURE_SIZE)},o.textures={},o.texture_configs={},o.boundTexture=null,o.activeUnit=null,n.default.addTarget("Texture",o),l.default(o)},{"../utils/log":259,"../utils/subscribe":265,"../utils/utils":269,"../utils/worker_broker":271}],209:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a("./extensions"),f=d(e),g=a("../utils/log"),h=d(g);c.default={disabled:!1,bound_vao:[],init:function(a){var b=void 0;this.disabled!==!0&&(b=f.default(a,"OES_vertex_array_object")),null!=b?h.default("info","Vertex Array Object extension available"):this.disabled!==!0?h.default("warn","Vertex Array Object extension NOT available"):h.default("warn","Vertex Array Object extension force disabled")},create:function(a,b,c){var d={};d.setup=b,d.teardown=c;var e=f.default(a,"OES_vertex_array_object");return null!=e&&(d._vao=e.createVertexArrayOES(),e.bindVertexArrayOES(d._vao)),d.setup(!0),d},getCurrentBinding:function(a){var b=this.bound_vao.filter(function(b){return b[0]===a})[0];return b&&b[1]},setCurrentBinding:function(a,b){var c=this.bound_vao,d=c.filter(function(b){return b[0]===a})[0];null==d?c.push([a,b]):d[1]=b},bind:function(a,b){var c=f.default(a,"OES_vertex_array_object");if(null!=b)null!=c&&null!=b._vao?(c.bindVertexArrayOES(b._vao),this.setCurrentBinding(a,b)):b.setup(!1);else{var d=this.getCurrentBinding(a);null!=c?c.bindVertexArrayOES(null):null!=d&&"function"==typeof d.teardown&&d.teardown(),this.setCurrentBinding(a,null)}},destroy:function(a,b){var c=f.default(a,"OES_vertex_array_object");null!=c&&null!=b&&null!=b._vao&&(c.deleteVertexArrayOES(b._vao),b._vao=null)}}},{"../utils/log":259,"./extensions":204}],210:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./shader_program"),h=d(g),i=a("./vao"),j=d(i),k=function(){function a(b,c,d,f,g){e(this,a),g=g||{},this.gl=b,this.vertex_data=c,this.element_data=d,this.vertex_layout=f,this.vertex_buffer=this.gl.createBuffer(),this.buffer_size=this.vertex_data.byteLength,this.draw_mode=g.draw_mode||this.gl.TRIANGLES,this.data_usage=g.data_usage||this.gl.STATIC_DRAW,this.vertices_per_geometry=3,this.uniforms=g.uniforms,this.retain=g.retain||!1,this.created_at=+new Date,this.fade_in_time=g.fade_in_time||0,this.vertex_count=this.vertex_data.byteLength/this.vertex_layout.stride,this.element_count=0,this.vaos={},this.toggle_element_array=!1,this.element_data?(this.toggle_element_array=!0,this.element_count=this.element_data.length,this.geometry_count=this.element_count/this.vertices_per_geometry,this.element_type=this.element_data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,this.element_buffer=this.gl.createBuffer(),this.buffer_size+=this.element_data.byteLength,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.element_buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.element_data,this.data_usage)):this.geometry_count=this.vertex_count/this.vertices_per_geometry,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertex_data,this.data_usage),this.retain||(delete this.vertex_data,delete this.element_data),this.valid=!0}return f(a,[{key:"render",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.valid)return!1;var b=a.program||h.default.current;b.use(),this.uniforms&&(b.saveUniforms(this.uniforms),b.setUniforms(this.uniforms,!1));var c=(+new Date-this.created_at)/1e3;return b.uniform("1f","u_visible_time",c),this.bind(b),this.toggle_element_array?this.gl.drawElements(this.draw_mode,this.element_count,this.element_type,0):this.gl.drawArrays(this.draw_mode,0,this.vertex_count),j.default.bind(this.gl,null),this.uniforms&&b.restoreUniforms(this.uniforms),c<this.fade_in_time}},{key:"bind",value:function(a){var b=this,c=this.vaos[a.id];c?j.default.bind(this.gl,c):this.vaos[a.id]=j.default.create(this.gl,function(c){b.gl.bindBuffer(b.gl.ARRAY_BUFFER,b.vertex_buffer),b.toggle_element_array&&b.gl.bindBuffer(b.gl.ELEMENT_ARRAY_BUFFER,b.element_buffer),b.vertex_layout.enable(b.gl,a,c)})}},{key:"destroy",value:function(){if(!this.valid)return!1;this.valid=!1;for(var a in this.vaos)j.default.destroy(this.gl,this.vaos[a]);return this.gl.deleteBuffer(this.vertex_buffer),this.vertex_buffer=null,this.element_buffer&&(this.gl.deleteBuffer(this.element_buffer),this.element_buffer=null),delete this.vertex_data,delete this.element_data,!0}}]),a}();c.default=k},{"./shader_program":207,"./vao":209}],211:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}Object.defineProperty(c,"__esModule",{value:!0});var g,h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./constants"),j=d(i),k=a("../utils/log"),l=d(k),m=a("./vertex_elements"),n=d(m),o=(g={},f(g,j.default.FLOAT,Float32Array),f(g,j.default.BYTE,Int8Array),f(g,j.default.UNSIGNED_BYTE,Uint8Array),f(g,j.default.INT,Int32Array),f(g,j.default.UNSIGNED_INT,Uint32Array),f(g,j.default.SHORT,Int16Array),f(g,j.default.UNSIGNED_SHORT,Uint16Array),g),p=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=c.prealloc,f=void 0===d?500:d;e(this,a),this.vertex_layout=b,this.vertex_elements=new n.default,this.stride=this.vertex_layout.stride,a.array_pool.length>0?(this.vertex_buffer=a.array_pool.pop(),this.byte_length=this.vertex_buffer.byteLength,this.size=Math.floor(this.byte_length/this.stride),l.default("trace","VertexData: reused buffer of bytes "+this.byte_length+", "+this.size+" vertices")):(this.size=f,this.byte_length=this.stride*this.size,this.vertex_buffer=new Uint8Array(this.byte_length)),this.offset=0,this.vertex_count=0,this.realloc_count=0,this.setBufferViews(),this.setAddVertexFunction()}return h(a,[{key:"setBufferViews",value:function(){this.views={},this.views[j.default.UNSIGNED_BYTE]=this.vertex_buffer;for(var a=0;a<this.vertex_layout.attribs.length;a++){var b=this.vertex_layout.attribs[a];if(null==this.views[b.type]){var c=o[b.type];this.views[b.type]=new c(this.vertex_buffer.buffer)}}}},{key:"checkBufferSize",value:function(){if(this.offset+this.stride>this.byte_length){this.size=Math.floor(1.5*this.size),this.size-=this.size%4,this.byte_length=this.stride*this.size;var b=new Uint8Array(this.byte_length);b.set(this.vertex_buffer),a.array_pool.push(this.vertex_buffer),this.vertex_buffer=b,this.setBufferViews(),this.realloc_count++}}},{key:"setAddVertexFunction",value:function(){this.vertexLayoutAddVertex=this.vertex_layout.getAddVertexFunction()}},{key:"addVertex",value:function(a){this.checkBufferSize(),this.vertexLayoutAddVertex(a,this.views,this.offset),this.offset+=this.stride,this.vertex_count++}},{key:"end",value:function(){return this.vertex_buffer=this.vertex_buffer.subarray(0,this.offset),this.element_buffer=this.vertex_elements.end(),l.default("trace","VertexData: "+this.size+" vertices total, realloc count "+this.realloc_count),this}}]),a}();c.default=p,p.array_pool=[]},{"../utils/log":259,"./constants":202,"./vertex_elements":212}],212:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){var c=b&&h?Uint32Array:Uint16Array;return new c(a)}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=Math.pow(2,16)-1,h=!1,i=function(){function a(){d(this,a),this.array=[],this.has_overflown=!1}return f(a,[{key:"push",value:function(a){(!this.has_overflown||h)&&(a>g&&(this.has_overflown=!0,!h)||this.array.push(a))}},{key:"end",value:function(){if(this.array.length){var a=e(this.array,this.has_overflown);return this.array=[],this.has_overflown=!1,a}return!1}}]),a}();c.default=i,i.setElementIndexUint=function(a){h=a}},{}],213:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./constants"),i=d(h),j=a("./vertex_data"),k=d(j),l=a("../utils/hash"),m=d(l),n=function(){function a(b){f(this,a),this.attribs=b,this.components=[],this.index={},this.stride=0;for(var c=0,d=0,e=0;e<this.attribs.length;e++){var g=this.attribs[e];g.offset=this.stride,g.byte_size=g.size;var h=0;switch(g.type){case i.default.FLOAT:case i.default.INT:case i.default.UNSIGNED_INT:g.byte_size*=4,h=2;break;case i.default.SHORT:case i.default.UNSIGNED_SHORT:g.byte_size*=2,h=1}3&g.byte_size&&(g.byte_size+=4-(3&g.byte_size)),this.stride+=g.byte_size;for(var j=g.offset>>h,k=0;k<g.size;k++)this.components.push({type:g.type,shift:h,offset:j++,index:d++});this.index[g.name]=c,c+=g.size}}return g(a,[{key:"enable",value:function(b,c,d){for(var e,f,g=0;g<this.attribs.length;g++)e=this.attribs[g],f=c.attribute(e.name).location,-1!==f&&((!a.enabled_attribs[f]||d)&&b.enableVertexAttribArray(f),b.vertexAttribPointer(f,e.size,e.type,e.normalized,this.stride,e.offset),a.enabled_attribs[f]=c);for(f in a.enabled_attribs)this.disableUnusedAttribute(b,f,c)}},{key:"disableUnusedAttribute",value:function(b,c,d){a.enabled_attribs[c]!==d&&(b.disableVertexAttribArray(c),delete a.enabled_attribs[c])}},{key:"createVertexData",value:function(){return new k.default(this)}},{key:"getAddVertexFunction",value:function(){return null==this.addVertex&&this.createAddVertexFunction(),this.addVertex}},{key:"createAddVertexFunction",value:function(){var b=m.default(JSON.stringify(this.attribs));if(null==a.add_vertex_funcs[b]){var c=["var t, o;"],d=void 0,f=[].concat(e(this.components));f.sort(function(a,b){return a.type!==b.type?a.type-b.type:a.index-b.index});for(var g=0;g<f.length;g++){var h=f[g];d!==h.type&&(c.push("t = vs["+h.type+"];"),c.push("o = off"+(h.shift?" >> "+h.shift:"")+";"),d=h.type),c.push("t[o + "+h.offset+"] = v["+h.index+"];")}c=c.join("\n");var i=new Function("v","vs","off",c);a.add_vertex_funcs[b]=i}this.addVertex=a.add_vertex_funcs[b]}}]),a}();c.default=n,n.enabled_attribs={},n.add_vertex_funcs={}},{"../utils/hash":258,"./constants":202,"./vertex_data":211}],214:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e,f=a("./repeat_group"),g=d(f),h=a("../utils/log"),i=d(h);c.default=e={tiles:{},startTile:function(a){var b=this.tiles[a]={bboxes:{aabb:[],obb:[]},objects:{},keep:{},styles:{}};null==b.complete&&(b.complete=new Promise(function(a,c){b.resolve=a,b.reject=c}))},resetTile:function(a){delete this.tiles[a]},abortTile:function(a){this.tiles[a]&&this.tiles[a].resolve&&this.tiles[a].resolve([]),this.resetTile(a)},addStyle:function(a,b){this.tiles[b].styles[a]=!0},collide:function(a,b,c){var d=this.tiles[c];if(!d)return i.default("trace","Collision.collide() called with null tile",c,this.tiles,b,a),Promise.resolve([]);for(var e=d.objects,f=0;f<a.length;f++){var g=a[f],h=g.label.layout.priority;e[h]=e[h]||{},e[h][b]=e[h][b]||[],e[h][b].push(g)}return delete d.styles[b],0===Object.keys(d.styles).length&&this.endTile(c),d.complete.then(function(){return d.resolve=null,d.keep[b]||[]})},endTile:function(a){var b=this.tiles[a],c=b.keep;g.default.clear(a);for(var d=Object.keys(b.objects).sort(function(a,b){return a-b}),e=0;e<d.length;e++){var f=b.objects[d[e]];if(f)for(var h in f){var i=f[h];c[h]=c[h]||[];for(var j=0;j<i.length;j++){var k=i[j];this.canBePlaced(k,a,k.linked)&&(k.linked?this.canBePlaced(k.linked,a,k)&&(c[h].push(k),this.place(k,a),this.place(k.linked,a)):(c[h].push(k),this.place(k,a)))}}}delete this.tiles[a],b.resolve()},canBePlaced:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=a.label,e=a.label.layout;if(null!=d.placed)return d.placed;var f=this.tiles[b].bboxes;if(e.collide&&d.discard(f,c&&c.label))e.collide&&(d.placed=!1);else{var h=g.default.check(d,e,b);if(!h)return!0;d.placed=!1}return d.placed},place:function(a,b){var c=a.label;null==c.placed&&(g.default.add(c,c.layout,b),c.add(this.tiles[b].bboxes))}}},{"../utils/log":259,"./repeat_group":221}],215:[function(a,b,c){"use strict";function d(a,b){return!(a[2]<b[0]||a[0]>b[2]||a[3]<b[1]||a[1]>b[3])}function e(a,b,c){for(var e=0;e<b.length&&(!d(a,b[e])||null==c(e));e++);}Object.defineProperty(c,"__esModule",{value:!0}),c.boxIntersectsBox=d,c.boxIntersectsList=e},{}],216:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./point_anchor"),h=d(g),i=a("./intersect"),j=a("../utils/utils"),k=d(j),l=a("../utils/obb"),m=d(l),n=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,a),this.size=b,this.layout=c,this.position=null,this.anchor=Array.isArray(this.layout.anchor)?this.layout.anchor[0]:this.layout.anchor,this.placed=null,this.offset=c.offset,this.aabb=null,this.obb=null,this.align="center",this.throw_away=!1}return f(a,[{key:"update",value:function(){this.align=this.layout.align||h.default.alignForAnchor(this.anchor)}},{key:"occluded",value:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=!1,e=a.aabb,f=a.obb;return e.length>0&&i.boxIntersectsList(this.aabb,e,function(a){return c&&e[a]===c.aabb?void 0:0===b.obb.angle&&0===f[a].angle?(d=!0,!0):m.default.intersect(b.obb,f[a])?(d=!0,!0):void 0}),d}},{key:"add",value:function(a){this.placed=!0,a.aabb.push(this.aabb),a.obb.push(this.obb)}},{key:"inTileBounds",value:function(){var a=[this.aabb[0],this.aabb[1]],b=[this.aabb[2],this.aabb[3]];return!(!k.default.pointInTile(a)||!k.default.pointInTile(b))}},{key:"discard",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!!this.throw_away||this.occluded(a,b)}}]),a}();c.default=n,n.epsilon=.9999},{"../utils/obb":262,"../utils/utils":269,"./intersect":215,"./point_anchor":219}],217:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function i(a,b){return b/a}function j(a,b){var c=s.default.sub(b,a);return s.default.angle(c)}function k(a,b){return-j(a,b)}function l(a){for(var b=[],c=0;c<a.length-1;c++){var d=a[c],e=a[c+1],f=Math.hypot(d[0]-e[0],d[1]-e[1]);b.push(f)}return b}function m(a,b){var c=void 0,d=void 0;for(a>b?(c=b,d=a):(c=a,d=b);d-c>Math.PI;)c+=2*Math.PI;return Math.abs(d-c)}Object.defineProperty(c,"__esModule",{value:!0});var n=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),p=a("./label"),q=d(p),r=a("../vector"),s=d(r),t=a("../utils/obb"),u=d(t),v=[0,.33,.66,.99],w=1.5,x=1.8,y=2.3,z=.1,A=1.3,B=.4,C=1,D=1.2,E=.01,F={create:function(a,b,c,d){for(var e=[{type:"straight",tolerance:d.no_curving?x:w},{type:"curved"},{type:"straight",tolerance:y}],f=0;f<e.length;f++){var g=e[f],h=void 0;if("straight"===g.type?h=new H(b,c,d,g.tolerance):"curved"===g.type&&!d.no_curving&&c.length>2&&(h=new I(a,c,d)),h&&!h.throw_away)return h}return!1}};c.default=F;var G=function(){function a(b){h(this,a),this.layout=b,this.position=[],this.angle=0,this.offset=b.offset.slice(),this.obbs=[],this.aabbs=[],this.type="",this.throw_away=!1}return o(a,[{key:"add",value:function(a){this.placed=!0;for(var b=0;b<this.aabbs.length;b++){var c=this.aabbs[b],d=this.obbs[b],e={aabb:c,obb:d};q.default.prototype.add.call(e,a)}}},{key:"discard",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.throw_away)return!0;for(var c=0;c<this.obbs.length;c++){var d=this.aabbs[c],e=this.obbs[c],f={aabb:d,obb:e},g=q.default.prototype.occluded.call(f,a,b);if(g)return!0}return!1}},{key:"inTileBounds",value:function(){for(var a=0;a<this.aabbs.length;a++){var b=this.aabbs[a],c={aabb:b},d=q.default.prototype.inTileBounds.call(c);if(!d)return!1}return!0}}],[{key:"splitLineByOrientation",value:function(a){for(var b=[a[0]],c=0,d=0,e=0,f=b,g=!1,h=1;h<a.length;h++){var i=a[h],j=a[h-1],k=s.default.length(s.default.sub(i,j));i[0]>j[0]?1===e?(b.push(i),c+=k,c>d&&(f=b,d=c,g=!1)):(b=[j,i],c=k,c>d&&(f=b,d=c,g=!1),e=1):i[0]<j[0]?-1===e?(b.unshift(i),c+=k,c>d&&(f=b,d=c,g=!0)):(b=[i,j],c=k,c>d&&(f=b,d=c,g=!0),e=-1):(-1===e?b.unshift(i):(b.push(i),e=1),c+=k,c>d&&(f=b,d=c,g=-1===e))}return[f,g]}},{key:"createOBB",value:function(a,b,c,d,e,f,g){var h=a[0],i=a[1];return!f||0===f[0]&&0===f[1]||(f=s.default.rot(f,e),h+=f[0]*g,i-=f[1]*g),new u.default(h,i,-d,b,c)}}]),a}(),H=function(a){function b(a,c,d,e){h(this,b);var g=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,d));return g.type="straight",g.throw_away=!g.fit(a,c,d,e),g}return g(b,a),o(b,[{key:"fit",value:function(a,b,c,d){var e=c.units_per_pixel,f=void 0,g=G.splitLineByOrientation(b),h=n(g,2);b=h[0],f=h[1],"number"==typeof c.orientation&&(this.offset[1]+=D*(a[1]-c.vertical_buffer),f&&(this.offset[1]*=-1),-1===c.orientation&&(this.offset[1]*=-1));for(var k=l(b),o=a[0]*e,p=0;p<b.length-1;p++)for(var q=b[p],r=0,t=0,u=p+1,v=void 0;u<b.length;){var w=b[u-1],x=b[u],y=j(w,x);if(u!==p+1&&(r+=m(y,v)),Math.abs(r)>z)break;if(t+=k[u-1],i(t,o)<d){var A=s.default.mult(s.default.add(q,x),.5);this.angle=-y;var B=this.angle;if("number"==typeof c.orientation&&(f&&(B+=Math.PI),-1===c.orientation&&(B+=Math.PI)),Math.abs(this.angle-Math.PI/2)<E&&(this.angle=-Math.PI/2,"number"==typeof c.orientation&&(this.offset[1]*=-1)),this.position=A,this.updateBBoxes(this.position,a,this.angle,this.angle,this.offset),this.inTileBounds())return!0}v=y,u++}return!1}},{key:"updateBBoxes",value:function(a,b,c,d,e){var f=this.layout.units_per_pixel;this.obbs=[],this.aabbs=[];var g=(b[0]+2*this.layout.buffer[0])*f*q.default.epsilon,h=(b[1]+2*this.layout.buffer[1])*f*q.default.epsilon,i=G.createOBB(a,g,h,c,d,e,f),j=i.getExtent();this.obbs.push(i),this.aabbs.push(j)}}]),b}(G),I=function(a){function b(a,c,d){h(this,b);var e=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,d));return e.type="curved",e.angles=[],e.pre_angles=[],e.offsets=[],e.num_segments=a.length,e.throw_away=!e.fit(a,c,d),e}return g(b,a),o(b,[{key:"fit",value:function(a,c,d){var f=d.units_per_pixel,g=void 0,h=Math.max.apply(Math,e(a.map(function(a){return a[1]}))),i=h*f,j=G.splitLineByOrientation(c),k=n(j,2);c=k[0],g=k[1],"number"==typeof d.orientation&&(this.offset[1]+=D*(h-d.vertical_buffer),g&&(this.offset[1]*=-1),-1===d.orientation&&(this.offset[1]*=-1));var m=l(c),o=a.map(function(a){return a[0]*f}),p=m.reduce(function(a,b){return a+b},0),q=o.reduce(function(a,b){return a+b},0);if(q>p)return!1;var r=b.checkTileBoundary(c,m,i,this.offset,f),s=n(r,2),t=s[0],u=s[1];if(2>u-t)return!1;var w=b.curvaturePlacement(c,p,m,q,t,u),x=c[w];if(-1===w||2>u-w)return!1;this.position=x;for(var y=0;y<o.length;y++){this.offsets[y]=[],this.angles[y]=[],this.pre_angles[y]=[];for(var z=0;z<v.length;z++){var A=v[z],B=b.scaleLine(A,c),C=n(B,2),E=C[0],F=C[1];x=E[w];var H=b.placeAtIndex(w,E,F,o),I=H.positions,J=H.offsets,K=H.angles,L=H.pre_angles,M=J.map(function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])/f});if(0===A){this.angle=1/K.length*K.reduce(function(a,b){return a+b});for(var N=0;N<I.length;N++){var O=I[N],P=L[N],Q=o[N],R=P+K[N],S=this.angle,T=G.createOBB(O,Q,i,R,S,this.offset,f),U=T.getExtent();this.obbs.push(T),this.aabbs.push(U)}}this.offsets[y].push(M[y]),this.angles[y].push(K[y]),this.pre_angles[y].push(L[y])}}return!0}}],[{key:"checkTileBoundary",value:function(a,b,c,d,e){var f=0,g=a.length-1;c*=q.default.epsilon;for(var h=b[f]*q.default.epsilon,i=b[b.length-1]*q.default.epsilon;g>f;){var k=j(a[f],a[f+1]),l=s.default.add(s.default.rot([h/2,0],k),a[f]),m=G.createOBB(l,h,c,-k,-k,d,e),n=m.getExtent(),o=q.default.prototype.inTileBounds.call({aabb:n});if(o)break;f++}for(;g>f;){var p=j(a[g-1],a[g]),r=s.default.add(s.default.rot([-i/2,0],p),a[g]),t=G.createOBB(r,i,c,-p,-p,d,e),u=t.getExtent(),v=q.default.prototype.inTileBounds.call({aabb:u});if(v)break;g--}return[f,g]}},{key:"curvaturePlacement",value:function(a,b,c,d,e,f){e=e||0,f=f||a.length-1;for(var g=[],h=e+1;f>h;h++){var i=a[h-1],j=a[h],k=a[h+1],l=s.default.perp(j,i),m=s.default.perp(k,j),n=s.default.angleBetween(l,m);n>C&&(n=1/0),g.push(n)}g.push(1/0);for(var o=[],p=[],q=e,r=0,t=0;e>t;t++)r+=c[t];for(;b>r+d;){for(var u=r,v=u+d,w=u,x=q,y=0;f>x&&w+c[x]<v&&(y+=g[x],1/0!==y);)w+=c[x],x++;if(0===y)return q;var z=y/(x-q);o.push(y),p.push(z),r+=c[q],q++}if(0===o.length)return-1;var D=Math.min.apply(null,o),E=o.indexOf(D),F=p[E];return A>D&&B>F?o.indexOf(D):-1}},{key:"scaleLine",value:function(a,b){var c=[b[0]],d=[];return b.forEach(function(e,f){if(f!==b.length-1){var g=s.default.sub(b[f+1],b[f]),h=s.default.mult(g,1+a);c.push(s.default.add(c[f],h)),d.push(s.default.length(h))}}),[c,d]}},{key:"placeAtIndex",value:function(a,c,d,e){var f=c[a],g=b.getIndicesAndOffsets(a,d,e),h=n(g,2),i=h[0],j=h[1],k=b.getPositionsFromIndicesAndOffsets(c,i,j),l=b.getAnglesFromIndicesAndOffsets(f,i,c,k),m=n(l,3),o=m[0],p=m[1],q=m[2];return{positions:k,offsets:o,angles:p,pre_angles:q}}},{key:"getIndicesAndOffsets",value:function(a,b,c){for(var d=c.length,e=[],f=[],g=0,h=0,i=0;d>g;){for(var j=c[g];d>g&&h+.5*j<=i+b[a];){var k=h-i+.5*j;f.push(k),e.push(a),h+=j,g++,j=c[g]}i+=b[a],a++}return[e,f]}},{key:"getPositionsFromIndicesAndOffsets",value:function(a,b,c){for(var d=[],e=0;e<b.length;e++){var f=b[e],g=c[e],h=j(a[f],a[f+1]),i=s.default.rot([g,0],h),k=s.default.add(a[f],i);d.push(k)}return d}},{key:"getAnglesFromIndicesAndOffsets",value:function(a,b,c,d){for(var e=[],f=[],g=[],h=0;h<d.length;h++){var i=d[h],j=b[h],l=s.default.sub(i,a),m=-s.default.angle(l),n=k(c[j],c[j+1]),o=n-m;if(h>0){var p=e[h-1],q=f[h-1];Math.abs(m-p)>Math.PI&&(m+=m>p?-2*Math.PI:2*Math.PI),Math.abs(q-o)>Math.PI&&(o+=o>q?-2*Math.PI:2*Math.PI)}e.push(m),f.push(o),g.push(l)}return[g,e,f]}}]),b}(G)},{"../utils/obb":262,"../vector":272,"./label":216}],218:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},j=a("./label"),k=d(j),l=a("./point_anchor"),m=d(l),n=a("../geo"),o=d(n),p=a("../utils/obb"),q=d(p),r=a("../styles/style_parser"),s=function(a){function b(a,c,d){e(this,b);var g=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,d));return g.position=[a[0],a[1]],g.parent=g.layout.parent,g.update(),g.start_anchor_index=1,g.degenerate=!(g.size[0]||g.size[1]||g.layout.buffer[0]||g.layout.buffer[1]),g.throw_away=!g.getNextFit(),g}return g(b,a),h(b,[{key:"update",value:function(){i(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"update",this).call(this),this.computeOffset(),this.updateBBoxes()}},{key:"computeOffset",value:function(){if(this.offset=[this.layout.offset[0],this.layout.offset[1]],this.parent){var a=this.parent;this.offset=m.default.computeOffset(this.offset,a.size,a.anchor,m.default.zero_buffer),this.offset=m.default.computeOffset(this.offset,a.size,this.anchor,m.default.zero_buffer),a.offset!==r.StyleParser.zeroPair&&(this.offset===r.StyleParser.zeroPair?this.offset=a.offset:(this.offset[0]+=a.offset[0],this.offset[1]+=a.offset[1]))}this.offset=m.default.computeOffset(this.offset,this.size,this.anchor)}},{key:"updateBBoxes",value:function(){var a=(this.size[0]+2*this.layout.buffer[0])*this.layout.units_per_pixel*k.default.epsilon,b=(this.size[1]+2*this.layout.buffer[1])*this.layout.units_per_pixel*k.default.epsilon;this.layout.italic&&(a+=5*this.layout.units_per_pixel);var c=[this.position[0]+this.offset[0]*this.layout.units_per_pixel,this.position[1]-this.offset[1]*this.layout.units_per_pixel];this.obb=new q.default(c[0],c[1],0,a,b),this.aabb=this.obb.getExtent()}},{key:"moveIntoTile",value:function(){var a=!1;return this.aabb[0]<0&&(this.position[0]+=-this.aabb[0],a=!0),this.aabb[2]>=o.default.tile_scale&&(this.position[0]-=this.aabb[2]-o.default.tile_scale+1,a=!0),this.aabb[3]>0&&(this.position[1]-=this.aabb[3],a=!0),this.aabb[1]<=-o.default.tile_scale&&(this.position[1]-=this.aabb[1]+o.default.tile_scale-1,a=!0),a&&this.updateBBoxes(),a}},{key:"getNextFit",value:function(){if(!this.layout.cull_from_tile||this.inTileBounds())return!0;
if(this.layout.move_into_tile)return this.moveIntoTile(),!0;if(Array.isArray(this.layout.anchor))for(var a=1;a<this.layout.anchor.length;a++)if(this.anchor=this.layout.anchor[a],this.update(),this.start_anchor_index=a,this.inTileBounds())return!0;return!1}},{key:"discard",value:function(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.degenerate)return!1;if(i(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"discard",this).call(this,a,c)){if(Array.isArray(this.layout.anchor))for(var d=this.start_anchor_index;d<this.layout.anchor.length;d++)if(this.anchor=this.layout.anchor[d],this.update(),(!this.layout.cull_from_tile||this.inTileBounds())&&!i(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"discard",this).call(this,a,c))return!1;return!0}return!1}}]),b}(k.default);c.default=s,s.PLACEMENT={VERTEX:0,MIDPOINT:1,SPACED:2,CENTROID:3}},{"../geo":201,"../styles/style_parser":245,"../utils/obb":262,"./label":216,"./point_anchor":219}],219:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=["left","top-left","bottom-left"],e=["right","top-right","bottom-right"],f=["top","top-left","top-right"],g=["bottom","bottom-left","bottom-right"],h=void 0;c.default=h={computeOffset:function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!c||"center"===c)return a;var e=[a[0],a[1]];return d=d||this.default_buffer,this.isLeftAnchor(c)?(e[0]-=b[0]/2,"left"===c&&(e[0]-=d[0])):this.isRightAnchor(c)&&(e[0]+=b[0]/2,"right"===c&&(e[0]+=d[1])),this.isTopAnchor(c)?(e[1]-=b[1]/2,"top"===c&&(e[1]-=d[2])):this.isBottomAnchor(c)&&(e[1]+=b[1]/2,"bottom"===c&&(e[1]+=d[3])),e},alignForAnchor:function(a){if(a&&"center"!==a){if(this.isLeftAnchor(a))return"right";if(this.isRightAnchor(a))return"left"}return"center"},isLeftAnchor:function(a){return d.indexOf(a)>-1},isRightAnchor:function(a){return e.indexOf(a)>-1},isTopAnchor:function(a){return f.indexOf(a)>-1},isBottomAnchor:function(a){return g.indexOf(a)>-1},default_buffer:[2.5,2.5,1.5,.75],zero_buffer:[0,0,0,0]}},{}],220:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c){var d=[],e=c.placement,h=Math.max(b[0],b[1])*c.placement_min_length_ratio*c.units_per_pixel;switch(e){case o.SPACED:var j=f(a,h,c);if(!j)return[];for(var k=j.positions,l=j.angles,p=0;p<k.length;p++){var q=k[p],r=l[p];if(c.tile_edges===!0||!n.isCoordOutsideTile(q)){var s=new m.default(q,b,c);s.angle=r,d.push(s)}}break;case o.VERTEX:for(var t=void 0,u=void 0,v=void 0,w=0;w<a.length-1;w++)t=a[w],u=a[w+1],c.tile_edges!==!0&&n.isCoordOutsideTile(t)||(v=new m.default(t,b,c),v.angle=g(t,u,c.angle),d.push(v));v=new m.default(u,b,c),v.angle=g(t,u,c.angle),d.push(v);break;case o.MIDPOINT:for(var x=0;x<a.length-1;x++){var y=a[x],z=a[x+1],A=[.5*(y[0]+z[0]),.5*(y[1]+z[1])];if((c.tile_edges===!0||!n.isCoordOutsideTile(A))&&(!h||i(y,z)>h)){var B=new m.default(A,b,c);B.angle=g(y,z,c.angle),d.push(B)}}}return d}function f(a,b,c){var d=c.units_per_pixel,e=(c.placement_spacing||p)*d,f=h(a);if(b>=f)return!1;for(var g=Math.max(Math.floor(f/e),1),i=f-(g-1)*e,k=[],l=[],m=.5*i,n=0;g>n;n++){var o=j(a,m,b,c),q=o.position,r=o.angle;null!=q&&null!=r&&(k.push(q),l.push(r)),m+=e}return{positions:k,angles:l}}function g(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return"auto"===c?Math.atan2(b[0]-a[0],b[1]-a[1]):c}function h(a){for(var b=0,c=0;c<a.length-1;c++)b+=i(a[c],a[c+1]);return b}function i(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2))}function j(a,b,c,d){for(var e=0,f=void 0,h=void 0,j=0;j<a.length-1;j++){var l=a[j],m=a[j+1],n=i(l,m);if(!(c>=n)&&(e+=n,e>b)){f=k(l,m,e-b),h=g(l,m,d.angle);break}}return{position:f,angle:h}}function k(a,b,c){var d=i(a,b),e=c/d;return[e*a[0]+(1-e)*b[0],e*a[1]+(1-e)*b[1]]}Object.defineProperty(c,"__esModule",{value:!0}),c.default=e;var l=a("./label_point"),m=d(l),n=a("../builders/common"),o=m.default.PLACEMENT,p=80},{"../builders/common":196,"./label_point":218}],221:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../geo"),h=d(g),i=function(){function a(b,c,d){e(this,a),this.key=b,this.repeat_dist=c,this.repeat_dist_sq=this.repeat_dist*this.repeat_dist,this.max_repeat_dist_sq=d*d,this.one_per_group=this.repeat_dist_sq>=this.max_repeat_dist_sq,this.positions=[]}return f(a,[{key:"check",value:function(a){if(this.one_per_group){if(this.positions.length>0)return{dist_sq:this.max_repeat_dist_sq,repeat_dist_sq:this.repeat_dist_sq,one_per_group:this.one_per_group}}else for(var b=a.position,c=0;c<this.positions.length;c++){var d=this.positions[c],e=b[0]-d[0],f=b[1]-d[1],g=e*e+f*f;if(g<this.repeat_dist_sq)return{dist_sq:g,repeat_dist_sq:this.repeat_dist_sq}}}},{key:"add",value:function(a){a&&a.position&&this.positions.push(a.position)}}],[{key:"clear",value:function(a){this.groups[a]={}}},{key:"check",value:function(a,b,c){return b.repeat_distance&&b.repeat_group&&this.groups[c][b.repeat_group]?this.groups[c][b.repeat_group].check(a):void 0}},{key:"add",value:function(b,c,d){c.repeat_distance&&c.repeat_group&&(null==this.groups[d][c.repeat_group]&&(this.groups[d][c.repeat_group]=new a(c.repeat_group,c.repeat_distance,a.max_repeat_dist)),this.groups[d][c.repeat_group].add(b))}}]),a}();c.default=i,i.groups={},i.max_repeat_dist=h.default.tile_scale},{"../geo":201}],222:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){return f(a)}function f(a){if("undefined"!=typeof p)return new p(a);if(h.default.is_main){var b=a.leaflet||window.L,d=b.GridLayer?b.GridLayer:b.TileLayer,e=d===b.GridLayer?"1.x":"0.7.x",f={},g=void 0,i=void 0;return d===b.TileLayer&&(f._addTile=function(){},f._removeTile=function(){},f._reset=function(){d.prototype._reset.apply(this,arguments),this.scene&&this.scene.container&&this.scene.canvas&&this.scene.container.appendChild(this.scene.canvas)}),Object.assign(f,{initialize:function(a){a.showDebug=!!a.showDebug,b.setOptions(this,a),this.updateTangramDebugSettings(),this.createScene(),this.hooks={},this._updating_tangram=!1,this._zoomAnimated=!1},createScene:function(){this.scene=j.default.create(this.options.scene,{numWorkers:this.options.numWorkers,preUpdate:this.options.preUpdate,postUpdate:this.options.postUpdate,continuousZoom:"1.x"===p.leafletVersion,wrapView:this.options.noWrap!==!0,highDensityDisplay:this.options.highDensityDisplay,logLevel:this.options.logLevel,introspection:this.options.introspection,webGLContextOptions:this.options.webGLContextOptions,disableRenderLoop:this.options.disableRenderLoop})},onAdd:function(a){var b=this;this.scene||this.createScene(),d.prototype.onAdd.apply(this,arguments),this.hooks.resize=function(){b._updating_tangram=!0,b.updateSize(),b._updating_tangram=!1},a.on("resize",this.hooks.resize),this.hooks.move=function(){if(!b._updating_tangram){b._updating_tangram=!0,b.scene.view.setPanning(!0);var c=a.getCenter();c.zoom=Math.max(Math.min(a.getZoom(),a.getMaxZoom()||l.default.default_view_max_zoom),a.getMinZoom()),b.scene.view.setView(c),b._mapLayerCount>1&&b.scene.immediateRedraw(),b.reverseTransform(),b._updating_tangram=!1}},a.on("move",this.hooks.move),this.hooks.moveend=function(){b.scene.view.setPanning(!1),b.scene.requestRedraw()},a.on("moveend",this.hooks.moveend),this.hooks.drag=function(){b.scene.view.markUserInput()},a.on("drag",this.hooks.drag),this.modifyScrollWheelBehavior(a),this.modifyDoubleClickZoom(a),i=n.default(function(a){a._moveEnd(!0),a.fire("viewreset")},2*a.options.wheelDebounceTime),this.trackMapLayerCounts(a),this.setupSelectionEventHandlers(a),this.setSelectionEvents(this.options.events,{radius:this.options.selectionRadius}),this.scene.container=this.getContainer(),this.updateSize(),this.updateView(),this.resizeOnFirstVisible(),this.scene.subscribe({move:this.onTangramViewUpdate.bind(this)}),this.scene.load(this.options.scene,{base_path:this.options.sceneBasePath,file_type:this.options.sceneFileType,blocking:!1}).then(function(){b._updating_tangram=!0,b.updateSize(),b.updateView(),b.reverseTransform(),b._updating_tangram=!1,b.fire("init")}).catch(function(a){b.fire("error",a)})},onRemove:function(a){d.prototype.onRemove.apply(this,arguments),a.off("layeradd layerremove overlayadd overlayremove",this._updateMapLayerCount),a.off("resize",this.hooks.resize),a.off("move",this.hooks.move),a.off("moveend",this.hooks.moveend),a.off("drag",this.hooks.drag),a.off("click",this.hooks.click),a.off("mousemove",this.hooks.mousemove),a.off("mouseout",this.hooks.mouseout),document.removeEventListener("visibilitychange",this.hooks.visibilitychange),this.hooks={},this.scene&&(this.scene.destroy(),this.scene=null)},createTile:function(a){var b=a.x+"/"+a.y+"/"+a.z,c=document.createElement("div");if(c.setAttribute("data-tile-key",b),c.style.width="256px",c.style.height="256px",this.options.showDebug){var d=document.createElement("div");d.textContent=b,d.style.position="absolute",d.style.left=0,d.style.top=0,d.style.color="white",d.style.fontSize="16px",d.style.textOutline="1px #000000",d.style.padding="8px",c.appendChild(d),c.style.borderStyle="solid",c.style.borderColor="white",c.style.borderWidth="1px"}return c},modifyScrollWheelBehavior:function(a){if(this.scene.view.continuous_zoom&&a.scrollWheelZoom&&this.options.modifyScrollWheel!==!1){a.options.zoomSnap=0;var c=a.scrollWheelZoom.enabled();a.scrollWheelZoom.disable(),b.Browser.chrome||b.Browser.safari?a.scrollWheelZoom._onWheelScroll=function(a){var c=b.DomEvent.getWheelDelta(a);this._delta+=c,this._lastMousePos=this._map.mouseEventToContainerPoint(a),this._performZoom(),b.DomEvent.stop(a)}:a.options.wheelDebounceTime=20;var d=this;a.scrollWheelZoom._performZoom=function(){var a=this._map,b=a.getZoom();a._stop();var c=this._delta/(4*this._map.options.wheelPxPerZoomLevel);this._delta=0,b+c>=this._map.getMaxZoom()?c=this._map.getMaxZoom()-b:b+c<=this._map.getMinZoom()&&(c=this._map.getMinZoom()-b),c&&("center"===a.options.scrollWheelZoom?g(d,a.getCenter(),b+c):g(d,this._lastMousePos,b+c),i(a))},c&&a.scrollWheelZoom.enable()}},modifyDoubleClickZoom:function(a){if(this.scene.view.continuous_zoom&&a.doubleClickZoom&&this.options.modifyDoubleClickZoom!==!1){var c=function(c,d,e,f){function h(){var f=(Date.now()-m)/n;if(1>=f){a._flyToFrame=b.Util.requestAnimFrame(h,a);var o=j.add(k.subtract(j).multiplyBy(f));o=[o.x,o.y],o=l.default.metersToLatLng(o),g(c,d,i+(e-i)*f)}else g(c,d,e)._moveEnd(!0)}if(f=f||{},f.animate===!1||!b.Browser.any3d)return a.setView(d,e,f);a._stop();var i=a._zoom;d=b.latLng(d),e=void 0===e?i:e,e=Math.min(e,a.getMaxZoom());var j=a.project(a.getCenter(),i),k=a.project(d,i),m=Date.now(),n=f.duration?1e3*f.duration:75;return a._moveStart(!0),h.call(a),a},d=a.doubleClickZoom.enabled();a.doubleClickZoom.disable();var e=this;a.doubleClickZoom._onDoubleClick=function(a){var b=this._map,d=b.getZoom(),f=b.options.zoomDelta,g=a.originalEvent.shiftKey?d-f:d+f;"center"===b.options.doubleClickZoom?c(e,b.getCenter(),g):c(e,b.containerPointToLatLng(a.containerPoint),g)},d&&a.doubleClickZoom.enable()}},updateView:function(){var a=this._map.getCenter();a.zoom=Math.max(Math.min(this._map.getZoom(),this._map.getMaxZoom()||l.default.default_view_max_zoom),this._map.getMinZoom()),this.scene.view.setView(a)},updateSize:function(){var a=this._map.getSize();this.scene.resizeMap(a.x,a.y)},resizeOnFirstVisible:function(){var a=this,b=!0;this.hooks.visibilitychange=function(){b&&(b=!1,a.updateSize())},document.addEventListener("visibilitychange",this.hooks.visibilitychange)},onTangramViewUpdate:function(){if(this._map&&!this._updating_tangram){var a=this._map.getCenter(),b=this.scene.view.center;(a.lng!==b.lng||a.lat!==b.lat||this._map.getZoom()!==this.scene.view.zoom)&&(this._updating_tangram=!0,this._map.setView([this.scene.view.center.lat,this.scene.view.center.lng],this.scene.view.zoom,{animate:!1}),this.reverseTransform(),this._updating_tangram=!1)}},render:function(){this.scene&&this.scene.update()},reverseTransform:function(){if(this._map&&this.scene&&this.scene.container){var a=this._map.containerPointToLayerPoint([0,0]);b.DomUtil.setPosition(this.scene.container,a)}},setupSelectionEventHandlers:function(a){var b=this;this._selection_events={},this._selection_radius=null,this.hooks.click=function(a){"function"==typeof b._selection_events.click&&b.scene.getFeatureAt(a.containerPoint,{radius:b._selection_radius}).then(function(c){var d=Object.assign({},c,{leaflet_event:a});b._selection_events.click(d)})},a.on("click",this.hooks.click),this.hooks.mousemove=function(a){"function"==typeof b._selection_events.hover&&b.scene.getFeatureAt(a.containerPoint,{radius:b._selection_radius}).then(function(c){var d=Object.assign({},c,{leaflet_event:a});b._selection_events.hover(d)})},a.on("mousemove",this.hooks.mousemove),this.hooks.mouseout=function(a){"function"==typeof b._selection_events.hover&&b._selection_events.hover({changed:!0,leaflet_event:a})},a.on("mouseout",this.hooks.mouseout)},setSelectionEvents:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=b.radius;this._selection_events=Object.assign(this._selection_events,a),this._selection_radius=void 0!==c?c:this._selection_radius},trackMapLayerCounts:function(a){var b=this;this._updateMapLayerCount=function(){var c=a.getPanes().mapPane.childNodes;b._mapLayerCount=0;for(var d=0;d<c.length;d++)b._mapLayerCount+=c[d].childNodes.length},a.on("layeradd layerremove overlayadd overlayremove",this._updateMapLayerCount),this._updateMapLayerCount()},updateTangramDebugSettings:function(){o.mergeDebugSettings(this.options.debug||{})}}),g=function(a,c,d){var e=a._map,f=a.scene,g=e.getZoomScale(d),h=e.getSize().divideBy(2),i=c instanceof b.Point?c:e.latLngToContainerPoint(c),j=i.subtract(h).multiplyBy(1-1/g),k=e.containerPointToLatLng(h.add(j));return f&&f.view.markUserInput(),e._move(k,d,{flyTo:!0})},c.LeafletLayer=p=d.extend(f),"function"!=typeof p.remove&&(p.prototype.remove=function(){this._map&&this._map.removeLayer(this),this.fire("remove")}),p.layerBaseClass=d,p.leafletVersion=e,new p(a)}}Object.defineProperty(c,"__esModule",{value:!0}),c.LeafletLayer=void 0,c.leafletLayer=e;var g=a("./utils/thread"),h=d(g),i=a("./scene"),j=d(i),k=a("./geo"),l=d(k),m=a("./utils/debounce"),n=d(m),o=a("./utils/debug_settings"),p=c.LeafletLayer=void 0},{"./geo":201,"./scene":226,"./utils/debounce":254,"./utils/debug_settings":255,"./utils/thread":267}],223:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=a("./gl/shader_program"),l=d(k),m=a("./gl/glsl"),n=d(m),o=a("./geo"),p=d(o),q=a("./vector"),r=d(q),s=a("./styles/style_parser"),t="/*\n\nExpected globals:\nlight_accumulator_*\n\n*/\n\nstruct AmbientLight {\n    vec3 ambient;\n};\n\nvoid calculateLight(in AmbientLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n    light_accumulator_ambient.rgb += _light.ambient;\n}\n",u="/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct DirectionalLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec3 direction;\n};\n\nvoid calculateLight(in DirectionalLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    light_accumulator_ambient.rgb += _light.ambient;\n\n    float nDotVP = clamp(dot(_normal, -_light.direction), 0.0, 1.0);\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        float pf = 0.0;\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(_light.direction, _normal);\n            float eyeDotR = max(dot(normalize(_eyeToPoint), reflectVector), 0.0);\n            pf = pow(eyeDotR, material.shininess);\n        }\n        light_accumulator_specular.rgb += _light.specular * pf;\n    #endif\n}\n",v="/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct PointLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec4 position;\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n    float attenuationExponent;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n    float innerRadius;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n    float outerRadius;\n#endif\n};\n\nvoid calculateLight(in PointLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    float dist = length(_light.position.xyz - _eyeToPoint);\n\n    // Compute vector from surface to light position\n    vec3 VP = (_light.position.xyz - _eyeToPoint) / dist;\n\n    // Normalize the vector from surface to light position\n    float nDotVP = clamp(dot(VP, _normal), 0.0, 1.0);\n\n    // Attenuation defaults\n    float attenuation = 1.0;\n    #ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n        float Rin = 1.0;\n        float e = _light.attenuationExponent;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n        #endif\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n            float Rdiff = _light.outerRadius-Rin;\n            float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n            attenuation = 1.0-(pow(d,e));\n        #else\n            // If no outer is provide behaves like:\n            // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n            float d = max(0.0,dist-Rin)/Rin+1.0;\n            attenuation = clamp(1.0/(pow(d,e)), 0.0, 1.0);\n        #endif\n    #else\n        float Rin = 0.0;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float Rdiff = _light.outerRadius-Rin;\n                float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                // If no outer is provide behaves like:\n                // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n                float d = max(0.0,dist-Rin)/Rin+1.0;\n                attenuation = clamp(1.0/d, 0.0, 1.0);\n            #endif\n        #else\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float d = clamp(dist/_light.outerRadius, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                attenuation = 1.0;\n            #endif\n        #endif\n    #endif\n\n    // Computer accumulators\n    light_accumulator_ambient.rgb += _light.ambient * attenuation;\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP * attenuation;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        float pf = 0.0; // power factor for shiny speculars\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(-VP, _normal);\n            float eyeDotR = max(0.0, dot(-normalize(_eyeToPoint), reflectVector));\n            pf = pow(eyeDotR, material.shininess);\n        }\n\n        light_accumulator_specular.rgb += _light.specular * pf * attenuation;\n    #endif\n}\n",w="/*\n\nExpected globals:\nmaterial\nlight_accumulator_*\n\n*/\n\nstruct SpotLight {\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    vec4 position;\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n    float attenuationExponent;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n    float innerRadius;\n#endif\n\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n    float outerRadius;\n#endif\n\n    vec3 direction;\n    float spotCosCutoff;\n    float spotExponent;\n};\n\nvoid calculateLight(in SpotLight _light, in vec3 _eyeToPoint, in vec3 _normal) {\n\n    float dist = length(_light.position.xyz - _eyeToPoint);\n\n    // Compute vector from surface to light position\n    vec3 VP = (_light.position.xyz - _eyeToPoint) / dist;\n\n    // normal . light direction\n    float nDotVP = clamp(dot(_normal, VP), 0.0, 1.0);\n\n    // Attenuation defaults\n    float attenuation = 1.0;\n    #ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\n        float Rin = 1.0;\n        float e = _light.attenuationExponent;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n        #endif\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n            float Rdiff = _light.outerRadius-Rin;\n            float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n            attenuation = 1.0-(pow(d,e));\n        #else\n            // If no outer is provide behaves like:\n            // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n            float d = max(0.0,dist-Rin)/Rin+1.0;\n            attenuation = clamp(1.0/(pow(d,e)), 0.0, 1.0);\n        #endif\n    #else\n        float Rin = 0.0;\n\n        #ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\n            Rin = _light.innerRadius;\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float Rdiff = _light.outerRadius-Rin;\n                float d = clamp(max(0.0,dist-Rin)/Rdiff, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                // If no outer is provide behaves like:\n                // https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n                float d = max(0.0,dist-Rin)/Rin+1.0;\n                attenuation = clamp(1.0/d, 0.0, 1.0);\n            #endif\n        #else\n            #ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\n                float d = clamp(dist/_light.outerRadius, 0.0, 1.0);\n                attenuation = 1.0-d*d;\n            #else\n                attenuation = 1.0;\n            #endif\n        #endif\n    #endif\n\n    // spotlight attenuation factor\n    float spotAttenuation = 0.0;\n\n    // See if point on surface is inside cone of illumination\n    float spotDot = clamp(dot(-VP, _light.direction), 0.0, 1.0);\n\n    if (spotDot >= _light.spotCosCutoff) {\n        spotAttenuation = pow(spotDot, _light.spotExponent);\n    }\n\n    light_accumulator_ambient.rgb += _light.ambient * attenuation * spotAttenuation;\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        light_accumulator_diffuse.rgb += _light.diffuse * nDotVP * attenuation * spotAttenuation;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        // Power factor for shiny speculars\n        float pf = 0.0;\n        if (nDotVP > 0.0) {\n            vec3 reflectVector = reflect(-VP, _normal);\n            float eyeDotR = max(dot(-normalize(_eyeToPoint), reflectVector), 0.0);\n            pf = pow(eyeDotR, material.shininess);\n        }\n        light_accumulator_specular.rgb += _light.specular * pf * attenuation * spotAttenuation;\n    #endif\n}\n",x=function(){function a(b,c){g(this,a),this.name=c.name,this.view=b,this.ambient=null==c.ambient||"number"==typeof c.ambient?n.default.expandVec3(c.ambient||0):s.StyleParser.parseColor(c.ambient).slice(0,3),this.diffuse=null==c.diffuse||"number"==typeof c.diffuse?n.default.expandVec3(null!=c.diffuse?c.diffuse:1):s.StyleParser.parseColor(c.diffuse).slice(0,3),this.specular=null==c.specular||"number"==typeof c.specular?n.default.expandVec3(c.specular||0):s.StyleParser.parseColor(c.specular).slice(0,3)}return j(a,[{key:"inject",value:function(){var b="\n            uniform "+this.struct_name+" u_"+this.name+";\n            "+this.struct_name+" "+this.name+";\n            ",c="\n            "+this.name+" = u_"+this.name+";\n\n        ";l.default.addBlock(a.block,b),l.default.addBlock("setup",c)}},{key:"update",value:function(){}},{key:"setupProgram",value:function(a){a.uniform("3fv","u_"+this.name+".ambient",this.ambient),a.uniform("3fv","u_"+this.name+".diffuse",this.diffuse),a.uniform("3fv","u_"+this.name+".specular",this.specular)}}],[{key:"create",value:function(b,c){return a.types[c.type]?new a.types[c.type](b,c):void 0}},{key:"setMode",value:function(b,c){b===!0&&(b="fragment"),b=a.enabled&&(null!=b?b:"fragment"),c.defines.TANGRAM_LIGHTING_FRAGMENT="fragment"===b,c.defines.TANGRAM_LIGHTING_VERTEX="vertex"===b}},{key:"inject",value:function(b){if(l.default.removeBlock(a.block),a.enabled){var c="";if(b&&Object.keys(b).length>0){var d={};for(var e in b)d[b[e].type]=!0;for(var f in d)a.types[f].inject();for(var g in b)b[g].inject(),c+="calculateLight("+g+", _eyeToPoint, _normal);\n"}var h="\n            vec4 calculateLighting(in vec3 _eyeToPoint, in vec3 _normal, in vec4 _color) {\n\n                // Do initial material calculations over normal, emission, ambient, diffuse and specular values\n                calculateMaterial(_eyeToPoint,_normal);\n\n                // Un roll the loop of individual ligths to calculate\n                "+c+"\n\n                //  Final light intensity calculation\n                vec4 color = vec4(vec3(0.), _color.a); // start with vertex color alpha\n\n                #ifdef TANGRAM_MATERIAL_EMISSION\n                    color.rgb = material.emission.rgb;\n                    color.a *= material.emission.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_AMBIENT\n                    color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.ambient.rgb;\n                    color.a *= material.ambient.a;\n                #else\n                    #ifdef TANGRAM_MATERIAL_DIFFUSE\n                        color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.diffuse.rgb;\n                    #endif\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_DIFFUSE\n                    color.rgb += light_accumulator_diffuse.rgb * _color.rgb * material.diffuse.rgb;\n                    color.a *= material.diffuse.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_SPECULAR\n                    color.rgb += light_accumulator_specular.rgb * material.specular.rgb;\n                    color.a *= material.specular.a;\n                #endif\n\n                // Clamp final color\n                color = clamp(color, 0.0, 1.0);\n\n                return color;\n            }";l.default.addBlock(a.block,h)}}}]),a}();c.default=x,x.types={},x.block="lighting",x.enabled=!0;var y=function(a){function b(a,c){g(this,b);var d=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.type="ambient",d.struct_name="AmbientLight",d}return f(b,a),j(b,[{key:"setupProgram",value:function(a){a.uniform("3fv","u_"+this.name+".ambient",this.ambient)}}],[{key:"inject",value:function(){l.default.addBlock(x.block,t)}}]),b}(x);x.types.ambient=y;var z=function(a){function b(a,c){g(this,b);var d=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));if(d.type="directional",d.struct_name="DirectionalLight",c.direction)d._direction=c.direction;else{var f=135,h=Math.sin(60*Math.PI/180);d._direction=[Math.cos(Math.PI*f/180)*h,Math.sin(Math.PI*f/180)*h,-.5],null==c.ambient&&(d.ambient=n.default.expandVec3(.5))}return d.direction=d._direction.map(parseFloat),d}return f(b,a),j(b,[{key:"setupProgram",value:function(a){i(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"setupProgram",this).call(this,a),a.uniform("3fv","u_"+this.name+".direction",this.direction)}},{key:"direction",get:function(){return this._direction},set:function(a){this._direction=r.default.normalize(a)}}],[{key:"inject",value:function(){l.default.addBlock(x.block,u)}}]),b}(x);x.types.directional=z;var A=function(a){function b(a,c){g(this,b);var d=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.type="point",d.struct_name="PointLight",d.position=c.position||[0,0,"100px"],d.position_eye=[],d.origin=c.origin||"ground",d.attenuation=isNaN(parseFloat(c.attenuation))?0:parseFloat(c.attenuation),d.radius=c.radius?Array.isArray(c.radius)&&2===c.radius.length?c.radius:[null,c.radius]:null,d}return f(b,a),j(b,[{key:"inject",value:function(){i(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"inject",this).call(this),l.default.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT=0!==this.attenuation,l.default.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS=null!=this.radius&&null!=this.radius[0],l.default.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS=null!=this.radius}},{key:"update",value:function(){this.updateEyePosition()}},{key:"updateEyePosition",value:function(){if("world"===this.origin){var a=p.default.latLngToMeters(this.position),b=h(a,2),c=b[0],d=b[1];this.position_eye[0]=c-this.view.camera.position_meters[0],this.position_eye[1]=d-this.view.camera.position_meters[1],this.position_eye[2]=s.StyleParser.convertUnits(this.position[2],{zoom:this.view.zoom,meters_per_pixel:p.default.metersPerPixel(this.view.zoom)}),this.position_eye[2]=this.position_eye[2]-this.view.camera.position_meters[2]}else("ground"===this.origin||"camera"===this.origin)&&(this.position_eye=s.StyleParser.convertUnits(this.position,{zoom:this.view.zoom,meters_per_pixel:p.default.metersPerPixel(this.view.zoom)}),"ground"===this.origin&&(this.position_eye[2]=this.position_eye[2]-this.view.camera.position_meters[2]));this.position_eye[3]=1}},{key:"setupProgram",value:function(a){i(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"setupProgram",this).call(this,a),a.uniform("4fv","u_"+this.name+".position",this.position_eye),l.default.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT&&a.uniform("1f","u_"+this.name+".attenuationExponent",this.attenuation),l.default.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS&&a.uniform("1f","u_"+this.name+".innerRadius",s.StyleParser.convertUnits(this.radius[0],{zoom:this.view.zoom,meters_per_pixel:p.default.metersPerPixel(this.view.zoom)})),l.default.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS&&a.uniform("1f","u_"+this.name+".outerRadius",s.StyleParser.convertUnits(this.radius[1],{zoom:this.view.zoom,meters_per_pixel:p.default.metersPerPixel(this.view.zoom)}))}}],[{key:"inject",value:function(){l.default.addBlock(x.block,v)}}]),b}(x);x.types.point=A;var B=function(a){function b(a,c){g(this,b);var d=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.type="spotlight",d.struct_name="SpotLight",d.direction=d._direction=(c.direction||[0,0,-1]).map(parseFloat),
d.exponent=c.exponent?parseFloat(c.exponent):.2,d.angle=c.angle?parseFloat(c.angle):20,d}return f(b,a),j(b,[{key:"setupProgram",value:function(a){i(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"setupProgram",this).call(this,a),a.uniform("3fv","u_"+this.name+".direction",this.direction),a.uniform("1f","u_"+this.name+".spotCosCutoff",Math.cos(3.14159*this.angle/180)),a.uniform("1f","u_"+this.name+".spotExponent",this.exponent)}},{key:"direction",get:function(){return this._direction},set:function(a){this._direction=r.default.normalize(a)}}],[{key:"inject",value:function(){l.default.addBlock(x.block,w)}}]),b}(A);x.types.spotlight=B},{"./geo":201,"./gl/glsl":205,"./gl/shader_program":207,"./styles/style_parser":245,"./vector":272}],224:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./gl/glsl"),h=d(g),i=a("./styles/style_parser"),j="/*\n\nDefines globals:\nmaterial\nlight_accumulator_*\n\n*/\n\n\n// MATERIALS\n//\nstruct Material {\n    #ifdef TANGRAM_MATERIAL_EMISSION\n        vec4 emission;\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n            vec3 emissionScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_AMBIENT\n        vec4 ambient;\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n            vec3 ambientScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_DIFFUSE\n        vec4 diffuse;\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n            vec3 diffuseScale;\n        #endif\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_SPECULAR\n        vec4 specular;\n        float shininess;\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n            vec3 specularScale;\n        #endif\n    #endif\n\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\n        vec3 normalScale;\n        float normalAmount;\n    #endif\n};\n\n// Note: uniform is copied to a global instance to allow modification\nuniform Material u_material;\nMaterial material;\n\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nuniform sampler2D u_material_emission_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nuniform sampler2D u_material_ambient_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nuniform sampler2D u_material_diffuse_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nuniform sampler2D u_material_specular_texture;\n#endif\n\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nuniform sampler2D u_material_normal_texture;\n#endif\n\n// Global light accumulators for each property\nvec4 light_accumulator_ambient = vec4(vec3(0.0), 1.);\nvec4 light_accumulator_diffuse = vec4(vec3(0.0), 1.);\n#ifdef TANGRAM_MATERIAL_SPECULAR\n    vec4 light_accumulator_specular = vec4(vec3(0.0), 1.);\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_SPHEREMAP\nvec4 getSphereMap (in sampler2D _tex, in vec3 _eyeToPoint, in vec3 _normal, in vec2 _skew) {\n    vec3 eye = normalize(_eyeToPoint);\n    eye.xy -= _skew;\n    eye = normalize(eye);\n\n    vec3 r = reflect(eye, _normal);\n    r.z += 1.0;\n    float m = 2. * length(r);\n    vec2 uv = r.xy / m + .5;\n    return texture2D(_tex, uv);\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_TRIPLANAR\nvec3 getTriPlanarBlend (in vec3 _normal) {\n    vec3 blending = abs(_normal);\n    blending = normalize(max(blending, 0.00001));\n    float b = (blending.x + blending.y + blending.z);\n    return blending / b;\n}\n\nvec4 getTriPlanar (in sampler2D _tex, in vec3 _pos, in vec3 _normal, in vec3 _scale) {\n    vec3 blending = getTriPlanarBlend(_normal);\n    vec4 xaxis = texture2D(_tex, fract(_pos.yz * _scale.x));\n    vec4 yaxis = texture2D(_tex, fract(_pos.xz * _scale.y));\n    vec4 zaxis = texture2D(_tex, fract(_pos.xy * _scale.z));\n    return  xaxis * blending.x + yaxis * blending.y + zaxis * blending.z;\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_TEXTURE_PLANAR\nvec4 getPlanar (in sampler2D _tex, in vec3 _pos, in vec2 _scale) {\n    return texture2D( _tex, fract(_pos.xy * _scale.x) );\n}\n#endif\n\n\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvoid calculateNormal (inout vec3 _normal) {\n    // Get NORMALMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_UV\n    _normal += texture2D(u_material_normal_texture, fract(v_texcoord*material.normalScale.xy)).rgb*2.0-1.0;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_PLANAR\n    vec3 normalTex = getPlanar(u_material_normal_texture, v_world_position.xyz, material.normalScale.xy).rgb*2.0-1.0;\n    _normal += normalTex;\n    #endif\n\n    #ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_TRIPLANAR\n    vec3 normalTex = getTriPlanar(u_material_normal_texture, v_world_position.xyz, _normal, material.normalScale).rgb*2.0-1.0;\n    _normal += normalTex;\n    #endif\n\n    _normal = normalize(_normal);\n}\n#endif\n\nvoid calculateMaterial (in vec3 _eyeToPoint, inout vec3 _normal) {\n    // get EMISSION TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_UV\n        material.emission *= texture2D(u_material_emission_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_PLANAR\n        material.emission *= getPlanar(u_material_emission_texture, v_world_position.xyz, material.emissionScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_TRIPLANAR\n        material.emission *= getTriPlanar(u_material_emission_texture, v_world_position.xyz, _normal, material.emissionScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_SPHEREMAP\n        material.emission *= getSphereMap(u_material_emission_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get AMBIENT TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_UV\n        material.ambient *= texture2D(u_material_ambient_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_PLANAR\n        material.ambient *= getPlanar(u_material_ambient_texture, v_world_position.xyz, material.ambientScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_TRIPLANAR\n        material.ambient *= getTriPlanar(u_material_ambient_texture, v_world_position.xyz, _normal, material.ambientScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_SPHEREMAP\n        material.ambient *= getSphereMap(u_material_ambient_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get DIFFUSE TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_UV\n        material.diffuse *= texture2D(u_material_diffuse_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_PLANAR\n        material.diffuse *= getPlanar(u_material_diffuse_texture, v_world_position.xyz, material.diffuseScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_TRIPLANAR\n        material.diffuse *= getTriPlanar(u_material_diffuse_texture, v_world_position.xyz, _normal, material.diffuseScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_SPHEREMAP\n        material.diffuse *= getSphereMap(u_material_diffuse_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n\n    // get SPECULAR TEXTUREMAP\n    //------------------------------------------------\n    #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_UV\n        material.specular *= texture2D(u_material_specular_texture,v_texcoord);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_PLANAR\n        material.specular *= getPlanar(u_material_specular_texture, v_world_position.xyz, material.specularScale.xy);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_TRIPLANAR\n        material.specular *= getTriPlanar(u_material_specular_texture, v_world_position.xyz, _normal, material.specularScale);\n        #endif\n\n        #ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_SPHEREMAP\n        material.specular *= getSphereMap(u_material_specular_texture, _eyeToPoint, _normal, u_vanishing_point);\n        #endif\n    #endif\n}\n",k=["emission","ambient","diffuse","specular"],l=function(){function a(b){var c=this;e(this,a),b=b||{},k.forEach(function(a){var d=b[a];null!=d&&(c[a]=d.texture?{texture:d.texture,mapping:d.mapping||"spheremap",scale:h.default.expandVec3(null!=d.scale?d.scale:1),amount:h.default.expandVec4(null!=d.amount?d.amount:1)}:"number"==typeof d||Array.isArray(d)?{amount:h.default.expandVec4(d)}:"string"==typeof d?{amount:i.StyleParser.parseColor(d)}:d)}),this.specular&&(this.specular.shininess=b.shininess?parseFloat(b.shininess):.2),null!=b.normal&&(this.normal={texture:b.normal.texture,mapping:b.normal.mapping||"triplanar",scale:h.default.expandVec3(null!=b.normal.scale?b.normal.scale:1),amount:null!=b.normal.amount?b.normal.amount:1})}return f(a,[{key:"inject",value:function(b){var c=this;k.forEach(function(a){var d="TANGRAM_MATERIAL_"+a.toUpperCase(),e=d+"_TEXTURE";b.defines[d]=null!=c[a],c[a]&&c[a].texture&&(b.defines[e]=!0,b.defines[e+"_"+c[a].mapping.toUpperCase()]=!0,b.defines["TANGRAM_MATERIAL_TEXTURE_"+c[a].mapping.toUpperCase()]=!0,b.texcoords=b.texcoords||"uv"===c[a].mapping)}),this.normal&&this.normal.texture&&(b.defines.TANGRAM_MATERIAL_NORMAL_TEXTURE=!0,b.defines["TANGRAM_MATERIAL_NORMAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,b.defines["TANGRAM_MATERIAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,b.texcoords=b.texcoords||"uv"===this.normal.mapping),b.replaceShaderBlock(a.block,j,"Material"),b.addShaderBlock("setup","\nmaterial = u_material;\n","Material")}},{key:"setupProgram",value:function(a){var b=this;k.forEach(function(c){b[c]&&(b[c].texture?(a.setTextureUniform("u_material_"+c+"_texture",b[c].texture),a.uniform("3fv","u_material."+c+"Scale",b[c].scale),a.uniform("4fv","u_material."+c,b[c].amount)):b[c].amount&&a.uniform("4fv","u_material."+c,b[c].amount))}),this.specular&&a.uniform("1f","u_material.shininess",this.specular.shininess),this.normal&&this.normal.texture&&(a.setTextureUniform("u_material_normal_texture",this.normal.texture),a.uniform("3fv","u_material.normalScale",this.normal.scale),a.uniform("1f","u_material.normalAmount",this.normal.amount))}}],[{key:"isValid",value:function(a){return null!=a&&(null!=a.emission||null!=a.ambient||null!=a.diffuse||null!=a.specular)}}]),a}();c.default=l,l.block="material"},{"./gl/glsl":205,"./styles/style_parser":245}],225:[function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}a("./utils/polyfills");var d=a("./leaflet_layer"),e=a("./scene"),f=c(e),g=a("./scene_worker"),h=a("./utils/version"),i=c(h),j=a("./utils/log"),k=c(j),l=a("./utils/thread"),m=c(l),n=a("./utils/utils"),o=c(n),p=a("./geo"),q=c(p),r=a("./vector"),s=c(r),t=a("./sources/data_source"),u=c(t);a("./sources/geojson"),a("./sources/topojson"),a("./sources/mvt"),a("./sources/raster");var v=a("./gl/glsl"),w=c(v),x=a("./gl/shader_program"),y=c(x),z=a("./gl/vertex_data"),A=c(z),B=a("./gl/texture"),C=c(B),D=a("./material"),E=c(D),F=a("./light"),G=c(F),H=a("./utils/worker_broker"),I=c(H),J=a("./styles/layer"),K=a("./styles/style_manager"),L=a("./styles/style_parser"),M=a("./labels/collision"),N=c(M),O=a("./selection"),P=c(O),Q=a("./styles/text/canvas_text"),R=c(Q),S=a("./utils/debug_settings"),T=c(S),U=a("js-yaml"),V=c(U),W=a("jszip"),X=c(W),Y={log:k.default,yaml:V.default,Thread:m.default,Utils:o.default,Geo:q.default,Vector:s.default,DataSource:u.default,GLSL:w.default,ShaderProgram:y.default,VertexData:A.default,Texture:C.default,Material:E.default,Light:G.default,Scene:f.default,SceneWorker:g.SceneWorker,WorkerBroker:I.default,layerCache:J.layerCache,StyleManager:K.StyleManager,StyleParser:L.StyleParser,Collision:N.default,FeatureSelection:P.default,CanvasText:R.default,debugSettings:T.default};m.default.is_main&&(o.default.requestAnimationFramePolyfill(),void 0===window.Promise&&(window.Promise=Promise,X.default.external.Promise=Promise)),b.exports={leafletLayer:d.leafletLayer,debug:Y,version:i.default}},{"./geo":201,"./gl/glsl":205,"./gl/shader_program":207,"./gl/texture":208,"./gl/vertex_data":211,"./labels/collision":214,"./leaflet_layer":222,"./light":223,"./material":224,"./scene":226,"./scene_worker":229,"./selection":230,"./sources/data_source":231,"./sources/geojson":232,"./sources/mvt":233,"./sources/raster":234,"./sources/topojson":235,"./styles/layer":237,"./styles/style_manager":244,"./styles/style_parser":245,"./styles/text/canvas_text":246,"./utils/debug_settings":255,"./utils/log":259,"./utils/polyfills":263,"./utils/thread":267,"./utils/utils":269,"./utils/version":270,"./utils/worker_broker":271,"./vector":272,"js-yaml":97,jszip:133}],226:[function(a,e,f){"use strict";function g(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function h(a){return a&&a.__esModule?a:{default:a}}function i(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(f,"__esModule",{value:!0});var k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m=a("./utils/log"),n=h(m),o=a("./utils/utils"),p=h(o),q=a("./utils/debug_settings"),r=h(q),s=a("./utils/urls"),t=g(s),u=a("./utils/worker_broker"),v=h(u),w=a("./utils/task"),x=h(w),y=a("./utils/subscribe"),z=h(y),A=a("./utils/slice"),B=h(A),C=a("./gl/context"),D=h(C),E=a("./gl/texture"),F=h(E),G=a("./gl/shader_program"),H=h(G),I=a("./gl/vao"),J=h(I),K=a("./styles/style_manager"),L=a("./styles/style"),M=a("./styles/style_parser"),N=a("./scene_loader"),O=h(N),P=a("./view"),Q=h(P),R=a("./light"),S=h(R),T=a("./tile"),U=h(T),V=a("./tile_manager"),W=h(V),X=a("./sources/data_source"),Y=h(X),Z=a("./selection"),$=h(Z),_=a("./gl/render_state"),aa=h(_),ba=a("./styles/text/canvas_text"),ca=h(ba),da=a("./styles/text/font_manager"),ea=h(da),fa=a("./utils/media_capture"),ga=h(fa),ha=function(){function a(b,c){j(this,a),c=c||{},z.default(this),this.id=a.id++,this.initialized=!1,this.initializing=null,this.sources={},this.view=new Q.default(this,c),this.tile_manager=new W.default({scene:this,view:this.view}),this.num_workers=c.numWorkers||2,c.disableVertexArrayObjects===!0&&(J.default.disabled=!0),p.default.use_high_density_display=void 0===c.highDensityDisplay||c.highDensityDisplay,p.default.updateDevicePixelRatio(),this.config=null,this.config_source=b,this.config_bundle=null,this.last_valid_config_source=null,this.styles=null,this.style_manager=new K.StyleManager,this.building=null,this.dirty=!0,c.preUpdate&&this.subscribe({preUpdate:c.preUpdate}),c.postUpdate&&this.subscribe({postUpdate:c.postUpdate}),this.render_loop=!c.disableRenderLoop,this.render_loop_active=!1,this.render_loop_stop=!1,this.render_count=0,this.last_render_count=0,this.render_count_changed=!1,this.frame=0,this.last_main_render=-1,this.last_selection_render=-1,this.media_capture=new ga.default,this.selection=null,this.introspection=c.introspection===!0,this.resetTime(),this.container=c.container,this.canvas=null,this.contextOptions=c.webGLContextOptions,this.lights=null,this.background=null,this.createListeners(),this.updating=0,this.generation=a.generation,this.last_complete_generation=a.generation,this.setupDebug(),this.log_level=c.logLevel||"warn",n.default.setLevel(this.log_level),n.default.reset()}return l(a,[{key:"load",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initializing?this.initializing:(n.default.reset(),this.updating++,this.initialized=!1,this.initial_build_time=null,c="string"==typeof c?{base_path:c}:c,c.blocking=void 0===c.blocking||c.blocking,this.render_loop!==!1&&this.setupRenderLoop(),this.createCanvas(),this.initializing=this.loadScene(b,c).then(function(){return a.createWorkers()}).then(function(){a.resetFeatureSelection();var b="object"===k(a.config_source)||a.hasSubscribersFor("load"),d=a.updateConfig({serialize_funcs:b,normalize:!1,load_event:!0,fade_in:!0});return c.blocking===!0?d:void 0}).then(function(){a.updating--,a.initializing=null,a.initialized=!0,a.last_valid_config_source=a.config_source,a.last_valid_options={base_path:c.base_path,file_type:c.file_type},a.requestRedraw()}).catch(function(b){a.initializing=null,a.updating=0;var c=void 0,d=void 0;if("YAMLException"===b.name?(c="yaml",d="Error parsing scene YAML"):d="Error initializing scene",a.trigger("error",{type:c,message:d,error:b,url:a.config_source}),d="Scene.load() failed to load "+a.config_source+": "+b.message,a.last_valid_config_source)return n.default("warn",d,b),n.default("info","Scene.load() reverting to last valid configuration"),a.load(a.last_valid_config_source,a.last_valid_base_path);throw n.default("error",d,b),b}),this.initializing)}},{key:"destroy",value:function(){if(this.initialized=!1,this.render_loop_stop=!0,this.destroyListeners(),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.container=null,this.selection&&this.selection.destroy(),this.gl){F.default.destroy(this.gl),this.style_manager.destroy(this.gl),this.styles={},H.default.reset();var a=this.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this.gl=null}this.sources={},this.destroyWorkers(),this.tile_manager.destroy(),this.tile_manager=null,n.default.reset()}},{key:"createCanvas",value:function(){if(!this.canvas){this.container=this.container||document.body,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.container.style.backgroundColor="transparent",this.container.appendChild(this.canvas);try{this.gl=D.default.getContext(this.canvas,Object.assign({alpha:!0,premultipliedAlpha:!0,device_pixel_ratio:p.default.device_pixel_ratio},this.contextOptions))}catch(a){throw new Error("Couldn't create WebGL context. Your browser may not support WebGL, or it's turned off? Visit http://webglreport.com/ for more info.")}this.resizeMap(this.container.clientWidth,this.container.clientHeight),J.default.init(this.gl),this.render_states=new aa.default(this.gl),this.media_capture.setCanvas(this.canvas,this.gl)}}},{key:"getWorkerUrl",value:function(){var a=void 0;if("undefined"!=typeof b){var e="("+b+")()";if(c&&""!==d){var f=c.slice(0,c.lastIndexOf("/")+1);e+="\n//# sourceMappingURL="+f+d}a=t.createObjectURL(new Blob([e],{type:"application/javascript"}))}if(!a)throw new Error("Couldn't find internal Tangram source variable (may indicate the library did not build correctly)");var g=[].concat(i(this.data_source_scripts));g.push(a);var h="importScripts("+g.map(function(a){return"'"+a+"'"}).join(",")+");";return t.createObjectURL(new Blob([h],{type:"application/javascript"}))}},{key:"updateDataSourceScripts",value:function(){var a,b=this,c=[].concat(i(this.data_source_scripts||[])),d=Object.keys(this.config.sources).map(function(a){return b.config.sources[a].scripts}).filter(function(a){return a});return d.length>0&&n.default("debug","loading custom data source scripts in worker:",d),this.data_source_scripts=(a=[]).concat.apply(a,i(d)).sort(),!(this.data_source_scripts.length===c.length&&this.data_source_scripts.every(function(a,b){return a===c[b]}))}},{key:"createWorkers",value:function(){return this.updateDataSourceScripts()&&this.destroyWorkers(),this.workers?Promise.resolve():this.makeWorkers(this.getWorkerUrl())}},{key:"makeWorkers",value:function(a){var b=this,c=!!this.gl.getExtension("OES_element_index_uint"),d=[];this.workers=[];for(var e=function(){g=new Worker(a),b.workers[f]=g,v.default.addWorker(g),n.default("debug","Scene.makeWorkers: initializing worker "+f);var e=f;d.push(v.default.postMessage(g,"self.init",b.id,f,b.num_workers,b.log_level,p.default.device_pixel_ratio,c).then(function(a){return n.default("debug","Scene.makeWorkers: initialized worker "+a),a},function(a){return n.default("error","Scene.makeWorkers: failed to initialize worker "+e+":",a),Promise.reject(a)}))},f=0;f<this.num_workers;f++){var g;e()}return this.next_worker=0,Promise.all(d).then(function(){n.default.setWorkers(b.workers),t.revokeObjectURL(a)})}},{key:"destroyWorkers",value:function(){Array.isArray(this.workers)&&(n.default.setWorkers(null),this.workers.forEach(function(a){a.terminate()}),this.workers=null)}},{key:"ready",value:function(){return!(!this.view.ready()||0===Object.keys(this.sources).length)}},{key:"updateDevicePixelRatio",value:function(){var a=this;p.default.updateDevicePixelRatio()&&v.default.postMessage(this.workers,"self.updateDevicePixelRatio",p.default.device_pixel_ratio).then(function(){return a.rebuild()}).then(function(){return a.resizeMap(a.view.size.css.width,a.view.size.css.height)})}},{key:"resizeMap",value:function(a,b){(0!==a||0!==b)&&(this.dirty=!0,this.view.setViewportSize(a,b),this.gl&&D.default.resize(this.gl,a,b,p.default.device_pixel_ratio))}},{key:"requestRedraw",value:function(){this.dirty=!0}},{key:"immediateRedraw",value:function(){this.dirty=!0,this.update()}},{key:"renderLoop",value:function(){this.render_loop_active=!0,this.initialized&&this.update(),x.default.setState({user_moving_view:this.view.user_input_active}),x.default.processAll(),this.render_loop_stop?(this.render_loop_stop=!1,this.render_loop_active=!1):window.requestAnimationFrame(this.renderLoop.bind(this))}},{key:"setupRenderLoop",value:function(){var a=this;this.render_loop_active||setTimeout(function(){a.renderLoop()},0)}},{key:"update",value:function(){var a=this.dirty,b=!!this.selection&&this.selection.hasPendingRequests(),c=!(a===!1&&b===!1||this.initialized===!1||this.updating>0||this.ready()===!1);return this.trigger("preUpdate",c),this.view.update(),!!c&&(this.dirty=!1,this.updateDevicePixelRatio(),this.render({main:a,selection:b}),this.updateViewComplete(),this.media_capture.completeScreenshot(),this.trigger("postUpdate",c),(this.animated===!0||this.view.isAnimating())&&(this.dirty=!0),this.frame++,n.default("trace","Scene.render()"),!0)}},{key:"render",value:function(a){var b=this,c=a.main,d=a.selection,e=this.gl;if(Object.keys(this.lights).forEach(function(a){return b.lights[a].update()}),c&&(this.render_count=this.renderPass(),this.last_main_render=this.frame),d){if(this.view.panning||this.view.user_input_active)return void this.selection.clearPendingRequests();!this.selection.locked&&this.last_selection_render<this.last_main_render&&(this.selection.bind(),this.renderPass("selection_program",{allow_blend:!1}),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.canvas.width,this.canvas.height),e.clearColor.apply(e,i(this.background.color)),this.last_selection_render=this.frame),this.selection.read()}return this.render_count_changed=!1,this.render_count!==this.last_render_count&&(this.render_count_changed=!0,this.getFeatureSelectionMapSize().then(function(a){a&&n.default("info","Scene: rendered "+b.render_count+" primitives ("+a+" features in selection map)")})),this.last_render_count=this.render_count,!0}},{key:"renderPass",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"program",c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=c.allow_blend;d=null==d||d,this.clearFrame({clear_color:!0,clear_depth:!0});for(var e=this.tile_manager.getActiveStyles().map(function(b){return a.styles[b]}).filter(function(a){return a}).sort(L.Style.blendOrderSort),f=0,g=void 0,h=0;h<e.length;h++){var i=e[h];if(i.blend!==g){var j=Object.assign({},L.Style.render_states[i.blend],{blend:d&&i.blend});this.setRenderState(j)}f+=this.renderStyle(i.name,b),g=i.blend}return f}},{key:"renderStyle",value:function(a,b){for(var c=this,d=this.styles[a],e=!0,f=0,g=void 0,h=this.tile_manager.getRenderableTiles(),i=0;i<h.length;i++){var j=h[i];if(null!=j.meshes[a]){if(e===!0&&(e=!1,g=this.setupStyle(d,b),!g))return 0;j.shouldProxyForStyle(a)&&(this.view.setupTile(j,g),j.meshes[a].forEach(function(a){d.render(a)&&c.requestRedraw(),f+=a.geometry_count}))}}return f}},{key:"setupStyle",value:function(a,b){var c=void 0;try{if(c=a.getProgram(b),!c)return}catch(b){return void this.trigger("warning",{type:"styles",message:"Error compiling style "+a.name,style:a,shader_errors:a.program&&a.program.shader_errors})}c.use(),a.setup(),c.uniform("1f","u_time",this.animated?(+new Date-this.start_time)/1e3:0),this.view.setupProgram(c);for(var d in this.lights)this.lights[d].setupProgram(c);return c}},{key:"clearFrame",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.clear_color,c=a.clear_depth;if(this.initialized){b=b!==!1,c=c!==!1,this.render_states.depth_write.set({depth_write:c});var d=this.gl;if(b||c){var e=(b&&d.COLOR_BUFFER_BIT)|(c&&d.DEPTH_BUFFER_BIT);d.clear(e)}}}},{key:"setRenderState",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.depth_test,c=a.depth_write,d=a.cull_face,e=a.blend;if(this.initialized){var f=this.render_states;b=b!==!1&&f.defaults.depth_test,c=c!==!1&&f.defaults.depth_write,d=d!==!1&&f.defaults.culling,e=null!=e?e:f.defaults.blending;var g=this.gl;f.depth_test.set({depth_test:b}),f.depth_write.set({depth_write:c}),f.culling.set({cull:d,face:f.defaults.culling_face}),e?"opaque"===e?f.blending.set({blend:!1}):"overlay"===e||"inlay"===e?f.blending.set({blend:!0,src:g.SRC_ALPHA,dst:g.ONE_MINUS_SRC_ALPHA,src_alpha:g.ONE,dst_alpha:g.ONE_MINUS_SRC_ALPHA}):"add"===e?f.blending.set({blend:!0,src:g.ONE,dst:g.ONE}):"multiply"===e&&f.blending.set({blend:!0,src:g.ZERO,dst:g.SRC_COLOR}):f.blending.set({blend:!1})}}},{key:"getFeatureAt",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=b.radius;if(!this.initialized)return n.default("debug","Scene.getFeatureAt() called before scene was initialized"),Promise.resolve();var d={x:a.x/this.view.size.css.width,y:a.y/this.view.size.css.height};return c=c>0?{x:c/this.view.size.css.width,y:c/this.view.size.css.height}:null,this.selection.getFeatureAt(d,{radius:c}).then(function(b){return Object.assign(b,{pixel:a})}).catch(function(a){return Promise.resolve({error:a})})}},{key:"queryFeatures",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.filter,c=a.unique,d=void 0===c||c,e=a.group_by,f=void 0===e?null:e,g=a.visible,h=void 0===g?null:g,i=a.geometry,j=void 0!==i&&i;b=p.default.serializeWithFunctions(b);var k=this.tile_manager.getRenderableTiles().map(function(a){return a.key});return v.default.postMessage(this.workers,"self.queryFeatures",{filter:b,visible:h,geometry:j,tile_keys:k}).then(function(a){var b=[],c={},e={};d="string"==typeof d?[d]:d;var g=d&&function(a){return JSON.stringify(Array.isArray(d)?B.default(a,d):a)};f=("string"==typeof f||Array.isArray(f))&&f;var h=f&&function(a){return Array.isArray(f)?JSON.stringify(B.default(a,f)):a[f]};return a.forEach(function(a){return a.forEach(function(a){if(g){var d=g(a);if(c[d])return;c[d]=!0}if(h){var f=h(a.properties);e[f]=e[f]||[],e[f].push(a)}else b.push(a)})}),h?e:b})}},{key:"rebuild",value:function(){var b=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=c.new_generation,e=void 0===d||d,f=c.sources,g=void 0===f?null:f,h=c.serialize_funcs,i=c.profile,j=void 0!==i&&i,k=c.fade_in,l=void 0!==k&&k;return new Promise(function(c,d){if(b.building){b.building.queued&&b.building.queued.reject&&(n.default("debug","Scene.rebuild: request superceded by a newer call"),b.building.queued.resolve(!1));var f={new_generation:e,sources:g,serialize_funcs:h,profile:j,fade_in:l};return b.building.queued={resolve:c,reject:d,options:f},void n.default("trace","Scene.rebuild(): queuing request")}if(b.building={resolve:c,reject:d},j&&b._profile("Scene.rebuild"),e){b.generation=++a.generation;for(var i in b.styles)b.styles[i].setGeneration(b.generation)}b.syncConfigToWorker({serialize_funcs:h}),b.resetFeatureSelection(g),b.resetTime(),b.tile_manager.pruneToVisibleTiles(),b.tile_manager.forEachTile(function(a){(!g||g.indexOf(a.source.name)>-1)&&b.tile_manager.buildTile(a,{fade_in:l})}),b.tile_manager.updateTilesForView(),b.tile_manager.checkBuildQueue()}).then(function(){j&&b._profileEnd("Scene.rebuild")})}},{key:"tileManagerBuildDone",value:function(){if(ca.default.pruneTextCache(),this.building){n.default("info","Scene: build geometry finished"),this.building.resolve&&(null==this.initial_build_time&&(this.initial_build_time=+new Date-this.start_time,n.default("debug","Scene: initial build time: "+this.initial_build_time)),this.building.resolve(!0));var a=this.building.queued;this.building=null,a&&(n.default("debug","Scene: starting queued rebuild() request"),this.rebuild(a.options).then(a.resolve,a.reject))}}},{key:"loadScene",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=c.base_path,e=c.file_type;return this.config_source=b||this.config_source,this.config_globals_applied=[],this.base_path=t.pathForURL("string"==typeof this.config_source?d||this.config_source:d),this.config_path=this.base_path,O.default.loadScene(this.config_source,{path:this.base_path,type:e}).then(function(b){var c=b.config,d=b.bundle;return a.config=c,a.config_bundle=d,a.config})}},{key:"setDataSource",value:function(a,b){if(!a||!b||!b.type||!b.url&&!b.data)return void n.default("error","No name provided or not a valid config:",a,b);var c=null==this.config.sources[a],d=this.config.sources[a]=Object.assign({},b);return d.data&&"object"===k(d.data)&&(d.url=t.createObjectURL(new Blob([JSON.stringify(d.data)])),delete d.data),c?this.updateConfig({rebuild:{sources:[a]}}):this.rebuild({sources:[a]})}},{key:"createDataSources",value:function(){var a=this,b=[],c=Object.keys(this.sources),d=0;for(var e in this.config.sources){var f=this.config.sources[e],g=this.sources[e];try{var h=Object.assign({},f,{name:e,id:d++});if(this.sources[e]=Y.default.create(h,this.sources),!this.sources[e])throw{}}catch(a){delete this.sources[e];var i="Could not create data source: "+a.message;n.default("warn","Scene: "+i,f),this.trigger("warning",{type:"sources",source:f,message:i})}Y.default.changed(this.sources[e],g)&&b.push(e)}c.forEach(function(c){a.config.sources[c]||(delete a.sources[c],b.push(c))}),b.length>0&&this.tile_manager.removeTiles(function(a){return b.indexOf(a.source.name)>-1});for(var j in this.config.layers){var k=this.config.layers[j];k.enabled!==!1&&k.data&&this.sources[k.data.source]&&(this.sources[k.data.source].builds_geometry_tiles=!0)}}},{key:"loadTextures",value:function(){var a=this;return F.default.createFromObject(this.gl,this.config.textures).then(function(){return F.default.createDefault(a.gl)})}},{key:"updateStyles",value:function(){if(!this.initialized&&!this.initializing)throw new Error("Scene.updateStyles() called before scene was initialized");this.styles=this.style_manager.build(this.config.styles),
this.style_manager.initStyles(this);for(var a in this.styles)this.styles[a].setGL(this.gl);this.dirty=!0}},{key:"getActiveCamera",value:function(){return this.view.getActiveCamera()}},{key:"setActiveCamera",value:function(a){return this.view.setActiveCamera(a)}},{key:"createLights",value:function(){this.lights={};for(var a in this.config.lights)if(this.config.lights[a]&&"object"===k(this.config.lights[a])){var b=this.config.lights[a];b.name=a.replace("-","_"),b.visible=b.visible!==!1,b.visible&&(this.lights[b.name]=S.default.create(this.view,b))}S.default.inject(this.lights)}},{key:"setBackground",value:function(){var a,b=this.config.scene.background;this.background={},b&&b.color&&(this.background.color=M.StyleParser.parseColor(b.color)),this.background.color||(this.background.color=[0,0,0,0]),this.canvas.style.backgroundColor=1===this.background.color[3]?"rgba("+this.background.color.map(function(a){return Math.floor(255*a)}).join(", ")+")":"transparent",(a=this.gl).clearColor.apply(a,i(this.background.color))}},{key:"setIntrospection",value:function(a){var b=this;return a!==this.introspection?(this.introspection=a||!1,this.updating++,this.updateConfig({normalize:!1}).then(function(){return b.updating--})):Promise.resolve()}},{key:"updateConfig",value:function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=b.load_event,d=void 0!==c&&c,e=b.rebuild,f=void 0===e||e,g=b.serialize_funcs,h=b.normalize,i=void 0===h||h,j=b.fade_in,l=void 0!==j&&j;this.generation=++a.generation,this.updating++,this.config=O.default.applyGlobalProperties(this.config,this.config_globals_applied),i&&O.default.normalize(this.config,this.config_bundle),this.trigger(d?"load":"update",{config:this.config}),O.default.hoistTextures(this.config),this.style_manager.init(),this.view.reset(),this.createLights(),this.createDataSources(),this.loadTextures(),this.setBackground(),ea.default.loadFonts(this.config.fonts),this.updateStyles();var m=f?this.rebuild(Object.assign({new_generation:!1,serialize_funcs:g,fade_in:l},"object"===("undefined"==typeof f?"undefined":k(f))&&f)):this.syncConfigToWorker({serialize_funcs:g});return this.updating--,this.view.updateBounds(),this.requestRedraw(),m}},{key:"syncConfigToWorker",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.serialize_funcs,c=void 0===b||b,d=c?p.default.serializeWithFunctions(this.config):JSON.stringify(this.config);return v.default.postMessage(this.workers,"self.updateConfig",{config:d,generation:this.generation,introspection:this.introspection},r.default)}},{key:"createListeners",value:function(){var a=this;this.listeners={},this.listeners.view={move:function(){return a.trigger("move")}},this.view.subscribe(this.listeners.view),this.listeners.texture={update:function(){return a.dirty=!0},warning:function(b){return a.trigger("warning",Object.assign({type:"textures"},b))}},F.default.subscribe(this.listeners.texture),this.listeners.scene_loader={error:function(b){return a.trigger("error",Object.assign({type:"scene"},b))}},O.default.subscribe(this.listeners.scene_loader)}},{key:"destroyListeners",value:function(){this.unsubscribeAll(),this.view.unsubscribe(this.listeners.view),F.default.unsubscribe(this.listeners.texture),O.default.unsubscribe(this.listeners.scene_loader),this.listeners=null}},{key:"resetFeatureSelection",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.selection?this.workers&&v.default.postMessage(this.workers,"self.resetFeatureSelection",b):this.selection=new $.default(this.gl,this.workers,function(){return a.building})}},{key:"getFeatureSelectionMapSize",value:function(){var a=this;return this.fetching_selection_map?Promise.resolve():(this.fetching_selection_map=!0,v.default.postMessage(this.workers,"self.getFeatureSelectionMapSize").then(function(b){return a.fetching_selection_map=!1,b.reduce(function(a,b){return a+b})}))}},{key:"resetTime",value:function(){this.start_time=+new Date}},{key:"updateViewComplete",value:function(){!this.render_count_changed&&this.generation===this.last_complete_generation||this.tile_manager.isLoadingVisibleTiles()||(this.last_complete_generation=this.generation,this.trigger("view_complete"))}},{key:"resetViewComplete",value:function(){this.last_complete_generation=null}},{key:"screenshot",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.background,c=void 0===b?"white":b;return this.requestRedraw(),this.media_capture.screenshot({background:c})}},{key:"startVideoCapture",value:function(){return this.requestRedraw(),this.media_capture.startVideoCapture()}},{key:"stopVideoCapture",value:function(){return this.media_capture.stopVideoCapture()}},{key:"_profile",value:function(a){console.profile("main thread: "+a),v.default.postMessage(this.workers,"self.profile",a)}},{key:"_profileEnd",value:function(a){console.profileEnd("main thread: "+a),v.default.postMessage(this.workers,"self.profileEnd",a)}},{key:"setupDebug",value:function(){var a=this;this.debug={timeRebuild:function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=[],e=function e(){var f=+new Date;a.rebuild(c).then(function(){if(d.push(+new Date-f),d.length<b)e();else{var a=~~(d.reduce(function(a,b){return a+b})/d.length);n.default("info","Profiled rebuild "+b+" times: "+a+" avg ("+Math.min.apply(Math,d)+" min, "+Math.max.apply(Math,d)+" max)")}})};e()},geometryCountByStyle:function(){var b={};return a.tile_manager.getRenderableTiles().forEach(function(a){var c=function(c){b[c]=b[c]||0,a.meshes[c].forEach(function(a){b[c]+=a.geometry_count})};for(var d in a.meshes)c(d)}),b},geometryCountByBaseStyle:function(){var b=a.debug.geometryCountByStyle(),c={};for(var d in b){var e=a.styles[d].baseStyle();c[e]=c[e]||0,c[e]+=b[d]}return c},geometrySizeByStyle:function(){var b={};return a.tile_manager.getRenderableTiles().forEach(function(a){var c=function(c){b[c]=b[c]||0,a.meshes[c].forEach(function(a){b[c]+=a.buffer_size})};for(var d in a.meshes)c(d)}),b},geometrySizeByBaseStyle:function(){var b=a.debug.geometrySizeByStyle(),c={};for(var d in b){var e=a.styles[d].baseStyle();c[e]=c[e]||0,c[e]+=b[d]}return c},layerStats:function(){return r.default.layer_stats?U.default.debugSumLayerStats(a.tile_manager.getRenderableTiles()):(n.default("warn","Enable the 'layer_stats' debug setting to collect layer stats"),{})},renderableTilesCount:function(){return a.tile_manager.getRenderableTiles().length}}}},{key:"tileFetchFailed",value:function(a){this.trigger("tileError",{statusCode:a})}},{key:"animated",get:function(){var a=this;return void 0!==this.config.scene.animated?this.config.scene.animated:this.tile_manager.getActiveStyles().some(function(b){return a.styles[b].animated})}}],[{key:"create",value:function(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new a(b,c)}}]),a}();f.default=ha,ha.id=0,ha.generation=0},{"./gl/context":203,"./gl/render_state":206,"./gl/shader_program":207,"./gl/texture":208,"./gl/vao":209,"./light":223,"./scene_loader":228,"./selection":230,"./sources/data_source":231,"./styles/style":243,"./styles/style_manager":244,"./styles/style_parser":245,"./styles/text/canvas_text":246,"./styles/text/font_manager":247,"./tile":251,"./tile_manager":252,"./utils/debug_settings":255,"./utils/log":259,"./utils/media_capture":260,"./utils/slice":264,"./utils/subscribe":265,"./utils/task":266,"./utils/urls":268,"./utils/utils":269,"./utils/worker_broker":271,"./view":273}],227:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function i(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return null!=d&&"zip"===d||"string"==typeof a&&!r.isLocalURL(a)&&"zip"===r.extensionForURL(a)?new x(a,b,c):new w(a,b,c)}function j(a){return!(!a||"global."!==a.slice(0,7))}function k(a){var b;try{b=v.default.safeLoad(a,{json:!0})}catch(a){throw a}return b}function l(a){return new Promise(function(b,c){"string"==typeof a?p.default.io(a).then(function(a){try{var d=k(a);b(d)}catch(a){c(a)}},c):(a=Object.assign({},a),b(a))})}Object.defineProperty(c,"__esModule",{value:!0}),c.ZipSceneBundle=c.SceneBundle=void 0;var m=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},n=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();c.createSceneBundle=i,c.isGlobal=j;var o=a("./utils/utils"),p=e(o),q=a("./utils/urls"),r=d(q),s=a("jszip"),t=e(s),u=a("js-yaml"),v=e(u),w=c.SceneBundle=function(){function a(b,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h(this,a),this.url=b,this.path=!c||r.isRelativeURL(c)&&!r.isRelativeURL(this.url)?r.pathForURL(this.url):c,this.path_for_parent=c||this.path,this.parent=d,this.container=null,this.parent&&(this.parent.container?this.container=this.parent.container:this.parent.isContainer()&&(this.container=this.parent))}return n(a,[{key:"load",value:function(){return l(this.url)}},{key:"resourceFor",value:function(a){return{url:this.urlFor(a),path:this.pathFor(a),type:this.typeFor(a)}}},{key:"urlFor",value:function(a){return j(a)?a:r.isRelativeURL(a)&&this.container?this.parent.urlFor(this.path_for_parent+a):r.addBaseURL(a,this.path)}},{key:"pathFor",value:function(a){return r.pathForURL(a)}},{key:"typeFor",value:function(a){return r.extensionForURL(a)}},{key:"isContainer",value:function(){return!1}}]),a}(),x=c.ZipSceneBundle=function(a){function b(a,c,d){h(this,b);var e=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d));return e.zip=null,e.files={},e.root=null,e.path="",e}return g(b,a),n(b,[{key:"isContainer",value:function(){return!0}},{key:"load",value:function(){var a=this;return this.zip=new t.default,"string"==typeof this.url?p.default.io(this.url,6e4,"arraybuffer").then(function(b){return a.zip.loadAsync(b)}).then(function(){return a.parseZipFiles()}).then(function(){return a.loadRoot()}).catch(function(a){return Promise.reject(a)}):Promise.resolve(this)}},{key:"urlFor",value:function(a){return j(a)?a:r.isRelativeURL(a)?this.urlForZipFile(r.flattenRelativeURL(a)):m(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"urlFor",this).call(this,a)}},{key:"typeFor",value:function(a){return r.isRelativeURL(a)?this.typeForZipFile(a):m(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"typeFor",this).call(this,a)}},{key:"loadRoot",value:function(){var a=this;return this.findRoot().then(function(){return l(a.urlForZipFile(a.root))})}},{key:"findRoot",value:function(){var a=this,b=Object.keys(this.files).filter(function(b){return 0===a.files[b].depth}).filter(function(a){return"yaml"===r.extensionForURL(a)});if(1===b.length&&(this.root=b[0]),!this.root){var c="Could not find root scene for bundle '"+this.url+"': ";return c+="The zip archive's root level must contain a single scene file with the '.yaml' extension. ",c+=b.length>0?"Found multiple YAML files at the root level: "+b.map(function(a){return"'"+a+"'"}).join(", ")+".":"Found NO YAML files at the root level.",Promise.reject(Error(c))}return Promise.resolve()}},{key:"parseZipFiles",value:function(){var a=this,b=[],c=[];return this.zip.forEach(function(a,d){d.dir||(b.push(a),c.push(d.async("arraybuffer")))}),Promise.all(c).then(function(c){for(var d=0;d<c.length;d++){var e=b[d],f=e.split("/").length-1;a.files[e]={data:c[d],type:r.extensionForURL(e),depth:f}}})}},{key:"urlForZipFile",value:function(a){return this.files[a]?(this.files[a].url||(this.files[a].url=r.createObjectURL(new Blob([this.files[a].data]))),this.files[a].url):void 0}},{key:"typeForZipFile",value:function(a){return this.files[a]&&this.files[a].type}}]),b}(w)},{"./utils/urls":268,"./utils/utils":269,"js-yaml":97,jszip:133}],228:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){return a&&a.__esModule?a:{default:a}}function f(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function g(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};c=c?c+b:"";for(var e in a){var f=c+e,h=a[e];d[f]=h,"object"!==("undefined"==typeof h?"undefined":i(h))||Array.isArray(h)||g(h,b,f,d)}return d}Object.defineProperty(c,"__esModule",{value:!0});var h,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},j=a("./utils/log"),k=e(j),l=a("./gl/glsl"),m=e(l),n=a("./utils/urls"),o=d(n),p=a("./utils/merge"),q=e(p),r=a("./utils/subscribe"),s=e(r),t=a("./scene_bundle");c.default=h={loadScene:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=c.path,e=c.type,f=[];return this.loadSceneRecursive({url:a,path:d,type:e},null,f).then(function(a){return b.finalize(a)}).then(function(a){var c=a.config,d=a.bundle;return c?(f.length>0&&f.forEach(function(a){var c="Failed to import scene: "+a.url;k.default("error",c,a),b.trigger("error",{type:"scene_import",message:c,error:a,url:a.url})}),{config:c,bundle:d}):Promise.reject(f[0])})},loadSceneRecursive:function(a,b){var c=a.url,d=a.path,e=a.type,g=this,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!c)return Promise.resolve({});var j=t.createSceneBundle(c,d,b,e);return j.load().then(function(a){if(null==a.import)return g.normalize(a,j);Array.isArray(a.import)||(a.import=[a.import]);var b=[];return a.import.forEach(function(a){"object"===("undefined"==typeof a?"undefined":i(a))&&(a=o.createObjectURL(new Blob([JSON.stringify(a)]))),b.push(j.resourceFor(a))}),delete a.import,Promise.all(b.map(function(a){return g.loadSceneRecursive(a,j,h)})).then(function(b){var c=b.map(function(a){return a.config});return a=q.default.apply(void 0,[{}].concat(f(c),[a])),g.normalize(a,j)})}).catch(function(a){return a.url=c,h.push(a),{}})},normalize:function(a,b){return this.normalizeDataSources(a,b),this.normalizeFonts(a,b),this.normalizeTextures(a,b),{config:a,bundle:b}},normalizeDataSources:function(a,b){a.sources=a.sources||{};for(var c in a.sources)this.normalizeDataSource(a.sources[c],b);return a},normalizeDataSource:function(a,b){return a.url=b.urlFor(a.url),Array.isArray(a.scripts)&&(a.scripts=a.scripts.map(function(a){return b.urlFor(a)})),a},normalizeFonts:function(a,b){a.fonts=a.fonts||{};for(var c in a.fonts)if(Array.isArray(a.fonts[c]))a.fonts[c].forEach(function(a){a.url=a.url&&b.urlFor(a.url)});else{var d=a.fonts[c];d.url=d.url&&b.urlFor(d.url)}return a},normalizeTextures:function(a,b){if(a.textures=a.textures||{},a.textures)for(var c in a.textures){var d=a.textures[c];d.url&&(d.url=b.urlFor(d.url))}if(a.styles){var e=function(c){var d=a.styles[c],e=d.texture;"string"!=typeof e||a.textures[e]||t.isGlobal(e)||(d.texture=b.urlFor(e)),d.material&&["emission","ambient","diffuse","specular","normal"].forEach(function(c){var e=null!=d.material[c]&&d.material[c].texture;"string"!=typeof e||a.textures[e]||t.isGlobal(e)||(d.material[c].texture=b.urlFor(e))}),d.shaders&&d.shaders.uniforms&&m.default.parseUniforms(d.shaders.uniforms).forEach(function(c){var d=c.type,e=c.value,f=c.key,g=c.uniforms;"sampler2D"!==d||"string"!=typeof e||a.textures[e]||t.isGlobal(e)||(g[f]=b.urlFor(e))})};for(var f in a.styles)e(f)}return a},applyGlobalProperties:function(a,b){function c(a,b){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(d.indexOf(a)>-1)return void k.default({level:"warn",once:!0},"Global properties: cyclical reference detected",d);d.push(a);var f="global."===a.slice(0,7)&&a.slice(7).replace(/\./g,e);return f&&void 0!==b[f]?"string"==typeof b[f]&&"global."===b[f].slice(0,7)?c(b[f],b,d):f:void 0}function d(a,e,g){if("string"==typeof a){var h=c(a,f),j=f[h];void 0!==j&&(b.push({prop:h,target:e,key:g}),a=j)}else if(Array.isArray(a))for(var k=0;k<a.length;k++)a[k]=d(a[k],a,k);else if("object"===("undefined"==typeof a?"undefined":i(a)))for(var l in a)a[l]=d(a[l],a,l);return a}if(!a.global||0===Object.keys(a.global).length)return a;var e=":",f=g(a.global,e);return b.forEach(function(a){var b=a.prop,c=a.target,d=a.key;c&&(c[d]=f[b])}),d(a)},hoistTextures:function(a){if(a.styles){var b=function(b){var c=a.styles[b],d=c.texture;if("string"==typeof d&&!a.textures[d]){var e=d,f=t.isGlobal(e)?"texture-"+e:e;a.textures[f]={url:e},c.texture=f}c.material&&["emission","ambient","diffuse","specular","normal"].forEach(function(b){var d=null!=c.material[b]&&c.material[b].texture;if("string"==typeof d&&!a.textures[d]){var e=d,f=t.isGlobal(e)?"texture-"+e:e;a.textures[f]={url:e},c.material[b].texture=f}}),c.shaders&&c.shaders.uniforms&&m.default.parseUniforms(c.shaders.uniforms).forEach(function(b){var c=b.type,d=b.value,e=b.key,f=b.uniforms;if("sampler2D"===c&&"string"==typeof d&&!a.textures[d]){var g=d,h=t.isGlobal(g)?"texture-"+g:g;a.textures[h]={url:g},f[e]=h}})};for(var c in a.styles)b(c)}},finalize:function(a){var b=a.config,c=a.bundle;return b?(b.scene=b.scene||{},b.cameras=b.cameras||{},b.lights=b.lights||{},b.styles=b.styles||{},b.layers=b.layers||{},b.camera&&(b.cameras.default=b.camera),0===Object.keys(b.cameras).length&&(b.cameras.default={}),(0===Object.keys(b.lights).length||Object.keys(b.lights).every(function(a){return b.lights[a].visible===!1}))&&(b.lights.default_light={type:"directional"}),{config:b,bundle:c}):{}}},s.default(h)},{"./gl/glsl":205,"./scene_bundle":227,"./utils/log":259,"./utils/merge":261,"./utils/subscribe":265,"./utils/urls":268}],229:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}Object.defineProperty(c,"__esModule",{value:!0}),c.SceneWorker=void 0;var f=a("./utils/thread"),g=d(f),h=a("./utils/utils"),i=d(h),j=a("./utils/debug_settings"),k=a("./utils/log"),l=d(k),m=a("./utils/worker_broker"),n=d(m),o=a("./tile"),p=d(o),q=a("./geo"),r=d(q),s=a("./sources/data_source"),t=d(s),u=a("./selection"),v=d(u),w=a("./styles/style_parser"),x=a("./styles/style_manager"),y=a("./styles/layer"),z=a("./styles/filter"),A=a("./gl/texture"),B=d(A),C=a("./gl/vertex_elements"),D=d(C);c.SceneWorker=self,g.default.is_worker&&(Object.assign(self,{FeatureSelection:v.default,sources:{},styles:{},layers:{},tiles:{},init:function(a,b,c,d,e,f){return self.scene_id=a,self._worker_id=b,self.num_workers=c,l.default.setLevel(d),i.default.device_pixel_ratio=e,D.default.setElementIndexUint(f),v.default.setPrefix(self._worker_id),self.style_manager=new x.StyleManager,b},updateConfig:function(a,b){var c=a.config,d=a.generation,e=a.introspection;c=JSON.parse(c),j.mergeDebugSettings(b),self.generation=d,self.introspection=e;for(var f in c.layers)c.layers[f]&&(c.layers[f].data=i.default.stringsToFunctions(c.layers[f].data));self.global=i.default.stringsToFunctions(c.global),self.createDataSources(c),c.styles=i.default.stringsToFunctions(c.styles,w.StyleParser.wrapFunction),self.styles=self.style_manager.build(c.styles),self.style_manager.initStyles({generation:self.generation,styles:self.styles,sources:self.sources,introspection:self.introspection}),self.layers=y.parseLayers(c.layers,self.style_manager.styles),self.syncing_textures=self.syncTextures(c.textures),self.configuring=self.syncing_textures.then(function(){l.default("debug","updated config")})},createDataSources:function(a){self.last_config_sources=self.config_sources||{},self.config_sources=a.sources;var b=self.sources,c=!1;a.sources=i.default.stringsToFunctions(a.sources),self.sources={};for(var d in a.sources)if(JSON.stringify(self.last_config_sources[d])!==JSON.stringify(a.sources[d])){var e=void 0;try{e=t.default.create(Object.assign({},a.sources[d],{name:d}),self.sources)}catch(a){continue}e&&(self.sources[d]=e,c=!0)}else self.sources[d]=b[d];c&&(self.tiles={})},awaitConfiguration:function(){return self.configuring},buildTile:function(a){var b=a.tile;if(null==self.getTile(b.key)||self.getTile(b.key).loading!==!0)return b=self.tiles[b.key]=Object.assign(self.getTile(b.key)||{},b),self.awaitConfiguration().then(function(){if(b.loaded!==!0)b.loading=!0,b.loaded=!1,b.error=null,self.loadTileSourceData(b).then(function(){return self.getTile(b.key)?(b.source_data.error&&(l.default("warn","tile load error(s) for "+b.key+": "+b.source_data.error),n.default.postMessage("TileManager_"+self.scene_id+".fetchTileError",b)),b.loading=!1,b.loaded=!0,void p.default.buildGeometry(b,self)):void l.default("trace","stop tile build after data source load because tile was removed: "+b.key)}).catch(function(a){b.loading=!1,b.loaded=!1,b.error=a.stack,l.default("error","tile load error for "+b.key+": "+b.error),n.default.postMessage("TileManager_"+self.scene_id+".buildTileError",p.default.slice(b))});else{l.default("trace","used worker cache for tile "+b.key);try{p.default.buildGeometry(b,self)}catch(a){b.error=a.toString(),n.default.postMessage("TileManager_"+self.scene_id+".buildTileError",p.default.slice(b))}}})},loadTileSourceData:function(a){return self.sources[a.source]?self.sources[a.source].load(a):(a.source_data={},Promise.resolve(a))},getTile:function(a){return self.tiles[a]},removeTile:function(a){var b=self.tiles[a];null!=b&&(b.loading===!0&&(l.default("trace","cancel tile load for "+a),b.loading=!1,p.default.cancel(b)),v.default.clearTile(a),delete self.tiles[a],l.default("trace","remove tile from cache for "+a))},queryFeatures:function(a){var b=a.filter,c=a.visible,d=a.geometry,e=a.tile_keys,f=[],g=e.map(function(a){return self.tiles[a]}).filter(function(a){return a});return null!=b&&(b=["{","["].indexOf(b[0])>-1?JSON.parse(b):b,b=i.default.stringsToFunctions(b,w.StyleParser.wrapFunction)),b=z.buildFilter(b,y.FilterOptions),g.forEach(function(a){var e=function(e){var g=a.source_data.layers[e];g.features.forEach(function(g){if(!(c===!0&&g.generation!==self.generation||c===!1&&g.generation===self.generation)){var h=w.StyleParser.getFeatureParseContext(g,a,self.global);if(h.source=a.source,h.layer=e,b(h)){var i={type:g.type,properties:g.properties};d===!0&&(i.geometry=r.default.copyGeometry(g.geometry),r.default.tileSpaceToLatlng(i.geometry,a.coords.z,a.min,a.max)),f.push(i)}}})};for(var g in a.source_data.layers)e(g)}),f},getFeatureSelection:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.id,c=a.key,d=v.default.map[c];return{id:b,feature:d&&d.feature}},resetFeatureSelection:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;v.default.reset(a)},getFeatureSelectionMapSize:function(){return v.default.getMapSize()},syncTextures:function(a){var b=[];return a&&b.push.apply(b,e(Object.keys(a))),l.default("trace","sync textures to worker:",b),b.length>0?B.default.syncTexturesToWorker(b):Promise.resolve()},updateDevicePixelRatio:function(a){i.default.device_pixel_ratio=a},profile:function(a){console.profile("worker "+self._worker_id+": "+a)},profileEnd:function(a){console.profileEnd("worker "+self._worker_id+": "+a)}}),n.default.addTarget("self",self))},{"./geo":201,"./gl/texture":208,"./gl/vertex_elements":212,"./selection":230,"./sources/data_source":231,"./styles/filter":236,"./styles/layer":237,"./styles/style_manager":244,"./styles/style_parser":245,"./tile":251,"./utils/debug_settings":255,"./utils/log":259,"./utils/thread":267,"./utils/utils":269,"./utils/worker_broker":271}],230:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./utils/log"),i=d(h),j=a("./gl/texture"),k=d(j),l=a("./utils/worker_broker"),m=d(l),n=function(){function a(b,c,d){f(this,a),this.gl=b,this.workers=c,this._lock_fn="function"==typeof d&&d,this.init()}return g(a,[{key:"init",value:function(){this.requests={},this.feature=null,this.read_delay=0,this.read_delay_timer=null,this.pixels=null,this.fbo=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.fbo_size={width:256,height:256};var a=k.default.create(this.gl,"selection_fbo",{filtering:"nearest"});a.setData(this.fbo_size.width,this.fbo_size.height,null,{filtering:"nearest"}),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,a.texture,0);var b=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,b),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.fbo_size.width,this.fbo_size.height),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,b),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}},{key:"destroy",value:function(){this.gl&&this.fbo&&(this.gl.deleteFramebuffer(this.fbo),this.fbo=null,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null))}},{key:"bind",value:function(){var b;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.gl.viewport(0,0,this.fbo_size.width,this.fbo_size.height),(b=this.gl).clearColor.apply(b,e(a.defaultColor))}},{key:"getFeatureAt",value:function(a,b){var c=this,d=b.radius;return!a||a.x<0||a.y<0||a.x>1||a.y>1?Promise.resolve({feature:null,changed:!1}):new Promise(function(b,e){c.selection_request_id=c.selection_request_id+1||0,c.requests[c.selection_request_id]={id:c.selection_request_id,point:a,radius:d,resolve:b,reject:e}})}},{key:"pendingRequests",value:function(){return Object.keys(this.requests).length?this.requests:null}},{key:"hasPendingRequests",value:function(){return null!=this.pendingRequests()}},{key:"clearPendingRequests",value:function(){for(var a in this.requests){var b=this.requests[a];b.sent||(b.reject({request:b}),delete this.requests[a])}}},{key:"read",value:function(){var a=this;null!=this.read_delay_timer&&clearTimeout(this.read_delay_timer),this.read_delay_timer=setTimeout(function(){if(!a.locked){var b=a.gl;b.bindFramebuffer(b.FRAMEBUFFER,a.fbo);for(var c in a.requests){var d=a.requests[c];if(!d.sent){var e=void 0,f=255,g=d.point,h=d.radius,i=void 0;if(h){var j=Math.min(a.fbo_size.width,a.fbo_size.height);i={x:Math.min(Math.ceil(2*h.x*a.fbo_size.width),j),y:Math.min(Math.ceil(2*h.y*a.fbo_size.height),j)}}else h={x:0,y:0},i={x:1,y:1};if((null==a.pixels||a.pixels.byteLength<i.x*i.y*4)&&(a.pixels=new Uint8Array(i.x*i.y*4)),a.pixels.fill instanceof Function)a.pixels.fill(0);else for(var k=0;k<a.pixels.length;k++)a.pixels[k]=0;b.readPixels(Math.round((g.x-h.x)*a.fbo_size.width),Math.round((1-g.y-h.y)*a.fbo_size.height),i.x,i.y,b.RGBA,b.UNSIGNED_BYTE,a.pixels);var l=4*(Math.round(i.y/2)*i.x+Math.round(i.x/2)),n=a.pixels[l]+(a.pixels[l+1]<<8)+(a.pixels[l+2]<<16);if(n>0)e=n+(a.pixels[l+3]<<24)>>>0,f=a.pixels[l+3];else{var o=-1>>>0;l=0;for(var p=0;p<i.y;p++)for(var q=0;q<i.x;q++,l+=4)if(n=a.pixels[l]+(a.pixels[l+1]<<8)+(a.pixels[l+2]<<16),n>0){var r=(q-i.x/2)*(q-i.x/2)+(p-i.y/2)*(p-i.y/2);o>=r&&(e=n+(a.pixels[l+3]<<24)>>>0,f=a.pixels[l+3],o=r)}}255!==f?null!=a.workers[f]&&m.default.postMessage(a.workers[f],"self.getFeatureSelection",{id:d.id,key:e}).then(function(b){a.finishRead(b)}):a.finishRead({id:d.id}),d.sent=!0}}b.bindFramebuffer(b.FRAMEBUFFER,null)}},this.read_delay)}},{key:"finishRead",value:function(a){var b=this.requests[a.id];if(!b)return void i.default("error","FeatureSelection.finishRead(): could not find message",a);var c=a.feature,d=!1;(null!=c&&null==this.feature||null==c&&null!=this.feature||null!=c&&null!=this.feature&&JSON.stringify(c)!==JSON.stringify(this.feature))&&(d=!0),this.feature=c,b.resolve({feature:c,changed:d,request:b}),delete this.requests[a.id]}},{key:"locked",get:function(){return this._lock_fn&&this._lock_fn()||!1}}],[{key:"makeEntry",value:function(a){this.map_entry++;var b=255&this.map_entry,c=this.map_entry>>8&255,d=this.map_entry>>16&255,e=this.map_prefix,f=b/255,g=c/255,h=d/255,i=e/255,j=b+(c<<8)+(d<<16)+(e<<24)>>>0;return this.map[j]={color:[f,g,h,i]},this.map_size++,this.tiles[a.key]||(this.tiles[a.key]={entries:[],tile:{key:a.key,coords:a.coords,style_zoom:a.style_zoom,source:a.source,generation:a.generation}}),this.tiles[a.key].entries.push(j),this.map[j]}},{key:"makeColor",value:function(a,b,c){var d=this.makeEntry(b);return d.feature={id:a.id,properties:a.properties,source_name:c.source,source_layer:c.layer,layers:c.layers,tile:this.tiles[b.key].tile},d.color}},{key:"reset",value:function(a){var b=this;Array.isArray(a)?a.forEach(function(a){return b.clearSource(a)}):(this.tiles={},this.map={},this.map_size=0,this.map_entry=0)}},{key:"clearSource",value:function(a){for(var b in this.tiles)this.tiles[b].tile.source===a&&this.clearTile(b)}},{key:"clearTile",value:function(a){var b=this;this.tiles[a]&&(this.tiles[a].entries.forEach(function(a){return delete b.map[a]}),this.map_size-=this.tiles[a].entries.length,delete this.tiles[a])}},{key:"getMapSize",value:function(){return this.map_size}},{key:"setPrefix",value:function(a){this.map_prefix=a}}]),a}();c.default=n,n.map={},n.tiles={},n.map_size=0,n.map_entry=0,n.map_prefix=0,n.defaultColor=[0,0,0,1]},{"./gl/texture":208,"./utils/log":259,"./utils/worker_broker":271}],231:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function i(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0}),c.NetworkTileSource=c.NetworkSource=void 0;var j=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d);
},k=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m=a("../geo"),n=e(m),o=a("../utils/errors"),p=a("../utils/utils"),q=e(p),r=a("../utils/urls"),s=d(r),t=a("../utils/log"),u=e(t),v=a("../utils/worker_broker"),w=e(v),x=function(){function a(b,c){var d=this;i(this,a),this.config=b,this.sources=c,this.id=b.id,this.name=b.name,this.pad_scale=b.pad_scale||1e-4,this.default_winding=null,this.rasters=[],Array.isArray(b.rasters)&&b.rasters.forEach(function(a){-1===d.rasters.indexOf(a)&&d.rasters.push(a)}),this.transform=b.transform,"function"==typeof this.transform&&this.transform.bind(this),this.extra_data=b.extra_data,this.scripts=b.scripts,this.max_zoom=null!=b.max_zoom?b.max_zoom:n.default.default_source_max_zoom,this.setTileSize(b.tile_size),this.max_coord_zoom=this.max_zoom+this.zoom_bias,this.min_display_zoom=null!=b.min_display_zoom?b.min_display_zoom:0,this.max_display_zoom=null!=b.max_display_zoom?b.max_display_zoom:null}return l(a,[{key:"load",value:function(a){var b=this;return a.source_data={},a.source_data.layers={},a.pad_scale=this.pad_scale,a.rasters=[].concat(h(this.rasters)),this._load(a).then(function(a){for(var c in a.source_data.layers){var d=a.source_data.layers[c];d&&d.features&&d.features.forEach(function(a){n.default.transformGeometry(a.geometry,function(a){a[1]=-a[1],b.pad_scale&&(a[0]=Math.round(a[0]*(1+b.pad_scale)-n.default.tile_scale*b.pad_scale/2),a[1]=Math.round(a[1]*(1+b.pad_scale)-n.default.tile_scale*b.pad_scale/2))}),b.updateDefaultWinding(a.geometry)})}return a.default_winding=b.default_winding||"CCW",a})}},{key:"_load",value:function(){throw new o.MethodNotImplemented("_load")}},{key:"setTileSize",value:function(a){this.tile_size=a||256,("number"!=typeof this.tile_size||this.tile_size<256||!q.default.isPowerOf2(this.tile_size))&&(u.default({level:"warn",once:!0},"Data source '"+this.name+"': 'tile_size' parameter must be a number that is a power of 2 greater than or equal to 256, but was '"+a+"'"),this.tile_size=256),this.zoom_bias=Math.log2(this.tile_size)-8}},{key:"updateDefaultWinding",value:function(a){return null==this.default_winding&&("Polygon"===a.type?this.default_winding=n.default.ringWinding(a.coordinates[0]):"MultiPolygon"===a.type&&(this.default_winding=n.default.ringWinding(a.coordinates[0][0]))),this.default_winding}},{key:"includesTile",value:function(a,b){if(a.z<this.min_display_zoom||null!=this.max_display_zoom&&b>this.max_display_zoom)return!1;for(var c=0;c<this.rasters.length;c++){var d=this.rasters[c];if(this.sources[d]&&this.sources[d]!==this&&!this.sources[d].includesTile(a,a.z))return!1}return!0}}],[{key:"create",value:function(b,c){return a.types[b.type]?new a.types[b.type](b,c):void 0}},{key:"changed",value:function(a,b){if(!a||!b)return!0;var c=Object.assign({},a.config,{id:null}),d=Object.assign({},b.config,{id:null});return JSON.stringify(c)!==JSON.stringify(d)}},{key:"projectData",value:function(a){var b=+new Date;for(var c in a.layers)for(var d=a.layers[c].features.length,e=0;d>e;e++){var f=a.layers[c].features[e];n.default.transformGeometry(f.geometry,function(a){var b=n.default.latLngToMeters(a),c=k(b,2),d=c[0],e=c[1];a[0]=d,a[1]=e})}void 0!==a.debug&&(a.debug.projection=+new Date-b)}},{key:"scaleData",value:function(a,b){var c=b.coords.z,d=b.min,e=(b.max,n.default.unitsPerMeter(c));for(var f in a.layers)for(var g=a.layers[f].features.length,h=0;g>h;h++){var i=a.layers[f].features[h];n.default.transformGeometry(i.geometry,function(a){a[0]=(a[0]-d.x)*e,a[1]=(a[1]-d.y)*e*-1})}}},{key:"register",value:function(b,c){b&&c&&(a.types[c]=b)}}]),a}();c.default=x,x.types={},w.default.addTarget("DataSource",x);var y=0,z=c.NetworkSource=function(a){function b(a,c){i(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));d.response_type="";var e=s.addParamsToURL(a.url,a.url_params),g=k(e,2),h=g[0],j=g[1];if(d.url=h,j.forEach(function(b){var c=k(b,2),e=c[0],f=c[1];u.default({level:"warn",once:!0},"Data source '"+d.name+"': parameter '"+e+"' already present in URL '"+a.url+"', "+("skipping value '"+e+"="+f+"' specified in 'url_params'"))}),"string"!=typeof d.url)throw Error("Network data source must provide a string `url` property");return d}return g(b,a),l(b,[{key:"_load",value:function(a){var b=this,c=this.formatUrl(this.url,a),d=a.source_data;return d.url=c,a.debug=a.debug||{},a.debug.network=+new Date,new Promise(function(e){d.error=null;var f=y++ +"-"+c,g=q.default.io(c,6e4,b.response_type,"GET",{},f);d.request_id=f;var h=function(c){c&&(c.length||c.byteLength)&&(a.debug.response_size=c.length||c.byteLength,a.debug.network=+new Date-a.debug.network,a.debug.parsing=+new Date,b.parseSourceData(a,d,c),a.debug.parsing=+new Date-a.debug.parsing),e(a)};g.then(function(a){h(a)}).catch(function(b){d.error=b.stack;try{h(b.body)}catch(b){e(a)}})})}},{key:"formatUrl",value:function(){throw new o.MethodNotImplemented("formatUrl")}},{key:"parseSourceData",value:function(){throw new o.MethodNotImplemented("parseSourceData")}}]),b}(x);c.NetworkTileSource=function(a){function b(a,c){i(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.tiled=!0,d.parseBounds(a),d.builds_geometry_tiles=!1,d.tms=a.tms===!0,d.url.search("{s}")>-1&&(Array.isArray(a.url_subdomains)&&a.url_subdomains.length>0?(d.url_subdomains=a.url_subdomains,d.next_url_subdomain=0):u.default({level:"warn",once:!0},"Data source '"+d.name+"': source URL includes '{s}' subdomain marker ('"+d.url+"'), but no subdomains were specified in 'url_subdomains' parameter")),d}return g(b,a),l(b,[{key:"parseBounds",value:function(a){if(Array.isArray(a.bounds)&&4===a.bounds.length){this.bounds=a.bounds;var b=k(this.bounds,4),c=b[0],d=b[1],e=b[2],f=b[3];this.bounds_meters={min:n.default.latLngToMeters([c,f]),max:n.default.latLngToMeters([e,d])},this.bounds_tiles={min:{},max:{}}}}},{key:"checkBounds",value:function(a){if(this.bounds){a=n.default.wrapTile(a,{x:!0});var b=this.bounds_tiles.min[a.z];b||(b=this.bounds_tiles.min[a.z]=n.default.tileForMeters(this.bounds_meters.min,a.z));var c=this.bounds_tiles.max[a.z];if(c||(c=this.bounds_tiles.max[a.z]=n.default.tileForMeters(this.bounds_meters.max,a.z)),a.x<b.x||a.x>c.x||a.y<b.y||a.y>c.y)return!1}return!0}},{key:"includesTile",value:function(a,c){return!(!j(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"includesTile",this).call(this,a,c)||!this.checkBounds(a))}},{key:"formatUrl",value:function(a,b){var c=n.default.wrapTile(b.coords,{x:!0});this.tms&&(c.y=Math.pow(2,c.z)-1-c.y);var d=a.replace("{x}",c.x).replace("{y}",c.y).replace("{z}",c.z);return null!=this.url_subdomains&&(d=d.replace("{s}",this.url_subdomains[this.next_url_subdomain]),this.next_url_subdomain=(this.next_url_subdomain+1)%this.url_subdomains.length),d}},{key:"urlHasTilePattern",value:function(a){return a&&a.search("{x}")>-1&&a.search("{y}")>-1&&a.search("{z}")>-1}}]),b}(z)},{"../geo":201,"../utils/errors":256,"../utils/log":259,"../utils/urls":268,"../utils/utils":269,"../utils/worker_broker":271}],232:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a,b,c){var d=q.default.centroid(a);if(d){var e={};return Object.assign(e,b,c),{type:"Feature",properties:e,geometry:{type:"Point",coordinates:d}}}}Object.defineProperty(c,"__esModule",{value:!0}),c.GeoJSONTileSource=c.GeoJSONSource=void 0;var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},k=a("../utils/log"),l=d(k),m=a("./data_source"),n=d(m),o=a("./mvt"),p=a("../geo"),q=d(p),r=a("geojson-vt"),s=d(r),t=c.GeoJSONSource=function(a){function b(a,c){e(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.load_data=null,d.tile_indexes={},d.max_zoom=Math.max(d.max_zoom||0,15),d.setTileSize(512),d.pad_scale=0,d}return g(b,a),i(b,[{key:"_load",value:function(a){var c=this;return this.load_data||(this.load_data=j(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"_load",this).call(this,{source_data:{layers:{}}}).then(function(a){a.source_data.error&&l.default("warn","data source load error(s) for source '"+c.name+"', URL '"+c.url+"': "+a.source_data.error);var b=a.source_data.layers;for(var d in b)c.tile_indexes[d]=s.default(b[d],{maxZoom:c.max_zoom,tolerance:1.5,extent:q.default.tile_scale,buffer:1e-4});return c.loaded=!0,a})),this.load_data.then(function(){for(var b in c.tile_indexes)a.source_data.layers[b]=c.getTileFeatures(a,b);return a})}},{key:"getTileFeatures",value:function(a,b){var c=q.default.wrapTile(a.coords,{x:!0}),d=this.tile_indexes[b].getTile(c.z,c.x,c.y),e=void 0;if(d&&d.features){e={type:"FeatureCollection",features:[]};for(var f=0;f<d.features.length;f++){var g=d.features[f],h={type:"Feature",geometry:{},properties:g.tags};if(1===g.type)h.geometry.coordinates=g.geometry.map(function(a){return[a[0],a[1]]}),h.geometry.type="MultiPoint";else{if(2!==g.type&&3!==g.type)continue;if(h.geometry.coordinates=g.geometry.map(function(a){return a.map(function(a){return[a[0],a[1]]})}),2===g.type)h.geometry.type="MultiLineString";else if(h.geometry=o.decodeMultiPolygon(h.geometry),null==h.geometry)continue}e.features.push(h)}}return e}},{key:"formatUrl",value:function(){return this.url}},{key:"parseSourceData",value:function(a,b,c){var d=JSON.parse(c),e=this.getLayers(d);b.layers=this.preprocessLayers(e)}},{key:"preprocessLayers",value:function(a){for(var b in a){var c=a[b];this.preprocessFeatures(c.features)}return"function"==typeof this.transform&&(1===Object.keys(a).length&&a._default?a._default=this.transform(a._default,this.extra_data):a=this.transform(a,this.extra_data)),a}},{key:"preprocessFeatures",value:function(a){if(this.config.generate_label_centroids){var b=[],c={label_placement:!0};a.forEach(function(a){if(null!=a.geometry){var d=void 0,e=void 0;switch(a.geometry.type){case"Polygon":d=a.geometry.coordinates,e=h(d,a.properties,c),b.push(e);break;case"MultiPolygon":d=a.geometry.coordinates;for(var f=-1/0,g=0,i=0;i<d.length;i++){var j=q.default.polygonArea(d[i]);j>f&&(f=j,g=i)}e=h(d[g],a.properties,c),b.push(e)}}}),b=b.filter(function(a){return a}),Array.prototype.push.apply(a,b)}return a}},{key:"getLayers",value:function(a){return"Feature"===a.type?{_default:{type:"FeatureCollection",features:[a]}}:"FeatureCollection"===a.type?{_default:a}:a}}]),b}(m.NetworkSource),u=c.GeoJSONTileSource=function(a){function b(a,c){var d;e(this,b);var g=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));if(!g.urlHasTilePattern(g.url)){if("GeoJSON"===a.type){var h;return h=new t(a),f(g,h)}var i;return i=null,f(g,i)}return d=g,f(g,d)}return g(b,a),i(b,[{key:"parseSourceData",value:function(a,b,c){var d=JSON.parse(c);this.prepareGeoJSON(d,a,b)}},{key:"prepareGeoJSON",value:function(a,b,c){"function"==typeof this.transform&&(a=this.transform(a,this.extra_data)),c.layers=t.prototype.getLayers(a);var d={coords:b.coords,min:q.default.metersForTile(q.default.wrapTile(b.coords,{x:!0}))};n.default.projectData(c),n.default.scaleData(c,d)}}]),b}(m.NetworkTileSource);n.default.register(u,"GeoJSON")},{"../geo":201,"../utils/log":259,"./data_source":231,"./mvt":233,"geojson-vt":78}],233:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(a){for(var b=[],c=[],d=void 0,e=0;e<a.coordinates.length;e++){var f=a.coordinates[e],g=m.default.ringWinding(f);null!=g&&(d=d||g,g===d&&c.length>0&&(b.push(c),c=[]),c.push(f))}return c.length>0&&b.push(c),1===b.length?(a.type="Polygon",a.coordinates=b[0]):b.length>1?(a.type="MultiPolygon",a.coordinates=b):a=null,a}Object.defineProperty(c,"__esModule",{value:!0}),c.MVTSource=void 0;var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();c.decodeMultiPolygon=h;var j=a("./data_source"),k=d(j),l=a("../geo"),m=d(l),n=a("pbf"),o=d(n),p=a("vector-tile"),q=c.MVTSource=function(a){function b(a,c){e(this,b);var d=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.response_type="arraybuffer",d}return g(b,a),i(b,[{key:"parseSourceData",value:function(a,b,c){var d=new Uint8Array(c),e=new o.default(d);b.data=new p.VectorTile(e),b.layers=this.toGeoJSON(b.data),"function"==typeof this.transform&&(b.layers=this.transform(b.layers,this.extra_data)),delete b.data}},{key:"toGeoJSON",value:function(a){var b={};for(var c in a.layers){for(var d=a.layers[c],e=m.default.tile_scale/d.extent,f={type:"FeatureCollection",features:[]},g=0;g<d.length;g++){for(var i=d.feature(g),j={type:"Feature",geometry:{},properties:i.properties},k=j.geometry,l=i.loadGeometry(),n=0;n<l.length;n++)for(var o=l[n],q=0;q<o.length;q++)o[q]=[o[q].x*e,o[q].y*e];k.coordinates=l,"Point"===p.VectorTileFeature.types[i.type]?(k.type="Point",k.coordinates=k.coordinates[0][0]):"LineString"===p.VectorTileFeature.types[i.type]?1===l.length?(k.type="LineString",k.coordinates=k.coordinates[0]):k.type="MultiLineString":"Polygon"===p.VectorTileFeature.types[i.type]&&(k=h(k)),f.features.push(j)}b[c]=f}return b}}]),b}(j.NetworkTileSource);k.default.register(q,"MVT")},{"../geo":201,"./data_source":231,pbf:182,"vector-tile":192}],234:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0}),c.RasterTileSource=void 0;var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=a("./data_source"),k=d(j),l=a("../tile"),m=d(l),n=a("../geo"),o=d(n),p=c.RasterTileSource=function(a){function b(a,c){f(this,b);var d=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return-1===d.rasters.indexOf(d.name)&&d.rasters.unshift(d.name),d.filtering=a.filtering,d.textures={},d}return h(b,a),i(b,[{key:"load",value:function(a){a.source_data={},a.source_data.layers={},a.pad_scale=this.pad_scale,a.rasters=[].concat(e(this.rasters));var b=o.default.tile_scale;return a.source_data.layers={_default:{type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[[0,0],[b,0],[b,-b],[0,-b],[0,0]]]},properties:{}}]}},a.default_winding="CW",Promise.resolve(a)}},{key:"tileTexture",value:function(a){var b=a.coords.key;if(!this.textures[b]){var c=m.default.coordinateWithMaxZoom(a.coords,this.max_zoom),d=this.formatUrl(this.url,{coords:c});this.textures[b]={url:d,filtering:this.filtering,coords:c}}return this.textures[b]}}]),b}(j.NetworkTileSource);k.default.register(p,"Raster")},{"../geo":201,"../tile":251,"./data_source":231}],235:[function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function i(a,b){var c=p.feature(a,b);return"Feature"===c.type&&(c={type:"FeatureCollection",features:[c]}),c}Object.defineProperty(c,"__esModule",{value:!0}),c.TopoJSONTileSource=c.TopoJSONSource=void 0;var j=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;return void 0===g?void 0:g.call(d)},l=a("./data_source"),m=e(l),n=a("./geojson"),o=a("topojson-client"),p=d(o),q=c.TopoJSONSource=function(a){function b(){return f(this,b),g(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return h(b,a),j(b,[{key:"parseSourceData",value:function(a,c,d){var e=JSON.parse(d);e=this.toGeoJSON(e);var f=this.getLayers(e);k(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"preprocessLayers",this).call(this,f),c.layers=f}},{key:"toGeoJSON",value:function(a){if(a.objects&&1===Object.keys(a.objects).length){var b=Object.keys(a.objects)[0];a=i(a,a.objects[b])}else{var c={};for(var d in a.objects)c[d]=i(a,a.objects[d]);a=c}return a}}]),b}(n.GeoJSONSource),r=c.TopoJSONTileSource=function(a){function b(a,c){f(this,b);var d=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));if(!d.urlHasTilePattern(d.url)){var e;return e=new q(a),g(d,e)}return d}return h(b,a),j(b,[{key:"parseSourceData",value:function(a,b,c){var d=JSON.parse(c);d=q.prototype.toGeoJSON(d),this.prepareGeoJSON(d,a,b)}}]),b}(n.GeoJSONTileSource);m.default.register(r,"TopoJSON")},{"./data_source":231,"./geojson":232,"topojson-client":187}],236:[function(a,b,c){"use strict";function d(a){return null!=a}function e(a){return"("+a+")"}function f(a){return"string"==typeof a?'"'+a+'"':a}function g(a){return"$"===a[0]?"context['"+a.substring(1)+"']":"context.feature.properties['"+a+"']"}function h(){return" true "}function i(a,b){return e(f(b)+" === "+g(a))}function j(a,b){return e(b.map(function(b){return i(a,b)}).join(" || "))}function k(a,b){return e(a.filter(d).map(function(a){return e(a.join(" && "))}).join(" "+b+" "))}function l(a,b,c){return b&&b.length>0?k(b.map(function(a){return r(a,c)}),"||"):"true"}function m(a,b,c){return b&&b.length>0?k(b.map(function(a){return r(a,c)}),"&&"):"true"}function n(a,b,c){return"!"+e(r(b,c).join(" && "))}function o(a,b,c){return"!"+e(l(null,b,c))}function p(a,b){return e(g(a)+(b?" != ":" == ")+"null")}function q(a,b,c){var d=[],f=c&&"function"==typeof c.rangeTransform&&c.rangeTransform;if(b.max){var h=f?f(b.max):b.max;d.push(""+g(a)+" < "+h)}if(b.min){var i=f?i=f(b.min):b.min;d.push(""+g(a)+" >= "+i)}return e(d.join(" && "))}function r(a,b){var c=[];if("function"==typeof a)return[e(a.toString()+"(context)")];if(Array.isArray(a))return[l(null,a,b)];if(null==a)return["true"];for(var d=Object.keys(a),f=0;f<d.length;f++){var g=d[f],k=a[g],r="undefined"==typeof k?"undefined":u(k);if("string"===r||"number"===r)c.push(i(g,k));else if("boolean"===r)c.push(p(g,k));else if("not"===g)c.push(n(g,k,b));else if("any"===g)c.push(l(g,k,b));else if("all"===g)c.push(m(g,k,b));else if("none"===g)c.push(o(g,k,b));else if(Array.isArray(k))c.push(j(g,k));else if("object"===r&&null!=k)(k.max||k.min)&&c.push(q(g,k,b));else{if(null!=k)throw new Error("Unknown Query syntax: "+k);c.push(h(g,k))}}return 0===d.length?["true"]:c}function s(a){return e(a.join(" && "))}function t(a,b){return null==a?function(){return!0}:new Function("context","return "+s(r(a,b))+";")}Object.defineProperty(c,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};c.buildFilter=t},{}],237:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function i(){return F}function j(a){if(a.length>1){for(var b=a[0],c=1;c<a.length;c++)b+="/"+a[c];return b}return a[0]}function k(a,b){for(var c=void 0,d=0,e=0;e<a.length;e++)a[e].length>d&&(d=a[e].length);if(0===d)return null;for(var f={visible:!0},g=function(d){return c=a.map(function(a){return a[d]&&a[d][b]}),0===c.length?"continue":(c.sort(function(a,b){return(a&&a.layer_name)>(b&&b.layer_name)?1:-1}),C.default.apply(void 0,[f].concat(h(c))),void delete f.layer_name)},i=0;d>i;i++)g(i);return f.visible===!1?null:f}function l(a){return E.indexOf(a)>-1}function m(a){return 0===Object.keys(a).length}function n(a){var b={},c={};for(var d in a)l(d)?b[d]=a[d]:c[d]=a[d];return[b,c]}function o(a){var b=[];if(a.parent){var c=a.parent.calculatedDraw||[];b.push.apply(b,h(c))}return b.push(a.draw),b}function p(a,b,c,d){b=null==b?{}:b;var e={name:a,layer:b,parent:c,styles:d},f=n(b),g=t(f,2),h=g[0],i=g[1],j=m(i),k=void 0;k=j&&null!=c?I:J;var l=new k(Object.assign(e,h));return l.enabled&&(c&&c.addLayer(l),l.children_to_parse=j?null:i),l}function q(a,b,c){for(var d in b){var e=b[d];if("object"!==("undefined"==typeof e?"undefined":u(e))||Array.isArray(e)){var f="Layer value must be an object: cannot create layer '"+d+": "+JSON.stringify(e)+"'";f+=", under parent layer '"+a.full_name+"'.",c[a.name]&&(f+=" The parent name '"+a.name+"' is also the name of a style, did you mean to create a 'draw' group",a.parent&&(f+=" under '"+a.parent.name+"'"),f+=" instead?"),A.default("warn",f)}else p(d,e,a,c)}}function r(a,b){F={};var c={};for(var d in a){var e=a[d];e&&(c[d]=p(d,e,null,b))}return c}function s(a,b,c,d){var e=!1,f=!1;if(0!==b.length){for(var g=0;g<b.length;g++){var h=b[g];h.is_leaf?h.doesMatch(a)&&(e=!0,c.push(h),d.push(h.id)):h.is_tree&&h.doesMatch(a)&&(e=!0,f=s(a,h.layers,c,d),f||(c.push(h),d.push(h.id)))}return e}}Object.defineProperty(c,"__esModule",{value:!0}),c.FilterOptions=c.LayerTree=c.LayerLeaf=c.reserved=void 0;var t=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();c.layerCache=i,c.mergeTrees=k,c.groupProps=n,c.calculateDraw=o,c.parseLayerNode=p,c.parseLayers=r,c.matchFeature=s;var w=a("./style_parser"),x=a("../utils/utils"),y=d(x),z=a("../utils/log"),A=d(z),B=a("../utils/merge"),C=d(B),D=a("./filter"),E=c.reserved=["filter","draw","visible","enabled","data"],F={},G=["any","all","not","none"],H=function(){function a(b){var c=b.layer,d=b.name,e=b.parent,f=b.draw,h=b.visible,i=b.enabled,j=b.filter,k=b.styles;if(g(this,a),this.id=a.id++,this.config_data=c.data,this.parent=e,this.name=d,this.full_name=this.parent?this.parent.full_name+":"+this.name:this.name,this.draw=f,this.filter=j,this.styles=k,this.is_built=!1,i=void 0===i?h:i,this.enabled=(!this.parent||this.parent.visible!==!1)&&i!==!1,this.draw)for(var l in this.draw)if(this.draw[l]=null==this.draw[l]?{}:this.draw[l],"object"!==u(this.draw[l])){var m="Draw group '"+l+"' for layer "+this.full_name+" is invalid, must be an object, ";m+="but was set to `"+l+": "+this.draw[l]+"` instead",A.default("warn",m),delete this.draw[l]}else this.draw[l].layer_name=this.full_name}return v(a,[{key:"build",value:function(){A.default("trace","Building layer '"+this.full_name+"'"),this.buildFilter(),this.buildDraw(),this.is_built=!0}},{key:"buildDraw",value:function(){this.draw=y.default.stringsToFunctions(this.draw,w.StyleParser.wrapFunction),this.calculatedDraw=o(this)}},{key:"buildFilter",value:function(){this.filter_original=this.filter,this.filter=y.default.stringsToFunctions(this.filter,w.StyleParser.wrapFunction);var a=u(this.filter);if(null!=this.filter&&"object"!==a&&"function"!==a){var b="Filter for layer "+this.full_name+" is invalid, filter value must be an object or function, ";return b+="but was set to `filter: "+this.filter+"` instead",void A.default("warn",b)}try{this.buildZooms(),this.buildPropMatches(),this.filter=null!=this.filter&&("function"==typeof this.filter||Object.keys(this.filter).length>0)?D.buildFilter(this.filter,K):null}catch(a){var c="Filter for layer "+this.full_name+" is invalid, `filter: "+JSON.stringify(this.filter)+"` ";c+="failed with error '"+a.message+"', stack trace: "+a.stack,A.default("warn",c)}}},{key:"buildZooms",value:function(){var a=this.filter&&this.filter.$zoom,b="undefined"==typeof a?"undefined":u(a);if(null!=a&&"function"!==b){if(this.zooms={},"number"===b)this.zooms[a]=!0;else if(Array.isArray(a))for(var c=0;c<a.length;c++)this.zooms[a[c]]=!0;else if("object"===b&&(null!=a.min||null!=a.max))for(var d=a.min||0,e=a.max||25,f=d;e>f;f++)this.zooms[f]=!0;delete this.filter.$zoom}}},{key:"buildPropMatches",value:function(){var a=this;this.filter&&!Array.isArray(this.filter)&&"function"!=typeof this.filter&&Object.keys(this.filter).forEach(function(b){if(-1===G.indexOf(b)){var c=a.filter[b],d="undefined"==typeof c?"undefined":u(c),e=Array.isArray(c);if(!e&&"string"!==d&&"number"!==d)return;"$"===b[0]?(a.context_prop_matches=a.context_prop_matches||[],a.context_prop_matches.push([b.substring(1),e?c:[c]])):(a.feature_prop_matches=a.feature_prop_matches||[],a.feature_prop_matches.push([b,e?c:[c]])),delete a.filter[b]}})}},{key:"doPropMatches",value:function(a){if(this.feature_prop_matches)for(var b=0;b<this.feature_prop_matches.length;b++){var c=this.feature_prop_matches[b],d=a.feature.properties[c[0]];if(null==d||-1===c[1].indexOf(d))return!1}if(this.context_prop_matches)for(var e=0;e<this.context_prop_matches.length;e++){var f=this.context_prop_matches[e],g=a[f[0]];if(null==g||-1===f[1].indexOf(g))return!1}return!0}},{key:"doesMatch",value:function(a){if(!this.enabled)return!1;if(this.is_built||this.build(),null!=this.zooms&&!this.zooms[a.zoom])return!1;if(!this.doPropMatches(a))return!1;var b=void 0;if(this.filter instanceof Function)try{b=this.filter(a)}catch(b){var c="Filter for this "+this.full_name+": `filter: "+this.filter_original+"` ";c+="failed with error '"+b.message+"', stack trace: "+b.stack,A.default("error",c,a.feature)}else b=null==this.filter;return!!b&&(this.children_to_parse&&(q(this,this.children_to_parse,this.styles),delete this.children_to_parse),!0)}}]),a}();H.id=0;var I=c.LayerLeaf=function(a){function b(a){g(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.is_leaf=!0,c}return f(b,a),b}(H),J=c.LayerTree=function(a){function b(a){g(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.is_tree=!0,c.layers=a.layers||[],c}return f(b,a),v(b,[{key:"addLayer",value:function(a){this.layers.push(a)}},{key:"buildDrawGroups",value:function(a){var b=[],c=[];if(s(a,[this],b,c),b.length>0){var d=j(c);if(void 0===F[d]){for(var e=b.map(function(a){return a&&a.visible!==!1&&a.calculatedDraw}),f={},g=0;g<e.length;g++){var h=e[g];if(h)for(var i=0;i<h.length;i++){var l=h[i];for(var m in l)f[m]=!0}}for(var n in f)F[d]=F[d]||{},F[d][n]=k(e,n),F[d][n]?(F[d][n].key=d+"/"+n,F[d][n].layers=b.map(function(a){return a&&a.full_name}),F[d][n].group=n):delete F[d][n];F[d]&&0===Object.keys(F[d]).length&&(F[d]=null)}return F[d]}}}]),b}(H),K=c.FilterOptions={rangeTransform:function(a){return"string"==typeof a&&"px2"===a.trim().slice(-3)?parseFloat(a)+" * context.meters_per_pixel_sq":a}}},{"../utils/log":259,"../utils/merge":261,"../utils/utils":269,"./filter":236,"./style_parser":245}],238:[function(a,b,c){"use strict";function d(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=b.dash_color||e,d=b.background_color||f,g=a,h=b.scale||1;g.length%2===1&&Array.prototype.push.apply(g,g);for(var i=!0,j=[],k=0;k<g.length;k++){for(var l=Math.floor(g[k]*h),m=0;l>m;m++)Array.prototype.push.apply(j,i?c:d);i=!i}j=new Uint8Array(j);var n=j.length/4;return{pixels:j,length:n}}Object.defineProperty(c,"__esModule",{value:!0}),c.default=d;var e=[255,255,255,255],f=[0,0,0,0]},{}],239:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.Lines=void 0;var e=a("../style"),f=a("../style_parser"),g=a("../../gl/constants"),h=d(g),i=a("../../gl/texture"),j=d(i),k=a("../../gl/vertex_layout"),l=d(k),m=a("../../builders/polylines"),n=a("./dasharray"),o=d(n),p=a("../../geo"),q=d(p),r=a("../polygons/polygons"),s=c.Lines=Object.create(e.Style);
Object.assign(s,{name:"lines",built_in:!0,vertex_shader_src:r.shaderSrc_polygonsVertex,fragment_shader_src:r.shaderSrc_polygonsFragment,selection:!0,init:function(){e.Style.init.apply(this,arguments);var a=[{name:"a_position",size:4,type:h.default.SHORT,normalized:!1},{name:"a_extrude",size:4,type:h.default.SHORT,normalized:!1},{name:"a_color",size:4,type:h.default.UNSIGNED_BYTE,normalized:!0}];this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_EXTRUDE_LINES=!0,this.selection&&a.push({name:"a_selection_color",size:4,type:h.default.UNSIGNED_BYTE,normalized:!0}),(this.texture||this.dash)&&(this.texcoords=!0),this.texcoords&&(this.defines.TANGRAM_TEXTURE_COORDS=!0,this.defines.TANGRAM_DASH_SCALE=1,this.defines.TANGRAM_V_SCALE_ADJUST=q.default.tile_scale*this.defines.TANGRAM_DASH_SCALE,a.push({name:"a_texcoord",size:2,type:h.default.UNSIGNED_SHORT,normalized:!0})),this.vertex_layout=new l.default(a),this.outline_feature_style={},this.inline_feature_style=this.feature_style},compileSetup:function(){return this.compile_setup||this.parseLineTexture(),e.Style.compileSetup.apply(this,arguments)},parseLineTexture:function(){var a=this;if(this.dash){this.dash_background_color&&(this.dash_background_color=f.StyleParser.parseColor(this.dash_background_color),this.defines.TANGRAM_LINE_BACKGROUND_COLOR="vec3("+this.dash_background_color.slice(0,3).join(", ")+")"),this.defines.TANGRAM_DASH_SCALE=20,this.defines.TANGRAM_V_SCALE_ADJUST=q.default.tile_scale*this.defines.TANGRAM_DASH_SCALE;var b=o.default(this.dash,{scale:this.defines.TANGRAM_DASH_SCALE});this.texture="_"+this.name+"_dasharray",j.default.create(this.gl,this.texture,{data:b.pixels,height:b.length,width:1,filtering:"nearest"})}this.texture&&(this.defines.TANGRAM_LINE_TEXTURE=!0,this.shaders.uniforms=this.shaders.uniforms||{},this.shaders.uniforms.u_texture=this.texture,this.shaders.uniforms.u_texture_ratio=1,j.default.getInfo(this.texture).then(function(b){b&&(a.shaders.uniforms.u_texture_ratio=b.height/b.width)}))},calcWidth:function(a,b){return a&&f.StyleParser.evalCachedDistanceProperty(a,b)||0},calcWidthNextZoom:function(a,b){b.zoom++;var c=this.calcWidth(a,b);return b.zoom--,c},_parseFeature:function(a,b,c){var d=this.feature_style,e=this.calcWidth(b.width,c);if(!(0>e)){var g=this.calcWidthNextZoom(b.next_width,c);if(!(0===e&&0===g||0>g)&&(d.width=e*c.units_per_meter_overzoom,d.next_width=2*g-e,d.next_width*=c.units_per_meter_overzoom,d.next_width/=2,d.color=this.parseColor(b.color,c),d.color)){if(d.z=b.z&&f.StyleParser.evalCachedDistanceProperty(b.z||0,c)||f.StyleParser.defaults.z,d.height=a.properties.height||f.StyleParser.defaults.height,d.extrude=f.StyleParser.evalProperty(b.extrude,c),d.extrude&&("number"==typeof d.extrude?d.height=d.extrude:Array.isArray(d.extrude)&&(d.height=d.extrude[1])),d.extrude&&d.height&&(d.z+=d.height),d.z*=q.default.height_scale,d.height*=q.default.height_scale,d.cap=b.cap,d.join=b.join,d.miter_limit=b.miter_limit,d.tile_edges=b.tile_edges,d.outline=d.outline||{width:{},next_width:{},preprocessed:!0},b.outline&&b.outline.visible!==!1&&b.outline.color&&b.outline.width){var h=2*this.calcWidth(b.outline.width,c),i=2*this.calcWidthNextZoom(b.outline.next_width,c);0===h&&0===i||0>h||0>i?(d.outline.width.value=null,d.outline.next_width.value=null,d.outline.color=null):(d.outline.width.value=h+e,d.outline.next_width.value=i+g,d.outline.color=b.outline.color,d.outline.cap=b.outline.cap||b.cap,d.outline.join=b.outline.join||b.join,d.outline.miter_limit=b.outline.miter_limit||b.miter_limit,d.outline.style=b.outline.style||this.name,d.outline.order=b.outline.order?this.parseOrder(b.outline.order,c):d.order,d.outline.order>d.order&&(d.outline.order=d.order),d.outline.order-=.5)}else d.outline.width.value=null,d.outline.next_width.value=null,d.outline.color=null;return d}}},_preprocess:function(a){return a.color=f.StyleParser.createColorPropertyCache(a.color),a.width=f.StyleParser.createPropertyCache(a.width,f.StyleParser.parseUnits),a.next_width=f.StyleParser.createPropertyCache(a.width,f.StyleParser.parseUnits),a.z=f.StyleParser.createPropertyCache(a.z,f.StyleParser.parseUnits),a.outline&&(a.outline.color=f.StyleParser.createColorPropertyCache(a.outline.color),a.outline.width=f.StyleParser.createPropertyCache(a.outline.width,f.StyleParser.parseUnits),a.outline.next_width=f.StyleParser.createPropertyCache(a.outline.width,f.StyleParser.parseUnits)),a},makeVertexTemplate:function(a){var b=0;return this.vertex_template[b++]=0,this.vertex_template[b++]=0,this.vertex_template[b++]=a.z||0,this.vertex_template[b++]=this.scaleOrder(a.order),this.vertex_template[b++]=0,this.vertex_template[b++]=0,this.vertex_template[b++]=0,this.vertex_template[b++]=a.next_width,this.vertex_template[b++]=255*a.color[0],this.vertex_template[b++]=255*a.color[1],this.vertex_template[b++]=255*a.color[2],this.vertex_template[b++]=255*a.color[3],this.selection&&(this.vertex_template[b++]=255*a.selection_color[0],this.vertex_template[b++]=255*a.selection_color[1],this.vertex_template[b++]=255*a.selection_color[2],this.vertex_template[b++]=255*a.selection_color[3]),this.texcoords&&(this.vertex_template[b++]=0,this.vertex_template[b++]=0),this.vertex_template},buildLines:function(a,b,c,d,e){if(this.feature_style=this.outline_feature_style,b.outline&&null!=b.outline.color&&null!=b.outline.width.value){var f=this.styles[b.outline.style];f&&f.addFeature(d.feature,b.outline,d)}this.feature_style=this.inline_feature_style;var g=this.makeVertexTemplate(b);return m.buildPolylines(a,b.width,c,g,{cap:b.cap,join:b.join,miter_limit:b.miter_limit,scaling_index:this.vertex_layout.index.a_extrude,scaling_normalize:256,texcoord_index:this.vertex_layout.index.a_texcoord,texcoord_width:(b.width||b.next_width)/d.tile.overzoom2,texcoord_normalize:65535,closed_polygon:e&&e.closed_polygon,remove_tile_edges:!b.tile_edges&&e&&e.remove_tile_edges,tile_edge_tolerance:q.default.tile_scale*d.tile.pad_scale*2})},buildPolygons:function(a,b,c,d){for(var e=0,f=0;f<a.length;f++)e+=this.buildLines(a[f],b,c,d,{closed_polygon:!0,remove_tile_edges:!0});return e}})},{"../../builders/polylines":199,"../../geo":201,"../../gl/constants":202,"../../gl/texture":208,"../../gl/vertex_layout":213,"../polygons/polygons":241,"../style":243,"../style_parser":245,"./dasharray":238}],240:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}Object.defineProperty(c,"__esModule",{value:!0}),c.Points=void 0;var f=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=a("../../utils/log"),h=d(g),i=a("../style"),j=a("../style_parser"),k=a("../../gl/constants"),l=d(k),m=a("../../gl/vertex_layout"),n=d(m),o=a("../../builders/points"),p=a("../../gl/texture"),q=d(p),r=a("../../geo"),s=d(r),t=a("../../vector"),u=d(t),v=a("../../labels/collision"),w=d(v),x=a("../../labels/label_point"),y=d(x),z=a("../../labels/point_placement"),A=d(z),B=a("../text/text_labels"),C=a("../../view"),D=a("../../utils/debug_settings"),E=d(D),F="uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_tile_proxy_depth;\nuniform bool u_tile_fade_in;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\nuniform float u_visible_time;\nuniform bool u_view_panning;\nuniform float u_view_pan_snap_timer;\n\nuniform mat4 u_model;\nuniform mat4 u_modelView;\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nattribute vec4 a_position;\nattribute vec4 a_shape;\nattribute vec4 a_color;\nattribute float a_outline_edge;\nattribute vec4 a_outline_color;\nattribute vec2 a_texcoord;\nattribute vec2 a_offset;\n\nuniform float u_point_type;\n\n#ifdef TANGRAM_CURVED_LABEL\n    attribute vec4 a_offsets;\n    attribute vec4 a_pre_angles;\n    attribute vec4 a_angles;\n#endif\n\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying vec4 v_world_position;\nvarying float v_alpha_factor;\n\n#ifdef TANGRAM_SHADER_POINT\n    varying float v_outline_edge;\n    varying vec4 v_outline_color;\n    varying float v_aa_offset;\n#endif\n\n#define PI 3.14159265359\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvec2 rotate2D(vec2 _st, float _angle) {\n    return mat2(cos(_angle),-sin(_angle),\n                sin(_angle),cos(_angle)) * _st;\n}\n\n// Assumes stops are [0, 0.33, 0.66, 0.99];\nfloat mix4linear(float a, float b, float c, float d, float x) {\n    return mix(mix(a, b, 3. * x),\n               mix(b,\n                   mix(c, d, 3. * (max(x, .66) - .66)),\n                   3. * (clamp(x, .33, .66) - .33)),\n               step(0.33, x)\n            );\n}\n\nvoid main() {\n    // Initialize globals\n    #pragma tangram: setup\n\n    v_alpha_factor = 1.0;\n    v_color = a_color;\n    v_texcoord = a_texcoord; // UV from vertex\n\n    #ifdef TANGRAM_SHADER_POINT\n        v_outline_color = a_outline_color;\n        v_outline_edge = a_outline_edge;\n        if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            v_outline_color = a_outline_color;\n            v_outline_edge = a_outline_edge;\n            float size = abs(a_shape.x/128.); // radius in pixels\n            v_texcoord = sign(a_shape.xy)*(size+1.)/(size);\n            size+=2.;\n            v_aa_offset=2./size;\n        }\n    #endif\n\n    // Position\n    vec4 position = u_modelView * vec4(a_position.xyz, 1.);\n\n    // Apply positioning and scaling in screen space\n    vec2 shape = a_shape.xy / 256.;                 // values have an 8-bit fraction\n    vec2 offset = vec2(a_offset.x, -a_offset.y);    // flip y to make it point down\n\n    float zoom = clamp(u_map_position.z - u_tile_origin.z, 0., 1.); //fract(u_map_position.z);\n    float theta = a_shape.z / 4096.;\n\n    #ifdef TANGRAM_CURVED_LABEL\n        //TODO: potential bug? null is passed in for non-curved labels, otherwise the first offset will be 0\n        if (a_offsets[0] != 0.){\n            #ifdef TANGRAM_FADE_ON_ZOOM_IN\n                v_alpha_factor *= clamp(1. + TANGRAM_FADE_ON_ZOOM_IN_RATE - TANGRAM_FADE_ON_ZOOM_IN_RATE * (u_map_position.z - u_tile_origin.z), 0., 1.);\n            #endif\n\n            vec4 angles_scaled = (PI / 16384.) * a_angles;\n            vec4 pre_angles_scaled = (PI / 128.) * a_pre_angles;\n            vec4 offsets_scaled = (1. / 64.) * a_offsets;\n\n            float pre_angle = mix4linear(pre_angles_scaled[0], pre_angles_scaled[1], pre_angles_scaled[2], pre_angles_scaled[3], zoom);\n            float angle = mix4linear(angles_scaled[0], angles_scaled[1], angles_scaled[2], angles_scaled[3], zoom);\n            float offset_curve = mix4linear(offsets_scaled[0], offsets_scaled[1], offsets_scaled[2], offsets_scaled[3], zoom);\n\n            shape = rotate2D(shape, pre_angle); // rotate in place\n            shape.x += offset_curve;            // offset for curved label segment\n            shape = rotate2D(shape, angle);     // rotate relative to curved label anchor\n            shape += rotate2D(offset, theta);   // offset if specified in the scene file\n        }\n        else {\n            shape = rotate2D(shape + offset, theta);\n        }\n    #else\n        shape = rotate2D(shape + offset, theta);\n    #endif\n\n    // Fade in (if requested) based on time mesh has been visible.\n    // Value passed to fragment shader in the v_alpha_factor varying\n    #ifdef TANGRAM_FADE_IN_RATE\n        if (u_tile_fade_in) {\n            v_alpha_factor *= clamp(u_visible_time * TANGRAM_FADE_IN_RATE, 0., 1.);\n        }\n    #endif\n\n    // Fade out when tile is zooming out, e.g. acting as proxy tiles\n    // NB: this is mostly done to compensate for text label collision happening at the label's 1x zoom. As labels\n    // in proxy tiles are scaled down, they begin to overlap, and the fade is a simple way to ease the transition.\n    // Value passed to fragment shader in the v_alpha_factor varying\n    #ifdef TANGRAM_FADE_ON_ZOOM_OUT\n        v_alpha_factor *= clamp(1. + TANGRAM_FADE_ON_ZOOM_OUT_RATE * (u_map_position.z - u_tile_origin.z), 0., 1.);\n    #endif\n\n    // World coordinates for 3d procedural textures\n    v_world_position = u_model * position;\n    v_world_position.xy += shape * u_meters_per_pixel;\n    v_world_position = wrapWorldPosition(v_world_position);\n\n    // Modify position before camera projection\n    #pragma tangram: position\n\n    cameraProjection(position);\n\n    #ifdef TANGRAM_LAYER_ORDER\n        // +1 is to keep all layers including proxies > 0\n        applyLayerOrder(a_position.w + u_tile_proxy_depth + 1., position);\n    #endif\n\n    // Apply pixel offset in screen-space\n    // Multiply by 2 is because screen is 2 units wide Normalized Device Coords (and u_resolution device pixels wide)\n    // Device pixel ratio adjustment is because shape is in logical pixels\n    position.xy += shape * position.w * 2. * u_device_pixel_ratio / u_resolution;\n    #ifdef TANGRAM_SHADER_POINT\n        if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            // enlarge by 1px to catch missed MSAA fragments\n            position.xy += sign(shape) * position.w * u_device_pixel_ratio / u_resolution;\n        }\n    #endif\n\n    // Snap to pixel grid\n    // Only applied to fully upright sprites/labels (not shader-drawn points), while panning is not active\n    if (!u_view_panning && (abs(theta) < TANGRAM_EPSILON) && u_point_type != TANGRAM_POINT_TYPE_SHADER) {\n        vec2 position_fract = fract((((position.xy / position.w) + 1.) * .5) * u_resolution);\n        vec2 position_snap = position.xy + ((step(0.5, position_fract) - position_fract) * position.w * 2. / u_resolution);\n\n        // Animate the snapping to smooth the transition and make it less noticeable\n        #ifdef TANGRAM_VIEW_PAN_SNAP_RATE\n            position.xy = mix(position.xy, position_snap, clamp(u_view_pan_snap_timer * TANGRAM_VIEW_PAN_SNAP_RATE, 0., 1.));\n        #else\n            position.xy = position_snap;\n        #endif\n    }\n\n    gl_Position = position;\n}\n",G="uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\nuniform float u_visible_time;\n\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nuniform sampler2D u_texture;\nuniform float u_point_type;\nuniform bool u_apply_color_blocks;\n\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying vec4 v_world_position;\nvarying float v_alpha_factor;\n\n#ifdef TANGRAM_SHADER_POINT\n    varying vec4 v_outline_color;\n    varying float v_outline_edge;\n    varying float v_aa_offset;\n#endif\n\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\n#ifdef TANGRAM_SHADER_POINT\n    //l is the distance from the center to the fragment, R is the radius of the drawn point\n    float _tangram_antialias(float l, float R){\n        float low  = R - v_aa_offset;\n        float high = R + v_aa_offset;\n        return 1. - smoothstep(low, high, l);\n    }\n#endif\n\nvoid main (void) {\n    // Initialize globals\n    #pragma tangram: setup\n\n    vec4 color = v_color;\n\n    if (u_point_type == TANGRAM_POINT_TYPE_TEXTURE) { // sprite texture\n        color *= texture2D(u_texture, v_texcoord);\n    }\n    else if (u_point_type == TANGRAM_POINT_TYPE_LABEL) { // label texture\n        color = texture2D(u_texture, v_texcoord);\n        color.rgb /= max(color.a, 0.001); // un-multiply canvas texture\n    }\n    #ifdef TANGRAM_SHADER_POINT\n        else if (u_point_type == TANGRAM_POINT_TYPE_SHADER) { // shader point\n            float outline_edge = v_outline_edge;\n            vec4 outlineColor  = v_outline_color;\n            // Distance to this fragment from the center.\n            float l = length(v_texcoord);\n            // Mask of outermost circle, either outline or point boundary.\n            float outer_alpha  = _tangram_antialias(l, 1.);\n            float fill_alpha   = _tangram_antialias(l, 1.-v_outline_edge*0.5) * color.a;\n            float stroke_alpha = (outer_alpha - _tangram_antialias(l, 1.-v_outline_edge)) * outlineColor.a;\n            // Apply alpha compositing with stroke 'over' fill.\n\n            #ifdef TANGRAM_BLEND_ADD\n                color.a = stroke_alpha + fill_alpha;\n                color.rgb = color.rgb * fill_alpha + outlineColor.rgb* stroke_alpha;\n            #else\n            //TANGRAM_BLEND_OVERLAY (and fallback for not implemented blending modes)\n                color.a = stroke_alpha + fill_alpha * (1. - stroke_alpha);\n                color.rgb = mix(color.rgb * fill_alpha, outlineColor.rgb, stroke_alpha) / color.a;\n            #endif\n        }\n    #endif\n\n    // Shader blocks for color/filter are only applied for sprites, shader points, and standalone text,\n    // NOT for text attached to a point (N.B.: for compatibility with ES)\n    if (u_apply_color_blocks) {\n        #pragma tangram: color\n        #pragma tangram: filter\n    }\n\n    color.a *= v_alpha_factor;\n\n    // If blending is off, use alpha discard as a lower-quality substitute\n    #if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY) && !defined(TANGRAM_BLEND_ADD)\n        if (color.a < TANGRAM_ALPHA_TEST) {\n            discard;\n        }\n    #endif\n\n    gl_FragColor = color;\n}\n",H=y.default.PLACEMENT,I=128/Math.PI,J=16384/Math.PI,K=64,L=65535,M=c.Points=Object.create(i.Style),N=1,O=2,P=3;Object.assign(M,B.TextLabels),Object.assign(M,{name:"points",built_in:!0,vertex_shader_src:F,fragment_shader_src:G,collision:!0,blend:"overlay",init:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];i.Style.init.call(this,a);var c=[{name:"a_position",size:4,type:l.default.SHORT,normalized:!1},{name:"a_shape",size:4,type:l.default.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:l.default.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:l.default.SHORT,normalized:!1},{name:"a_color",size:4,type:l.default.UNSIGNED_BYTE,normalized:!0}];b.length&&Array.prototype.push.apply(c,b),this.selection=!0,c.push({name:"a_selection_color",size:4,type:l.default.UNSIGNED_BYTE,normalized:!0}),"overlay"!==this.blend&&(this.defines.TANGRAM_LAYER_ORDER=!0),this.defines.TANGRAM_POINT_TYPE_TEXTURE=N,this.defines.TANGRAM_POINT_TYPE_LABEL=O,this.defines.TANGRAM_POINT_TYPE_SHADER=P,this.texture||(this.defines.TANGRAM_SHADER_POINT=!0,c.push({name:"a_outline_color",size:4,type:l.default.UNSIGNED_BYTE,normalized:!0}),c.push({name:"a_outline_edge",size:1,type:l.default.FLOAT,normalized:!1})),this.vertex_layout=new n.default(c),this.defines.TANGRAM_FADE_ON_ZOOM_OUT=!0,this.defines.TANGRAM_FADE_ON_ZOOM_OUT_RATE=2,E.default.suppress_label_fade_in===!0?(this.fade_in_time=0,this.defines.TANGRAM_FADE_IN_RATE=null):(this.fade_in_time=.15,this.defines.TANGRAM_FADE_IN_RATE=1/this.fade_in_time),E.default.suppress_label_snap_animation!==!0&&(this.defines.TANGRAM_VIEW_PAN_SNAP_RATE=1/C.VIEW_PAN_SNAP_TIME),this.collision_group_points=this.name+"-points",this.collision_group_text=this.name+"-text",this.reset()},reset:function(){this.queues={},this.resetText(),this.texture_missing_sprites={}},addFeature:function(a,b,c){var d=c.tile;if(d.generation===this.generation){var e={};if(e.color=this.parseColor(b.color,c),e.color||this.texture){var f=void 0;if(this.hasSprites()){if(f=this.parseSprite(b,c),!f)return;e.texcoords=f.texcoords}if(e.size=b.size,e.size?(e.size=j.StyleParser.evalCachedProperty(e.size,c),"number"==typeof e.size&&(e.size=[e.size,e.size])):e.size=f?f.size:[16,16],b.outline&&(e.outline_width=j.StyleParser.evalCachedProperty(b.outline.width,c)||j.StyleParser.defaults.outline.width,e.outline_color=this.parseColor(b.outline.color,c)),e.outline_edge_pct=0,e.outline_width&&e.outline_color){var g=e.outline_width;e.size[0]+=g,e.size[1]+=g,e.outline_edge_pct=g/Math.min(e.size[0],e.size[1])*2}e.size=[Math.min(e.size[0],256),Math.min(e.size[1],256)],e.placement=b.placement,e.placement_min_length_ratio=j.StyleParser.evalCachedProperty(b.placement_min_length_ratio,c),e.placement===H.SPACED&&b.placement_spacing&&(e.placement_spacing=j.StyleParser.evalCachedProperty(b.placement_spacing,c)),e.angle=j.StyleParser.evalProperty(b.angle,c)||0,e.z=b.z&&j.StyleParser.evalCachedDistanceProperty(b.z,c)||j.StyleParser.defaults.z,e.tile_edges=b.tile_edges,e.label_texture=null,this.computeLayout(e,a,b,c,d);var i=b.text&&b.text.visible!==!1&&this.parseTextFeature(a,b.text,c,d);Array.isArray(i)&&(i=null,h.default({level:"warn",once:!0},"Layer '"+b.layers[b.layers.length-1]+"': cannot use boundary labels (e.g. 'text_source: { left: ..., right: ... }') for 'text' labels attached to 'points'; "+("provided 'text_source' value was '"+JSON.stringify(b.text.text_source)+"'"))),i&&(i.layout.parent=e,i.layout.priority=b.text.priority?Math.max(i.layout.priority,e.priority+.5):e.priority+.5,i.layout.move_into_tile=!1,w.default.addStyle(this.collision_group_text,d.id)),this.queueFeature({feature:a,draw:b,context:c,style:e,text_feature:i},d),w.default.addStyle(this.collision_group_points,d.id)}}},hasSprites:function(){return this.texture&&q.default.textures[this.texture]&&q.default.textures[this.texture].sprites},getSpriteInfo:function(a){var b=q.default.textures[this.texture].sprites[a]&&q.default.getSpriteInfo(this.texture,a);return a&&!b&&(this.texture_missing_sprites[a]||(h.default("debug","Style: in style '"+this.name+"', could not find sprite '"+a+"' for texture '"+this.texture+"'"),this.texture_missing_sprites[a]=!0)),b},parseSprite:function(a,b){var c=j.StyleParser.evalProperty(a.sprite,b),d=this.getSpriteInfo(c)||this.getSpriteInfo(a.sprite_default);return d},queueFeature:function(a,b){this.tile_data[b.id]&&this.queues[b.id]||this.startData(b),this.queues[b.id]=this.queues[b.id]||[],this.queues[b.id].push(a)},endData:function(a){var b=this;if(a.canceled)return h.default("trace","Style "+this.name+": stop tile build because tile was canceled: "+a.key),Promise.resolve();var c=this.queues[a.id];delete this.queues[a.id];var d=[],g=[];return c.forEach(function(a){for(var c=a.style,e=a.feature,f=e.geometry,h=b.buildLabels(c.size,f,c),i=0;i<h.length;i++){var j=h[i],k={feature:e,draw:a.draw,context:a.context,style:c,label:j};if(g.push(k),a.text_feature){var l={feature:e,draw:a.text_feature.draw,context:a.context,text:a.text_feature.text,text_settings_key:a.text_feature.text_settings_key,layout:a.text_feature.layout,point_label:j,linked:k};d.push(l),a.draw.text.optional||(k.linked=l)}}}),Promise.all([w.default.collide(g,this.collision_group_points,a.id).then(function(a){a.forEach(function(a){b.feature_style=a.style,b.feature_style.label=a.label,i.Style.addFeature.call(b,a.feature,a.draw,a.context)})}),this.collideAndRenderTextLabels(a,this.collision_group_text,d)]).then(function(c){var d=f(c,2),g=d[1],h=g.labels,j=g.texts,k=g.textures;return h&&j&&h.forEach(function(a){var c=a.text_settings_key,d=j[c]&&j[c][a.text],e=b.feature_style;e.label=a.label,e.size=d.size.logical_size,e.angle=0,e.texcoords=d.align[a.label.align].texcoords,e.label_texture=k[d.align[a.label.align].texture_id],i.Style.addFeature.call(b,a.feature,a.draw,a.context)}),b.freeText(a),i.Style.endData.call(b,a).then(function(a){if(a&&k&&k.length){var b;a.textures=a.textures||[],(b=a.textures).push.apply(b,e(k))}return a})})},_preprocess:function(a){return a.color=j.StyleParser.createColorPropertyCache(a.color),a.outline&&(a.outline.color=j.StyleParser.createColorPropertyCache(a.outline.color),a.outline.width=j.StyleParser.createPropertyCache(a.outline.width,function(a){return Array.isArray(a)?a.map(parseFloat):parseFloat(a)})),a.z=j.StyleParser.createPropertyCache(a.z,j.StyleParser.parseUnits),a.size=j.StyleParser.createPropertyCache(a.size,function(a){return Array.isArray(a)?a.map(parseFloat):parseFloat(a)}),a.offset=j.StyleParser.createPropertyCache(a.offset,function(a){return Array.isArray(a)&&a.map(parseFloat)||0}),a.buffer=j.StyleParser.createPropertyCache(a.buffer,function(a){return(Array.isArray(a)?a:[a,a]).map(parseFloat)||0}),a.repeat_distance=j.StyleParser.createPropertyCache(a.repeat_distance,parseFloat),a.placement=H[a.placement&&a.placement.toUpperCase()],null==a.placement&&(a.placement=H.VERTEX),a.placement_spacing=null!=a.placement_spacing?a.placement_spacing:80,a.placement_spacing=j.StyleParser.createPropertyCache(a.placement_spacing,parseFloat),a.placement_min_length_ratio=null!=a.placement_min_length_ratio?a.placement_min_length_ratio:1,a.placement_min_length_ratio=j.StyleParser.createPropertyCache(a.placement_min_length_ratio,parseFloat),a.angle="number"==typeof a.angle?a.angle*Math.PI/180:a.angle||0,a.text=this.preprocessText(a.text),a.text&&(a.text.key=a.key,a.text.group=a.group,a.text.layers=a.layers,a.text.order=a.order,a.text.repeat_group=a.text.repeat_group||a.repeat_group,a.text.anchor=a.text.anchor||this.default_anchor,a.text.optional="boolean"==typeof a.text.optional&&a.text.optional,a.text.interactive=a.text.interactive||a.interactive),a},default_anchor:["bottom","top","right","left"],computeLayout:function(a,b,c,d,e){var f=a||{};f.id=b,f.units_per_pixel=e.units_per_pixel||1,f.collide=c.collide!==!1,f.cull_from_tile=null!=c.cull_from_tile&&c.cull_from_tile,f.move_into_tile=!1,f.anchor=c.anchor,f.offset=j.StyleParser.evalCachedProperty(c.offset,d)||j.StyleParser.zeroPair,f.buffer=j.StyleParser.evalCachedProperty(c.buffer,d)||j.StyleParser.zeroPair,f.repeat_distance=j.StyleParser.evalCachedProperty(c.repeat_distance,d),f.repeat_distance&&(f.repeat_distance*=f.units_per_pixel,f.repeat_group="function"==typeof c.repeat_group?c.repeat_group(d):"string"==typeof c.repeat_group?c.repeat_group:c.key);var g=c.priority;return null!=g?"function"==typeof g&&(g=g(d)):g=-1>>>0,f.priority=g,f},buildTextLabels:function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=this.texts[a.id][e.text_settings_key][e.text],g=f.size.collision_size;e.label=new y.default(e.point_label.position,g,e.layout),c.push(e)}return c},buildLabels:function(a,b,c){var d=[];if("Point"===b.type)d.push(new y.default(b.coordinates,a,c));else if("MultiPoint"===b.type)for(var e=b.coordinates,f=0;f<e.length;++f){var g=e[f];d.push(new y.default(g,a,c))}else if("LineString"===b.type)for(var h=b.coordinates,i=A.default(h,a,c),j=0;j<i.length;++j)d.push(i[j]);else if("MultiLineString"===b.type)for(var k=b.coordinates,l=0;l<k.length;l++)for(var m=k[l],n=A.default(m,a,c),o=0;o<n.length;++o)d.push(n[o]);else if("Polygon"===b.type)if(c.placement===H.CENTROID){var p=s.default.centroid(b.coordinates);d.push(new y.default(p,a,c))}else for(var q=b.coordinates,r=0;r<q.length;r++)for(var t=A.default(q[r],a,c),u=0;u<t.length;++u)d.push(t[u]);else if("MultiPolygon"===b.type)if(c.placement===H.CENTROID){var v=s.default.multiCentroid(b.coordinates);d.push(new y.default(v,a,c))}else for(var w=b.coordinates,x=0;x<w.length;x++)for(var z=w[x],B=0;B<z.length;B++)for(var C=A.default(z[B],a,c),D=0;D<C.length;++D)d.push(C[D]);return d},makeVertexTemplate:function(a){var b=a.color||j.StyleParser.defaults.color;if(this.fillVertexTemplate("a_position",0,{size:2}),this.fillVertexTemplate("a_position",a.z||0,{size:1,offset:2}),this.fillVertexTemplate("a_position",this.scaleOrder(a.order),{size:1,offset:3}),this.fillVertexTemplate("a_shape",0,{size:3}),this.fillVertexTemplate("a_texcoord",0,{size:2}),this.fillVertexTemplate("a_offset",0,{size:2}),this.fillVertexTemplate("a_color",u.default.mult(b,255),{size:4}),this.defines.TANGRAM_SHADER_POINT){var c=a.outline_color||j.StyleParser.defaults.outline.color;this.fillVertexTemplate("a_outline_color",u.default.mult(c,255),{size:4}),this.fillVertexTemplate("a_outline_edge",a.outline_edge_pct||j.StyleParser.defaults.outline.width,{size:1})}return this.selection&&this.fillVertexTemplate("a_selection_color",u.default.mult(a.selection_color,255),{size:4}),this.vertex_template},buildQuad:function(a,b,c,d,e,f,g,h,i,j,k){return o.buildQuadsForPoints(a,j,k,{texcoord_index:this.vertex_layout.index.a_texcoord,position_index:this.vertex_layout.index.a_position,shape_index:this.vertex_layout.index.a_shape,offset_index:this.vertex_layout.index.a_offset,offsets_index:this.vertex_layout.index.a_offsets,pre_angles_index:this.vertex_layout.index.a_pre_angles,angles_index:this.vertex_layout.index.a_angles},{quad:b,quad_normalize:256,offset:f,offsets:g,pre_angles:e,angle:4096*c,angles:d,curve:i,texcoord_scale:h,texcoord_normalize:L,pre_angles_normalize:I,angles_normalize:J,offsets_normalize:K})},build:function(a,b,c){var d=a.label;return"curved"===d.type?this.buildArticulatedLabel(d,a,b,c):this.buildLabel(d,a,b,c)},buildLabel:function(a,b,c,d){var e=this.makeVertexTemplate(b),f=a.angle||b.angle,g=void 0,h=void 0;a.type?(g=b.size[a.type],h=b.texcoords[a.type].texcoord):(g=b.size,h=b.texcoords);var i=this.getTileMesh(d.tile,this.meshVariantTypeForDraw(b));c=i.vertex_data,i.uniforms=i.uniforms||{},b.label_texture?(i.uniforms.u_texture=b.label_texture,i.uniforms.u_point_type=O,i.uniforms.u_apply_color_blocks=!1):this.texture?(i.uniforms.u_texture=this.texture,i.uniforms.u_point_type=N,i.uniforms.u_apply_color_blocks=!0):(i.uniforms.u_texture=q.default.default,i.uniforms.u_point_type=P,i.uniforms.u_apply_color_blocks=!0);var j=a.offset;return this.buildQuad([a.position],g,f,null,null,j,null,h,!1,c,e)},buildArticulatedLabel:function(a,b,c,d){for(var e=this.makeVertexTemplate(b),f=a.angle,g=0,h=0;h<a.num_segments;h++){var i=b.size[a.type][h],j=b.texcoords_stroke[h];b.label_texture=b.label_textures[h];var k=this.getTileMesh(d.tile,this.meshVariantTypeForDraw(b));c=k.vertex_data,k.uniforms=k.uniforms||{},k.uniforms.u_texture=b.label_texture,k.uniforms.u_point_type=O,k.uniforms.u_apply_color_blocks=!1;var l=a.offset||[0,0],m=a.position,n=a.angles[h],o=a.offsets[h],p=a.pre_angles[h];g+=this.buildQuad([m],i,f,n,p,l,o,j,!0,c,e)}for(var q=0;q<a.num_segments;q++){var r=b.size[a.type][q],s=b.texcoords[a.type][q].texcoord;b.label_texture=b.label_textures[q];var t=this.getTileMesh(d.tile,this.meshVariantTypeForDraw(b));c=t.vertex_data,t.uniforms=t.uniforms||{},t.uniforms.u_texture=b.label_texture,t.uniforms.u_point_type=O,t.uniforms.u_apply_color_blocks=!1;var u=a.offset||[0,0],v=a.position,w=a.angles[q],x=a.offsets[q],y=a.pre_angles[q];g+=this.buildQuad([v],r,f,w,y,u,x,s,!0,c,e)}return g},buildLines:function(a,b,c,d){return this.build(b,c,d)},buildPoints:function(a,b,c,d){return this.build(b,c,d)},buildPolygons:function(a,b,c,d){return this.build(b,c,d)},meshVariantTypeForDraw:function(a){return a.label_texture?a.label_texture:this.default_mesh_variant},makeMesh:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c=Object.assign({},c,{fade_in_time:this.fade_in_time}),i.Style.makeMesh.call(this,a,b,c)}})},{"../../builders/points":197,"../../geo":201,"../../gl/constants":202,"../../gl/texture":208,"../../gl/vertex_layout":213,"../../labels/collision":214,"../../labels/label_point":218,"../../labels/point_placement":220,"../../utils/debug_settings":255,"../../utils/log":259,"../../vector":272,"../../view":273,"../style":243,"../style_parser":245,"../text/text_labels":249}],241:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.Polygons=c.shaderSrc_polygonsFragment=c.shaderSrc_polygonsVertex=void 0;
var e=a("../style"),f=a("../style_parser"),g=a("../../gl/constants"),h=d(g),i=a("../../gl/vertex_layout"),j=d(i),k=a("../../builders/polygons"),l=a("../../geo"),m=d(l),n=c.shaderSrc_polygonsVertex='uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_tile_proxy_depth;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\n\nuniform mat4 u_model;\nuniform mat4 u_modelView;\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nattribute vec4 a_position;\nattribute vec4 a_color;\n\n// Optional normal attribute, otherwise default to up\n#ifdef TANGRAM_NORMAL_ATTRIBUTE\n    attribute vec3 a_normal;\n    #define TANGRAM_NORMAL a_normal\n#else\n    #define TANGRAM_NORMAL vec3(0., 0., 1.)\n#endif\n\n// Optional dynamic line extrusion\n#ifdef TANGRAM_EXTRUDE_LINES\n    // xy: extrusion direction in xy plane\n    // z:  half-width of line (amount to extrude)\n    // w:  scaling factor for interpolating width between zooms\n    attribute vec4 a_extrude;\n#endif\n\nvarying vec4 v_position;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec4 v_world_position;\n\n// Optional texture UVs\n#ifdef TANGRAM_TEXTURE_COORDS\n    attribute vec2 a_texcoord;\n    varying vec2 v_texcoord;\n#endif\n\n// Optional model position varying for tile coordinate zoom\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n    varying vec4 v_modelpos_base_zoom;\n#endif\n\n#if defined(TANGRAM_LIGHTING_VERTEX)\n    varying vec4 v_lighting;\n#endif\n\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvoid main() {\n    // Initialize globals\n    #pragma tangram: setup\n\n    // Texture UVs\n    #ifdef TANGRAM_TEXTURE_COORDS\n        v_texcoord = a_texcoord;\n        #ifdef TANGRAM_EXTRUDE_LINES\n            v_texcoord.y *= TANGRAM_V_SCALE_ADJUST;\n        #endif\n    #endif\n\n    // Pass model position to fragment shader\n    #ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n        v_modelpos_base_zoom = modelPositionBaseZoom();\n    #endif\n\n    // Position\n    vec4 position = vec4(a_position.xy, a_position.z / TANGRAM_HEIGHT_SCALE, 1.); // convert height back to meters\n\n    #ifdef TANGRAM_EXTRUDE_LINES\n        vec2 extrude = a_extrude.xy / 256.; // values have an 8-bit fraction\n        float width = a_extrude.z;\n        float dwdz = a_extrude.w;\n\n        // Adjust line width based on zoom level, to prevent proxied lines from being either too small or too big.\n        // "Flattens" the zoom between 1-2 to peg it to 1 (keeps lines from prematurely shrinking), then interpolate\n        // and clamp to 4 (keeps lines from becoming too small when far away).\n        float dz = clamp(u_map_position.z - u_tile_origin.z, 0., 4.);\n        dz += step(1., dz) * (1. - dz) + mix(0., 2., clamp((dz - 2.) / 2., 0., 1.));\n\n        // Interpolate between zoom levels\n        width += dwdz * dz;\n\n        // Scale pixel dimensions to be consistent in screen space\n        // Scale from style zoom units back to tile zoom\n        width *= exp2(-dz - (u_tile_origin.z - u_tile_origin.w));\n\n        // Modify line width before extrusion\n        #pragma tangram: width\n\n        position.xy += extrude * width;\n    #endif\n\n    // World coordinates for 3d procedural textures\n    v_world_position = wrapWorldPosition(u_model * position);\n\n    // Adjust for tile and view position\n    position = u_modelView * position;\n\n    // Modify position before camera projection\n    #pragma tangram: position\n\n    // Setup varyings\n    v_position = position;\n    v_normal = normalize(u_normalMatrix * TANGRAM_NORMAL);\n    v_color = a_color;\n\n    #if defined(TANGRAM_LIGHTING_VERTEX)\n        // Vertex lighting\n        vec3 normal = v_normal;\n\n        // Modify normal before lighting\n        #pragma tangram: normal\n\n        // Pass lighting intensity to fragment shader\n        v_lighting = calculateLighting(position.xyz - u_eye, normal, vec4(1.));\n    #endif\n\n    // Camera\n    cameraProjection(position);\n\n    // +1 is to keep all layers including proxies > 0\n    applyLayerOrder(a_position.w + u_tile_proxy_depth + 1., position);\n\n    gl_Position = position;\n}\n',o=c.shaderSrc_polygonsFragment="uniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_map_position;\nuniform vec4 u_tile_origin;\nuniform float u_meters_per_pixel;\nuniform float u_device_pixel_ratio;\n\nuniform mat3 u_normalMatrix;\nuniform mat3 u_inverseNormalMatrix;\n\nvarying vec4 v_position;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec4 v_world_position;\n\n#define TANGRAM_NORMAL v_normal\n\n#ifdef TANGRAM_TEXTURE_COORDS\n    varying vec2 v_texcoord;\n#endif\n\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\n    varying vec4 v_modelpos_base_zoom;\n#endif\n\n#if defined(TANGRAM_LIGHTING_VERTEX)\n    varying vec4 v_lighting;\n#endif\n\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n\nvoid main (void) {\n    // Initialize globals\n    #pragma tangram: setup\n\n    vec4 color = v_color;\n    vec3 normal = TANGRAM_NORMAL;\n\n    // Apply raster to vertex color\n    #ifdef TANGRAM_RASTER_TEXTURE_COLOR\n        color *= sampleRaster(0); // multiplied to tint texture color\n    #endif\n\n    // Apply line texture\n    #ifdef TANGRAM_LINE_TEXTURE\n        vec2 _line_st = vec2(v_texcoord.x, fract(v_texcoord.y / u_texture_ratio));\n        vec4 _line_color = texture2D(u_texture, _line_st);\n\n        if (_line_color.a < TANGRAM_ALPHA_TEST) {\n            #ifdef TANGRAM_LINE_BACKGROUND_COLOR\n                color.rgb = TANGRAM_LINE_BACKGROUND_COLOR;\n            #elif !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY)\n                discard; // use discard when alpha blending is unavailable\n            #else\n                color.a = 0.; // use alpha channel when blending is available\n            #endif\n        }\n        else {\n            color *= _line_color;\n        }\n    #endif\n\n    // First, get normal from raster tile (if applicable)\n    #ifdef TANGRAM_RASTER_TEXTURE_NORMAL\n        normal = normalize(sampleRaster(0).rgb * 2. - 1.);\n    #endif\n\n    // Second, alter normal with normal map texture (if applicable)\n    #if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\n        calculateNormal(normal);\n    #endif\n\n    // Normal modification applied here for fragment lighting or no lighting,\n    // and in vertex shader for vertex lighting\n    #if !defined(TANGRAM_LIGHTING_VERTEX)\n        #pragma tangram: normal\n    #endif\n\n    // Color modification before lighting is applied\n    #pragma tangram: color\n\n    #if defined(TANGRAM_LIGHTING_FRAGMENT)\n        // Calculate per-fragment lighting\n        color = calculateLighting(v_position.xyz - u_eye, normal, color);\n    #elif defined(TANGRAM_LIGHTING_VERTEX)\n        // Apply lighting intensity interpolated from vertex shader\n        color *= v_lighting;\n    #endif\n\n    // Post-processing effects (modify color after lighting)\n    #pragma tangram: filter\n\n    gl_FragColor = color;\n}\n",p=c.Polygons=Object.create(e.Style);Object.assign(p,{name:"polygons",built_in:!0,vertex_shader_src:n,fragment_shader_src:o,init:function(){e.Style.init.apply(this,arguments);var a=[{name:"a_position",size:4,type:h.default.SHORT,normalized:!1},{name:"a_normal",size:3,type:h.default.BYTE,normalized:!0},{name:"a_color",size:4,type:h.default.UNSIGNED_BYTE,normalized:!0}];this.defines.TANGRAM_NORMAL_ATTRIBUTE=!0,this.defines.TANGRAM_LAYER_ORDER=!0,this.selection=!0,a.push({name:"a_selection_color",size:4,type:h.default.UNSIGNED_BYTE,normalized:!0}),this.texcoords&&(this.defines.TANGRAM_TEXTURE_COORDS=!0,a.push({name:"a_texcoord",size:2,type:h.default.UNSIGNED_SHORT,normalized:!0})),this.vertex_layout=new j.default(a)},_parseFeature:function(a,b,c){var d=this.feature_style;return d.color=this.parseColor(b.color,c),d.color?(d.z=b.z&&f.StyleParser.evalCachedDistanceProperty(b.z,c)||f.StyleParser.defaults.z,d.z*=m.default.height_scale,d.extrude=f.StyleParser.evalProperty(b.extrude,c),d.extrude&&(d.extrude===!0?(d.height=a.properties.height||f.StyleParser.defaults.height,d.min_height=a.properties.min_height||f.StyleParser.defaults.min_height):"number"==typeof d.extrude?(d.height=d.extrude,d.min_height=0):Array.isArray(d.extrude)&&(d.min_height=d.extrude[0],d.height=d.extrude[1]),d.height*=m.default.height_scale,d.min_height*=m.default.height_scale),d.tile_edges=b.tile_edges,d):null},_preprocess:function(a){return a.color=f.StyleParser.createColorPropertyCache(a.color),a.z=f.StyleParser.createPropertyCache(a.z,f.StyleParser.parseUnits),a},makeVertexTemplate:function(a){var b=0;return this.vertex_template[b++]=0,this.vertex_template[b++]=0,this.vertex_template[b++]=a.z||0,this.vertex_template[b++]=this.scaleOrder(a.order),this.vertex_template[b++]=0,this.vertex_template[b++]=0,this.vertex_template[b++]=127,this.vertex_template[b++]=255*a.color[0],this.vertex_template[b++]=255*a.color[1],this.vertex_template[b++]=255*a.color[2],this.vertex_template[b++]=255*a.color[3],this.selection&&(this.vertex_template[b++]=255*a.selection_color[0],this.vertex_template[b++]=255*a.selection_color[1],this.vertex_template[b++]=255*a.selection_color[2],this.vertex_template[b++]=255*a.selection_color[3]),this.texcoords&&(this.vertex_template[b++]=0,this.vertex_template[b++]=0),this.vertex_template},buildPolygons:function(a,b,c,d){var e=this.makeVertexTemplate(b),f={texcoord_index:this.vertex_layout.index.a_texcoord,texcoord_normalize:65535,remove_tile_edges:!b.tile_edges,tile_edge_tolerance:m.default.tile_scale*d.tile.pad_scale*4,winding:d.winding};return b.extrude&&b.height?k.buildExtrudedPolygons(a,b.z,b.height,b.min_height,c,e,this.vertex_layout.index.a_normal,127,f):k.buildPolygons(a,c,e,f)}})},{"../../builders/polygons":198,"../../geo":201,"../../gl/constants":202,"../../gl/vertex_layout":213,"../style":243,"../style_parser":245}],242:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.RasterStyle=void 0;var d=a("../style_parser"),e=a("../polygons/polygons"),f=c.RasterStyle=Object.create(e.Polygons);Object.assign(f,{name:"raster",super:e.Polygons,built_in:!0,init:function(){this.raster=this.raster||"color",this.super.init.apply(this,arguments),this.selection=!1},_preprocess:function(a){return a.color=a.color||d.StyleParser.defaults.color,this.super._preprocess.apply(this,arguments)}})},{"../polygons/polygons":241,"../style_parser":245}],243:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function f(a,b,c,d,e,f){a[b]=a[b]||{features:0,geoms:0,styles:{},base:{}},a[b].features+=c,a[b].geoms+=d;for(var g in e)a[b].styles[g]=a[b].styles[g]||0,a[b].styles[g]+=e[g];for(var h in f)a[b].base[h]=a[b].base[h]||0,a[b].base[h]+=f[h]}Object.defineProperty(c,"__esModule",{value:!0}),c.Style=void 0;var g=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};c.addLayerDebugEntry=f;var i=a("./style_parser"),j=a("../selection"),k=d(j),l=a("../gl/shader_program"),m=d(l),n=a("../gl/vbo_mesh"),o=d(n),p=a("../gl/texture"),q=d(p),r=a("../material"),s=d(r),t=a("../light"),u=d(t),v=a("../sources/raster"),w=a("../utils/log"),x=d(w),y=a("../utils/merge"),z=d(y),A=a("../utils/thread"),B=d(A),C=a("../utils/worker_broker"),D=d(C),E=a("../utils/debug_settings"),F=d(E),G="// Fragment shader for feature selection passes\n// Renders in silhouette according to selection (picking) color, or black if none defined\n\n#ifdef TANGRAM_FEATURE_SELECTION\n    varying vec4 v_selection_color;\n#endif\n\nvoid main (void) {\n    #ifdef TANGRAM_FEATURE_SELECTION\n        gl_FragColor = v_selection_color;\n    #else\n        gl_FragColor = vec4(0., 0., 0., 1.);\n    #endif\n}\n",H="// Uniforms defining raster textures and macros for accessing them\n\n#ifdef TANGRAM_FRAGMENT_SHADER\nuniform sampler2D u_rasters[TANGRAM_NUM_RASTER_SOURCES];    // raster tile texture samplers\nuniform vec2 u_raster_sizes[TANGRAM_NUM_RASTER_SOURCES];    // raster tile texture sizes (width/height in pixels)\nuniform vec3 u_raster_offsets[TANGRAM_NUM_RASTER_SOURCES];  // raster tile texture UV starting offset for tile\n\n// Note: the raster accessors below are #defines rather than functions to\n// avoid issues with constant integer expressions for array indices\n\n// Adjusts UVs in model space to account for raster tile texture overzooming\n// (applies scale and offset adjustments)\n#define adjustRasterUV(raster_index, uv) \\\n    ((uv) * u_raster_offsets[raster_index].z + u_raster_offsets[raster_index].xy)\n\n// Returns the UVs of the current model position for a raster sampler\n#define currentRasterUV(raster_index) \\\n    (adjustRasterUV(raster_index, v_modelpos_base_zoom.xy))\n\n// Returns pixel location in raster tile texture at current model position\n#define currentRasterPixel(raster_index) \\\n    (currentRasterUV(raster_index) * rasterPixelSize(raster_index))\n\n// Samples a raster tile texture for the current model position\n#define sampleRaster(raster_index) \\\n    (texture2D(u_rasters[raster_index], currentRasterUV(raster_index)))\n\n// Samples a raster tile texture for a given pixel\n#define sampleRasterAtPixel(raster_index, pixel) \\\n    (texture2D(u_rasters[raster_index], adjustRasterUV(raster_index, (pixel) / rasterPixelSize(raster_index))))\n\n// Returns size of raster sampler in pixels\n#define rasterPixelSize(raster_index) \\\n    (u_raster_sizes[raster_index])\n\n#endif\n",I=c.Style={init:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.generation,c=a.styles,d=a.sources,e=void 0===d?{}:d,f=a.introspection;this.setGeneration(b),this.styles=c,this.sources=e,this.defines=this.hasOwnProperty("defines")&&this.defines||{},this.shaders=this.hasOwnProperty("shaders")&&this.shaders||{},this.introspection=f||!1,this.selection=this.selection||this.introspection||!1,this.compile_setup=!1,this.program=null,this.selection_program=null,this.feature_style={},this.vertex_template=[],this.tile_data={},this.defines.TANGRAM_WORLD_POSITION_WRAP=1e5,this.blend=this.blend||"opaque",this.defines["TANGRAM_BLEND_"+this.blend.toUpperCase()]=!0,null==this.blend_order&&(this.blend_order=-1),this.removeShaderBlock("setup"),this.material instanceof s.default||(s.default.isValid(this.material)||(this.material=i.StyleParser.defaults.material),this.material=new s.default(this.material)),this.material.inject(this),u.default.setMode(this.lighting,this),this.setupRasters(),this.initialized=!0},destroy:function(){this.program&&(this.program.destroy(),this.program=null),this.selection_program&&(this.selection_program.destroy(),this.selection_program=null),D.default.removeTarget(this.main_thread_target),this.gl=null,this.initialized=!1},reset:function(){},baseStyle:function(){return this.base||this.name},setGeneration:function(a){this.generation=a,this.main_thread_target=["Style",this.name,this.generation].join("/"),B.default.is_main&&D.default.addTarget(this.main_thread_target,this)},fillVertexTemplate:function(a,b,c){var d=c.size,e=c.offset;e=void 0===e?0:e;var f=this.vertex_layout.index[a];if(void 0===f)return void x.default("warn","Style: in style '"+this.name+"', no index found in vertex layout for attribute '"+a+"'");for(var g=0;d>g;++g){var h=b.length>g?b[g]:b;this.vertex_template[f+g+e]=h}},startData:function(a){this.tile_data[a.id]=this.tile_data[a.id]||{meshes:{},uniforms:{},textures:[]}},endData:function(a){var b=this.tile_data[a.id];if(this.tile_data[a.id]=null,b&&Object.keys(b.meshes).length>0){for(var c in b.meshes){var d=b.meshes[c];0!==d.vertex_data.vertex_count?(d.vertex_data.end(),d.vertex_elements=d.vertex_data.element_buffer,d.vertex_data=d.vertex_data.vertex_buffer):delete b.meshes[c]}return this.buildRasterTextures(a,b).then(function(){return b})}return Promise.resolve(null)},hasDataForTile:function(a){return null!=this.tile_data[a.id]},getTileMesh:function(a,b){var c=this.tile_data[a.id].meshes;return null==c[b]&&(c[b]={variant:b,vertex_data:this.vertexLayoutForMeshVariant(b).createVertexData()}),c[b]},vertexLayoutForMeshVariant:function(){return this.vertex_layout},default_mesh_variant:0,meshVariantTypeForDraw:function(){return this.default_mesh_variant},addFeature:function(a,b,c){var d=c.tile;if(d.generation===this.generation){this.tile_data[d.id]||this.startData(d);var e=this.parseFeature(a,b,c);if(e){var f=this.getTileMesh(d,this.meshVariantTypeForDraw(e)).vertex_data;this.buildGeometry(a.geometry,e,f,c)>0&&(a.generation=this.generation)}}},buildGeometry:function(a,b,c,d){var g=this,h=void 0;if("Polygon"===a.type?h=this.buildPolygons([a.coordinates],b,c,d):"MultiPolygon"===a.type?h=this.buildPolygons(a.coordinates,b,c,d):"LineString"===a.type?h=this.buildLines([a.coordinates],b,c,d):"MultiLineString"===a.type?h=this.buildLines(a.coordinates,b,c,d):"Point"===a.type?h=this.buildPoints([a.coordinates],b,c,d):"MultiPoint"===a.type&&(h=this.buildPoints(a.coordinates,b,c,d)),h>0&&F.default.layer_stats){var i=d.tile;i.debug.layers=i.debug.layers||{list:{},tree:{}};var j=i.debug.layers.list,k=i.debug.layers.tree,l={};d.layers.forEach(function(a){f(j,a,1,h,e({},g.name,h),e({},g.baseStyle(),h));for(var b=k,c=l,d=a.split(":"),i=0;i<d.length;i++){var m=d[i];b[m]=b[m]||{features:0,geoms:0,styles:{},base:{}},null==c[m]&&(c[m]={},f(b,m,1,h,e({},g.name,h),e({},g.baseStyle(),h))),i<d.length-1&&(b[m].layers=b[m].layers||{}),b=b[m].layers,c=c[m]}})}return h},parseFeature:function(a,b,c){try{var d=this.feature_style;if(d.order=this.parseOrder(b.order,c),null==d.order&&"overlay"!==this.blend){var e="Layer '"+b.layers.join(", ")+"', draw group '"+b.group+"': ";return e+="'order' parameter is required unless blend mode is 'overlay'",null!=b.order&&(e+="; 'order' was set to a dynamic value (e.g. string tied to feature property, ",e+="or JS function), but evaluated to null for one or more features"),void x.default({level:"warn",once:!0},e)}if(d=this._parseFeature(a,b,c),!d)return;return d.interactive=!!this.selection&&i.StyleParser.evalProperty(this.introspection||b.interactive,c),d.selection_color=d.interactive===!0?k.default.makeColor(a,c.tile,c):k.default.defaultColor,d}catch(b){x.default("error","Style.parseFeature: style parsing error",a,d,b.stack)}},_parseFeature:function(){return this.feature_style},preprocess:function(a){if(!a.preprocessed){if(this.draw)for(var b in this.draw){var c=this.draw[b];"object"!==("undefined"==typeof c?"undefined":h(c))||Array.isArray(c)?null==a[b]&&(a[b]=c):a[b]=z.default({},c,a[b])}if(a=this._preprocess(a),!a)return;a.preprocessed=!0}return a},_preprocess:function(a){return a},parseOrder:function(a,b){return"number"!=typeof a?i.StyleParser.calculateOrder(a,b):a},scaleOrder:function(a){return 2*a},parseColor:function(a,b){return a?i.StyleParser.evalCachedColorProperty(a,b):this.shaders.blocks.color||this.shaders.blocks.filter?i.StyleParser.defaults.color:void 0},buildPolygons:function(){return 0},buildLines:function(){return 0},buildPoints:function(){return 0},setGL:function(a){this.gl=a,this.max_texture_size=q.default.getMaxTextureSize(this.gl)},makeMesh:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=this.vertexLayoutForMeshVariant(c.variant);return new o.default(this.gl,a,b,d,c)},render:function(a){return a.render()},getProgram:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"program";this.compileSetup();var b=this[a];if(b&&!b.error){if(!b.compiled){x.default("debug","Compiling style '"+this.name+"', program key '"+a+"'");try{b.compile()}catch(b){x.default("error","Style: error compiling program for style '"+this.name+"' (program key '"+a+"')",this,b.stack)}}return b}},compileSetup:function(){if(!this.compile_setup){if(!this.gl)throw new Error("style.compile(): skipping for "+this.name+" because no GL context");var a=this.buildDefineList();if(this.selection){var b=Object.assign({},a);b.TANGRAM_FEATURE_SELECTION=!0}var c=this.shaders&&this.shaders.blocks,d=this.shaders&&this.shaders.block_scopes,e=Object.assign({},this.shaders&&this.shaders.uniforms);for(var f in e)null==e[f]&&x.default({level:"warn",once:!0},"Style '"+this.name+"' has invalid uniform '"+f+"': uniform values must be non-null");var g=this.shaders&&this.shaders.extensions;"string"==typeof g&&(g=[g]),this.program=new m.default(this.gl,this.vertex_shader_src,this.fragment_shader_src,{name:this.name,defines:a,uniforms:e,blocks:c,block_scopes:d,extensions:g}),this.selection_program=this.selection?new m.default(this.gl,this.vertex_shader_src,G,{name:this.name+" (selection)",defines:b,uniforms:e,blocks:c,block_scopes:d,extensions:g}):null,this.compile_setup=!0}},addShaderBlock:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.shaders.blocks=this.shaders.blocks||{},this.shaders.blocks[a]=this.shaders.blocks[a]||[],this.shaders.blocks[a].push(b),this.shaders.block_scopes=this.shaders.block_scopes||{},this.shaders.block_scopes[a]=this.shaders.block_scopes[a]||[],this.shaders.block_scopes[a].push(c)},removeShaderBlock:function(a){this.shaders.blocks&&(this.shaders.blocks[a]=null)},replaceShaderBlock:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.removeShaderBlock(a),this.addShaderBlock(a,b,c)},buildDefineList:function(){var a={};if(null!=this.defines)for(var b in this.defines)a[b]=this.defines[b];if(null!=this.shaders&&null!=this.shaders.defines)for(b in this.shaders.defines)a[b]=this.shaders.defines[b];return a},hasRasters:function(){return["color","normal","custom"].indexOf(this.raster)>-1},setupRasters:function(){var a=this;if(this.hasRasters()){"color"===this.raster?this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0:"normal"===this.raster&&(this.defines.TANGRAM_RASTER_TEXTURE_NORMAL=!0);var b=Object.keys(this.sources).filter(function(b){return a.sources[b]instanceof v.RasterTileSource}).length;this.defines.TANGRAM_NUM_RASTER_SOURCES=""+b,b>0&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",H,"Raster"))}},buildRasterTextures:function(a,b){var c=this;if(!this.hasRasters())return Promise.resolve(b);var d={},e={};return a.rasters.map(function(a){return c.sources[a]}).filter(function(a){return a}).forEach(function(b,c){if(b instanceof v.RasterTileSource){var f=b.tileTexture(a);d[f.url]=f,e[f.url]=c}}),0===Object.keys(d).length?Promise.resolve(b):D.default.postMessage(this.main_thread_target+".loadTextures",d).then(function(c){if(!c||c.length<1)return b;b.uniforms=b.uniforms||{},b.textures=b.textures||[];var f=b.uniforms.u_rasters=[],h=b.uniforms.u_raster_sizes=[],i=b.uniforms.u_raster_offsets=[];return c.forEach(function(c){var j=g(c,3),k=j[0],l=j[1],m=j[2],n=e[k],o=d[k].coords;if(f[n]=k,b.textures.push(k),h[n]=[l,m],a.coords.z>o.z){var p=a.coords.z-o.z,q=Math.pow(2,p);i[n]=[(a.coords.x%q+q)%q/q,(q-1-a.coords.y%q)/q,1/q]}else i[n]=[0,0,1]}),b})},loadTextures:function(a){return q.default.createFromObject(this.gl,a).then(function(){return Promise.all(Object.keys(a).map(function(a){return q.default.textures[a]&&q.default.textures[a].load()}).filter(function(a){return a}))}).then(function(a){return a.forEach(function(a){return a.retain()}),a.map(function(a){return[a.name,a.width,a.height]})})},setup:function(){this.setUniforms(),this.material.setupProgram(m.default.current)},setUniforms:function(){var a=m.default.current;a&&a.setUniforms(this.shaders&&this.shaders.uniforms,!0)},render_states:{opaque:{depth_test:!0,depth_write:!0},add:{depth_test:!0,depth_write:!1},multiply:{depth_test:!0,depth_write:!1},inlay:{depth_test:!0,depth_write:!1},overlay:{depth_test:!1,depth_write:!1}},default_blend_orders:{opaque:0,add:1,multiply:2,inlay:3,overlay:4},blendOrderSort:function(a,b){return"opaque"===a.blend||"opaque"===b.blend?"opaque"===a.blend&&"opaque"===b.blend?a.name<b.name?-1:1:"opaque"===a.blend?-1:1:a.blend_order<b.blend_order?-1:a.blend_order>b.blend_order?1:I.default_blend_orders[a.blend]<I.default_blend_orders[b.blend]?-1:I.default_blend_orders[a.blend]>I.default_blend_orders[b.blend]?1:a.name<b.name?-1:1}}},{"../gl/shader_program":207,"../gl/texture":208,"../gl/vbo_mesh":210,"../light":223,"../material":224,"../selection":230,"../sources/raster":234,"../utils/debug_settings":255,"../utils/log":259,"../utils/merge":261,"../utils/thread":267,"../utils/worker_broker":271,"./style_parser":245}],244:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0}),c.StyleManager=void 0;var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../gl/shader_program"),i=d(h),j=a("../utils/merge"),k=d(j),l=a("../geo"),m=d(l),n=a("../utils/log"),o=d(n),p=a("./polygons/polygons"),q=a("./lines/lines"),r=a("./points/points"),s=a("./text/text"),t=a("./raster/raster"),u="#ifdef TANGRAM_VERTEX_SHADER\n\n// Vertex position in model space: [0, 1] range over the local tile\n// Note positions can be outside that range due to unclipped geometry, geometry higher than a unit cube, etc.\nvec4 modelPosition() {\n    return\n        vec4(\n            a_position.xyz / TANGRAM_TILE_SCALE         // scale coords to ~0-1 range\n            * exp2(u_tile_origin.z - u_tile_origin.w),  // adjust for tile overzooming\n        1.)\n        + vec4(0., 1., 0., 0.);\n        // NB: additional offset to account for unusual Tangram JS y coords,\n        // should be refactored to remove\n}\n\n// Position in model space as above, but according to tile coordinate (as opposed to style) zoom\n// e.g. unadjusted for tile overzooming\nvec4 modelPositionBaseZoom() {\n    return\n        vec4(\n            a_position.xyz / TANGRAM_TILE_SCALE,    // scale coords to ~0-1 range\n        1.)\n        + vec4(0., 1., 0., 0.); // see note on offset above\n}\n\n#endif\n\n// Vertex position in world coordinates, useful for 3d procedural textures, etc.\nvec4 worldPosition() {\n    return v_world_position;\n}\n\n// Optionally wrap world coordinates (allows more precision at higher zooms)\n// e.g. at wrap 1000, the world space will wrap every 1000 meters\n#ifdef TANGRAM_VERTEX_SHADER\n\nvec4 wrapWorldPosition(vec4 world_position) {\n    #if defined(TANGRAM_WORLD_POSITION_WRAP)\n    vec2 anchor = u_tile_origin.xy - mod(u_tile_origin.xy, TANGRAM_WORLD_POSITION_WRAP);\n        world_position.xy -= anchor;\n    #endif\n    return world_position;\n}\n\n#endif\n\n// Normal in world space\n#if defined(TANGRAM_VERTEX_SHADER)\n\nvec3 worldNormal() {\n    return TANGRAM_NORMAL;\n}\n\n#elif defined(TANGRAM_FRAGMENT_SHADER)\n\nvec3 worldNormal() {\n    return u_inverseNormalMatrix * TANGRAM_NORMAL;\n}\n\n#endif\n",v="// Apply layer ordering to avoid z-fighting\nvoid applyLayerOrder (float layer, inout vec4 position) {\n    position.z -= layer * TANGRAM_LAYER_DELTA * position.w;\n}\n",w="// Vertex attribute + varying for feature selection\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\n    attribute vec4 a_selection_color;\n    varying vec4 v_selection_color;\n#endif\n",x="// Selection pass-specific rendering\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\n    if (a_selection_color.rgb == vec3(0.)) {\n        // Discard by forcing invalid triangle if we're in the feature\n        // selection pass but have no selection info\n        // TODO: in some cases we may actually want non-selectable features to occlude selectable ones?\n        gl_Position = vec4(0., 0., 0., 1.);\n        return;\n    }\n    v_selection_color = a_selection_color;\n#endif\n";c.StyleManager=function(){function a(){f(this,a),this.styles={},this.base_styles={},this.register(Object.create(p.Polygons)),this.register(Object.create(q.Lines)),this.register(Object.create(r.Points)),this.register(Object.create(s.TextStyle)),this.register(Object.create(t.RasterStyle))}return g(a,[{key:"init",value:function(){i.default.removeBlock("global"),i.default.removeBlock("setup"),i.default.addBlock("global",u),i.default.addBlock("global",v),i.default.addBlock("global",w),i.default.replaceBlock("setup",x),i.default.defines.TANGRAM_EPSILON=1e-5,i.default.defines.TANGRAM_LAYER_DELTA=1/16384,i.default.defines.TANGRAM_TILE_SCALE="vec3("+m.default.tile_scale+"., "+m.default.tile_scale+"., u_meters_per_pixel * "+m.default.tile_size+".)",i.default.defines.TANGRAM_HEIGHT_SCALE=m.default.height_scale,i.default.defines.TANGRAM_ALPHA_TEST=.5}},{key:"destroy",value:function(a){var b=this;Object.keys(this.styles).forEach(function(c){var d=b.styles[c];d.gl===a&&(o.default("trace","StyleManager.destroy: destroying render style "+d.name),d.base&&b.remove(d.name),d.destroy())})}},{key:"register",value:function(a){this.styles[a.name]=a,this.base_styles[a.name]=a}},{key:"remove",value:function(a){delete this.styles[a]}},{key:"mix",value:function(a,b){if(a.mixed)return a;a.mixed={};var c=[];if(a.mix){if(Array.isArray(a.mix)){var d;(d=c).push.apply(d,e(a.mix))}else c.push(a.mix);c=c.map(function(a){return b[a]}).filter(function(b){return b&&b!==a}),c.forEach(function(b){return a.mixed[b.name]=!0})}c.push(a),a.animated=c.some(function(a){return a&&a.animated}),a.texcoords=c.some(function(a){return a&&a.texcoords}),a.base=c.map(function(a){return a.base}).filter(function(a){return a}).pop(),a.lighting=c.map(function(a){return a.lighting}).filter(function(a){return null!=a}).pop(),a.texture=c.map(function(a){return a.texture}).filter(function(a){return a}).pop(),a.raster=c.map(function(a){return a.raster}).filter(function(a){return null!=a}).pop(),a.dash=c.map(function(a){return a.dash}).filter(function(a){return null!=a}).pop(),a.dash_background_color=c.map(function(a){return a.dash_background_color}).filter(function(a){return null!=a}).pop(),c.some(function(a){return a.hasOwnProperty("blend")&&a.blend})&&(a.blend=c.map(function(a){return a.hasOwnProperty("blend")&&a.blend}).filter(function(a){return a}).pop()),a.blend_order=c.map(function(a){return a.blend_order}).filter(function(a){return null!=a}).pop(),a.defines=Object.assign.apply(Object,[{}].concat(e(c.map(function(a){return a.defines}).filter(function(a){return a})))),a.material=Object.assign.apply(Object,[{}].concat(e(c.map(function(a){return a.material}).filter(function(a){return a}))));var f=c.map(function(a){return a.draw}).filter(function(a){return a});return f.length>0&&(a.draw=k.default.apply(void 0,[{}].concat(e(f)))),this.mixShaders(a,b,c),a}},{key:"mixShaders",value:function(a,b,c){var d={},f=c.map(function(a){return a.shaders}).filter(function(a){return a});if(d.defines=Object.assign.apply(Object,[{}].concat(e(f.map(function(a){return a.defines}).filter(function(a){return a})))),d.uniforms={},d._uniforms=a.shaders&&a.shaders.uniforms||{},d._uniform_scopes={},c.filter(function(a){return a.shaders&&a.shaders.uniforms;
}).forEach(function(a){var c=function(c){d._uniform_scopes[c]=a.name,Object.defineProperty(d.uniforms,c,{enumerable:!0,configurable:!0,get:function(){return void 0!==d._uniforms[c]?d._uniforms[c]:b[d._uniform_scopes[c]].shaders.uniforms!==d.uniforms?b[d._uniform_scopes[c]].shaders.uniforms[c]:void 0},set:function(a){d._uniforms[c]=a}})};for(var e in a.shaders.uniforms)c(e)}),d.extensions=Object.keys(f.map(function(a){return a.extensions}).filter(function(a){return a}).reduce(function(a,b){return"string"==typeof b?a[b]=!0:b.forEach(function(b){return a[b]=!0}),a},{})||{}),a.shaders&&a.shaders.blocks){a.shaders.block_scopes=a.shaders.block_scopes||{};for(var g in a.shaders.blocks){var h=a.shaders.blocks[g];if(a.shaders.block_scopes[g]=a.shaders.block_scopes[g]||[],Array.isArray(h)){var i;(i=a.shaders.block_scopes[g]).push.apply(i,e(h.map(function(){return a.name})))}else a.shaders.block_scopes[g].push(a.name)}}var j={};return f.forEach(function(a){if(a.blocks){d.blocks=d.blocks||{},d.block_scopes=d.block_scopes||{};var b={};for(var c in a.blocks){var e=a.blocks[c],f=a.block_scopes[c];d.blocks[c]=d.blocks[c]||[],d.block_scopes[c]=d.block_scopes[c]||[],e=Array.isArray(e)?e:[e],f=Array.isArray(f)?f:[f];for(var g=0;g<e.length;g++)j[f[g]]||(b[f[g]]=!0,d.blocks[c].push(e[g]),d.block_scopes[c].push(f[g]))}Object.assign(j,b)}}),Object.assign(a.mixed,j),a.shaders=d,a}},{key:"create",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=k.default({},b);return d.name=a,d=this.mix(d,c),d.base&&this.base_styles[d.base]?this.styles[a]=d=Object.assign(Object.create(this.base_styles[d.base]),d):d.base=null,d}},{key:"build",value:function(a){var b=this,c=Object.keys(a).sort(function(c,d){return b.inheritanceDepth(c,a)-b.inheritanceDepth(d,a)});for(var d in this.styles)this.base_styles[d]?this.styles[d].reset():delete this.styles[d];var e={};return c.forEach(function(c){e[c]=b.create(c,a[c],e)}),this.styles}},{key:"initStyles",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var b in this.styles)this.styles[b].init(a)}},{key:"inheritanceDepth",value:function(a,b){for(var c=this,d=0;;){var f=b[a];if(!f)break;if(!f.mix)break;if(d++,Array.isArray(f.mix)){d+=Math.max.apply(Math,e(f.mix.map(function(d){return a!==d?c.inheritanceDepth(d,b):void 0})));break}if(a===f.mix)break;a=f.mix}return d}}]),a}()},{"../geo":201,"../gl/shader_program":207,"../utils/log":259,"../utils/merge":261,"./lines/lines":239,"./points/points":240,"./polygons/polygons":241,"./raster/raster":242,"./text/text":248}],245:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.StyleParser=void 0;var e=a("../utils/utils"),f=d(e),g=a("../geo"),h=d(g),i=a("csscolorparser"),j=d(i),k=c.StyleParser={};k.wrapFunction=function(a){var b="\n        var feature = context.feature.properties;\n        var global = context.global;\n        var $zoom = context.zoom;\n        var $layer = context.layer;\n        var $source = context.source;\n        var $geometry = context.geometry;\n        var $meters_per_pixel = context.meters_per_pixel;\n\n        var val = (function(){ "+a+" }());\n\n        if (typeof val === 'number' && isNaN(val)) {\n            val = null; // convert NaNs to nulls\n        }\n\n        return val;\n    ";return b},k.zeroPair=Object.freeze([0,0]),k.defaults={color:[1,1,1,1],width:1,size:1,extrude:!1,height:20,min_height:0,order:0,z:0,outline:{color:[0,0,0,0],width:0},material:{ambient:1,diffuse:1}},k.macros={"Style.color.pseudoRandomColor":function(){return[.7*(parseInt(feature.id,16)/100%1),.7*(parseInt(feature.id,16)/1e4%1),.7*(parseInt(feature.id,16)/1e6%1),1]},"Style.color.randomColor":function(){return[.7*Math.random(),.7*Math.random(),.7*Math.random(),1]}},k.getFeatureParseContext=function(a,b,c){return{feature:a,tile:b,global:c,zoom:b.style_zoom,geometry:h.default.geometryType(a.geometry.type),meters_per_pixel:b.meters_per_pixel,meters_per_pixel_sq:b.meters_per_pixel_sq,units_per_meter_overzoom:b.units_per_meter_overzoom}},k.createPropertyCache=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=a){if(a.value)return{value:a.value,zoom:a.zoom?{}:null};var c={value:a};return Array.isArray(c.value)&&Array.isArray(c.value[0])&&(c.zoom={}),"function"==typeof b&&(c.zoom?c.value=c.value.map(function(a){return[a[0],b(a[1])]}):"function"!=typeof c.value&&(c.value=b(c.value))),c}},k.createColorPropertyCache=function(a){return k.createPropertyCache(a,function(a){return"Style.color.pseudoRandomColor"===a?f.default.stringToFunction(k.wrapFunction(k.macros["Style.color.pseudoRandomColor"])):"Style.color.randomColor"===a?k.macros["Style.color.randomColor"]:a})},k.evalCachedProperty=function(a,b){if(null!=a){if(a.dynamic){var c=a.dynamic(b);return c}if(a.static)return a.static;if(a.zoom&&a.zoom[b.zoom])return a.zoom[b.zoom];if("function"==typeof a.value){a.dynamic=a.value;var d=a.dynamic(b);return d}return Array.isArray(a.value)&&Array.isArray(a.value[0])?(a.zoom=a.zoom||{},a.zoom={},a.zoom[b.zoom]=f.default.interpolate(b.zoom,a.value),a.zoom[b.zoom]):(a.static=a.value,a.static)}},k.convertUnits=function(a,b){if(null!=a.val)return"px"===a.units?a.val*h.default.metersPerPixel(b.zoom):a.val;if("string"==typeof a)"px"===a.trim().slice(-2)?(a=parseFloat(a),a*=h.default.metersPerPixel(b.zoom)):a=parseFloat(a);else if(Array.isArray(a))return a.map(Array.isArray(a[0])?function(a){return[a[0],k.convertUnits(a[1],b)]}:function(a){return k.convertUnits(a,b)});return a},k.parseUnits=function(a){var b={val:parseFloat(a)};return 0!==b.val&&"string"==typeof a&&"px"===a.trim().slice(-2)&&(b.units="px"),b},k.evalCachedDistanceProperty=function(a,b){if(a.dynamic){var c=a.dynamic(b);return c}if(a.zoom&&a.zoom[b.zoom])return a.zoom[b.zoom];if("function"==typeof a.value){a.dynamic=a.value;var d=a.dynamic(b);return d}return a.zoom?(a.zoom[b.zoom]=f.default.interpolate(b.zoom,a.value,function(a){return k.convertUnits(a,b)}),a.zoom[b.zoom]):k.convertUnits(a.value,b)},k.string_colors={},k.colorForString=function(a){if(k.string_colors[a])return k.string_colors[a];var b=j.default.parseCSSColor(a);return b&&4===b.length?(b[0]/=255,b[1]/=255,b[2]/=255):b=k.defaults.color,k.string_colors[a]=b,b},k.evalCachedColorProperty=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a.dynamic){var c=a.dynamic(b);return"string"==typeof c&&(c=k.colorForString(c)),c&&null==c[3]&&(c[3]=1),c}if(a.static)return a.static;if(a.zoom&&a.zoom[b.zoom])return a.zoom[b.zoom];if("function"==typeof a.value){a.dynamic=a.value;var d=a.dynamic(b);return"string"==typeof d&&(d=k.colorForString(d)),d&&null==d[3]&&(d[3]=1),d}if("string"==typeof a.value)return a.static=k.colorForString(a.value),a.static;if(a.zoom){if(!a.zoom_preprocessed){for(var e=0;e<a.value.length;e++){var g=a.value[e];g&&"string"==typeof g[1]&&(g[1]=k.colorForString(g[1]))}a.zoom_preprocessed=!0}return a.zoom[b.zoom]=f.default.interpolate(b.zoom,a.value),a.zoom[b.zoom][3]=a.zoom[b.zoom][3]||1,a.zoom[b.zoom]}return a.static=a.value.map(function(a){return a}),a.static&&null==a.static[3]&&(a.static[3]=1),a.static},k.parseColor=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"==typeof a&&(a=a(b)),"string"==typeof a)a=k.colorForString(a);else if(Array.isArray(a)&&Array.isArray(a[0])){for(var c=0;c<a.length;c++){var d=a[c];"string"==typeof d[1]&&(d[1]=k.colorForString(d[1]))}b.zoom&&(a=f.default.interpolate(b.zoom,a))}return Array.isArray(a)?(a=a.map(function(a){return a}),null==a[3]&&(a[3]=1)):a=[0,0,0,1],a},k.calculateOrder=function(a,b){return"function"==typeof a?a=a(b):"string"==typeof a&&(a=b.feature.properties[a]?b.feature.properties[a]:parseFloat(a)),a},k.evalProperty=function(a,b){return"function"==typeof a?a(b):a}},{"../geo":201,"../utils/utils":269,csscolorparser:71}],246:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a){return z.test(a)}function h(a){return B.test(a)}function i(a){return L.test(a)}function j(a,b){var c=b?1:M;if(a.length<c)return[a];var d=a;if(y.cache.segment[d])return y.cache.stats.segment_hits++,y.cache.segment[d];var e=[];if(D.exec(a)){e=a.split(E);for(var f=-1,g=0;g<e.length-1;g++){if(g>0){var h=F.exec(e[g]);h&&(e[g]=e[g].substring(h[0].length),e[g-1]+=h[0],f+=h[0].length)}f+=1+e[g].length,e[g]+=a.slice(f,f+1)}a=""}for(;a.length;){var i="",j=a,k=0;for(k;c>k&&j.length;k++){var l=(I.exec(j)||j)[0];i+=l,j=j.substring(l.length)}e.push(i),a=a.substring(i.length)}return b&&e.reverse(),y.cache.stats.segment_misses++,y.cache.segment[d]=e,e}Object.defineProperty(c,"__esModule",{value:!0});var k=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m=a("../../utils/log"),n=d(m),o=a("../../utils/utils"),p=d(o),q=a("../../gl/texture"),r=d(q),s=a("./font_manager"),t=d(s),u=a("../../utils/task"),v=d(u),w=a("../../utils/debug_settings"),x=d(w),y=function(){function a(){f(this,a),this.createCanvas(),this.vertical_text_buffer=8,this.horizontal_text_buffer=4}return l(a,[{key:"createCanvas",value:function(){this.canvas=document.createElement("canvas"),this.canvas.style.backgroundColor="transparent",this.context=this.canvas.getContext("2d")}},{key:"resize",value:function(a,b){this.canvas.width=a,this.canvas.height=b,this.context.clearRect(0,0,a,b)}},{key:"setFont",value:function(a){var b=a.font_css,c=a.fill,d=a.stroke,e=a.stroke_width,f=a.px_size,g=a.supersample;this.px_size=f;var h=this.context,i=p.default.device_pixel_ratio*g;d&&e>0&&(h.strokeStyle=d,h.lineWidth=e*i),h.fillStyle=c,h.font=b,h.miterLimit=2}},{key:"textSizes",value:function(a,b){var c=this;return t.default.loadFonts().then(function(){return v.default.add({type:"textSizes",target:c,method:"processTextSizesTask",texts:b,tile_id:a,cursor:{styles:Object.keys(b),texts:null,style_idx:null,text_idx:null}})})}},{key:"processTextSizesTask",value:function(a){var b=a.cursor,c=a.texts;for(b.style_idx=b.style_idx||0;b.style_idx<b.styles.length;){var d=b.styles[b.style_idx];null==b.text_idx&&(b.text_idx=0,b.texts=Object.keys(c[d]));for(var e=c[d],f=!0;b.text_idx<b.texts.length;){var k=b.texts[b.text_idx],l=e[k],m=l.text_settings;if(f&&(this.setFont(m),f=!1),l.size=this.textSize(d,k,m).size,m.can_articulate){var n=!1,o=!1;if(g(k)&&(h(k)?n=!0:o=!0),l.isRTL=n,l.no_curving=o||i(k),l.vertical_buffer=this.vertical_text_buffer,l.segment_sizes=[],!l.no_curving){var p=j(k,n);l.segments=p;for(var q=0;q<p.length;q++)l.segment_sizes.push(this.textSize(d,p[q],m).size)}}if(b.text_idx++,!v.default.shouldContinue(a))return!1}b.text_idx=null,b.style_idx++}return v.default.finish(a,{texts:c}),!0}},{key:"textSize",value:function(b,c,d){var e=d.transform,f=d.text_wrap,g=d.max_lines,h=d.stroke_width,i=void 0===h?0:h,j=d.supersample;if(a.cache.text[b]=a.cache.text[b]||{},a.cache.text[b][c])return a.cache.stats.text_hits++,a.cache.text[b][c];a.cache.stats.text_misses++,a.cache.text_count++;var k=p.default.device_pixel_ratio*j,l=this.applyTextTransform(c,e),m=this.context,n=this.vertical_text_buffer*k,o=k*(i+this.horizontal_text_buffer),q=2*k,r=this.px_size+q,s=N.parse(l,f,g,r,m),t=s.height,u=s.width,v=s.lines,w=[u/k,t/k],x=[u+2*o,t+2*n],y=[x[0]/k,x[1]/k];return a.cache.text[b][c]={lines:v,size:{collision_size:w,texture_size:x,logical_size:y,line_height:r}},a.cache.text[b][c]}},{key:"drawTextMultiLine",value:function(a,b,c,d,e){for(var f=k(b,2),g=f[0],h=f[1],i=d.stroke,j=d.stroke_width,l=void 0===j?0:j,m=d.transform,n=d.align,o=d.supersample,q=c.line_height,r=h,s=0;s<a.length;s++){var t=a[s];this.drawTextLine(t,[g,r],c,{stroke:i,stroke_width:l,transform:m,align:n,supersample:o},e),r+=q}if(x.default.draw_label_collision_boxes){this.context.save();var u=p.default.device_pixel_ratio*o,v=u*(this.horizontal_text_buffer+l),w=u*this.vertical_text_buffer,y=c.collision_size,z=2;this.context.strokeStyle="blue",this.context.lineWidth=z,this.context.strokeRect(g+v,h+w,u*y[0],u*y[1]),"curved"===e&&this.context.strokeRect(g+c.texture_size[0]+v,h+w,u*y[0],u*y[1]),this.context.restore()}if(x.default.draw_label_texture_boxes){this.context.save();var A=c.texture_size,B=2;this.context.strokeStyle="green",this.context.lineWidth=B,this.context.strokeRect(g+B,h+B,A[0]-2*B,A[1]-2*B),"curved"===e&&this.context.strokeRect(g+B+c.texture_size[0],h+B,A[0]-2*B,A[1]-2*B),this.context.restore()}}},{key:"drawTextLine",value:function(a,b,c,d,e){var f=k(b,2),g=f[0],h=f[1],i=d.stroke,j=d.stroke_width,l=void 0===j?0:j,m=d.transform,n=d.align,o=d.supersample,q=p.default.device_pixel_ratio*o;n=n||"center";var r=this.vertical_text_buffer*q,s=c.texture_size,t=c.line_height,u=q*(l+this.horizontal_text_buffer),v=this.applyTextTransform(a.text,m),w=void 0;"left"===n?w=g+u:"center"===n?w=g+s[0]/2-a.width/2:"right"===n&&(w=g+s[0]-a.width-u);var x=h+.75*r+t;if(i&&l>0){var y="curved"===e?s[0]:0;this.context.strokeText(v,w+y,x)}this.context.fillText(v,w,x)}},{key:"rasterize",value:function(a,b,c,d,e){return v.default.add({type:"rasterizeLabels",target:this,method:"processRasterizeTask",cancel:"cancelRasterizeTask",pause_factor:2,user_moving_view:!1,texts:a,textures:b,texture_prefix:d,gl:e,tile_id:c,cursor:{styles:Object.keys(a),texts:null,style_idx:0,text_idx:null,texture_idx:0,texture_resize:!0,texture_names:[]}})}},{key:"processRasterizeTask",value:function(a){for(var b=a.cursor,c=a.texts,d=a.textures,f=void 0;b.texture_idx<a.textures.length;){for(f=d[b.texture_idx],b.texture_resize&&(b.texture_resize=!1,this.resize.apply(this,e(f.texture_size)));b.style_idx<b.styles.length;){var g=b.styles[b.style_idx];null==b.text_idx&&(b.text_idx=0,b.texts=Object.keys(c[g]));for(var h=c[g],i=!0;b.text_idx<b.texts.length;){var j=b.texts[b.text_idx],k=h[j],l=k.text_settings;if(i&&(this.setFont(l),i=!1),l.can_articulate){k.texcoords=k.texcoords||{};for(var m=0;m<k.type.length;m++){var n=k.type[m];switch(n){case"straight":if(k.textures[m]!==b.texture_idx)continue;var o=k.isRTL?j.split().reverse().join():j,p=f.texcoord_cache[g][o],q=void 0;if(p.texcoord)q=p.texcoord;else{var s=p.texture_position,t=this.textSize(g,o,l),u=t.size,w=t.lines;this.drawTextMultiLine(w,s,u,l,n),q=r.default.getTexcoordsForSprite(s,u.texture_size,f.texture_size),p.texcoord=q}k.texcoords[n]={texcoord:q,texture_id:p.texture_id};break;case"curved":var x=k.segments;k.texcoords.curved=k.texcoords.curved||[],k.texcoords_stroke=k.texcoords_stroke||[];for(var y=0;y<x.length;y++)if(k.textures[m][y]===b.texture_idx){var z=x[y],A=f.texcoord_cache[g][z],B=void 0,C=void 0;if(A.texcoord)B=A.texcoord,C=A.texcoord_stroke,k.texcoords_stroke.push(C);else{var D=A.texture_position,E=this.textSize(g,z,l),F=E.size,G=E.lines;this.drawTextMultiLine(G,D,F,l,n),B=r.default.getTexcoordsForSprite(D,F.texture_size,f.texture_size);var H=[D[0]+F.texture_size[0],D[1]];C=r.default.getTexcoordsForSprite(H,F.texture_size,f.texture_size),A.texcoord=B,A.texcoord_stroke=C,k.texcoords_stroke.push(C)}k.texcoords.curved.push({texcoord:B,texture_id:A.texture_id})}}}}else{var I=this.textSize(g,j,l).lines;for(var J in k.align)k.align[J].texture_id===b.texture_idx&&(this.drawTextMultiLine(I,k.align[J].texture_position,k.size,{stroke:l.stroke,stroke_width:l.stroke_width,transform:l.transform,supersample:l.supersample,align:J}),k.align[J].texcoords=r.default.getTexcoordsForSprite(k.align[J].texture_position,k.size.texture_size,f.texture_size))}if(b.text_idx++,!v.default.shouldContinue(a))return!1}b.text_idx=null,b.style_idx++}var K=a.texture_prefix+b.texture_idx;r.default.create(a.gl,K,{element:this.canvas,filtering:"linear",UNPACK_PREMULTIPLY_ALPHA_WEBGL:!0}),r.default.retain(K),b.texture_names.push(K),b.texture_idx++,b.texture_resize=!0,b.style_idx=0}return v.default.finish(a,{textures:b.texture_names}),!0}},{key:"cancelRasterizeTask",value:function(a){n.default("trace","RasterizeTask: release textures ["+a.cursor.texture_names.join(", ")+"]"),a.cursor.texture_names.forEach(function(a){return r.default.release(a)})}},{key:"setTextureTextPositions",value:function(a,b){var c={cx:0,cy:0,width:0,height:0,column_width:0,texture_id:0,texcoord_cache:{}},d=[];for(var e in a){var f=a[e];for(var g in f){var h=f[g],i=void 0;if(h.text_settings.can_articulate){h.textures=[],c.texcoord_cache[e]=c.texcoord_cache[e]||{};for(var j=0;j<h.type.length;j++){var k=h.type[j];switch(k){case"straight":var l=h.isRTL?g.split().reverse().join():g;if(!c.texcoord_cache[e][l]){var m=h.size.texture_size;i=this.placeText(m[0],m[1],e,c,d,b),c.texcoord_cache[e][l]={texture_id:c.texture_id,texture_position:i}}h.textures[j]=c.texture_id;break;case"curved":h.textures[j]=[];for(var n=0;n<h.segment_sizes.length;n++){var o=h.segments[n];if(!c.texcoord_cache[e][o]){var p=h.segment_sizes[n].texture_size,q=2*p[0];i=this.placeText(q,p[1],e,c,d,b),c.texcoord_cache[e][o]={texture_id:c.texture_id,texture_position:i}}h.textures[j].push(c.texture_id)}}}}else{var r=h.size.texture_size;for(var s in h.align)i=this.placeText(r[0],r[1],e,c,d,b),h.align[s].texture_id=c.texture_id,h.align[s].texture_position=i}}}return c.column_width>0&&c.height>0&&(d[c.texture_id]={texture_size:[c.width,c.height],texcoord_cache:c.texcoord_cache}),Promise.resolve({textures:d})}},{key:"placeText",value:function(a,b,c,d,e,f){var g=void 0;return d.cy+b>f?(d.cx+=d.column_width,d.cy=0,d.column_width=a):d.column_width=Math.max(d.column_width,a),d.cx+d.column_width<=f?(g=[d.cx,d.cy],d.cy+=b,d.height=Math.max(d.height,d.cy),d.width=Math.max(d.width,d.cx+d.column_width)):(e[d.texture_id]={texture_size:[d.width,d.height],texcoord_cache:d.texcoord_cache},d.texcoord_cache={},d.texcoord_cache[c]={},d.texture_id++,d.cx=0,d.cy=b,d.column_width=a,d.width=a,d.height=b,g=[0,0]),g}},{key:"applyTextTransform",value:function(a,b){return"capitalize"===b?a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1)}):"uppercase"===b?a.toUpperCase():"lowercase"===b?a.toLowerCase():a}}],[{key:"fontPixelSize",value:function(b){if(null!=b){b="string"==typeof b?b:String(b);var c=b.match(a.font_size_re)||[],d=k(c,3),e=d[1],f=d[2];return f=f||"px","em"===f?e*=16:"pt"===f?e/=.75:"%"===f&&(e/=6.25),e=parseFloat(e),e*=p.default.device_pixel_ratio}}},{key:"pruneTextCache",value:function(){a.cache.text_count>a.cache.text_count_max&&(a.cache.text={},a.cache.text_count=0,n.default("debug","CanvasText: pruning text cache")),Object.keys(a.cache.segment).length>a.cache.segment_count_max&&(a.cache.segment={},n.default("debug","CanvasText: pruning segment cache"))}}]),a}();c.default=y,y.font_size_re=/((?:[0-9]*\.)?[0-9]+)\s*(px|pt|em|%)?/,y.cache={text:{},text_count:0,text_count_max:2e3,segment:{},segment_count_max:2e3,stats:{text_hits:0,text_misses:0,segment_hits:0,segment_misses:0}};var z=new RegExp("[---]"),A="\0-/:-@[-`{----\u2029-",B=new RegExp("["+A+"]+"),C="",D=new RegExp("^["+A+"-]+"),E=new RegExp("["+A+"-----]"),F=new RegExp("^[-----]+"),G="[------------------------------------------]",H="[]",I=new RegExp("^.(?:"+G+"+)?("+H+"\\W(?:"+G+"+)?)*"),J={Mongolian:"-"},K=Object.keys(J).map(function(a){return J[a]}).join(""),L=new RegExp("["+K+"]"),M=2,N=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;f(this,a),this.width=0,this.height=0,this.lines=[],this.max_lines=c,this.text_wrap=d,this.context=b}return l(a,[{key:"createLine",value:function(a){return this.lines.length<this.max_lines&&new O(a,this.text_wrap)}},{key:"push",value:function(a){if(this.lines.length<this.max_lines){var b=this.context.measureText(a.text).width;return a.width=b,b>this.width&&(this.width=Math.ceil(b)),this.lines.push(a),this.height+=a.height,!0}return this.addEllipsis(),!1}},{key:"advance",value:function(a,b){var c=this.push(a);return!!c&&this.createLine(b)}},{key:"addEllipsis",value:function(){var b=this.lines[this.lines.length-1],c=Math.ceil(this.context.measureText(a.ellipsis).width);b.append(a.ellipsis),b.width+=c,b.width>this.width&&(this.width=b.width)}},{key:"finish",value:function(a){a?this.push(a):this.addEllipsis()}}],[{key:"parse",value:function(b,c,d,e,f){var i=void 0;i="number"==typeof c?b.split(" "):[b];for(var j=new a(f,d,c),k=j.createLine(e),l=0;l<i.length;l++){for(var m=i[l].split("\n"),n=0===l,o=0;o<m.length&&k;o++){var p=m[o];g(p)&&h(p[p.length-1])&&(p+=C);var q=n?p:" "+p;if(c&&l>0&&k.exceedsTextwrap(q)){if(k=j.advance(k,e),!k)break;k.append(p),n=!0}else k.append(q);o<m.length-1&&(k=j.advance(k,e),n=!0)}l===i.length-1&&j.finish(k)}return j}}]),a}();N.ellipsis="...";var O=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,a),this.chars=0,this.text="",this.height=Math.ceil(b),this.text_wrap=c}return l(a,[{key:"append",value:function(a){this.chars+=a.length,this.text+=a}},{key:"exceedsTextwrap",value:function(a){return a.length+this.chars>this.text_wrap}}]),a}()},{"../../gl/texture":208,"../../utils/debug_settings":255,"../../utils/log":259,"../../utils/task":266,"../../utils/utils":269,"./font_manager":247}],247:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},f=a("../../utils/log"),g=d(f),h=a("../../utils/utils"),i=d(h),j=a("fontfaceobserver"),k=d(j),l={fonts_loaded:Promise.resolve(),last_loaded:null,loadFonts:function(a){var b=this,c=JSON.stringify(a)===this.last_loaded;return a&&!c&&!function(){var c=[],d=function(d){Array.isArray(a[d])?a[d].forEach(function(a){return c.push(b.loadFontFace(d,a))}):c.push(b.loadFontFace(d,a[d]))};for(var e in a)d(e);b.last_loaded=JSON.stringify(a),b.fonts_loaded=Promise.all(c.filter(function(a){return a}))}(),this.fonts_loaded},loadFontFace:function(a,b){if(null!=b&&("object"===("undefined"==typeof b?"undefined":e(b))||"external"===b)){var c={family:a},d=Promise.resolve();"object"===("undefined"==typeof b?"undefined":e(b))&&(Object.assign(c,b),"string"==typeof b.url&&(d=this.injectFontFace(c)));var f=new k.default(a,c);return d.then(function(){return f.load()}).then(function(){g.default("debug","Font face '"+a+"' is available",c)},function(){g.default("debug","Font face '"+a+"' is NOT available",c)})}},injectFontFace:function(a){var b=this,c=a.family,d=a.url,e=a.weight,f=a.style;void 0===this.supports_native_font_loading&&(this.supports_native_font_loading=void 0!==window.FontFace);var h=Promise.resolve(d);return"blob:"===d.slice(0,5)&&(h=i.default.io(d,6e4,"arraybuffer").then(function(a){var c=new Uint8Array(a);if(b.supports_native_font_loading)return c;for(var d="",e=0;e<c.length;e++)d+=String.fromCharCode(c[e]);return"data:font/opentype;base64,"+btoa(d)})),h.then(function(a){if(b.supports_native_font_loading){var d=void 0;"string"==typeof a?d=new FontFace(c,"url("+encodeURI(a)+")",{weight:e,style:f}):a instanceof Uint8Array&&(d=new FontFace(c,a,{weight:e,style:f})),document.fonts.add(d),g.default("trace","Adding FontFace to document.fonts:",d)}else{var h="\n                    @font-face {\n                        font-family: '"+c+"';\n                        font-weight: "+(e||"normal")+";\n                        font-style: "+(f||"normal")+";\n                        src: url("+encodeURI(a)+");\n                    }\n                ",i=document.createElement("style");i.appendChild(document.createTextNode("")),document.head.appendChild(i),i.sheet.insertRule(h,0),g.default("trace","Injecting CSS font face:",h)}})}};c.default=l},{"../../utils/log":259,"../../utils/utils":269,fontfaceobserver:74}],248:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}Object.defineProperty(c,"__esModule",{value:!0}),c.TextStyle=void 0;var f=a("../../geo"),g=d(f),h=a("../style"),i=a("../points/points"),j=a("../../labels/collision"),k=d(j),l=a("../../labels/label_point"),m=d(l),n=a("../../labels/label_line"),o=d(n),p=a("../../gl/constants"),q=d(p),r=c.TextStyle=Object.create(i.Points);Object.assign(r,{name:"text",super:i.Points,built_in:!0,init:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=[{name:"a_angles",size:4,type:q.default.SHORT,normalized:!1},{name:"a_offsets",size:4,type:q.default.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles",size:4,type:q.default.BYTE,normalized:!1}];this.super.init.call(this,a,b),this.defines.TANGRAM_SHADER_POINT=!1,this.defines.TANGRAM_CURVED_LABEL=!0,this.defines.TANGRAM_FADE_ON_ZOOM_OUT=!0,this.defines.TANGRAM_FADE_ON_ZOOM_OUT_RATE=2,this.defines.TANGRAM_FADE_ON_ZOOM_IN=!0,this.defines.TANGRAM_FADE_ON_ZOOM_IN_RATE=2,this.reset()},makeVertexTemplate:function(a){return this.super.makeVertexTemplate.call(this,a),this.fillVertexTemplate("a_pre_angles",0,{size:4}),this.fillVertexTemplate("a_offsets",0,{size:4}),this.fillVertexTemplate("a_angles",0,{size:4}),this.vertex_template},reset:function(){this.queues={},this.resetText()},addFeature:function(a,b,c){var d=this,e=c.tile;if(e.generation===this.generation){var f=a.geometry.type;b.can_articulate="LineString"===f||"MultiLineString"===f,b.supersample_text="LineString"===f||"MultiLineString"===f;var g=this.parseTextFeature(a,b,c,e);g&&(g instanceof Array?g.forEach(function(b){b.feature=a,b.context=c,b.layout.vertex=!1,d.queueFeature(b,e)}):(g.feature=a,g.context=c,g.layout.vertex=!1,this.queueFeature(g,e)),k.default.addStyle(this.name,e.id))}},endData:function(a){var b=this,c=this.queues[a.id];return delete this.queues[a.id],this.collideAndRenderTextLabels(a,this.name,c).then(function(c){var d=c.labels,f=c.texts,g=c.textures;return d&&f&&(b.texts[a.id]=f,d.forEach(function(c){var d=c.text_settings_key,e=b.texts[a.id][d]&&b.texts[a.id][d][c.text],f=b.feature_style;f.label=c.label,e.text_settings.can_articulate?(f.size={},f.texcoords={},"straight"===c.label.type?(f.size.straight=e.size.logical_size,f.texcoords.straight=e.texcoords.straight,f.label_texture=g[e.texcoords.straight.texture_id]):(f.size.curved=e.segment_sizes.map(function(a){return a.logical_size}),f.texcoords_stroke=e.texcoords_stroke,f.texcoords.curved=e.texcoords.curved,f.label_textures=e.texcoords.curved.map(function(a){return g[a.texture_id]}))):(f.size=e.size.logical_size,f.texcoords=e.align[c.label.align].texcoords,f.label_texture=g[e.align[c.label.align].texture_id]),h.Style.addFeature.call(b,c.feature,c.draw,c.context)})),b.freeText(a),h.Style.endData.call(b,a).then(function(a){if(a){if(g&&g.length){var b;(b=a.textures).push.apply(b,e(g))}for(var c in a.meshes)a.meshes[c].uniforms.u_apply_color_blocks=!0}return a})})},_preprocess:function(a){return this.preprocessText(a)},buildTextLabels:function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=this.texts[a.id][e.text_settings_key][e.text],g=void 0;if(e.layout.vertical_buffer=f.vertical_buffer,f.text_settings.can_articulate){var h=f.segment_sizes.map(function(a){return a.collision_size});e.layout.no_curving=f.no_curving,g=this.buildLabels(h,e.feature.geometry,e.layout,f.size.collision_size)}else g=this.buildLabels(f.size.collision_size,e.feature.geometry,e.layout);for(var i=0;i<g.length;i++){var j=Object.create(e);j.label=g[i],c.push(j)}}return c},buildLabels:function(a,b,c,d){var e=[];if("LineString"===b.type)Array.prototype.push.apply(e,this.buildLineLabels(b.coordinates,a,c,d));else if("MultiLineString"===b.type)for(var f=b.coordinates,h=0;h<f.length;++h)Array.prototype.push.apply(e,this.buildLineLabels(f[h],a,c,d));else if("Point"===b.type)e.push(new m.default(b.coordinates,a,c));else if("MultiPoint"===b.type)for(var i=b.coordinates,j=0;j<i.length;++j)e.push(new m.default(i[j],a,c));else if("Polygon"===b.type){var k=g.default.centroid(b.coordinates);e.push(new m.default(k,a,c))}else if("MultiPolygon"===b.type){var l=g.default.multiCentroid(b.coordinates);e.push(new m.default(l,a,c))}return e},buildLineLabels:function(a,b,c,d){var e=[],f=Math.min(c.subdiv,a.length-1);if(f>1)for(var g=(a.length-1)/f,h=0;f>h;h++){var i=Math.floor(h*g),j=Math.floor((h+1)*g)+1,k=a.slice(i,j),l=o.default.create(b,d,k,c);l&&e.push(l)}else{var m=o.default.create(b,d,a,c);m&&e.push(m)}return e}}),r.texture_id=0},{"../../geo":201,"../../gl/constants":202,"../../labels/collision":214,"../../labels/label_line":217,"../../labels/label_point":218,"../points/points":240,"../style":243}],249:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.TextLabels=void 0;var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},f=a("../style_parser"),g=a("../../geo"),h=d(g),i=a("../../utils/log"),j=d(i),k=a("../../utils/thread"),l=d(k),m=a("../../utils/worker_broker"),n=d(m),o=a("../../labels/collision"),p=d(o),q=a("../text/text_settings"),r=d(q),s=a("../text/canvas_text"),t=d(s),u=0;c.TextLabels={resetText:function(){l.default.is_main?this.canvas=new t.default:l.default.is_worker&&(this.texts={})},freeText:function(a){delete this.texts[a.id]},parseTextFeature:function(a,b,c,d){var e=this.parseTextSource(a,b,c);if(null!=e&&""!==e){var f=r.default.compute(a,b,c),g=r.default.key(f);this.texts[d.id]=this.texts[d.id]||{};var h=this.texts[d.id][g]=this.texts[d.id][g]||{};if(e instanceof Object){var i=[],j=e.left+"-"+e.right;for(var k in e){var l=e[k];if(l){var m=this.computeTextLayout({},a,b,c,d,l,f,j,k);h[l]||(h[l]={text_settings:f,ref:0}),i.push({draw:b,text:l,text_settings_key:g,layout:m})}}return i.length>0&&i}var n=this.computeTextLayout({},a,b,c,d,e,f);return h[e]||(h[e]={text_settings:f,ref:0}),{draw:b,text:e,text_settings_key:g,layout:n}}},parseTextSource:function(a,b,c){var d=void 0,f=b.text_source||"name";if(null!=f&&"object"===("undefined"==typeof f?"undefined":e(f))){d={};for(var g in f)d[g]=this.parseTextSourceValue(f[g],a,c)}else d=this.parseTextSourceValue(f,a,c);return d},parseTextSourceValue:function(a,b,c){var d=void 0;if(Array.isArray(a)){for(var e=0;e<a.length;e++)if("string"==typeof a[e]?d=b.properties[a[e]]:"function"==typeof a[e]&&(d=a[e](c)),d)return d}else"string"==typeof a?d=b.properties[a]:a instanceof Function&&(d=a(c));return d},prepareTextLabels:function(a,b,c){var d=this;return 0===Object.keys(this.texts[a.id]||{}).length?Promise.resolve([]):n.default.postMessage(this.main_thread_target+".calcTextSizes",a.id,this.texts[a.id]).then(function(b){var e=b.texts;return a.canceled?(j.default("trace","Style "+d.name+": stop tile build because tile was canceled: "+a.key+", post-calcTextSizes()"),[]):(d.texts[a.id]=e||[],e?d.buildTextLabels(a,c):(p.default.abortTile(a.id),[]))})},collideAndRenderTextLabels:function(a,b,c){var d=this;return this.prepareTextLabels(a,b,c).then(function(c){
return 0===c.length?(p.default.collide([],b,a.id),Promise.resolve({})):p.default.collide(c,b,a.id).then(function(b){if(a.canceled)return j.default("trace","stop tile build because tile was canceled: "+a.key+", post-collide()"),{};var c=d.texts[a.id];return null==c||0===b.length?{}:(d.cullTextStyles(c,b),b.forEach(function(a){var b=a.text_settings_key,d=c[b]&&c[b][a.text];d.text_settings.can_articulate?(d.type||(d.type=[]),-1===d.type.indexOf(a.label.type)&&d.type.push(a.label.type)):(d.align=d.align||{},d.align[a.label.align]={})}),n.default.postMessage(d.main_thread_target+".rasterizeTexts",a.id,a.key,c).then(function(c){var d=c.texts,e=c.textures;return a.canceled?(j.default("trace","stop tile build because tile was canceled: "+a.key+", post-rasterizeTexts()"),{}):{labels:b,texts:d,textures:e}}))})})},cullTextStyles:function(a,b){for(var c=0;c<b.length;c++){var d=b[c];a[d.text_settings_key][d.text].ref++}for(var e in a)for(var f in a[e])a[e][f].ref<1&&delete a[e][f];for(var g in a)0===Object.keys(a[g]).length&&delete a[g]},calcTextSizes:function(a,b){return this.canvas.textSizes(a,b)},rasterizeTexts:function(a,b,c){var d=this,e=new t.default,f=Math.min(this.max_texture_size,2048);return e.setTextureTextPositions(c,f).then(function(f){var g=f.textures;if(!g)return{};var h=["labels",d.name,b,a,u,""].join("-");return u++,e.rasterize(c,g,a,h,d.gl).then(function(a){var b=a.textures;return b?{texts:c,textures:b}:{}})})},preprocessText:function(a){return a&&a.font&&"object"===e(a.font)?(a.font.fill=f.StyleParser.createPropertyCache(a.font.fill),a.font.stroke&&(a.font.stroke.color=f.StyleParser.createPropertyCache(a.font.stroke.color)),a.font.px_size=f.StyleParser.createPropertyCache(a.font.size||r.default.defaults.size,t.default.fontPixelSize),a.font.stroke&&null!=a.font.stroke.width&&(a.font.stroke.width=f.StyleParser.createPropertyCache(a.font.stroke.width,parseFloat)),a.offset=f.StyleParser.createPropertyCache(a.offset,function(a){return Array.isArray(a)&&a.map(parseFloat)||0}),a.buffer=f.StyleParser.createPropertyCache(a.buffer,function(a){return(Array.isArray(a)?a:[a,a]).map(parseFloat)||0}),a.repeat_distance=f.StyleParser.createPropertyCache(a.repeat_distance||h.default.tile_size,parseFloat),a):void 0},computeTextLayout:function(a,b,c,d,e,f,g,h,i){var j=a||{};return j=this.computeLayout(j,b,c,d,e),j.cull_from_tile=null==c.cull_from_tile||c.cull_from_tile,j.move_into_tile=null==c.move_into_tile||c.move_into_tile,j.repeat_distance&&(h&&(j.repeat_group+="/"+h),j.repeat_group+="/"+f),j.subdiv=e.overzoom2,j.align=c.align,j.italic="normal"!==g.style,"right"===i?j.orientation=1:"left"===i&&(j.orientation=-1),j}}},{"../../geo":201,"../../labels/collision":214,"../../utils/log":259,"../../utils/thread":267,"../../utils/worker_broker":271,"../style_parser":245,"../text/canvas_text":246,"../text/text_settings":250}],250:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e,f=a("../../utils/utils"),g=d(f),h=a("../../geo"),i=d(h),j=a("../style_parser");c.default=e={key:function(a){return[a.style,a.weight,a.family,a.px_size,a.fill,a.stroke,a.stroke_width,a.transform,a.text_wrap,a.max_lines,a.supersample,g.default.device_pixel_ratio].join("/")},defaults:{style:"normal",weight:null,size:"12px",px_size:12,family:"Helvetica",fill:"white",text_wrap:15,max_lines:5,align:"center",stroke:null,stroke_width:0},compute:function(a,b,c){var d={};b.font=b.font||this.defaults,d.can_articulate=b.can_articulate,d.fill=b.font.fill&&g.default.toCSSColor(j.StyleParser.evalCachedColorProperty(b.font.fill,c))||this.defaults.fill,d.style=b.font.style||this.defaults.style,d.weight=b.font.weight||this.defaults.weight,b.font.family?(d.family=b.font.family,d.family!==this.defaults.family&&(d.family+=", "+this.defaults.family)):d.family=this.defaults.family,d.transform=b.font.transform,d.size=b.font.size||this.defaults.size,d.supersample=b.supersample_text?1.5:1,d.px_size=j.StyleParser.evalCachedProperty(b.font.px_size,c)*d.supersample,b.font.stroke&&b.font.stroke.color&&(d.stroke=g.default.toCSSColor(j.StyleParser.evalCachedColorProperty(b.font.stroke.color,c)||this.defaults.stroke),d.stroke_width=j.StyleParser.evalCachedProperty(b.font.stroke.width,c)||this.defaults.stroke_width),d.font_css=this.fontCSS(d);var e=b.text_wrap;return null==e&&"line"!==i.default.geometryType(a.geometry.type)&&(e=!0),e===!0&&(e=this.defaults.text_wrap),d.text_wrap=e,d.max_lines=b.max_lines||this.defaults.max_lines,d},fontCSS:function(a){var b=a.style,c=a.weight,d=a.px_size,e=a.family;return[b,c,d+"px",e].filter(function(a){return a}).join(" ")}}},{"../../geo":201,"../../utils/utils":269,"../style_parser":245}],251:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){for(var c in a){var d=a[c];q.addLayerDebugEntry(b,c,d.features,d.geoms,d.styles,d.base),d.layers&&(b[c].layers=b[c].layers||{},g(d.layers,b[c].layers))}}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./utils/log"),j=d(i),k=a("./utils/utils"),l=d(k),m=a("./utils/merge"),n=d(m),o=a("./geo"),p=d(o),q=a("./styles/style"),r=a("./styles/style_parser"),s=a("./labels/collision"),t=d(s),u=a("./utils/worker_broker"),v=d(u),w=a("./utils/task"),x=d(w),y=a("./gl/texture"),z=d(y),A=a("./utils/gl-matrix"),B=0,C=function(){function a(b){var c=b.coords,d=b.style_zoom,e=b.source,g=b.worker,h=b.view;f(this,a),this.id=B++,this.worker=g,this.view=h,this.source=e,this.generation=null,this.visible=!1,this.proxy_for=null,this.proxy_depth=0,this.proxied_as=null,this.fade_in=!0,this.loading=!1,this.loaded=!1,this.built=!1,this.error=null,this.debug={},this.style_zoom=d,this.coords=a.normalizedCoordinate(c,this.source,this.style_zoom),this.key=a.key(this.coords,this.source,this.style_zoom),this.overzoom=Math.max(this.style_zoom-this.coords.z,0),this.overzoom2=Math.pow(2,this.overzoom),this.min=p.default.metersForTile(this.coords),this.max=p.default.metersForTile({x:this.coords.x+1,y:this.coords.y+1,z:this.coords.z}),this.span={x:this.max.x-this.min.x,y:this.max.y-this.min.y},this.bounds={sw:{x:this.min.x,y:this.max.y},ne:{x:this.max.x,y:this.min.y}},this.center_dist=0,this.meters_per_pixel=p.default.metersPerPixel(this.style_zoom),this.meters_per_pixel_sq=this.meters_per_pixel*this.meters_per_pixel,this.units_per_pixel=p.default.units_per_pixel/this.overzoom2,this.units_per_meter_overzoom=p.default.unitsPerMeter(this.coords.z)*this.overzoom2,this.meshes={},this.textures=[],this.previous_textures=[],this.new_mesh_styles=[]}return h(a,[{key:"freeResources",value:function(){for(var a in this.meshes)this.meshes[a].forEach(function(a){return a.destroy()});this.meshes={},this.textures.forEach(function(a){return z.default.release(a)}),this.textures=[],this.previous_textures.forEach(function(a){return z.default.release(a)}),this.previous_textures=[]}},{key:"destroy",value:function(){x.default.removeForTile(this.id),this.workerMessage("self.removeTile",this.key),this.freeResources(),this.worker=null}},{key:"buildAsMessage",value:function(){return{id:this.id,key:this.key,source:this.source.name,coords:this.coords,min:this.min,max:this.max,units_per_pixel:this.units_per_pixel,meters_per_pixel:this.meters_per_pixel,meters_per_pixel_sq:this.meters_per_pixel_sq,units_per_meter_overzoom:this.units_per_meter_overzoom,style_zoom:this.style_zoom,overzoom:this.overzoom,overzoom2:this.overzoom2,generation:this.generation,debug:this.debug}}},{key:"workerMessage",value:function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return v.default.postMessage.apply(v.default,[this.worker].concat(b))}},{key:"build",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=b.fade_in,d=void 0===c||c;return this.generation=a,this.fade_in=d,this.loaded||(this.loading=!0,this.built=!1),this.workerMessage("self.buildTile",{tile:this.buildAsMessage()}).catch(function(a){throw a})}},{key:"buildMeshes",value:function(a,b){var c;if(!this.error){b.start&&(this.debug.geometry_count=0,this.debug.buffer_size=0);var d={},f=[],g=this.mesh_data;if(g)for(var h in g){for(var i in g[h].meshes){var k=g[h].meshes[i];if(k.vertex_data){if(!a[h]){j.default("warn","Could not create mesh because style '"+h+"' not found, for tile "+this.key+", aborting tile");break}var l=Object.assign({},g[h]);l.uniforms=Object.assign({},l.uniforms,k.uniforms),l.variant=k.variant;var m=a[h].makeMesh(k.vertex_data,k.vertex_elements,l);d[h]=d[h]||[],d[h].push(m),this.debug.buffer_size+=m.buffer_size,this.debug.geometry_count+=m.geometry_count}}g[h].textures&&f.push.apply(f,e(g[h].textures))}delete this.mesh_data,b.start&&(this.previous_textures=[].concat(e(this.textures)),this.textures=[]);for(var n in d)this.meshes[n]&&this.meshes[n].forEach(function(a){return a.destroy()}),this.meshes[n]=d[n],this.new_mesh_styles.push(n);if((c=this.textures).push.apply(c,f),b.done){for(var o in this.meshes)-1===this.new_mesh_styles.indexOf(o)&&(this.meshes[o].forEach(function(a){return a.destroy()}),delete this.meshes[o]);this.new_mesh_styles=[],this.previous_textures.forEach(function(a){return z.default.release(a)}),this.previous_textures=[],this.debug.geometry_ratio=(this.debug.geometry_count/this.debug.feature_count).toFixed(1),this.printDebug()}}}},{key:"setProxyFor",value:function(a){a?(this.visible=!0,this.proxy_for=this.proxy_for||[],this.proxy_for.push(a),this.proxy_depth=1,a.proxied_as=a.style_zoom>this.style_zoom?"child":"parent"):(this.proxy_for=null,this.proxy_depth=0)}},{key:"shouldProxyForStyle",value:function(a){return!this.proxy_for||this.proxy_for.some(function(b){return null==b.meshes[a]})}},{key:"setupProgram",value:function(a,b){var c=a.model,d=a.model32;b.uniform("4fv","u_tile_origin",[this.min.x,this.min.y,this.style_zoom,this.coords.z]),b.uniform("1f","u_tile_proxy_depth",this.proxy_depth),A.mat4.identity(c),A.mat4.translate(c,c,A.vec3.fromValues(this.min.x,this.min.y,0)),A.mat4.scale(c,c,A.vec3.fromValues(this.span.x/p.default.tile_scale,-1*this.span.y/p.default.tile_scale,1)),A.mat4.copy(d,c),b.uniform("Matrix4fv","u_model",d),b.uniform("1i","u_tile_fade_in",this.fade_in&&"child"!==this.proxied_as)}},{key:"merge",value:function(a){return this.loading=a.loading,this.loaded=a.loaded,this.generation=a.loaded,this.error=a.error,this.mesh_data=a.mesh_data,this.debug=n.default(this.debug,a.debug),this}},{key:"printDebug",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["layers"],b={};for(var c in this.debug)-1===a.indexOf(c)&&(b[c]=this.debug[c]);j.default("debug","Tile: debug for "+this.key+": [  "+JSON.stringify(b)+" ]")}}],[{key:"coord",value:function(b){return{x:b.x,y:b.y,z:b.z,key:a.coordKey(b)}}},{key:"coordKey",value:function(a){var b=a.x,c=a.y,d=a.z;return b+"/"+c+"/"+d}},{key:"key",value:function(a,b,c){return a.y<0||a.y>=1<<a.z||a.z<0?void 0:[b.name,c,a.x,a.y,a.z].join("/")}},{key:"normalizedKey",value:function(b,c,d){return a.key(a.normalizedCoordinate(b,c,d),c,d)}},{key:"normalizedCoordinate",value:function(b,c){return c.zoom_bias&&(b=a.coordinateAtZoom(b,Math.max(0,b.z-c.zoom_bias))),a.coordinateWithMaxZoom(b,c.max_zoom)}},{key:"coordinateAtZoom",value:function(b,c){var d=b.x,e=b.y,f=b.z;if(f!==c){var g=Math.pow(2,f-c);d=Math.floor(d/g),e=Math.floor(e/g),f=c}return a.coord({x:d,y:e,z:f})}},{key:"coordinateWithMaxZoom",value:function(b,c){var d=b.x,e=b.y,f=b.z;return void 0!==c&&f>c?a.coordinateAtZoom({x:d,y:e,z:f},c):a.coord({x:d,y:e,z:f})}},{key:"childrenForCoordinate",value:function(b){var c=b.x,d=b.y,e=b.z,f=b.key;return a.coord_children[f]||(e++,c*=2,d*=2,a.coord_children[f]=[a.coord({x:c,y:d,z:e}),a.coord({x:c+1,y:d,z:e}),a.coord({x:c,y:d+1,z:e}),a.coord({x:c+1,y:d+1,z:e})]),a.coord_children[f]}},{key:"isDescendant",value:function(b,c){if(c.z>b.z){var d=a.coordinateAtZoom(c,b.z),e=d.x,f=d.y;return b.x===e&&b.y===f}return!1}},{key:"cancel",value:function(b){b&&(b.canceled=!0,b.source_data&&b.source_data.request_id&&(l.default.cancelRequest(b.source_data.request_id),b.source_data.request_id=null),a.abortBuild(b))}},{key:"buildGeometry",value:function(b,c){var d=c.scene_id,e=c.layers,f=c.styles,g=c.global,h=b.source_data;b.debug.rendering=+new Date,b.debug.feature_count=0,b.debug.layers=null,t.default.startTile(b.id);for(var i in e){var k=e[i];if(k&&k.config_data){if(k.config_data.source===b.source)for(var l=a.getDataForSource(h,k.config_data,i),m=0;m<l.length;m++){var n=l[m],o=n.geom;if(o)for(var p=0;p<o.features.length;p++){var q=o.features[p];if(null!=q.geometry){var s=r.StyleParser.getFeatureParseContext(q,b,g);s.winding=b.default_winding,s.source=b.source,s.layer=n.layer;var u=k.buildDrawGroups(s,!0);if(u){for(var v in u){var w=u[v],x=w.style||v,y=f[x];y?(w=y.preprocess(w),null!=w&&w.visible!==!1&&(s.layers=w.layers,y.addFeature(q,w,s))):j.default("warn","Style '"+x+"' not found, skipping layer '"+i+"':",w,q)}b.debug.feature_count++}}}}}else j.default("warn","Layer "+i+" was defined without a geometry data source and will not be rendered.")}b.debug.rendering=+new Date-b.debug.rendering;var z=this.stylesForTile(b,f).map(function(a){return f[a]});a.sendStyleGroups(b,z,{scene_id:d},function(a){return a.collision?"collision":"non-collision"})}},{key:"stylesForTile",value:function(a,b){var c=[];for(var d in b)b[d].hasDataForTile(a)&&c.push(d);return c}},{key:"sendStyleGroups",value:function(b,c,d,e){var f=d.scene_id,g={};c.forEach(function(a){var b=e(a);g[b]=g[b]||[],g[b].push(a)}),Object.keys(g).length>0?!function(){var c={start:!0};b.mesh_data={};var d=function(d){var e=g[d];Promise.all(e.map(function(a){return a.endData(b).then(function(c){c&&(b.mesh_data[a.name]=c)})})).then(function(){j.default("trace","Finished style group '"+d+"' for tile "+b.key),g[d]=[],Object.keys(g).every(function(a){return 0===g[a].length})&&(c.done=!0),v.default.postMessage("TileManager_"+f+".buildTileStylesCompleted",v.default.withTransferables({tile:a.slice(b,["mesh_data"]),progress:c})),c.start=null,b.mesh_data={},c.done&&t.default.resetTile(b.id)}).catch(function(a){j.default("error","Error for style group '"+d+"' for tile "+b.key,a.stack)})};for(var e in g)d(e)}():(v.default.postMessage("TileManager_"+f+".buildTileStylesCompleted",v.default.withTransferables({tile:a.slice(b),progress:{start:!0,done:!0}})),t.default.resetTile(b.id))}},{key:"getDataForSource",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=[];return null!=b&&null!=a&&null!=a.layers&&(!b.layer&&a.layers._default?d.push({geom:a.layers._default}):!b.layer&&c?d.push({layer:c,geom:a.layers[c]}):"string"==typeof b.layer?d.push({layer:b.layer,geom:a.layers[b.layer]}):Array.isArray(b.layer)&&b.layer.forEach(function(b){a.layers[b]&&a.layers[b].features&&d.push({layer:b,geom:a.layers[b]})})),d}},{key:"abortBuild",value:function(a){if(x.default.removeForTile(a.id),t.default.abortTile(a.id),a.mesh_data)for(var b in a.mesh_data){var c=a.mesh_data[b].textures;c&&c.forEach(function(b){var c=z.default.textures[b];c&&(j.default("trace","releasing texture "+b+" for tile "+a.key),c.release())})}}},{key:"slice",value:function(a,b){var c=["id","key","loading","loaded","generation","error","debug"];Array.isArray(b)&&c.push.apply(c,e(b));for(var d={},f=0;f<c.length;f++){var g=c[f];d[g]=a[g]}return d}},{key:"debugSumLayerStats",value:function(a){var b={},c={};return a.filter(function(a){return a.debug.layers}).forEach(function(a){Object.keys(a.debug.layers.list).forEach(function(c){var d=a.debug.layers.list[c];q.addLayerDebugEntry(b,c,d.features,d.geoms,d.styles,d.base)}),g(a.debug.layers.tree,c)}),{list:b,tree:c}}}]),a}();c.default=C,C.coord_children={}},{"./geo":201,"./gl/texture":208,"./labels/collision":214,"./styles/style":243,"./styles/style_parser":245,"./utils/gl-matrix":257,"./utils/log":259,"./utils/merge":261,"./utils/task":266,"./utils/utils":269,"./utils/worker_broker":271}],252:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./tile"),h=d(g),i=a("./tile_pyramid"),j=d(i),k=a("./geo"),l=d(k),m=a("./utils/log"),n=d(m),o=a("./utils/worker_broker"),p=d(o),q=function(){function a(b){var c=b.scene,d=b.view;e(this,a),this.scene=c,this.view=d,this.tiles={},this.pyramid=new j.default,this.visible_coords={},this.queued_coords=[],this.building_tiles=null,this.renderable_tiles=[],this.active_styles=[],this.main_thread_target=["TileManager",this.scene.id].join("_"),p.default.addTarget(this.main_thread_target,this)}return f(a,[{key:"destroy",value:function(){this.forEachTile(function(a){return a.destroy()}),this.tiles={},this.pyramid=null,this.visible_coords={},this.queued_coords=[],this.scene=null,this.view=null}},{key:"keepTile",value:function(a){this.tiles[a.key]=a,this.pyramid.addTile(a)}},{key:"hasTile",value:function(a){return void 0!==this.tiles[a]}},{key:"forgetTile",value:function(a){if(this.hasTile(a)){var b=this.tiles[a];this.pyramid.removeTile(b)}delete this.tiles[a],this.tileBuildStop(a)}},{key:"removeTile",value:function(a){n.default("trace","tile unload for "+a);var b=this.tiles[a];null!=b&&b.destroy(),this.forgetTile(b.key),this.scene.requestRedraw()}},{key:"forEachTile",value:function(a){for(var b in this.tiles)a(this.tiles[b])}},{key:"removeTiles",value:function(a){var b=[];for(var c in this.tiles){var d=this.tiles[c];a(d)&&b.push(c)}for(var e=0;e<b.length;e++){var f=b[e];this.removeTile(f)}}},{key:"updateTilesForView",value:function(){this.visible_coords={};for(var a=this.view.findVisibleTileCoordinates(),b=0;b<a.length;b++){var c=a[b];this.queueCoordinate(c),this.visible_coords[c.key]=c}this.updateTileStates()}},{key:"updateTileStates",value:function(){var a=this;this.forEachTile(function(b){a.updateVisibility(b)}),this.loadQueuedCoordinates(),this.updateProxyTiles(),this.view.pruneTilesForView(),this.updateRenderableTiles(),this.updateActiveStyles()}},{key:"updateProxyTiles",value:function(){var a=this;if(0!==this.view.zoom_direction){this.forEachTile(function(a){return a.setProxyFor(null)});var b=!1;this.forEachTile(function(c){if(1===a.view.zoom_direction){if(c.visible&&!c.built){var d=a.pyramid.getAncestor(c);d&&(d.setProxyFor(c),b=!0)}}else if(-1===a.view.zoom_direction&&c.visible&&!c.built)for(var e=a.pyramid.getDescendants(c),f=0;f<e.length;f++)e[f].setProxyFor(c),b=!0}),b||(this.view.zoom_direction=0)}}},{key:"updateVisibility",value:function(a){if(a.visible=!1,a.style_zoom===this.view.tile_zoom)if(this.visible_coords[a.coords.key])a.visible=!0;else for(var b in this.visible_coords)if(h.default.isDescendant(a.coords,this.visible_coords[b])){a.visible=!0;break}}},{key:"pruneToVisibleTiles",value:function(){this.removeTiles(function(a){return!a.visible})}},{key:"getRenderableTiles",value:function(){return this.renderable_tiles}},{key:"updateRenderableTiles",value:function(){this.renderable_tiles=[];for(var a in this.tiles){var b=this.tiles[a];b.visible&&b.loaded&&this.renderable_tiles.push(b)}return this.renderable_tiles}},{key:"getWorkerForTile",value:function(a,b){var c=void 0;return c=b.tiled?this.scene.workers[Math.abs(a.x+a.y+a.z)%this.scene.workers.length]:this.scene.workers[b.id%this.scene.workers.length]}},{key:"getActiveStyles",value:function(){return this.active_styles}},{key:"updateActiveStyles",value:function(){for(var a=this.renderable_tiles,b={},c=0;c<a.length;c++){var d=a[c];Object.keys(d.meshes).forEach(function(a){return b[a]=!0})}return this.active_styles=Object.keys(b),this.active_styles}},{key:"isLoadingVisibleTiles",value:function(){var a=this;return Object.keys(this.tiles).some(function(b){return a.tiles[b].visible&&!a.tiles[b].built})}},{key:"queueCoordinate",value:function(a){this.queued_coords[this.queued_coords.length]=a}},{key:"loadQueuedCoordinates",value:function(){var a=this;0!==this.queued_coords.length&&(this.queued_coords.sort(function(b,c){var d=a.view.center.meters,e=l.default.metersPerTile(b.z)/2,f=l.default.metersForTile(b);f.x+=e,f.y-=e;var g=l.default.metersForTile(c);g.x+=e,g.y-=e;var h=Math.abs(d.x-f.x)+Math.abs(d.y-f.y),i=Math.abs(d.x-g.x)+Math.abs(d.y-g.y);return b.center_dist=h,c.center_dist=i,i>h?-1:i===h?0:1}),this.queued_coords.forEach(function(b){return a.loadCoordinate(b)}),this.queued_coords=[])}},{key:"loadCoordinate",value:function(a){if(a.z===this.view.center.tile.z)for(var b in this.scene.sources){var c=this.scene.sources[b];if(c.builds_geometry_tiles&&c.includesTile(a,this.view.tile_zoom)){var d=h.default.normalizedKey(a,c,this.view.tile_zoom);if(d&&!this.hasTile(d)){n.default("trace","load tile "+d+", distance from view center: "+a.center_dist);var e=new h.default({source:c,coords:a,worker:this.getWorkerForTile(a,c),style_zoom:this.view.baseZoom(a.z),view:this.view});this.keepTile(e),this.buildTile(e)}}}}},{key:"buildTile",value:function(a,b){this.tileBuildStart(a.key),this.updateVisibility(a),a.build(this.scene.generation,b)}},{key:"buildTileStylesCompleted",value:function(a){var b=a.tile,c=a.progress;if(null==this.tiles[b.key])n.default("trace","discarded tile "+b.key+" in TileManager.buildTileStylesCompleted because previously removed"),h.default.abortBuild(b),this.updateTileStates();else if(b.generation!==this.scene.generation)n.default("debug","discarded tile "+b.key+" in TileManager.buildTileStylesCompleted because built with "+("scene config gen "+b.generation+", current "+this.scene.generation)),h.default.abortBuild(b),this.updateTileStates();else{if(this.tiles[b.key]){if(b.id<this.tiles[b.key].id)return n.default("trace","discarded tile "+b.key+" for id "+b.id+" in TileManager.buildTileStylesCompleted because built for discarded tile id"),void h.default.abortBuild(b);b=this.tiles[b.key].merge(b)}c.done&&(b.built=!0),b.buildMeshes(this.scene.styles,c),this.updateTileStates(),this.scene.requestRedraw()}c.done&&this.tileBuildStop(b.key)}},{key:"fetchTileError",value:function(a){var b=/\(code:(\d{3,3})\)/gi.exec(a.source_data.error),c=b&&b[1];this.scene.tileFetchFailed(c)}},{key:"buildTileError",value:function(a){n.default("error","Error building tile "+a.key+":",a.error),this.forgetTile(a.key),h.default.abortBuild(a)}},{key:"tileBuildStart",value:function(a){this.building_tiles=this.building_tiles||{},this.building_tiles[a]=!0,n.default("trace","tileBuildStart for "+a+": "+Object.keys(this.building_tiles).length)}},{key:"tileBuildStop",value:function(a){this.building_tiles&&(n.default("trace","tileBuildStop for "+a+": "+Object.keys(this.building_tiles).length),delete this.building_tiles[a],this.checkBuildQueue())}},{key:"checkBuildQueue",value:function(){this.building_tiles&&0!==Object.keys(this.building_tiles).length||(this.building_tiles=null,this.scene.tileManagerBuildDone())}},{key:"getDebugProp",value:function(a,b){var c=[];for(var d in this.tiles)null==this.tiles[d].debug[a]||"function"==typeof b&&b(this.tiles[d])!==!0||c.push(this.tiles[d].debug[a]);return c}},{key:"getDebugSum",value:function(a,b){var c=0;for(var d in this.tiles)null==this.tiles[d].debug[a]||"function"==typeof b&&b(this.tiles[d])!==!0||(c+=this.tiles[d].debug[a]);return c}},{key:"getDebugAverage",value:function(a,b){return this.getDebugSum(a,b)/Object.keys(this.tiles).length}}]),a}();c.default=q},{"./geo":201,"./tile":251,"./tile_pyramid":253,"./utils/log":259,"./utils/worker_broker":271}],253:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./geo"),i=d(h),j=a("./tile"),k=d(j),l=function(){function a(){f(this,a),this.coords={},this.max_proxy_descendant_depth=3,this.max_proxy_ancestor_depth=5}return g(a,[{key:"sourceTiles",value:function(a,b){return this.coords[a.key]&&this.coords[a.key].sources&&this.coords[a.key].sources[b.name]}},{key:"addTile",value:function(a){var b=a.coords.key,c=this.coords[b];c||(c=this.coords[b]={descendants:0}),c.sources||(c.sources={}),c.sources[a.source.name]||(c.sources[a.source.name]={}),c.sources[a.source.name][a.style_zoom]=a;for(var d=a.coords.z-1;d>=0;d--){var e=k.default.coordinateAtZoom(a.coords,d);this.coords[e.key]||(this.coords[e.key]={descendants:0}),this.coords[e.key].descendants++}}},{key:"removeTile",value:function(a){var b=this.sourceTiles(a.coords,a.source),c=a.coords.key;b&&(delete b[a.style_zoom],0===Object.keys(b).length&&(delete this.coords[c].sources[a.source.name],0===Object.keys(this.coords[c].sources).length&&(delete this.coords[c].sources,0===this.coords[c].descendants&&delete this.coords[c])));for(var d=a.coords.z-1;d>=0;d--){var e=k.default.coordinateAtZoom(a.coords,d);this.coords[e.key]&&this.coords[e.key].descendants>0&&(this.coords[e.key].descendants--,0!==this.coords[e.key].descendants||this.coords[e.key].sources||delete this.coords[e.key])}}},{key:"getAncestor",value:function(a){var b=a.coords,c=a.style_zoom,d=a.source,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!(e>this.max_proxy_ancestor_depth)){if(c>d.max_coord_zoom){var f=this.sourceTiles(b,d);if(f)for(var g=c-1;g>=d.max_coord_zoom;g--)if(f[g]&&f[g].loaded)return f[g];c=d.max_coord_zoom}c--;var h=k.default.coordinateAtZoom(b,b.z-1),i=this.sourceTiles(h,d);return i&&i[c]&&i[c].loaded?i[c]:h.z>0?this.getAncestor({coords:h,style_zoom:c,source:d},e+1):void 0}}},{key:"getDescendants",value:function(a){var b=a.coords,c=a.style_zoom,d=a.source,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,g=[];if(c>=d.max_coord_zoom){var h=this.sourceTiles(b,d);if(h)for(var j=Math.max(i.default.default_view_max_zoom,c+this.max_proxy_descendant_depth),l=c+1;j>=l;l++)if(h[l]&&h[l].loaded)return g.push(h[l]),g;return g}if(this.coords[b.key]&&this.coords[b.key].descendants>0){c++;for(var m=k.default.childrenForCoordinate(b),n=0;n<m.length;n++){var o=m[n],p=this.sourceTiles(o,d);p&&p[c]&&p[c].loaded?g.push(p[c]):f<=this.max_proxy_descendant_depth&&o.z<=d.max_coord_zoom&&g.push.apply(g,e(this.getDescendants({coords:o,source:d,style_zoom:c},f+1)))}}return g}}]),a}();c.default=l},{"./geo":201,"./tile":251}],254:[function(a,b,c){"use strict";function d(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}Object.defineProperty(c,"__esModule",{value:!0}),c.default=d},{}],255:[function(a,b,c){"use strict";function d(a){Object.assign(e,a)}Object.defineProperty(c,"__esModule",{value:!0}),c.mergeDebugSettings=d;var e=void 0;c.default=e={draw_label_collision_boxes:!1,draw_label_texture_boxes:!1,suppress_label_fade_in:!1,suppress_label_snap_animation:!1,layer_stats:!1}},{}],256:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0}),c.MethodNotImplemented=function(a){function b(a){d(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return c.name="MethodNotImplemented",c.message="Method "+a+" must be implemented in subclass",c}return f(b,a),b}(Error)},{}],257:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0}),c.mat4=c.mat3=c.vec3=void 0;var e=a("gl-mat3/normal-from-mat4"),f=d(e),g=a("gl-mat3/invert"),h=d(g),i=a("gl-mat4/multiply"),j=d(i),k=a("gl-mat4/translate"),l=d(k),m=a("gl-mat4/scale"),n=d(m),o=a("gl-mat4/perspective"),p=d(o),q=a("gl-mat4/lookAt"),r=d(q),s=a("gl-mat4/identity"),t=d(s),u=a("gl-mat4/copy"),v=d(u),w={fromValues:function(a,b,c){var d=new Float64Array(3);return d[0]=a,d[1]=b,d[2]=c,d}},x={normalFromMat4:f.default,invert:h.default},y={multiply:j.default,translate:l.default,scale:n.default,perspective:p.default,lookAt:r.default,identity:t.default,copy:v.default};c.vec3=w,c.mat3=x,c.mat4=y},{"gl-mat3/invert":83,"gl-mat3/normal-from-mat4":84,"gl-mat4/copy":85,"gl-mat4/identity":86,"gl-mat4/lookAt":87,"gl-mat4/multiply":88,"gl-mat4/perspective":89,"gl-mat4/scale":90,"gl-mat4/translate":91}],258:[function(a,b,c){"use strict";function d(a){var b,c,d,e=0;if(0===a.length)return e;for(b=0,d=a.length;d>b;b++)c=a.charCodeAt(b),e=(e<<5)-e+c,e|=0;return e}Object.defineProperty(c,"__esModule",{value:!0}),c.default=d},{}],259:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a){return l.default.is_main?(p[a]=p[a]||(console[a]?console[a]:console.log).bind(console),p[a]):void 0}function g(a){var b="object"===("undefined"==typeof a?"undefined":h(a))?a.level:a;if(o[b]<=o[g.level]){for(var c=arguments.length,d=Array(c>1?c-1:0),i=1;c>i;i++)d[i-1]=arguments[i];if(l.default.is_worker)n.default.postMessage.apply(n.default,["_logProxy",a].concat(d));else{if("object"===("undefined"==typeof a?"undefined":h(a))&&a.once===!0){if(q[JSON.stringify(d)])return;q[JSON.stringify(d)]=!0}var k=f(b);d.length>1?k.apply(void 0,["Tangram "+j.default+" ["+b+"]: "+d[0]].concat(e(d.slice(1)))):k("Tangram "+j.default+" ["+b+"]: "+d[0])}}}Object.defineProperty(c,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};c.default=g;var i=a("./version"),j=d(i),k=a("./thread"),l=d(k),m=a("./worker_broker"),n=d(m),o={silent:-1,error:0,warn:1,info:2,debug:3,trace:4},p={},q={};g.level="info",g.workers=null,g.setLevel=function(a){g.level=a,l.default.is_main&&Array.isArray(g.workers)&&n.default.postMessage(g.workers,"_logSetLevelProxy",a)},l.default.is_main&&(g.setWorkers=function(a){g.workers=a},g.reset=function(){q={}}),n.default.addTarget("_logProxy",g),n.default.addTarget("_logSetLevelProxy",g.setLevel)},{"./thread":267,"./version":270,"./worker_broker":271}],260:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./log"),h=d(g),i=a("./urls"),j=a("../styles/style_parser"),k=function(){
function a(){e(this,a),this.canvas=null,this.gl=null,this.screenshot_canvas=null,this.screenshot_context=null,this.queue_screenshot=null,this.video_capture=null}return f(a,[{key:"setCanvas",value:function(a,b){this.canvas=a,this.gl=b}},{key:"screenshot",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=b.background;return null!=this.queue_screenshot?this.queue_screenshot.promise:(this.queue_screenshot={background:c},this.queue_screenshot.promise=new Promise(function(b,c){a.queue_screenshot.resolve=b,a.queue_screenshot.reject=c}),this.queue_screenshot.promise)}},{key:"completeScreenshot",value:function(){if(null!=this.queue_screenshot){var a=this.canvas.width,b=this.canvas.height,c=new Uint8Array(a*b*4);this.gl.readPixels(0,0,a,b,this.gl.RGBA,this.gl.UNSIGNED_BYTE,c);var d=this.queue_screenshot.background;d=d&&"transparent"!==d?j.StyleParser.parseColor(d).slice(0,3).map(function(a){return 255*a}):null;for(var e=new Uint8ClampedArray(a*b*4),f=0;b>f;f++)for(var g=0;a>g;g++){var h=4*((b-f-1)*a+g),i=4*(f*a+g),k=c[h+3];e[i+0]=255*c[h+0]/k,e[i+1]=255*c[h+1]/k,e[i+2]=255*c[h+2]/k,e[i+3]=k,d&&(k/=255,e[i+0]=e[i+0]*k+d[0]*(1-k),e[i+1]=e[i+1]*k+d[1]*(1-k),e[i+2]=e[i+2]*k+d[2]*(1-k),e[i+3]=255)}this.screenshot_canvas=this.screenshot_canvas||document.createElement("canvas");var l=this.screenshot_canvas;l.width=a,l.height=b,this.screenshot_context=this.screenshot_context||l.getContext("2d");var m=this.screenshot_context,n=new ImageData(e,a,b);m.putImageData(n,0,0);for(var o=l.toDataURL("image/png"),p=atob(o.slice(22)),q=new Uint8Array(p.length),r=0;r<p.length;++r)q[r]=p.charCodeAt(r);var s=new Blob([q],{type:"image/png"});this.queue_screenshot.resolve({url:o,blob:s,type:"png"}),this.queue_screenshot=null}}},{key:"startVideoCapture",value:function(){var a=this;if("function"!=typeof window.MediaRecorder||!this.canvas||"function"!=typeof this.canvas.captureStream)return h.default("warn","Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(this.video_capture)return h.default("warn","Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var b=this.video_capture={};b.chunks=[],b.stream=this.canvas.captureStream(),b.options={mimeType:"video/webm"},b.media_recorder=new MediaRecorder(b.stream,b.options),b.media_recorder.ondataavailable=function(c){if(c.data.size>0&&b.chunks.push(c.data),b.resolve){var d=new Blob(b.chunks,{type:b.options.mimeType}),e=i.createObjectURL(d);if(b.stream){var f=b.stream.getTracks()||[];f.forEach(function(a){a.stop(),b.stream.removeTrack(a)})}b.stream=null,b.media_recorder=null,a.video_capture=null,b.resolve({url:e,blob:d,type:"webm"})}},b.media_recorder.start()}catch(a){return this.video_capture=null,h.default("error","Scene video capture failed",a),!1}return!0}},{key:"stopVideoCapture",value:function(){var a=this;return this.video_capture?(this.video_capture.promise=new Promise(function(b,c){a.video_capture.resolve=b,a.video_capture.reject=c}),this.video_capture.media_recorder.stop(),this.video_capture.promise):(h.default("warn","No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))}}]),a}();c.default=k},{"../styles/style_parser":245,"./log":259,"./urls":268}],261:[function(a,b,c){"use strict";function d(a){for(var b=arguments.length,c=Array(b>1?b-1:0),f=1;b>f;f++)c[f-1]=arguments[f];for(var g=0;g<c.length;g++){var h=c[g];if(h)for(var i in h){var j=h[i];null===j||"object"!==("undefined"==typeof j?"undefined":e(j))||Array.isArray(j)?void 0!==j&&(a[i]=j):a[i]=null===a[i]||"object"!==e(a[i])||Array.isArray(a[i])?d({},j):d(a[i],j)}}return a}Object.defineProperty(c,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};c.default=d},{}],262:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../vector"),h=d(g),i=function(){function a(b,c,d,f,g){e(this,a),this.dimension=[f,g],this.angle=d,this.centroid=[b,c],this.quad=[],this.axes=[],this.update()}return f(a,[{key:"move",value:function(a,b){this.centroid=[a,b],this.update()}},{key:"getExtent",value:function(){for(var a=1e6,b=[a,a,-a,-a],c=0;4>c;++c)b[0]=Math.min(this.quad[c][0],b[0]),b[1]=Math.min(this.quad[c][1],b[1]),b[2]=Math.max(this.quad[c][0],b[2]),b[3]=Math.max(this.quad[c][1],b[3]);return b}},{key:"perpAxes",value:function(){this.axes[0]=h.default.normalize(h.default.sub(this.quad[2],this.quad[3])),this.axes[1]=h.default.normalize(h.default.sub(this.quad[2],this.quad[1]))}},{key:"update",value:function(){var a=[Math.cos(this.angle),Math.sin(this.angle)],b=[-Math.sin(this.angle),Math.cos(this.angle)];a=h.default.mult(a,this.dimension[0]/2),b=h.default.mult(b,this.dimension[1]/2),this.quad[0]=h.default.sub(h.default.sub(this.centroid,a),b),this.quad[1]=h.default.sub(h.default.add(this.centroid,a),b),this.quad[2]=h.default.add(h.default.add(this.centroid,a),b),this.quad[3]=h.default.add(h.default.sub(this.centroid,a),b),this.perpAxes()}}],[{key:"projectToAxis",value:function(a,b){for(var c=1e6,d=c,e=-c,f=a.quad,g=0;4>g;++g){var i=h.default.dot(f[g],b);d=Math.min(d,i),e=Math.max(e,i)}return[d,e]}},{key:"axisCollide",value:function(b,c,d){for(var e=0;2>e;++e){var f=a.projectToAxis(b,d[e]),g=a.projectToAxis(c,d[e]);if(g[0]>f[1]||g[1]<f[0])return!1}return!0}},{key:"intersect",value:function(b,c){return a.axisCollide(b,c,b.axes)&&a.axisCollide(b,c,c.axes)}}]),a}();c.default=i},{"../vector":272}],263:[function(a){"use strict";a("core-js/es6/promise"),"function"!=typeof Object.assign&&!function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e])}return b}}(),Math.hypot=Math.hypot||function(){for(var a=0,b=arguments.length,c=0;b>c;c++){if(1/0===arguments[c]||arguments[c]===-1/0)return 1/0;a+=arguments[c]*arguments[c]}return Math.sqrt(a)},Math.log2=Math.log2||function(a){return Math.log(a)*Math.LOG2E};var b=void 0;if("undefined"!=typeof window?("performance"in window==0&&(window.performance={}),b=window.performance):"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&("performance"in self==0&&(self.performance={}),b=self.performance),b&&"function"!=typeof b.now){var c=+new Date;b.now=function(){return+new Date-c}}},{"core-js/es6/promise":6}],264:[function(a,b,c){"use strict";function d(a,b){var c={};return b.forEach(function(b){return c[b]=a[b]}),c}Object.defineProperty(c,"__esModule",{value:!0}),c.default=d},{}],265:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){var b=[];return Object.assign(a,{subscribe:function(a){-1===b.indexOf(a)&&b.push(a)},unsubscribe:function(a){var c=b.indexOf(a);c>-1&&b.splice(c,1)},unsubscribeAll:function(){b=[]},trigger:function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];b.forEach(function(b){if("function"==typeof b[a])try{b[a].apply(b,d)}catch(b){g.default("warn","Caught exception in listener for event '"+a+"':",b)}})},hasSubscribersFor:function(a){var c=!1;return b.forEach(function(b){"function"==typeof b[a]&&(c=!0)}),c}})}Object.defineProperty(c,"__esModule",{value:!0}),c.default=e;var f=a("./log"),g=d(f)},{"./log":259}],266:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={id:0,queue:[],max_time:20,start_time:null,state:{},add:function(a){a.id=d.id++,a.max_time=a.max_time||d.max_time,a.pause_factor=a.pause_factor||1;var b=new Promise(function(b,c){a.resolve=b,a.reject=c});return a.promise=b,a.total_elapsed=0,a.stats={calls:0},this.queue.push(a),this.start_time=this.start_time||performance.now(),this.elapsed=performance.now()-this.start_time,this.elapsed<d.max_time&&this.process(a),a.promise},remove:function(a){var b=this.queue.indexOf(a);b>-1&&this.queue.splice(b,1)},process:function(a){return this.state.user_moving_view&&a.user_moving_view===!1?void 0:a.pause?(a.pause--,!0):(a.stats.calls++,a.start_time=performance.now(),a.target[a.method](a))},processAll:function(){this.start_time=this.start_time||performance.now();for(var a=0;a<this.queue.length;a++){var b=this.queue[a];if(this.process(b)!==!0&&(b.pause||(b.pause=b.elapsed>b.max_time?b.pause_factor:0),b.total_elapsed+=b.elapsed),this.elapsed=performance.now()-this.start_time,this.elapsed>=d.max_time){this.start_time=null;break}}},finish:function(a,b){return a.elapsed=performance.now()-a.start_time,a.total_elapsed+=a.elapsed,this.remove(a),a.resolve(b),a.promise},cancel:function(a){var b=void 0;a.cancel&&a.target[a.cancel]instanceof Function&&(b=a.target[a.cancel](a)),a.resolve(b||{})},shouldContinue:function(a){return a.elapsed=performance.now()-a.start_time,this.elapsed=performance.now()-this.start_time,a.elapsed<a.max_time&&this.elapsed<d.max_time},removeForTile:function(a){for(var b=this.queue.length-1;b>=0;b--)this.queue[b].tile_id===a&&(this.cancel(this.queue[b]),this.queue.splice(b,1))},setState:function(a){this.state=a}};c.default=d},{}],267:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={};c.default=d;try{window.document!==HTMLDocument&&(d.is_worker=!1,d.is_main=!0)}catch(a){void 0!==self&&(d.is_worker=!0,d.is_main=!1,self.window={document:{}},self.document=self.window.document)}},{}],268:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!a||!i(a))return a;var c,d="/"!==a[0];if(b?(c=document.createElement("a"),c.href=b):c=window.location,d){var e=f(c.href);a=e+a}else{var g=c.origin;g||(g=c.protocol+"//"+c.host),a=g+a}return a}function f(a){if("string"==typeof a&&-1===a.search(/^(data|blob):/)){var b=a.indexOf("?");b>-1&&(a=a.substr(0,b));var c=a.indexOf("#");return c>-1&&(a=a.substr(0,c)),a.substr(0,a.lastIndexOf("/")+1)||""}return""}function g(a){a=a.split("/").pop();var b=a.lastIndexOf(".");return b>-1?a.substring(b+1):void 0}function h(a){return"string"==typeof a?a.search(/^(data|blob):/)>-1:void 0}function i(a){return"string"==typeof a?!(a.search(/^(http|https|data|blob):/)>-1||"//"===a.substr(0,2)):void 0}function j(a){for(var b=(a||"").split("/"),c=1;c<b.length;c++)"."===b[c]?(b.splice(c,1),c--):".."===b[c]&&(c+=0,b.splice(c-1,2),c--);return b.join("/")}function k(a,b){if(!b||0===Object.keys(b).length)return[a,[]];var c=a.indexOf("?"),d=a.indexOf("#"),e="";d>-1&&(e=a.slice(d),a=a.slice(0,d)),-1===c&&(c=a.length,a+="?"),c++;var f="",g=[];for(var h in b)""===o(h,a)?f+=h+"="+b[h]+"&":g.push([h,b[h]]);return a=a.slice(0,c)+f+a.slice(c)+e,[a,g]}function l(a){return void 0===r&&(r=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL,"function"!=typeof r&&(r=null,q.default("warn","window.URL.createObjectURL (or vendor prefix) not found, unable to create local blob URLs"))),r?r(a):a}function m(a){return void 0===s&&(s=window.URL&&window.URL.revokeObjectURL||window.webkitURL&&window.webkitURL.revokeObjectURL,"function"!=typeof s&&(s=null,q.default("warn","window.URL.revokeObjectURL (or vendor prefix) not found, unable to create local blob URLs"))),s?s(a):a}function n(){for(var a=document.currentScript,b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];if(a)return a.src;if(Array.isArray(c))for(var e=document.getElementsByTagName("script"),f=0;f<e.length;f++)for(var g=0;g<c.length;g++)if(e[f].src.indexOf(c[g])>-1)return e[f].src}function o(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(b);return null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))}Object.defineProperty(c,"__esModule",{value:!0}),c.addBaseURL=e,c.pathForURL=f,c.extensionForURL=g,c.isLocalURL=h,c.isRelativeURL=i,c.flattenRelativeURL=j,c.addParamsToURL=k,c.createObjectURL=l,c.revokeObjectURL=m,c.findCurrentURL=n;var p=a("./log"),q=d(p),r=void 0,s=void 0},{"./log":259}],269:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(c,"__esModule",{value:!0});var e,f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=a("./log"),h=d(g),i=a("./thread"),j=d(i),k=a("./worker_broker"),l=d(k),m=a("../geo"),n=d(m);c.default=e={},l.default.addTarget("Utils",e),e.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},e.isMicrosoft=function(){return/(Trident\/7.0|Edge[ \/](\d+[\.\d]+))/i.test(navigator.userAgent)},e._requests={},e._proxy_requests={},e.io=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"GET",f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(j.default.is_worker&&e.isMicrosoft())return h.default("debug","Proxying request for URL to worker",a),g&&(e._proxy_requests[g]=!0),l.default.postMessage("Utils.io",a,b,c,d,f,g,!0);var k=new XMLHttpRequest,m=new Promise(function(e,f){k.open(d,a,!0),k.timeout=b,k.responseType=c,k.onload=function(){if(200===k.status)e(["text","json"].indexOf(k.responseType)>-1?k.responseText:k.response);else{var a=Error("Request error with a status (code:"+k.status+") of "+k.statusText);a.body=["text","json"].indexOf(k.responseType)>-1?k.responseText:k.response,f(a)}},k.onerror=function(a){f(Error("There was a network error"+a.toString()))},k.ontimeout=function(a){f(Error("timeout "+a.toString()))},k.send()});return m=m.then(function(a){return g&&delete e._requests[g],i?l.default.withTransferables(a):a}),g&&(e._requests[g]=k),m},e.cancelRequest=function(a){if(j.default.is_worker&&e._proxy_requests[a])return l.default.postMessage("Utils.cancelRequest",a);var b=e._requests[a];b?(h.default("trace","Cancelling network request key '"+a+"'"),e._requests[a].abort(),delete e._requests[a]):h.default("trace","Could not find network request key '"+a+"'")},e.requestAnimationFramePolyfill=function(){"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,1e3/60)})},e.serializeWithFunctions=function(a){if("function"==typeof a)return a.toString();var b=JSON.stringify(a,function(a,b){return"function"==typeof b?b.toString():b});return b},e.stringsToFunctions=function(a,b){if("string"==typeof a)a=e.stringToFunction(a,b);else if(null!=a&&"object"===("undefined"==typeof a?"undefined":f(a)))for(var c in a)a[c]=e.stringsToFunctions(a[c],b);return a},e.stringToFunction=function(a,b){var c="string"==typeof a&&a.match(/^\s*function[^(]*\(([^)]*)\)\s*?\{([\s\S]*)\}$/m);if(c&&c.length>2)try{var d=c[2],e=c[1].length>0&&c[1].split(",").map(function(a){return a.trim()}).filter(function(a){return a});return e=e.length>0?e:["context"],"function"==typeof b?new Function(e.toString(),b(d)):new Function(e.toString(),d)}catch(b){return a}return a},e.use_high_density_display=!0,e.updateDevicePixelRatio=function(){var a=e.device_pixel_ratio;return e.device_pixel_ratio=e.use_high_density_display&&window.devicePixelRatio||1,e.device_pixel_ratio!==a},j.default.is_main&&e.updateDevicePixelRatio(),e.isPowerOf2=function(a){return 0===(a&a-1)},e.interpolate=function(a,b,c){if(!Array.isArray(b)||!Array.isArray(b[0]))return b;if(b.length<1)return b;var d,e,f,g,h,i;if(a<=b[0][0])g=b[0][1],"function"==typeof c&&(g=c(g));else if(a>=b[b.length-1][0])g=b[b.length-1][1],"function"==typeof c&&(g=c(g));else for(var j=0;j<b.length-1;j++)if(a>=b[j][0]&&a<b[j+1][0]){if(d=b[j][0],e=b[j+1][0],Array.isArray(b[j][1])){g=[];for(var k=0;k<b[j][1].length;k++)"function"==typeof c?(h=c(b[j][1][k]),i=c(b[j+1][1][k]),f=i-h,g[k]=f*(a-d)/(e-d)+h):(f=b[j+1][1][k]-b[j][1][k],g[k]=f*(a-d)/(e-d)+b[j][1][k])}else"function"==typeof c?(h=c(b[j][1]),i=c(b[j+1][1]),f=i-h,g=f*(a-d)/(e-d)+h):(f=b[j+1][1]-b[j][1],g=f*(a-d)/(e-d)+b[j][1]);break}return g},e.toCSSColor=function(a){return 1===a[3]?"rgb("+a.slice(0,3).map(function(a){return Math.round(255*a)}).join(", ")+")":"rgba("+a.map(function(a,b){return 3>b&&Math.round(255*a)||a}).join(", ")+")"},e.pointInTile=function(a){return a[0]>=0&&a[1]>-n.default.tile_scale&&a[0]<n.default.tile_scale&&a[1]<=0}},{"../geo":201,"./log":259,"./thread":267,"./worker_broker":271}],270:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=JSON.parse('{\n  "name": "tangram",\n  "version": "0.13.2",\n  "description": "WebGL Maps for Vector Tiles",\n  "repository": {\n    "type": "git",\n    "url": "git://github.com/tangrams/tangram.git"\n  },\n  "main": "dist/tangram.min.js",\n  "homepage": "https://github.com/tangrams/tangram",\n  "keywords": [\n    "maps",\n    "graphics",\n    "rendering",\n    "visualization",\n    "WebGL",\n    "OpenStreetMap"\n  ],\n  "config": {\n    "output": "",\n    "output_map": ""\n  },\n  "scripts": {\n    "start": "npm run watch",\n    "test": "npm run lint && npm run build-bundle && npm run test-local",\n    "test-ci": "npm run lint && npm run build-bundle && npm run test-remote",\n    "test-remote": "./node_modules/karma/bin/karma start --browsers SL_Firefox --single-run",\n    "test-local": "./node_modules/karma/bin/karma start --browsers Chrome --single-run",\n    "karma-start": "./node_modules/karma/bin/karma start --browsers Chrome --no-watch",\n    "karma-run": "./node_modules/karma/bin/karma run --browsers Chrome",\n    "lint": "$(npm bin)/jshint src/ && jshint test/",\n    "build": "npm run build-bundle && npm run build-minify",\n    "build-bundle": "$(npm bin)/browserify src/module.js -t [ babelify --presets [ es2015 ] ] -t brfs --debug -s Tangram -p browserify-derequire -p [ \'./build/quine.js\' \'\' ] -p [ mapstraction \'dist/\' ] -o dist/tangram.debug.js",\n    "build-minify": "$(npm bin)/uglifyjs dist/tangram.debug.js -c warnings=false -m | sed -e \'s///g\' > dist/tangram.min.js && npm run build-size",\n    "build-size": "gzip dist/tangram.min.js -c | wc -c | awk \'{kb=$1/1024; print kb}\' OFMT=\'%.0fk minified+gzipped\'",\n    "watch": "$(npm bin)/budo src/module.js:dist/tangram.debug.js --port 8000 --cors --live -- -t [ babelify --presets [ es2015 ] ] -t brfs -s Tangram -p [ \'./build/quine.js\' \'tangram.debug.temp.js.map\' ] -p [ mapstraction \'dist/tangram.debug.temp.js.map\' ]"\n  },\n  "author": {\n    "name": "Mapzen",\n    "email": "tangram@mapzen.com"\n  },\n  "contributors": [\n    {\n      "name": "Brett Camper"\n    },\n    {\n      "name": "Peter Richardson"\n    },\n    {\n      "name": "Patricio Gonzalez Vivo"\n    },\n    {\n      "name": "Karim Naaji"\n    },\n    {\n      "name": "Ivan Willig"\n    },\n    {\n      "name": "Lou Huang"\n    },\n    {\n      "name": "David Valdman"\n    },\n    {\n      "name": "Nick Doiron"\n    }\n  ],\n  "license": "MIT",\n  "dependencies": {\n    "brfs": "1.4.3",\n    "csscolorparser": "1.0.3",\n    "earcut": "2.1.1",\n    "fontfaceobserver": "2.0.7",\n    "geojson-vt": "2.4.0",\n    "gl-mat3": "1.0.0",\n    "gl-mat4": "1.1.4",\n    "gl-shader-errors": "1.0.3",\n    "js-yaml": "tangrams/js-yaml#read-only",\n    "jszip": "tangrams/jszip#read-only",\n    "pbf": "1.3.7",\n    "strip-comments": "0.3.2",\n    "topojson-client": "tangrams/topojson-client#read-only",\n    "vector-tile": "1.3.0"\n  },\n  "devDependencies": {\n    "babelify": "7.3.0",\n    "babel-preset-es2015": "6.16.0",\n    "browserify": "14.4.0",\n    "browserify-derequire": "0.9.4",\n    "budo": "10.0.3",\n    "chai": "1.9.2",\n    "chai-as-promised": "4.1.1",\n    "core-js": "2.4.1",\n    "glob": "4.0.6",\n    "jshint": "2.9.4",\n    "karma": "1.5.0",\n    "karma-browserify": "5.1.1",\n    "karma-chrome-launcher": "2.0.0",\n    "karma-mocha": "0.1.9",\n    "karma-mocha-reporter": "1.0.0",\n    "karma-sauce-launcher": "tangrams/karma-sauce-launcher#firefox-profiles2",\n    "karma-sinon": "1.0.4",\n    "mapstraction": "1.0.1",\n    "mocha": "1.21.4",\n    "sinon": "1.10.3",\n    "through2": "2.0.3",\n    "uglify-js": "2.4.14",\n    "yargs": "1.3.2"\n  }\n}\n'),e=void 0;c.default=e="v"+d.version},{}],271:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a){var b=[];"string"==typeof a&&(b=a.split("."),a=b.pop());for(var c=t,d=0;d<b.length;d++){if(!c[b[d]])return[];c=c[b[d]]}return[a,c]}function g(){k.postMessage=function(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),f=2;c>f;f++)d[f-2]=arguments[f];if(Array.isArray(a))return Promise.all(a.map(function(a){var c;return(c=k).postMessage.apply(c,[a,b].concat(e(d)))}));var g=new Promise(function(a,c){s[r]={method:b,message:d,resolve:a,reject:c}}),h=void 0,i=[];return d&&1===d.length&&d[0]instanceof k.withTransferables&&(i=d[0].transferables,d=d[0].value),h={type:"main_send",message_id:r,method:b,message:d},a.postMessage(h,i.map(function(a){return a.object})),j(i),i.length>0&&q.default("trace","'"+b+"' transferred "+i.length+" objects to worker thread"),r++,g},k.addWorker=function(a){if(!(a instanceof Worker))throw Error("Worker broker could not add non-Worker object",a);a.addEventListener("message",function(b){var c=b.data,d=c.message_id;if("worker_reply"===c.type)s[d]&&(c.error?s[d].reject(c.error):s[d].resolve(c.message),delete s[d]);else if("worker_send"===c.type&&null!=d){var e=f(c.method),g=m(e,2),h=g[0],i=g[1];if(!i)throw Error("Worker broker could not dispatch message type "+c.method+" on target "+c.target+" because no object with that name is registered on main thread");var l="function"==typeof i[h]&&i[h];if(!l)throw Error("Worker broker could not dispatch message type "+c.method+" on target "+c.target+" because object has no method with that name");var n,o;try{n=l.apply(i,c.message)}catch(a){o=a}var p=void 0,r=[];n instanceof Promise?n.then(function(b){b instanceof k.withTransferables&&(r=b.transferables,b=b.value[0]),p={type:"main_reply",message_id:d,message:b},a.postMessage(p,r.map(function(a){return a.object})),j(r),r.length>0&&q.default("trace","'"+h+"' transferred "+r.length+" objects to worker thread")},function(b){a.postMessage({type:"main_reply",message_id:d,error:b instanceof Error?b.message+": "+b.stack:b})}):(n instanceof k.withTransferables&&(r=n.transferables,n=n.value[0]),p={type:"main_reply",message_id:d,message:n,error:o instanceof Error?o.message+": "+o.stack:o},a.postMessage(p,r.map(function(a){return a.object})),j(r),r.length>0&&q.default("trace","'"+h+"' transferred "+r.length+" objects to worker thread"))}})},k.getMessages=function(){return s},k.getMessageId=function(){return r}}function h(){k.postMessage=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];var e=new Promise(function(b,d){s[r]={method:a,message:c,resolve:b,reject:d}}),f=void 0,g=[];return c&&1===c.length&&c[0]instanceof k.withTransferables&&(g=c[0].transferables,c=c[0].value),f={type:"worker_send",message_id:r,method:a,message:c},self.postMessage(f,g.map(function(a){return a.object})),j(g),g.length>0&&q.default("trace","'"+a+"' transferred "+g.length+" objects to main thread"),r++,e},self.addEventListener("message",function(a){var b=a.data,c=b.message_id;if("main_reply"===b.type)s[c]&&(b.error?s[c].reject(b.error):s[c].resolve(b.message),delete s[c]);else if("main_send"===b.type&&null!=c){var d=f(b.method),e=m(d,2),g=e[0],h=e[1];if(!h)throw Error("Worker broker could not dispatch message type "+b.method+" on target "+b.target+" because no object with that name is registered on main thread");var i="function"==typeof h[g]&&h[g];if(!i)throw Error("Worker broker could not dispatch message type "+b.method+" because worker has no method with that name");var l,n;try{l=i.apply(h,b.message)}catch(a){n=a}var o=void 0,p=[];l instanceof Promise?l.then(function(a){a instanceof k.withTransferables&&(p=a.transferables,a=a.value[0]),o={type:"worker_reply",message_id:c,message:a},self.postMessage(o,p.map(function(a){return a.object})),j(p),p.length>0&&q.default("trace","'"+g+"' transferred "+p.length+" objects to main thread")},function(a){self.postMessage({type:"worker_reply",message_id:c,error:a instanceof Error?a.message+": "+a.stack:a})}):(l instanceof k.withTransferables&&(p=l.transferables,l=l.value[0]),o={type:"worker_reply",message_id:c,message:l,error:n instanceof Error?n.message+": "+n.stack:n},self.postMessage(o,p.map(function(a){return a.object})),j(p),p.length>0&&q.default("trace","'"+g+"' transferred "+p.length+" objects to main thread"))}})}function i(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!a)return d;if(Array.isArray(a))a.forEach(function(b,c){return i(b,a,c,d)});else if("object"===("undefined"==typeof a?"undefined":l(a)))if(a instanceof ArrayBuffer)d.push({object:a,parent:b,property:c});else if(a.buffer instanceof ArrayBuffer)d.push({object:a.buffer,parent:b,property:c});else for(var e in a)i(a[e],a,e,d);return d}function j(a){Array.isArray(a)&&a.filter(function(a){return a.parent&&a.property}).forEach(function(a){return delete a.parent[a.property]})}Object.defineProperty(c,"__esModule",{value:!0});var k,l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},m=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=a("./thread"),o=d(n),p=a("./log"),q=d(p);c.default=k={};var r=0,s={},t={};k.addTarget=function(a,b){t[a]=b},k.removeTarget=function(a){delete t[a]},k.withTransferables=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return this instanceof k.withTransferables?(this.value=b,void(this.transferables=i(this.value))):new(Function.prototype.bind.apply(k.withTransferables,[null].concat(b)))},o.default.is_main&&g(),o.default.is_worker&&h()},{"./log":259,"./thread":267}],272:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();c.default=d={},d.set=function(a){for(var b=[],c=a.length,d=0;c>d;d++)b[d]=a[d];return b},d.neg=function(a){for(var b=[],c=a.length,d=0;c>d;d++)b[d]=-a[d];return b},d.add=function(a,b){for(var c=[],d=Math.min(a.length,b.length),e=0;d>e;e++)c[e]=a[e]+b[e];return c},d.sub=function(a,b){for(var c=[],d=Math.min(a.length,b.length),e=0;d>e;e++)c[e]=a[e]-b[e];return c},d.signed_area=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])},d.mult=function(a,b){var c,d=[],e=a.length;if("number"==typeof b)for(c=0;e>c;c++)d[c]=a[c]*b;else for(e=Math.min(a.length,b.length),c=0;e>c;c++)d[c]=a[c]*b[c];return d},d.div=function(a,b){var c,d=[];if("number"==typeof b)for(c=0;c<a.length;c++)d[c]=a[c]/b;else{var e=Math.min(a.length,b.length);for(c=0;e>c;c++)d[c]=a[c]/b[c]}return d},d.perp=function(a,b){return[b[1]-a[1],a[0]-b[0]]},d.rot=function(a,b){var c=Math.cos(b),d=Math.sin(b);return[a[0]*c-a[1]*d,a[0]*d+a[1]*c]},d.angle=function(a){var b=e(a,2),c=b[0],d=b[1];return Math.atan2(d,c)},d.angleBetween=function(a,b){var c=d.dot(d.normalize(a),d.normalize(b));return c>1&&(c=1),Math.acos(c)},d.isEqual=function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d]!==b[d])return!1;return!0},d.lengthSq=function(a){return 2===a.length?a[0]*a[0]+a[1]*a[1]:a.length>=3?a[0]*a[0]+a[1]*a[1]+a[2]*a[2]:0},d.length=function(a){return Math.sqrt(d.lengthSq(a))},d.normalize=function(a){var b;if(2===a.length)return b=a[0]*a[0]+a[1]*a[1],1===b?a:(b=Math.sqrt(b),0!==b?[a[0]/b,a[1]/b]:[0,0]);if(a.length>=3){if(b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],1===b)return a;if(b=Math.sqrt(b),0!==b)return[a[0]/b,a[1]/b,a[2]/b]}return[0,0,0]},d.cross=function(a,b){return 2===a.length?a[0]*b[1]-a[1]*b[0]:3===a.length?[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]:void 0},d.dot=function(a,b){for(var c=0,d=Math.min(a.length,b.length),e=0;d>e;e++)c+=a[e]*b[e];return c}},{}],273:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0}),c.VIEW_PAN_SNAP_TIME=void 0;var f=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./geo"),i=d(h),j=a("./tile"),k=d(j),l=a("./camera"),m=d(l),n=a("./utils/utils"),o=d(n),p=a("./utils/subscribe"),q=d(p),r=a("./utils/log"),s=d(r),t=c.VIEW_PAN_SNAP_TIME=.5,u=function(){function a(b,c){e(this,a),q.default(this),this.scene=b,this.createMatrices(),this.zoom=null,this.center=null,this.bounds=null,this.meters_per_pixel=null,this.panning=!1,this.panning_stop_at=0,this.pan_snap_timer=0,this.zoom_direction=0,this.user_input_at=0,this.user_input_timeout=50,this.user_input_active=!1,this.size={css:{},device:{},meters:{}},this.aspect=null,this.buffer=0,this.continuous_zoom="boolean"!=typeof c.continuousZoom||c.continuousZoom,this.wrap=c.wrapView!==!1,this.preserve_tiles_within_zoom=1,this.reset()}return g(a,[{key:"reset",value:function(){this.createCamera()}},{key:"createCamera",value:function(){var a=this.getActiveCamera();a&&(this.camera=m.default.create(a,this,this.scene.config.cameras[a]),this.camera.updateView())}},{key:"getActiveCamera",value:function(){if(this.scene.config&&this.scene.config.cameras){for(var a in this.scene.config.cameras)if(this.scene.config.cameras[a].active)return a;var b=Object.keys(this.scene.config.cameras);return b.length&&b[0]}}},{key:"setActiveCamera",value:function(a){var b=this.getActiveCamera();return this.scene.config.cameras[a]&&(this.scene.config.cameras[a].active=!0,b&&b!==a&&this.scene.config.cameras[b]&&delete this.scene.config.cameras[b].active),this.scene.updateConfig({
rebuild:!1,normalize:!1}),this.getActiveCamera()}},{key:"update",value:function(){null!=this.camera&&this.ready()&&this.camera.update(),this.pan_snap_timer=(+new Date-this.panning_stop_at)/1e3,this.user_input_active=+new Date-this.user_input_at<this.user_input_timeout}},{key:"setViewportSize",value:function(a,b){this.size.css={width:a,height:b},this.size.device={width:Math.round(this.size.css.width*o.default.device_pixel_ratio),height:Math.round(this.size.css.height*o.default.device_pixel_ratio)},this.aspect=this.size.css.width/this.size.css.height,this.updateBounds()}},{key:"setView",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.lng,c=a.lat,d=a.zoom,e=!1;return"number"==typeof b&&"number"==typeof c&&(this.center&&b===this.center.lng&&c===this.center.lat||(e=!0,this.center={lng:b,lat:c})),"number"==typeof d&&d!==this.zoom&&(e=!0,this.setZoom(d)),e&&this.updateBounds(),e}},{key:"setZoom",value:function(a){var b=this.tile_zoom,c=this.baseZoom(a);this.continuous_zoom||(a=c),c!==b&&(this.zoom_direction=c>b?1:-1),this.zoom=a,this.tile_zoom=c,this.updateBounds(),this.scene.requestRedraw()}},{key:"baseZoom",value:function(a){return Math.floor(a)}},{key:"setPanning",value:function(a){this.panning=a,this.panning||(this.panning_stop_at=+new Date)}},{key:"markUserInput",value:function(){this.user_input_at=+new Date}},{key:"ready",value:function(){return"number"==typeof this.size.css.width&&"number"==typeof this.size.css.height&&null!=this.center&&"number"==typeof this.zoom}},{key:"updateBounds",value:function(){if(this.ready()){this.meters_per_pixel=i.default.metersPerPixel(this.zoom),this.size.meters={x:this.size.css.width*this.meters_per_pixel,y:this.size.css.height*this.meters_per_pixel};var a=i.default.latLngToMeters([this.center.lng,this.center.lat]),b=f(a,2),c=b[0],d=b[1];this.center.meters={x:c,y:d},this.center.tile=i.default.tileForMeters([this.center.meters.x,this.center.meters.y],this.tile_zoom),this.bounds={sw:{x:this.center.meters.x-this.size.meters.x/2,y:this.center.meters.y-this.size.meters.y/2},ne:{x:this.center.meters.x+this.size.meters.x/2,y:this.center.meters.y+this.size.meters.y/2}},this.scene.tile_manager.updateTilesForView(),this.trigger("move"),this.scene.requestRedraw()}}},{key:"findVisibleTileCoordinates",value:function(){if(!this.bounds)return[];var a=this.tile_zoom,b=i.default.tileForMeters([this.bounds.sw.x,this.bounds.sw.y],a),c=i.default.tileForMeters([this.bounds.ne.x,this.bounds.ne.y],a),d=[b.x-this.buffer,c.x+this.buffer,c.y-this.buffer,b.y+this.buffer];if(this.wrap===!1){var e=(1<<a)-1;d=d.map(function(a){return Math.min(Math.max(0,a),e)})}for(var f=[],g=d[0];g<=d[1];g++)for(var h=d[2];h<=d[3];h++)f.push(k.default.coord({x:g,y:h,z:a}));return f}},{key:"pruneTilesForView",value:function(){var a=this;if(this.ready()){var b=[Math.ceil((Math.floor(this.size.css.width/i.default.tile_size)+2)/2),Math.ceil((Math.floor(this.size.css.height/i.default.tile_size)+2)/2)];this.scene.tile_manager.removeTiles(function(c){if(c.visible||c.proxy_for)return!1;if(c.loading&&c.style_zoom!==a.tile_zoom)return!0;var d=Math.abs(c.style_zoom-a.tile_zoom);if(d>a.preserve_tiles_within_zoom)return!0;var e=k.default.coordinateAtZoom(c.coords,a.tile_zoom);return Math.abs(e.x-a.center.tile.x)-b[0]>a.buffer?(s.default("trace","View: remove tile "+c.key+" (as "+e.x+"/"+e.y+"/"+a.tile_zoom+") for being too far out of visible area ***"),!0):Math.abs(e.y-a.center.tile.y)-b[1]>a.buffer&&(s.default("trace","View: remove tile "+c.key+" (as "+e.x+"/"+e.y+"/"+a.tile_zoom+") for being too far out of visible area ***"),!0)})}}},{key:"createMatrices",value:function(){this.matrices={},this.matrices.model=new Float64Array(16),this.matrices.model32=new Float32Array(16),this.matrices.model_view=new Float64Array(16),this.matrices.model_view32=new Float32Array(16),this.matrices.normal=new Float64Array(9),this.matrices.normal32=new Float32Array(9),this.matrices.inverse_normal32=new Float32Array(9)}},{key:"setupTile",value:function(a,b){a.setupProgram(this.matrices,b),this.camera.setupMatrices(this.matrices,b)}},{key:"setupProgram",value:function(a){a.uniform("2fv","u_resolution",[this.size.device.width,this.size.device.height]),a.uniform("3fv","u_map_position",[this.center.meters.x,this.center.meters.y,this.zoom]),a.uniform("1f","u_meters_per_pixel",this.meters_per_pixel),a.uniform("1f","u_device_pixel_ratio",o.default.device_pixel_ratio),a.uniform("1f","u_view_pan_snap_timer",this.pan_snap_timer),a.uniform("1i","u_view_panning",this.panning),this.camera.setupProgram(a)}},{key:"isAnimating",value:function(){return this.pan_snap_timer<=t}}]),a}();c.default=u},{"./camera":200,"./geo":201,"./tile":251,"./utils/log":259,"./utils/subscribe":265,"./utils/utils":269}]},{},[225])(225)})}();
//# sourceMappingURL=tangram.min.js.map