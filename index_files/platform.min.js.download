define("platform/common/constants",["constants"],function(e){"use strict";return{EDITOR_API_NS:"editorAPI",PLATFORM_PANEL:"PLATFORM_PANEL",PLATFORM_ON_EVENT:"PLATFORM_ON_EVENT",PLATFORM_SDK_ALIVE:"PLATFORM_SDK_ALIVE",PLATFORM_SDK_READY:"PLATFORM_SDK_READY",CONTROLLER_COMPONENT_TYPE:"platform.components.AppController",TPA_WIDGET_TYPE_TEMPLATE:{qname:{prefix:"$w",shortName:"IFrame"},componentType:"wysiwyg.viewer.components.tpapps.TPAWidget",tagName:"",members:null,events:null,baseTypes:{},inheritanceChain:null},ACTION_CONNECT:"connect",EVENTS:{controllerSettingsButtonClicked:"controllerSettingsButtonClicked",componentConnectButtonClicked:"componentConnectButtonClicked",createCollectionButtonClicked:"openCreateNewCollection",formBuilderAppClicked:"formBuilderAppClicked"},panelTypes:{COMPONENT_PANEL:"componentPanel",FULL_STAGE:"fullStagePanel",MODAL:"modalPanel",TOOL:"toolPanel",TOOL_BAR:"toolBarPanel"},pages:{page_settings:{layout:{type:e.PAGE_SETTINGS_TABS.LAYOUT,fallbackType:"Pages_Layouts_Tab_Title"},permissions:{type:e.PAGE_SETTINGS_TABS.PERMISSIONS,fallbackType:"Pages_Permissions_Tab_Title"},pageInfo:{type:e.PAGE_SETTINGS_TABS.PAGE_INFO},seo:{type:e.PAGE_SETTINGS_TABS.SEO}},page_actions:{rename:{title:"Pages_Actions_Page_Rename",type:"Pages_Actions_Page_Rename",icon:"quickActionsRename"}}},members:{router_actions:{view_site_members:{title:"Pages_Panel_MemberMenu_SiteMembers_Link",type:"view_site_members",icon:"goToURLAction"},open_signup_settings:{title:"Pages_Panel_MemberMenu_SignupSettings_Link",type:"open_signup_settings",icon:"membersAction"}}},controller:{DEFAULT_STATE:"default"}}}),define("platform/bi/events.json",[],function(){return{CONTROLLER_GFPP_CLICK:{evid:26,src:79,endpoint:"platform",fields:{app_name:"string",action_name:"string",controller_type:"string",component_id:"string",pageId:"string"}},page_delete_dataset:{evid:91,src:79,endpoint:"platform",fields:{app_name:"string",controller_type:"string",component_id:"string",pageId:"string"}}}}),define("platform/appController/controllerSettingsGfpp",["lodash","platform/common/constants","platform/bi/events.json"],function(e,n,t){"use strict";function o(n,t){var o=e.get(n.platform.controllers.getStageData(e.head(t)),"mainAction.label");return e.isNil(o)?a:o}var i={dataset:"7f921134-acd3-4771-ac24-33bbeafefb90",router_dataset:"7f921134-acd3-4771-ac24-33bbeafefb90"},a="Manage Dataset",r={mainActions:[{label:o,shouldTranslate:!1,onClick:function(i,a){var r=e.head(a),p=i.components.data.get(r),l=n.EVENTS.controllerSettingsButtonClicked,s=i.documentServices.platform.controllers.settings.get(r),c=i.documentServices.platform.controllers.getName(r),m={controllerRef:r,controllerConfig:s,controllerType:p.controllerType,controllerDisplayName:c,origin:"gfpp"};i.bi.event(t.CONTROLLER_GFPP_CLICK,{action_name:o(i,a),app_name:p.applicationId,controller_type:p.controllerType,component_id:r.id,pageId:i.pages.getCurrentPageId()});var u=i.documentServices.platform.getAppDataByAppDefId(p.applicationId);i.documentServices.platform.notifyApplication(u.applicationId,{eventType:l,eventPayload:m})}}],presetActions:{help:{helpId:function(e,n){var t=e.components.data.get(n).controllerType;return i[t]||"3c9b0528-699b-475f-818c-2123885cb11f"}}}};return{init:function(e,n){r.enabledActions=[n.HELP],e("AppController",r)}}}),define("platform/appController/appController",["lodash","platform/appController/controllerSettingsGfpp","platform/bi/events.json"],function(e,n,t){"use strict";function o(n,t){var o=e.reduce(t,function(e,t){return n.components.is.container(t)?e.concat(t,n.components.get.byAncestor(t)):e.concat(t)},[]),i=void 0;return e.some(o,function(t){var a=n.documentServices.platform.controllers.connections.get(t);return!e.isEmpty(a)&&function(t){return i=i||e.keyBy(o,"id"),e(t).map("controllerRef").some(function(e){var t=e.id;return!i[t]&&n.components.getPage(e).id!==n.pages.getMasterPageId()})}(a)})}function i(n,t,i){function a(t){n.panelManager.openPanel("platform.panels.warnForDisconnectedComponentsPanel",e.assign({undo:n.history.undo},t))}t=e.isArray(t)?t:[t];var r=n.components.isShowOnAllPages(t),p=n.components.isShowOnAllPages(i);r&&!p&&function(n,t){return e(t).reduce(function(e,t){return n.components.is.container(t)?e.concat(t,n.components.get.byAncestor(t)):e.concat(t)},[]).some(function(e){return"platform.components.AppController"===n.components.getType(e)})}(n,t)&&a({controllerComp:!0}),!r&&p&&o(n,t)&&a({connectedComps:!0})}function a(e,o,a){return n.init(o,a),e.registerCannotRemovePlugin("platform.components.AppController",function(e,n){var o=e.components.data.get(n);e.bi.event(t.page_delete_dataset,{app_name:o.applicationId,controller_type:o.controllerType,controller_id:n.id,pageId:e.documentServices.pages.getPrimaryPageId()})}.bind(null,e)),e.editorEventRegistry.register(e.editorEventRegistry.constants.events.SET_CONTAINER_BEFORE,i),this}return{init:a}}),define("platform/common/utils",["lodash","util"],function(e,n){"use strict";return{getPanelName:function(e){return"platformPanels."+e},getFullApplicationUrl:function(t,o,i,a){var r=e.chain(window.location.search.substr(1)).thru(n.url.parseUrlParams).get("editorPlatformAppSources","").split(",").invokeMap("split",":").fromPairs().value();if(e.startsWith(o,"http"))return n.url.setUrlParam(o,"applicationId",a);var p=function(o){var a=t.documentServices.platform.getAppDataByAppDefId(i),r=e.get(a,"appFields.platform.editorScriptUrl");if(r)return r;var p=e.get(a,"editorArtifact");return p?o?n.url.joinURL(n.serviceTopology.scriptsDomainUrl,"services",p,o):n.serviceTopology.scriptsLocationMap[p]:void 0}(r[i]);if(p){var l=new URL(o,p).href;return n.url.setUrlParam(l,"applicationId",a)}}}}),define("platform/connection/connectableComponentsConfig",["lodash","experiment"],function(e,n){"use strict";var t=["WRichText","Image","MatrixGallery","PaginatedGridGallery","SliderGallery","SlideShowGallery","SiteButton","TextInput","TextAreaInput","Checkbox","RadioButton","RadioGroup","OptionsListInput","WPhoto","ImageButton","ComboBoxInput","Grid","DatePicker","ToggleSwitch"],o=["Impress","Masonry","Thumbnails","StripSlideshow","StripShowcase","Accordion","Freestyle","Collage","Honeycomb","SlideShowGallery","TPA3DGallery","TPA3DCarousel"];return{getConnectableComponents:function(){return n.isOpen("se_addConnectButtonToTpaGalleries")&&(t=[].concat(t,o)),n.isOpen("se_addFileUploaderConnect")&&(t=[].concat(t,["FileUploader"])),n.isOpen("se_addSocialVideoPlayerConnect")&&(t=[].concat(t,["Video"])),n.isOpen("se_addColumnConnect")&&(t=[].concat(t,["Column"])),n.isOpen("se_addPageConnect")&&(t=[].concat(t,["Page"])),n.isOpen("se_addStripConnect")&&(t=[].concat(t,["StripColumnsContainer"])),[].concat(t)}}}),define("platform/connection/connectableComponents",["lodash","platform/common/constants","platform/connection/connectableComponentsConfig"],function(e,n,t){"use strict";var o={enabledActions:[n.ACTION_CONNECT]};return{registerGfpp:function(e){t.getConnectableComponents().forEach(function(n){e(n,o)})}}}),define("platform/connection/connection",["lodash","coreUtilsLib","platform/common/constants","platform/common/utils","platform/connection/connectableComponents"],function(e,n,t,o,i){"use strict";function a(n,t){return n.platform.controllers.connections.isConnectedToDataBindingController(e.head(t))}function r(o,i){var a=o.documentServices.platform.getInstalledAppsData(),r=1===a.length?e.head(a):"multiple application ids provided - TODO",p=e.head(i),l=t.EVENTS.componentConnectButtonClicked,s={componentRef:p,componentType:o.components.getType(p),componentSdkType:o.wixCode.getCompSdkType(p),origin:"gfpp"};o.documentServices.platform.notifyApplication(r.applicationId,{eventType:l,eventPayload:n.objectUtils.cloneDeep(s)})}var p={connect:{isSelected:function(n){var i=o.getPanelName(t.panelTypes.COMPONENT_PANEL);return e.some(n.panelManager.getOpenPanels(),{name:i})},isApplied:a,tooltip:"gfpp_component_connect",tooltip_active:"gfpp_component_connected_to_controllers",icon:"connect",rightClickMenuLabel:"PLATFORM_RightClick_Menu_Connect",className:function(e,n){return a(e,n)?"connected":""},onClick:r}};return{init:function(e,n){return e(p),i.registerGfpp(n),this},notifyConnectButtonClicked:r}}),define("platform/services/tokenService",["lodash"],function(e){"use strict";return{generatePanelToken:function(n){return e.uniqueId("platform_"+n+"_")},generateStaticGlobalPanelToken:function(n){return e.uniqueId("platform_"+n)}}}),define("platform/api/editor/utils/utils",["util"],function(e){"use strict";return{getLinkAsString:function(n,t,o,i){return e.link.getLinkValueAsString(n,i.link)}}}),define("platform/api/editor/editor",["lodash","jquery","pmrpc","constants","platform/common/constants","platform/common/utils","platform/services/tokenService","platform/api/editor/utils/utils","stateManagement","experiment"],function(e,n,t,o,i,a,r,p,l,s){"use strict";function c(t,o,r,p){var l=m(t,o,p),s=a.getPanelName(i.panelTypes.TOOL),c=function(t,o){o=o||{};var i=t.panelManager.getOpenPanels(),a=e.find(i,{type:"platform"});if(a){var r=n('[name="'+a.token+'"]');if(r){var p=r.offset();if(p&&e.isNumber(p.top)&&e.isNumber(p.left)){if(e.isNumber(o.x)&&e.isNumber(o.y))return{top:p.top+o.y,left:p.left+o.x};if(e.isNumber(o.height)&&e.get(a,"props.height")&&e.get(a,"props.width"))return{top:p.top+a.props.height/2-o.height/2,left:p.left+a.props.width/2}}}}return{top:"25%",left:"45%"}}(t,p);return e.merge(l,c),new Promise(function(e){t.panelManager.openPlatformPanel({panelName:s,panelProps:l,panelMetaData:{resolve:e}})})}function m(n,t,o){var i=n.documentServices.platform.getAppDataByApplicationId(t.applicationId),p=e.assign({token:r.generatePanelToken(i.appDefinitionId)},o);return o.url&&e.assign(p,{url:a.getFullApplicationUrl(n,o.url,i.appDefinitionId,i.applicationId)}),p}function u(n,t,o,i){var a=function(n,t){return e.find(n.panelManager.getOpenPanels(),{token:t})}(n,o);if(a){var r=m(n,t,i);r.token=o,n.panelManager.updatePanelProps(a.name,r)}}var f={IMAGE:function(e){return{uri:e.uri,title:e.title,width:e.width,height:e.height}},DOCUMENT:function(e){return{uri:e.uri,title:e.title}},VIDEO:function(n){var t=function(n){var t=Math.floor(n.length/2)-(1-n.length%2);return e.nth(n,t)}(n.fileOutput.image);return{id:n.id,title:n.title,posterUri:t&&t.url,posterWidth:t&&t.width,posterHeight:t&&t.height}}};return{openPanel:function(e,n,t,o,i){e.panelManager.openPanel(t,o,i)},openComponentPanel:function(e,n,t,r){var p=m(e,n,r);e.selection.selectComponentByCompRef(r.componentRef),e.panelManager.openPlatformPanel({panelName:a.getPanelName(i.panelTypes.COMPONENT_PANEL),panelProps:p,panelMetaData:{frameType:o.PANEL_TYPES.COMP,closeAllOtherPanels:!0}})},openModalPanel:function(e,n,t,o){var r=m(e,n,o);return new Promise(function(n){e.panelManager.openPlatformPanel({panelName:a.getPanelName(i.panelTypes.MODAL),panelProps:r,panelMetaData:{resolve:n}})})},openToolPanel:c,openPagePanel:function(n,t,i,a){if(s.isOpen("newPagesPanel")){var r=a.pageRef.id,p=n.pages.dynamicPages.getDynamicPageActions(r,"pageSettings"),l=e.isEmpty(p)?{initialSettingsTabType:o.PAGE_SETTINGS_TABS.PAGE_INFO}:{initialSettingsTabType:e.head(p).type};n.navigateAndOpenPagesPanel(r,l)}else{var c=n.documentServices.pages.getPagesData(),m=a.pageRef.id,u=n.pages.dynamicPages.getMenuItems(),f=e.flatMap(u,"items"),d=n.mainMenu.getMenuItemsFlattened(c),g=e.find(d,["pageData.id",m])||e.find(f,{id:m}),P=n.pages.dynamicPages.getDynamicPageActions(m,"pageSettings")||[],_={menuItemToShowSettingsFor:g,selectedSettingsTab:e.isEmpty(P)?null:P[0].title};n.navigateAndOpenPagesPanel(m,_)}},openFullStagePanel:function(e,n,t,r){var p=m(e,n,r);e.panelManager.openPlatformPanel({panelName:a.getPanelName(i.panelTypes.FULL_STAGE),panelProps:p,panelMetaData:{frameType:o.PANEL_TYPES.FULL_STAGE,closeAllOtherPanels:!0}})},openLinkPanel:function(n,t,o,i){return new Promise(function(t){var o={link:e.get(i,"value",null),callback:t,onCancelCallback:t};n.openLinkPanel(o)})},openMediaPanel:function(n,t,o,i){return i=e.defaults(i||{},{callOnCancel:!0,isMultiSelect:!0,mediaType:"IMAGE"}),new Promise(function(t){n.mediaServices.mediaManager.open(i.mediaType,{multiSelect:i.isMultiSelect,callback:function(n){var o=void 0;if(e.isEmpty(n))i.callOnCancel&&(o=null);else{e.isArray(n)||(n=[n]);var a=e.get(f,i.mediaType,f.IMAGE);o=n.map(a)}t(o)}})})},openHelpPanel:function(e,n,t,o){var i={component:e.selection.getSelectedComponentType(),learn_more:!1,panel_name:"platform"};e.panelManager.openHelpCenter(o.helpId,{origin:"platform"},i)},updatePanelOptions:u,closePanel:function(e,n,t,o){e.store.dispatch(l.panels.logic.closePlatformPanel(t,o))},setAppAPI:function(e,n){return t.api.request(n.applicationId,{target:e.documentServices.platform.getAppsContainer()}).then(function(e){t.api.set(n.applicationId,e)})},save:function(e){return new Promise(function(n,t){e.saveManager.saveInBackground(function(){n()},t)})},utils:p}}),define("platform/api/editor/preview/preview",[],function(){"use strict";return{navigateTo:function(e,n,t,o){return new Promise(function(n){e.documentServices.platform.pages.navigateTo(o.pageUrl,function(){e.preview.isInPreviewMode()?n():e.preview.togglePreview(n)})})}}}),define("platform/api/document/vfs/vfs",["lodash"],function(e){"use strict";function n(e){return{name:e.name,fullPath:e.location,isDirectory:e.directory}}return{listChildren:function(t,o,i,a){var r=t.wixCode.fileSystem,p=r.getVirtualDescriptor(a.path,!0);return r.getChildren(p).then(function(t){return e.map(t,n)})},readFile:function(e,n,t,o){var i=e.wixCode.fileSystem,a=i.getVirtualDescriptor(o.path,!1);return i.readFile(a)},writeFile:function(e,n,t,o){var i=e.wixCode.fileSystem,a=i.getVirtualDescriptor(o.path,!1);return i.writeFile(a,o.content)},flush:function(e){return e.wixCode.fileSystem.flush()}}}),define("platform/api/document/pages/pages",["lodash","util"],function(e,n){"use strict";return{navigateTo:function(n,t,o,i){var a=e.get(i,"pageRef.id"),r=e.get(i,"pageLink"),p=a||r;if(p)return new Promise(function(e){n.pages.navigateTo(p,function(){e()})})},rename:function(e,t,o,i){var a=i.pageRef.id,r=n.validate.pageNameValidator(i.title);return r||e.pages.data.update(a,{title:i.title}),r},add:function(e,n,t,o){return new Promise(function(n){var t=e.pages.add(o.title,o.definition);e.pages.navigateTo(t.id,function(){n(t)})})},data:{update:function(e,n,t,o){var i=o.pageRef.id;e.pages.data.update(i,o.data)}}}}),define("platform/api/document/components/components",["lodash"],function(e){"use strict";function n(n,t,o,i){return new Promise(function(t,o){e.isEmpty(i.componentDefinition.componentType)&&o(new Error("componentDefinition must contain componentType"));var a=n.components.buildDefaultComponentStructure(i.componentDefinition.componentType);!function(n,t,o){var i=e.get(o,"pageRef.id")||n.documentServices.pages.getFocusedPageId(),a=n.pasteLogic.addContext.getPastePosition(n,t.layout,i);e.merge(t.layout,a)}(n,a,i),e.merge(a,i.componentDefinition);var r=n.components.add(i.pageRef,a,i.customId,void 0,"editorSdk",{showAddToHeaderPanel:i.showAddToHeaderPanel});n.documentServices.waitForChangesApplied(function(){n.components.is.exist(r)?t(r):o(new Error("Could not add component"))})})}return{add:n,getPage:function(e,n,t,o){return e.components.getPage(o.componentRef)},properties:{get:function(e,n,t,o){return e.components.properties.get(o.componentRef)},update:function(e,n,t,o){e.components.properties.update(o.componentRef,o.props)}},data:{get:function(e,n,t,o){return e.components.data.get(o.componentRef)},update:function(e,n,t,o){e.components.data.update(o.componentRef,o.data,!0)}},layout:{get:function(e,n,t,o){return e.components.layout.get(o.componentRef)}}}}),define("platform/api/document/routers/routers",["lodash","util"],function(e,n){"use strict";return{isValidPrefix:function(t,o,i,a){var r=e.get(o,"applicationId"),p=t.documentServices.routers.isValidPrefix(r,a.prefix);if(!p.valid){var l="";switch(p.message){case 1:l="DYNAMIC_PAGES_VALIDATION_PREFIX_CAN_NOT_BE_EMPTY";break;case 2:l="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_TOO_LONG";break;case 3:l="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_DUPLICATE_OF_URISEO";break;case 4:l="DYNAMIC_PAGES_VALIDATION_PREFIX_CONTAINS_INVALID_CHARCTERS";break;case 5:l="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_FORBIDDEN_WORD";break;case 6:l="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_IN_USE_BY_ANOTHER_APPLICATION"}p.message=n.translate(l)}return p},pages:{delete:function(n,t,o,i){return new Promise(function(o,a){var r=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),p=n.documentServices.routers.get.byRef(i.routerRef);p&&p.appDefinitionId===r?n.pages.remove(i.pageRef.id,function(){o()},function(){a()},!1):a()})}}}}),define("platform/api/document/history/history",[],function(){"use strict";return{add:function(e,n,t,o){return new Promise(function(n){e.documentServices.waitForChangesApplied(function(){e.history.add(o.label,null,o.historySnapshotId),n()})})}}}),define("platform/api/editor/ide/ide",["lodash"],function(e){"use strict";function n(e,n,t,o){return e.wixCode.collectionsTree.navigateToCollection(e,o.name)}function t(t,o,i,a){var r=a.path,p=t.wixCode.fileSystem.getRoots().schemas.location;if(function(n,t){return e.startsWith(t,n)&&e.endsWith(t,".json")}(p,r)){return n(t,0,0,{name:function(e,n){return n.replace(e,"").replace(".json","")}(p,a.path)})}return t.wixCode.fileTree.navigateToFile(t,a.path,e.pick(a,["functionName","caretOffset"]))}return{openFile:t,navigateToCollection:n,treePane:{isOpen:function(e){return e.developerMode.ui.treePane.isOpen()},toggle:function(e){return new Promise(function(n){e.developerMode.ui.treePane.toggle(function(){n()})})}}}}),define("platform/api/editor/info/info",["lodash","util"],function(e,n){"use strict";function t(e,n){return["//",i(),"/my-account/sites/",e.documentServices.generalInfo.getMetaSiteId(),"/app/",n,"?referralInfo=editor"].join("")}function o(e){return["//",i(),"/my-account/sites/",e.documentServices.generalInfo.getMetaSiteId(),"/simple-app","?app=wixcode","&referralInfo=editor_platform"].join("")}function i(){var e=window.location.hostname.match(/editor\.(.*)/);return e?"www."+e[1]:"www.wix.com"}function a(e){return!e.documentServices.generalInfo.isFirstSave()}var r=window.mainLoaded||0;return{getDashboardUrl:function(n,i){return new Promise(function(r,p){var l=a(n),s=e.get(n.documentServices.platform.getAppDataByApplicationId(i.applicationId),"appDefinitionId");l?r(s===n.documentServices.platform.editorApps.DATA_BINDING.appDefId?o(n):t(n,s)):s===n.documentServices.platform.editorApps.DATA_BINDING.appDefId?n.saveManager.saveInBackground(function(){r(o(n))},p):n.saveManager.saveInBackground(function(){r(t(n,s))},p)})},getMetaSiteId:function(e){return e.documentServices.generalInfo.getMetaSiteId()},getEditorSessionId:function(){return n.editorSessionUtil.editorSessionId},getSiteId:function(e){return e.documentServices.generalInfo.getSiteId()},getEditorReadyTimestamp:function(){return e.now()-r},getEditorMode:function(e){return e.getDeviceType()},getAppDefinitionId:function(e,n){var t=n.applicationId;return e.documentServices.platform.getAppDataByApplicationId(t).appDefinitionId},isSitePublished:function(e){return e.documentServices.generalInfo.isSitePublished()},getLanguage:function(e){return e.documentServices.generalInfo.getLanguage()},isSiteSaved:a}}),define("platform/api/editor/environment/environment",["util"],function(e){"use strict";return{getLocale:function(){return e.editorModel.languageCode}}}),define("platform/api/editor/userPreferences/userPreferences",["lodash","coreUtilsLib","stateManagement"],function(e,n,t){"use strict";return{site:{set:function(n,o,i,a){var r=e.get(n.documentServices.platform.getAppDataByApplicationId(o.applicationId),"appDefinitionId");if(!r)throw new Error("Illegal appData - application is not registered in clientSpecMap");e.forEach(a,function(e,o){n.store.dispatch(t.userPreferences.logic.setSiteUserPreferences(o,e,r))})},get:function(o,i,a,r){var p=e.get(o.documentServices.platform.getAppDataByApplicationId(i.applicationId),"appDefinitionId");if(!p)throw new Error("Illegal appData - application is not registered in clientSpecMap");var l=e.isArray(r)?e(r).keyBy().mapValues(e.noop).value():r,s=e.mapValues(l,function(e,i){return n.objectUtils.cloneDeep(t.userPreferences.selectors.getSiteUserPreferences(i,p)(o.store.getState()))});return e.defaults(s,l)}}}}),define("platform/api/document/tpa/tpa",["lodash"],function(e){"use strict";return{add:{application:function(n,t,o,i){return new Promise(function(t,o){e.get(i,"appDefinitionId")?n.tpa.addApplication(i.appDefinitionId,i).then(function(e){t(e)}).catch(function(e){o(e)}):o(new Error("options must contain appDefinitionId"))})},component:function(n,t,o,i){return new Promise(function(o,a){if((i=i||{}).componentType){if(i.appDefinitionId||(i.appDefinitionId=t.appDefinitionId),"WIDGET"===i.componentType){if(!e.isObject(i.widget))return void a(new Error("options must contain a widget object"));i.widget.tpaWidgetId=i.widget.widgetId}else if("PAGE"===i.componentType){if(!e.isObject(i.page))return void a(new Error("options must contain a page object"));if(i.page.isHidden&&!e.isBoolean(i.page.isHidden))return void a(new Error("isHidden param should be of type boolean"))}n.tpa.addComponent(i).then(function(e){o(e)}).catch(function(e){a(e)})}else a(new Error("options must contain componentType"))})}},isApplicationInstalled:function(n,t,o,i){return new Promise(function(t,o){e.get(i,"appDefinitionId")?t(n.documentServices.tpa.app.isInstalled(i.appDefinitionId)):o(new Error("options must contain appDefinitionId"))})},isAppSectionInstalled:function(n,t,o,i){return new Promise(function(o,a){if(e.get(i,"sectionId")){var r=t.applicationId;if(i.appDefinitionId){var p=n.documentServices.tpa.app.getDataByAppDefId(i.appDefinitionId);r=e.get(p,"applicationId")}o(n.documentServices.tpa.section.isSectionInstalledByTpaPageId(r,i.sectionId))}else a(new Error("options must contain sectionId"))})}}}),define("platform/api/document/application/application",["lodash"],function(e){"use strict";return{install:function(n,t,o,i){return new Promise(function(o,a){e.get(i,"appDefinitionId")?n.documentServices.platform.provision(i.appDefinitionId,{origin:{type:"APP",info:{appDefinitionId:e.get(t,"appDefinitionId")}}}).then(o,a):a(new Error("options must contain appDefinitionId"))})}}}),define("platform/api/internalAPIs",["lodash"],function(e){"use strict";return{addApp:function(n,t,o){n.wixCode.provision(e.noop,e.noop),n.documentServices.platform.initApp({appDefinitionId:e.get(o,"appDefinitionId"),editorUrl:e.get(o,"editorUrl"),viewerUrl:e.get(o,"viewerUrl")})}}}),define("platform/api/editor/selection/selection",["lodash"],function(e){"use strict";return{getSelectedComponents:function(e){return e.selection.getSelectedComponents()},deselectComponents:function(n,t,o,i){n.selection.deselectComponents(e.get(i,"compsToDeselect",[]))},selectComponentByCompRef:function(n,t,o,i){n.selection.selectComponentByCompRef(e.get(i,"compsToSelect",[]))}}}),define("platform/api/api",["lodash","platform/api/editor/editor","platform/api/editor/preview/preview","platform/api/document/vfs/vfs","platform/api/document/pages/pages","platform/api/document/components/components","platform/api/document/routers/routers","platform/api/document/history/history","platform/api/editor/ide/ide","platform/api/editor/info/info","platform/api/editor/environment/environment","platform/api/editor/userPreferences/userPreferences","platform/api/document/tpa/tpa","platform/api/document/application/application","platform/api/internalAPIs","platform/api/editor/selection/selection"],function(e,n,t,o,i,a,r,p,l,s,c,m,u,f,d,g){"use strict";var P={document:{application:f,components:a,history:p,pages:i,routers:r,tpa:u,vfs:o},editor:e.assign(n,{environment:c,ide:l,info:s,__internal__:d,preview:t,selection:g,userPreferences:m})};return e.merge(P,P.document,P.editor)}),define("platform/services/platformPostMessageService",["lodash","pmrpc","coreUtilsLib","platform/common/constants"],function(e,n,t,o){"use strict";function i(n,i){return function(a){if(a.data.intent===o.PLATFORM_PANEL&&a.data.sourcePanel===i)switch(a.data.type){case o.PLATFORM_SDK_READY:!function(n,o,i){if(e.isUndefined(n))return;o.event.eventPayload=t.objectUtils.cloneDeep(o.event.eventPayload),n.postMessage||(n=n.contentWindow);n.postMessage(o,i||"*")}(a.source,{intent:o.PLATFORM_ON_EVENT,event:{eventType:"startConfiguration",eventPayload:n}});break;default:return}}}return{init:function(e,t){n.api.set(o.EDITOR_API_NS,t,{onApiCall:e.documentServices.platform.reportAPICallBI})},createPostMessageListener:i}}),define("platform/plugins/componentsRemoveHandlerPlugins",["lodash","stateManagement"],function(e,n){"use strict";function t(t,o,i,a,r){if(function(n,t,o){var i=(o=e(o)).filter(function(e){return"platform.components.AppController"===n.components.getType(e)});if(i.isEmpty())return!1;var a=o.map("id").value();return i.map(function(e){return n.platform.controllers.connections.getConnectedComponents(e)}).some(function(n){return!e(n).map("id").difference(a).isEmpty()})}(o,0,a)){var p=e.filter(a,function(e){return"platform.components.AppController"===o.components.getType(e)}),l=1===p.length;return t(n.panels.logic.updateOrOpenPanel("platform.panels.appControllerDeleteConfirmationPanel",{onConfirm:r,isSingleController:l,controllerDisplayName:l?o.platform.controllers.getName(p[0]):""})),!0}return!1}function o(t,o,i,a,r){var p=!1;return e.forEach(a,function(i){var a=function(n,t){var o=e.head(n.platform.controllers.connections.get(t));if(!o)return!1;var i=e.get(n.platform.controllers.getStageData(o.controllerRef),["connections",o.role,"confirmOnDelete"]);return i||!1}(o,i);if(a)return t(n.panels.logic.updateOrOpenPanel("platform.panels.connectedComponentsDeleteConfirmationPanel",{onConfirm:r,title:a.title,contentText:a.contentText})),p=!0,!1}),p}return{confirmOnOrphanConnections:t,confirmOnProtectedComponents:o}}),define("platform/panels/appControllerDeleteConfirmationPanel.rt",["react","lodash","panels","baseUI"],function(e,n,t,o){"use strict";return function(){return e.createElement(t.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.appControllerDeleteConfirmationPanel",onConfirm:this.props.onConfirm,confirmLabel:"PLATFORM_messages_delete",cancelLabel:"PLATFORM_messages_cancel_delete",panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"deleteBlogConfirmationIcon"})),e.createElement("div",{className:"content"},e.createElement("p",{},this.getContentText())))}}),define("platform/panels/appControllerDeleteConfirmationPanel",["create-react-class","prop-types","core","util","platform/panels/appControllerDeleteConfirmationPanel.rt"],function(e,n,t,o,i){"use strict";return e({displayName:"appControllerDeleteConfirmationPanel",propTypes:{controllerDisplayName:n.string,isSingleController:n.bool,onConfirm:n.func},mixins:[o.translationMixin,t.mixins.editorAPIMixin],getContentText:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_text":"PLATFORM_messages_multidelete_dataset_text";return this.translateTemplate(e,{appName:"Wix Database"},this.getEditorAPI())},getTitle:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_title":"PLATFORM_messages_multidelete_dataset_title";return this.translateTemplate(e,{appControllerName:this.props.controllerDisplayName},this.getEditorAPI())},render:i})}),define("platform/panels/connectedComponentsDeleteConfirmationPanel.rt",["react","lodash","panels","baseUI"],function(e,n,t,o){"use strict";return function(){return e.createElement(t.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.connectedComponentsDeleteConfirmationPanel",onConfirm:this.props.onConfirm,confirmLabel:"PLATFORM_messages_delete",cancelLabel:"PLATFORM_messages_cancel_delete",panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"deleteBlogConfirmationIcon"})),e.createElement("div",{className:"content"},e.createElement("p",{},this.getContentText())))}}),define("platform/panels/connectedComponentsDeleteConfirmationPanel",["lodash","create-react-class","prop-types","util","higherOrderComponents","stateManagement","platform/panels/connectedComponentsDeleteConfirmationPanel.rt"],function(e,n,t,o,i,a,r){"use strict";var p=a.bi.error,l=n({displayName:"connectedComponentsDeleteConfirmationPanel",propTypes:{title:t.string,contentText:t.string,onConfirm:t.func},getContentText:function(){return this.props.contentText||o.translationUtil.translateTemplate("PLATFORM_messages_confirm_delete_connected_component_text",{},this.props.reportOnBiError)},getTitle:function(){return this.props.title||o.translationUtil.translateTemplate("PLATFORM_messages_confirm_delete_connected_component_title",{},this.props.reportOnBiError)},render:r}),s=i.connect(e.noop,function(e){return{reportOnBiError:function(n,t){return e(p(n,t))}}})(l);return s.pure=l,s}),define("platform/panels/warnForDisconnectedComponentsPanel.rt",["react","lodash","panels","baseUI"],function(e,n,t,o){"use strict";return function(){return e.createElement(t.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.warnForDisconnectedComponentsPanel",onCancel:this.props.undo,confirmLabel:"PLATFORM_messages_continue",cancelLabel:"PLATFORM_messages_cancel",shouldCloseByDefaultOnConfirm:!0,panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"platformWarning"})),this.props.connectedComps?e.createElement("div",{className:"content",key:"connectedCompsContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line2"))):null,this.props.connectedComps?null:e.createElement("div",{className:"content",key:"connectedDatasetContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line2"))))}}),define("platform/panels/warnForDisconnectedComponentsPanel",["create-react-class","prop-types","lodash","util","platform/panels/warnForDisconnectedComponentsPanel.rt"],function(e,n,t,o,i){"use strict";return e({displayName:"warnForDisconnectedComponentsPanel",propTypes:{undo:n.func.isRequired,connectedComps:n.bool.isRequired},mixins:[o.translationMixin],getTitle:function(){var e=this.props.connectedComps?"PLATFORM_messages_move_connected_element_title":"PLATFORM_messages_move_connected_dataset_title";return this.translateIfNeeded(e)},render:i})}),define("platform",["lodash","experiment","platform/appController/appController","platform/connection/connection","platform/api/api","platform/services/platformPostMessageService","platform/services/tokenService","platform/common/constants","platform/common/utils","platform/plugins/componentsRemoveHandlerPlugins","platform/panels/appControllerDeleteConfirmationPanel","platform/panels/connectedComponentsDeleteConfirmationPanel","platform/panels/warnForDisconnectedComponentsPanel"],function(e,n,t,o,i,a,r,p,l,s,c,m,u){"use strict";function f(r,p,l,c,m){var u=g(i,r),f=r.documentServices.platform.getAPIForSDK(u);t.init(r,l,m),o.init(p,c),a.init(r,f),r.documentServices.platform.init(u),function(t){t.registerSitePublishedCallbacks(e.partial(d,t)),n.isOpen("se_platformConfirmOnDelete")&&t.registerComponentsRemoveHandlerPlugin(s.confirmOnProtectedComponents);t.registerComponentsRemoveHandlerPlugin(s.confirmOnOrphanConnections)}(r)}function d(n){var t=n.platform.getInstalledEditorApps();e.forEach(t,function(e){n.documentServices.platform.notifyApplication(e.applicationId,{eventType:"siteWasPublished"})})}function g(n,t){return e.isFunction(n)?e.partial(n,t):e.isObject(n)?e.mapValues(n,function(e){return g(e,t)}):n}return{api:i,init:f,platformPostMessageService:a,tokenService:r,constants:p,utils:l,panels:{appControllerDeleteConfirmationPanel:c,connectedComponentsDeleteConfirmationPanel:m,warnForDisconnectedComponentsPanel:u}}});
//# sourceMappingURL=platform.min.js.map