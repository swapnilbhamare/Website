define("compUtils/core/compFactory",["react","create-react-class","lodash","utils"],function(e,t,r,i){"use strict";var s={},o={},n=void 0,p={},a={},c={};return i.sessionFreezer.freeze(s),i.sessionFreezer.freeze(o),{getCompClass:function(u,d){return function(u){var d=p[u];if(!d){var h=r.get(s,[u,"def"]);if(!h)return void i.log.error("Component not implemented:",u);var m=t({displayName:h.displayName||u||"componentClass",mixins:o[u].concat([h])});if(c[u]=m,d=e.createFactory(m),a[u]=d,r.get(s,[u,"isAPIComp"])){var l=n(u,m);p[u]=e.createFactory(l)}else p[u]=d}}(u),d?a[u]:p[u]},getCompReactClass:function(e){return this.getCompClass(e),c[e]},invalidate:function(e){delete p[e]},extend:function(e,t){s.hasOwnProperty(e)?o[e]=r.union(o[e].concat(t)):i.log.error("Component can't be extended:",e)},register:function(e,t,r){return s[e]={def:t,isAPIComp:r},o[e]=[],this},registerMobxObserver:function(e){return n=e,this},keys:function(){return r.keys(s)}}}),define("compUtils/core/MagicStructure",["lodash","mobx","utils"],function(e,t,r){"use strict";function i(t,r,i,s,o,n,p){!function(t,r){e.forOwn(r,function(e,r){Object.defineProperty(t,r,{value:e,enumerable:!1})})}(this,{cachedComputedStructureValues:{},siteData:t,displayedDAL:r,pointers:i,compId:s,computedPagePointer:o,computedChildrenToRender:n,computedParentDimensions:p})}var s=e(r.constants.COMP_DATA_QUERY_KEYS).values().concat(["id","componentType","type","modes","layout","skin","styleId","originalStyleId","originCompId"]).value();return i.prototype=e.transform(s,function(e,r){Object.defineProperty(e,r,{get:function(){return function(e){if(this.cachedComputedStructureValues[e])return this.cachedComputedStructureValues[e].get();var r=t.computed(function(){var t=this.pointers.components.getComponent(this.compId,this.computedPagePointer.get());if(!t||!this.displayedDAL.isExist(t))return null;var r=this.pointers.getInnerPointer(t,[e]);return this.displayedDAL.getStructureProperty(r)},{context:this,compareStructural:!0,name:this.compId+"_MagicStructure_"+e});return this.cachedComputedStructureValues[e]=r,r.get()}.call(this,r)}})},{}),Object.defineProperty(i.prototype,"components",{get:function(){if(this.cachedComputedStructureValues.components)return this.cachedComputedStructureValues.components.get();var r=t.computed(function(){return e.map(this.computedChildrenToRender.get(),"id")},{context:this,compareStructural:!0,name:this.compId+"_MagicStructure_components"});return this.cachedComputedStructureValues.components=r,r.get()}}),Object.defineProperty(i.prototype,"dimensions",{get:function(){if(this.cachedComputedStructureValues.dimensions)return this.cachedComputedStructureValues.dimensions.get();var e=t.computed(function(){return r.positionAndSize.isVerbsLayout(this.layout)?r.positionAndSize.getVerbsPositionAndSize(this.layout,this.computedParentDimensions.get(),this.siteData.getScreenSize(),this.siteData.getSiteWidth()):r.positionAndSize.getAbsolutePositionAndSize(this.layout)},{context:this,compareStructural:!0,name:this.compId+"_MagicStructure_dimensions"});return this.cachedComputedStructureValues.dimensions=e,e.get()}}),i}),define("compUtils/core/mobxObserverWrapper",["lodash","zepto","react","react-dom-factories","prop-types","create-react-class","reactDOM","mobx","mobx-react","utils","coreUtils","compUtils/core/compFactory","compUtils/core/MagicStructure","santaProps"],function(e,t,r,i,s,o,n,p,a,c,u,d,h,m){"use strict";function l(e){return{fetchSantaType:m.fetchers.fetch,siteData:e.getSiteData(),siteAPI:e}}function g(t,r,i,s){var o=e.isUndefined(r)?"masterPage":r;return{structure:i,rootNavigationInfo:t.getSiteData().getExistingRootNavigationInfo(o),rootId:o,id:s}}function f(t,r,i,s){var o=function(e,t,r,i){var s=l(e),o=g(e,t,r,i);return A.getInstance(s,o).getComputedProps(o).get()}(t.mobxObserverWrapperProps.siteAPI,t.rootId,s,t.id);return function(e){return"SITE_PAGES"===e}(t.id)&&e.assign(o,t.mobxObserverWrapperProps.propsForSitePages),o.isAffectedByModeChanges=r,i&&(o.className=(o.className||"")+" transitioning-comp"),o}function P(t){return!e.isEmpty(t)}function v(t,r,i){var s=e.map(i,function(i){return!!t||function(t,r){var i=[],s=e.get(t,"modes.definitions");if(s&&s.length){var o=e.map(s,"modeId"),n=e.keys(r);i=e.intersection(n,o)}return!e.isEmpty(i)}(i,r)});return e.zipObject(e.map(i,"id"),s)}function y(){var t=this.props.mobxObserverWrapperProps.viewerPrivateServices.displayedDAL,r=this.props.mobxObserverWrapperProps.viewerPrivateServices.pointers,i=this.props.mobxObserverWrapperProps.siteAPI.getSiteData();this.pagePointer=this.props.pagePointer||p.computed(function(){var e=i.getViewMode();return r.components.getPage(this.props.rootId,e)||r.components.getMasterPage(e)},{context:this,compareStructural:!0,name:"pagePointer_"+this.props.id}),this.childrenPointers=p.computed(function(){var e=r.components.getComponent(this.props.id,this.pagePointer.get());return function(e,t,r){var i=e&&t.components.getChildrenContainer(e);i&&r.get(i)}(e,r,t),e?r.components.getChildren(e):[]},{context:this,compareStructural:!0,name:"childrenPointers_"+this.props.id}),this.isPageStub=this.props.isPageStub||p.computed(function(){return!function(e,t){var r=e.getRootIdsWhichShouldBeRendered();return u.componentUtils.shouldBeRendered(r,t)}(this.props.mobxObserverWrapperProps.siteAPI,this.props.rootId)},{context:this,name:"isPageStub_"+this.props.id}),this.computedChildrenToRender=p.computed(function(){var i=this.childrenPointers.get();return this.isPageStub.get()&&(i=e.filter(this.childrenPointers.get(),function(t,r,i,s){return e.some([s].concat(i.components.getChildrenRecursively(s)),function(s){var o=r.get(i.getInnerPointer(s,["componentType"]));return e.includes(t.COMPONENTS_TO_KEEP_IN_STUB,o)})}.bind(this,this.props.mobxObserverWrapperProps.siteAPI,t,r))),function(t,r,i){return e.map(t,function(e){return{id:r.get(i.getInnerPointer(e,["id"])),componentType:r.get(i.getInnerPointer(e,["componentType"]))}})}(i,t,r)},{context:this,compareStructural:!0,name:"computedChildrenToRender_"+this.props.id}),this.magicStructure=new h(i,t,r,this.props.id,this.pagePointer,this.computedChildrenToRender,this.props.computedParentDimensions),this.computedDimensions=p.computed(function(){return this.magicStructure.dimensions},{name:"computedDimensions_"+this.props.id,context:this}),this.shouldRenderInStub=p.computed(function(){var t=this.isPageStub.get(),r=e.isEmpty(this.computedChildrenToRender.get()),i=this.magicStructure.componentType;return!t||!r||e.includes(this.props.mobxObserverWrapperProps.siteAPI.COMPONENTS_TO_KEEP_IN_STUB,i)},{context:this,name:this.props.id+"_shouldRenderInStub"}),this.compModes=p.computed(function(){var i=e.get(this.magicStructure.modes,"definitions");if(e.isEmpty(i))return{};var s=this.pagePointer.get().id,o=r.activeModes.getPageActiveModes(s),n=t.get(o);return e(n).mapValues(function(t,r){return e.some(i,{modeId:r})}).pickBy().value()},{context:this,compareStructural:!0,name:this.props.id+"_activeModes"}),this.compBehaviors=p.computed(function(){var e=this.props.mobxObserverWrapperProps.siteAPI,t=this.magicStructure.propertyQuery,r=this.magicStructure.behaviorQuery;return I.getCompBehaviors(e,t,r,this.props.rootId,this.props.id)},{context:this,compareStructural:!0})}function C(){var e=this.props.mobxObserverWrapperProps.siteAPI,t=this.props.mobxObserverWrapperProps.siteAPI.getPointers(),r=this.props.mobxObserverWrapperProps.siteAPI.getDisplayedDAL(),i=this.pagePointer.get(),s=t.components.getComponent(this.props.id,i);(this.props.structure||s&&r.isExist(s))&&e.registerCompBehaviours(this.props.rootId,this.props.id,this.compBehaviors.get())}function S(r,i,s,o,p){var a=r.getComponentByPageAndCompId(i,s);if(a){var c=e.clone(o),d=u.style.getPrefixedTransform(),h=function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}(d);c[h]=o[d],d!==h&&(c[d]=""),c.zIndex=function(t,r,i){var s=void 0;s=e.includes(t.getRenderRealtimeConfigItem("compsToShowOnTop"),r)?u.style.MAX_Z_INDEX:i?t.getRenderFlag("renderFixedPositionContainers")?50:49:"";return s}(r,s,p),a.hasOwnProperty("getRootStyle")&&e.assign(c,a.getRootStyle(c)),t(n.findDOMNode(a)).css(c)}}var b=c.triggerTypesConsts,A=m.computedPropsBuilder,I=m.propsBuilderUtil,O={ENTER:c.siteConstants.Animations.Modes.AnimationType.ENTER,LEAVE:c.siteConstants.Animations.Modes.AnimationType.LEAVE,TRANSITION:c.siteConstants.Animations.Modes.AnimationType.TRANSITION};return function(t,n){return a.observer(o({displayName:function(e,t){return"SantaTypeObserver("+(e.displayName||e.name||t.split(".").pop())+")"}(n,t),mixins:[u.renderDoneMixin],propTypes:{id:s.string.isRequired,structure:s.object,rootId:s.string,mobxObserverWrapperProps:s.object,applyStyleOverrides:s.bool},componentWillMount:function(){this.transitioningChildrenPrevLayout={},this.currentlyAnimatingChildren={},this.childrenAnimations={},this.renderedCompProps={},this.childrenToRender={},this.lastRenderedComp=null,this.isDomOnly=!1,y.call(this),this.prevActiveModes=null,this.disposeReactions=function(){return p.observe(this.compBehaviors,C.bind(this),{})}.call(this),this.props.mobxObserverWrapperProps.siteAPI.setComponentRenderStart(this.props.id||this.props.structure.id);var e=this.props.mobxObserverWrapperProps.siteAPI,t=this.props.structure||this.magicStructure,r=l(e),i=g(e,this.props.rootId,t,this.props.id);this.computedPropsManager=A.getInstance(r,i,!!n.shouldLayout)},componentWillUpdate:function(){this.setComponentRenderStartIfNeeded()},componentWillReact:function(){this.props.mobxObserverWrapperProps.siteAPI.getSiteData().reacted=!0,this.setComponentRenderStartIfNeeded()},componentWillUnmount:function(){var t=this.props.mobxObserverWrapperProps.siteAPI;t.cancelReLayoutPending(this.props.id||this.props.structure.id),t.unregisterCompBehaviours(this.props.rootId,this.props.id||this.props.structure.id),t.clearMeshStyles(this.props.rootId,this.props.id||this.props.structure.id),e.invoke(this,"disposeReactions")},componentDidMount:function(){C.call(this),this.prevActiveModes=this.compModes.get(),u.displayedOnlyStructureUtil.isDisplayedComponent(this.props.id)&&this.props.mobxObserverWrapperProps.siteAPI.requestEnforceAnchors(),this.props.mobxObserverWrapperProps.siteAPI.setComponentRenderEnd(this.props.id||this.props.structure.id)},getModesChanges:function(){return this.prevActiveModes?c.modes.getModeChanges(this.prevActiveModes,this.compModes.get()):{}},componentDidUpdate:function(){var t=this.props.mobxObserverWrapperProps.siteAPI,r=t.getSiteAspect("WidgetAspect").isContextReady(this.props.rootId);if(this.isDomOnly&&t.isDuringPostUpdatesOperations(this.props.id)||!r)return t.removePostUpdateOperationsRender(this.props.id),void t.cancelReLayoutPending(this.props.id);if(P(this.childrenAnimations)&&(!function(e,t,r,i,s,o){t.getSiteAspect("actionsAspect").executeAction("modeChange",b.MODE_CHANGED_INIT,{modeChanges:r,componentAnimations:i,transitioningComponentsPrevLayout:s,pageId:e,onComplete:o})}(this.props.rootId,t,this.getModesChanges(),this.childrenAnimations,this.transitioningChildrenPrevLayout,this.handleModeChangeAnimationsFinished),function(e){e.getSiteAspect("actionsAspect").executeAction("modeChange",b.MODE_CHANGED_EXECUTE)}(t),this.childrenAnimations={},this.transitioningChildrenPrevLayout={}),this.isDomOnly){this.isDomOnly=!1;var i=this.renderedCompProps.style,s=e.get(this.magicStructure,"layout.fixedPosition",!1);S(t,this.props.rootId,this.props.id,i,s),n.applyCompSpecificDomOnlyPatches&&n.applyCompSpecificDomOnlyPatches(this,i)}var o=this.props.mobxObserverWrapperProps.siteAPI.getPointers(),p=this.props.mobxObserverWrapperProps.siteAPI.getDisplayedDAL(),a=this.pagePointer.get(),c=this.computedChildrenToRender.get();this.childrenData={rotationDegrees:e.reduce(c,function(t,r){var i=r.id,s=o.components.getComponent(i,a);return e.set(t,i,p.get(o.getInnerPointer(s,"layout.rotationInDegrees")))},{})},this.prevActiveModes=this.compModes.get(),u.displayedOnlyStructureUtil.isDisplayedComponent(this.props.id)&&t.requestEnforceAnchors(),this.computedPropsManager.clearChangedPropsMap();var d=this.props.id||this.props.structure.id;this.shouldLayout&&t.setComponentRenderEnd(d)},getRenderedCompProps:function(t,r){var i=t.mobxObserverWrapperProps.siteAPI,s=this.currentlyAnimatingChildren,o=this.getModesChanges(),n=!e.isEmpty(o),p=function(e,t,r,i,s){var o=r&&!!s,n=f(i,r,i.compAnimationType===O.TRANSITION||o,e);return n.childrenSet=t,n}(t.structure||this.magicStructure,this.props.structure?[]:this.computedChildrenToRender.get(),n,t,r);if(n){var a=v(p.isAffectedByModeChanges,o,this.computedChildrenToRender.get());this.childrenAnimations=function(t,r,i){var s=e.keyBy(t.childrenSet,"id"),o=e.keyBy(r.childrenSet,"id"),n=e.reduce(o,function(t,r,i){return s[i]?t:e.set(t,i,O.ENTER)},{});return e.reduce(s,function(t,r,s){return o[s]?i[s]?e.set(t,s,O.TRANSITION):t:e.set(t,s,O.LEAVE)},n)}(r,p,a),this.transitioningChildrenPrevLayout=function(t,r,i){var s=t.getSiteData(),o=s.measureMap;if(!o)return{};var n=t.getSiteAspect("windowScrollEvent").getScrollPosition(),p=e.partial(e.isEqual,O.TRANSITION);return e(r).pickBy(p).mapValues(function(t,r){var p=o.shownInFixed[r]?o.absoluteLeft[r]-n.x:o.absoluteLeft[r]-s.getSiteX()-n.x;return{width:o.width[r],height:o.height[r],left:p,top:o.absoluteTop[r]-n.y,rotation:e.get(i,["rotationDegrees",r])}}).value()}(i,this.childrenAnimations,this.childrenData),e.assign(s,this.childrenAnimations)}return P(s)?this.childrenToRender=function(t,r,i,s){var o=e.filter(i,function(e){return!!s[e.id]});return e.unionBy(t.childrenSet,o,r.childrenSet,"id")}(r,p,this.childrenToRender,s):this.childrenToRender=p.childrenSet,e.assign(p,{pageStub:this.isPageStub.get(),ref:this.compRefFunction},this.props)},compRefFunction:function(e){this.props.mobxObserverWrapperProps.addComponentRef&&this.props.mobxObserverWrapperProps.addComponentRef(e,this.props.id)},getChildProps:function(t){return{id:t,rootId:this.props.rootId,anyChangeInParentActiveModes:!(!this.props.anyChangeInParentActiveModes&&e.isEmpty(this.getModesChanges())),computedParentDimensions:this.computedDimensions,mobxObserverWrapperProps:this.props.mobxObserverWrapperProps,pagePointer:this.pagePointer,isPageStub:this.isPageStub,key:t,refInParent:t}},setComponentRenderStartIfNeeded:function(){var t=this;this.shouldLayout=function(){var r=t.computedPropsManager.getChangedProps(),i=n.shouldLayout;if(i){if(e.isFunction(i))return i(r);if(e.isObject(i))return e.some(r,function(t,r){return e.isUndefined(i[r])||i[r]})}return!0}(),this.shouldLayout&&this.props.mobxObserverWrapperProps.siteAPI.setComponentRenderStart(this.props.id||this.props.structure.id)},render:function(){var t=this.props.mobxObserverWrapperProps.siteAPI,s=t.getSiteAspect("WidgetAspect").isContextReady(this.props.rootId);if(!this.props.structure&&!this.magicStructure.id||!this.shouldRenderInStub.get()||!s&&!this.isPageStub.get())return this.lastRenderedComp;var o=e.clone(this.renderedCompProps);if(this.renderedCompProps=this.getRenderedCompProps(this.props,o),this.isDomOnly=!t.isExperimentOpen("sv_meshLayout")&&function(t,r,i){var s=e.omitBy(r,function(r,i){return t[i]===r||e.isEqual(t[i],r)}),o=1===e.size(s)&&!!s.style&&!e.isEqual(t.style,r.style)&&r.style.display===t.style.display;return e.isFunction(i.compSpecificIsDomOnly)?o&&i.compSpecificIsDomOnly(t,r):o}(o,this.renderedCompProps,n),this.isDomOnly)return this.lastRenderedComp;var p=e.map(this.childrenToRender,function(e){return function(e){return e&&d.getCompClass(e)||i.div}(e.componentType)(this.getChildProps(e.id))}.bind(this)),a=e.omit(this.renderedCompProps,["mobxObserverWrapperProps","childrenSet","isPageStub","pagePointer"]);return this.lastRenderedComp=r.createElement(n,a,p),this.lastRenderedComp},handleModeChangeAnimationsFinished:function(t){this.currentlyAnimatingChildren=e.omit(this.currentlyAnimatingChildren,e.keys(t)),P(this.currentlyAnimatingChildren)||this.forceUpdate()}}))}}),define("compUtils",["compUtils/core/compFactory","compUtils/core/mobxObserverWrapper"],function(e,t){"use strict";return{compFactory:e,mobxObserverWrapper:t}});
//# sourceMappingURL=compUtils.min.js.map