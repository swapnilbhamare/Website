define("mediaServices/services/wixMediaManager/presets.json",[],function(){return{SHAPE:{canAddMedia:!0,canAddMultipleMedia:!0,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!1,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["FREE_FROM_WIX"],manage:[],default:"FREE_FROM_WIX"},socialNetworksList:[],mmgrParams:{i18nPrefix:["shape","multiple_shapes"],mediaType:"shape",publicMediaRoot:"shapes",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},VECTOR_SHAPE:{canAddMedia:!0,canAddMultipleMedia:!0,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!1,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["FREE_FROM_WIX"],manage:[],default:"FREE_FROM_WIX"},socialNetworksList:[],mmgrParams:{i18nPrefix:["shape","multiple_shapes"],mediaType:"shape",publicMediaRoot:"vector_shapes",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},VECTOR_ART:{canAddMedia:!0,canAddMultipleMedia:!0,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!1,canUseImageAnalysis:!1,helpId:"f0a9768b-ca4a-48db-96ef-26522d2e3863",tabsList:{open:["FREE_FROM_WIX"],manage:[],default:"FREE_FROM_WIX"},socialNetworksList:[],mmgrParams:{i18nPrefix:["shape","multiple_shapes"],mediaType:"shape",publicMediaRoot:"vector_art",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},IMAGE:{canAddMedia:!0,canAddMultipleMedia:!0,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!0,helpId:"",tabsList:{open:["MY_IMAGE","MY_NETWORK","FREE_FROM_WIX","SHUTTER_STOCK"],manage:["MY_IMAGE"],default:"MY_IMAGE"},socialNetworksList:["FACEBOOK","INSTAGRAM","DROPBOX","GOOGLE_DRIVE","FLICKR","PICASA"],mmgrParams:{i18nPrefix:["single_image","multiple_images"],mediaType:"picture",publicMediaRoot:"photos",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},IMAGE_PRO:{canAddMedia:!0,canAddMultipleMedia:!0,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!0,helpId:"",tabsList:{open:["MY_IMAGE_PRO"],manage:["MY_IMAGE_PRO"],default:"MY_IMAGE_PRO"},socialNetworksList:[],mmgrParams:{i18nPrefix:["single_secure_image","addmultiple_secure_images"],mediaType:"secure_picture",publicMediaRoot:"",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},IMAGE_UOU:{canAddMedia:!1,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!1,canUseImageAnalysis:!0,helpId:"",tabsList:{open:["MY_IMAGE_UOU"],manage:["MY_IMAGE_UOU"],default:"MY_IMAGE_UOU"},socialNetworksList:[],mmgrParams:{i18nPrefix:["single_image","multiple_images"],mediaType:"picture",publicMediaRoot:"",videoEncodingProfile:"",namespace:"_WixCodeAnonymUpload"},translationMap:{title:!0,tabCaption:!0,description:!0,uploadCaption:!1,noItems:!0,submitCaption:!1}},DOCUMENT_UOU:{canAddMedia:!1,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!1,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_DOCUMENT_UOU"],manage:["MY_DOCUMENT_UOU"],default:"MY_DOCUMENT_UOU"},socialNetworksList:[],mmgrParams:{i18nPrefix:["document","addmultiple_document"],mediaType:"document",publicMediaRoot:"",videoEncodingProfile:"",namespace:"_WixCodeAnonymUpload"},translationMap:{title:!0,tabCaption:!0,description:!0,uploadCaption:!1,noItems:!0,submitCaption:!1}},VIDEO:{canAddMedia:!0,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!0,canUploadMedia:!0,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_VIDEO"],manage:["MY_VIDEO"],default:"MY_VIDEO"},socialNetworksList:[],mmgrParams:{i18nPrefix:["video","addmultiple_video"],mediaType:"video",publicMediaRoot:"",videoEncodingProfile:"mp4-storyboard",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},MUSIC:{canAddMedia:!0,canAddMultipleMedia:!0,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_MUSIC"],manage:["MY_MUSIC"],default:"MY_MUSIC"},socialNetworksList:[],mmgrParams:{i18nPrefix:["music","addmultiple_music"],mediaType:"music",publicMediaRoot:"",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},MUSIC_PRO:{canAddMedia:!0,canAddMultipleMedia:!0,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_MUSIC_PRO"],manage:["MY_MUSIC_PRO"],default:"MY_MUSIC_PRO"},socialNetworksList:[],mmgrParams:{i18nPrefix:["secure_music","addmultiple_secure_music"],mediaType:"secure_music",publicMediaRoot:"",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},DOCUMENT:{canAddMedia:!0,canAddMultipleMedia:!0,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_DOCUMENT"],manage:["MY_DOCUMENT"],default:"MY_DOCUMENT"},socialNetworksList:[],mmgrParams:{i18nPrefix:["document","addmultiple_document"],mediaType:"document",publicMediaRoot:"",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},FLASH:{canAddMedia:!0,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_FLASH"],manage:[],default:"MY_FLASH"},socialNetworksList:[],mmgrParams:{i18nPrefix:["flash","multiple_flash"],mediaType:"swf",publicMediaRoot:"",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},CLIPART:{canAddMedia:!0,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!0,helpId:"",tabsList:{open:["MY_IMAGE","MY_NETWORK","FREE_FROM_WIX","SHUTTER_STOCK"],manage:[],default:"MY_IMAGE"},socialNetworksList:["FACEBOOK","INSTAGRAM","DROPBOX","GOOGLE_DRIVE","FLICKR","PICASA"],mmgrParams:{i18nPrefix:["clipart","addmultiple_clipart"],mediaType:"picture",publicMediaRoot:"clipart",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},ILLUSTRATION:{canAddMedia:!0,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!1,canUseImageAnalysis:!1,helpId:"49601b49-c395-44ff-84bf-2934e789b6a4",tabsList:{open:["FREE_FROM_WIX"],manage:[],default:"FREE_FROM_WIX"},socialNetworksList:[],mmgrParams:{i18nPrefix:["clipart","addmultiple_clipart"],mediaType:"picture",publicMediaRoot:"illustrations",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!1,noItems:!1,submitCaption:!0}},BG_IMAGE:{canAddMedia:!0,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!0,helpId:"",tabsList:{open:["MY_IMAGE","MY_NETWORK","FREE_FROM_WIX","SHUTTER_STOCK"],manage:[],default:"MY_IMAGE"},socialNetworksList:["FACEBOOK","INSTAGRAM","DROPBOX","GOOGLE_DRIVE","FLICKR","PICASA"],mmgrParams:{i18nPrefix:["background","multiple_background"],mediaType:"picture",publicMediaRoot:"backgrounds",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},BG_VIDEO:{canAddMedia:!0,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!0,canUploadMedia:!0,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_VIDEO","FREE_FROM_WIX"],manage:[],default:"MY_VIDEO"},socialNetworksList:[],mmgrParams:{i18nPrefix:["video","addmultiple_video"],mediaType:"video",publicMediaRoot:"videos",videoEncodingProfile:"mp4-storyboard",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},ICON_DOCUMENT:{canAddMedia:!0,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_IMAGE","MY_NETWORK","FREE_FROM_WIX","SHUTTER_STOCK"],manage:[],default:"FREE_FROM_WIX"},socialNetworksList:["FACEBOOK","INSTAGRAM","DROPBOX","GOOGLE_DRIVE","FLICKR","PICASA"],mmgrParams:{i18nPrefix:["single_icon","multiple_icons"],mediaType:"picture",publicMediaRoot:"file_icons",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},ICON_SOCIAL:{canAddMedia:!0,canAddMultipleMedia:!0,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_IMAGE","MY_NETWORK","FREE_FROM_WIX","SHUTTER_STOCK"],manage:[],default:"FREE_FROM_WIX"},socialNetworksList:["FACEBOOK","INSTAGRAM","DROPBOX","GOOGLE_DRIVE","FLICKR","PICASA"],mmgrParams:{i18nPrefix:["single_icon","multiple_icons"],mediaType:"picture",publicMediaRoot:"social_icons",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}},ICON_FAVICON:{canAddMedia:!0,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:!0,canUseImageAnalysis:!1,helpId:"",tabsList:{open:["MY_FAVICON","SHUTTER_STOCK"],manage:[],default:"MY_FAVICON"},socialNetworksList:[],mmgrParams:{i18nPrefix:["favicon","multiple_favicons"],mediaType:"site_icon",publicMediaRoot:"",videoEncodingProfile:"",namespace:""},translationMap:{title:!0,tabCaption:!1,description:!0,uploadCaption:!0,noItems:!1,submitCaption:!0}}}}),define("mediaServices/services/wixMediaManager/constants",["util"],function(e){"use strict";return{BASE_HOST:e.serviceTopology.baseDomain,MMGR_BASE_URL:e.serviceTopology.mediaManagerUrl,MMGR_LANGUAGE_CODE:e.editorModel.languageCode,MMGR_WINDOW_STYLE:"fullscreen",MMGR_MAX_PARALLEL_UPLOADS:6,MMGR_SELECTION_TYPE:["single","multiple"],MMGR_TRANSLATION_KEYS_MAP:{description:{private:"private_media.upload_restrictions_header_message",external:"social_images.upload_restrictions_header_message",public:"free_from_wix.upload_restrictions_header_message",photoStock:"bigstock_images.upload_restrictions_header_message",shutterStock:"shutterstock_images.upload_restrictions_header_message"},tab:{private:"private_media_tab",external:"external_media_tab",public:"public_media_tab",photoStock:"photo_stock_tab",shutterStock:"shutterstock_tab"},noItems:{allMediaFolder:{header:"no_items.header_allMedia",text:"no_items.text_allMedia"},siteMediaFolder:{header:"no_items.header_siteMedia",text:"no_items.text_siteMedia"},userMediaFolder:{header:"no_items.header_user_folder",text:"no_items.text_user_folder"}},title:"header",submitButton:"footer.submit",uploadButton:"uploader.upload"},MMGR_SERVICES_LIST_MAP:{FACEBOOK:"facebook",FLICKR:"flickr",INSTAGRAM:"instagram",PICASA:"picasa",GOOGLE_DRIVE:"drive",DROPBOX:"dropbox"},SINGLE:0,MULTIPLE:1,PRIVATE_MEDIA:"private",MMGR_TABS_MAP:{MY_SHAPE:"private",MY_SHAPE_UOU:"private",MY_IMAGE:"private",MY_IMAGE_PRO:"private",MY_IMAGE_UOU:"private",MY_VIDEO:"private",MY_VIDEO_PRO:"private",MY_VIDEO_UOU:"private",MY_MUSIC:"private",MY_MUSIC_PRO:"private",MY_MUSIC_UOU:"private",MY_DOCUMENT:"private",MY_DOCUMENT_PRO:"private",MY_DOCUMENT_UOU:"private",MY_FLASH:"private",MY_FLASH_UOU:"private",MY_FAVICON:"private",MY_NETWORK:"external",FREE_FROM_WIX:"public",BIG_STOCK:"photoStock",SHUTTER_STOCK:"shutterStock"},MMGR_IMAGE_ANALYSIS_OPTIONS:{faces:["face"],labels:["label","explicit_content"],dominantColors:["color"],cropHints:["crop_hints"],landmarks:["landmark"],logos:["logo"]}}}),define("mediaServices/services/wixMediaManager/mmgrUtils",["lodash","mediaServices/services/wixMediaManager/constants","util"],function(e,a,i){"use strict";function t(e){return a.MMGR_TABS_MAP[e]}return{getMMGRMediaType:function(e){return e.mmgrParams.mediaType},getMMGRSelectionType:function(e){return a.MMGR_SELECTION_TYPE[e.canAddMultipleMedia?a.MULTIPLE:a.SINGLE]},getMMGRI18nPrefix:function(e){return e.mmgrParams.i18nPrefix[e.canAddMultipleMedia?a.MULTIPLE:a.SINGLE]},getMMGRTabsList:function(e){for(var a=[],i=0;i<e.tabsList.length;i++)a[i]=t(e.tabsList[i]);return a},getMMGRServicesList:function(e){for(var i=[],t=0;t<e.socialNetworksList.length;t++)i[t]=a.MMGR_SERVICES_LIST_MAP[e.socialNetworksList[t]];return i},getMMGRTranslations:function(n){var o={},s=void 0,d=void 0,l=n.canAddMultipleMedia?"_MULTISELECT":"";return n.translationMap.title&&(s=("MMGR_API_"+n.categoryName+(n.manageMode?"_MANAGE":"_OPEN")+"_TITLE"+l).toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.title,o[d]=n.translation.title||i.translate(s)),e.forEach(n.tabsList,function(e){n.translationMap.tabCaption&&(s=("MMGR_API_"+e+"_TAB").toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.tab[t(e)],o[d]=i.translate(s)),n.translationMap.description&&(s=("MMGR_API_"+e+"_DESCRIPTION").toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.description[t(e)],o[d]=i.translate(s)),t(e)===a.PRIVATE_MEDIA&&n.translationMap.noItems&&(s=("MMGR_API_"+e+"_NO_ITEMS_HEADER_ALL_MEDIA").toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.noItems.allMediaFolder.header,o[d]=i.translate(s),s=("MMGR_API_"+e+"_NO_ITEMS_TEXT_ALL_MEDIA").toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.noItems.allMediaFolder.text,o[d]=i.translate(s),s=("MMGR_API_"+e+"_NO_ITEMS_HEADER_SITE_MEDIA").toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.noItems.siteMediaFolder.header,o[d]=i.translate(s),s=("MMGR_API_"+e+"_NO_ITEMS_TEXT_SITE_MEDIA").toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.noItems.siteMediaFolder.text,o[d]=i.translate(s),s=("MMGR_API_"+e+"_NO_ITEMS_HEADER_USER_FOLDER").toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.noItems.userMediaFolder.header,o[d]=i.translate(s),s=("MMGR_API_"+e+"_NO_ITEMS_TEXT_USER_FOLDER").toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.noItems.userMediaFolder.text,o[d]=i.translate(s))}),n.translationMap.uploadCaption&&(s=("MMGR_API_"+n.categoryName+"_UPLOAD_BUTTON").toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.uploadButton,o[d]=i.translate(s)),n.translationMap.submitCaption&&(s=("MMGR_API_"+n.categoryName+"_SUBMIT_BUTTON"+l).toUpperCase(),d=a.MMGR_TRANSLATION_KEYS_MAP.submitButton,o[d]=n.translation.submitButton||i.translate(s)),o},getImageAnalysisOptions:function(i){return[].concat.apply([],e(a.MMGR_IMAGE_ANALYSIS_OPTIONS).keys().filter(function(e){return i[e]}).map(function(e){return a.MMGR_IMAGE_ANALYSIS_OPTIONS[e]}).value()).filter(function(e,a,i){return i.indexOf(e)===a})}}}),define("mediaServices/services/wixMediaManager/adapter",["lodash","jquery","mediaServices/services/wixMediaManager/presets.json","mediaServices/services/wixMediaManager/constants","mediaServices/services/wixMediaManager/mmgrUtils","coreUtilsLib"],function(e,a,i,t,n,o){"use strict";function s(i){function o(e){if(i.callback){var t=e&&e.items||null,n=t&&{path:e.path}||null;i.callback(t,n)}s.off("close",o),s.off("items",o),function(){var e=a("#editor");if(e){var i=a(window),t=i.scrollTop();e.trigger("focus"),i.scrollTop(t)}}()}var s=window.MediaFrame,d={mediaGalleryBaseHost:t.MMGR_BASE_URL,baseHost:t.BASE_HOST,i18nCode:t.MMGR_LANGUAGE_CODE,windowStyle:t.MMGR_WINDOW_STYLE,i18nPrefix:n.getMMGRI18nPrefix(i),mediaType:n.getMMGRMediaType(i),selectionType:n.getMMGRSelectionType(i),canShowSelectButton:i.canAddMedia,canSubmitUntranscoded:i.canAddMediaBeforeEncodingComplete,disableUpload:!i.canUploadMedia,tabsList:n.getMMGRTabsList(i),path:i.path,siteMediaToken:i.siteMediaToken,isEmailWithWixDomain:i.isEmailWithWixDomain,maxParallelUploads:t.MMGR_MAX_PARALLEL_UPLOADS};if(i.imageAnalysis){var l=n.getImageAnalysisOptions(i.imageAnalysis);l.length&&(d.vision=l)}d.translations=n.getMMGRTranslations(i),i.mmgrParams.publicMediaRoot&&(d.publicMediaRoot=i.mmgrParams.publicMediaRoot),e.isEmpty(i.socialNetworksList)||(d.servicesList=n.getMMGRServicesList(i)),e.isEmpty(i.mmgrParams.videoEncodingProfile)||(d.videoEncodingProfile=i.mmgrParams.videoEncodingProfile),e.isEmpty(i.mmgrParams.namespace)||(d.namespace=i.mmgrParams.namespace),e.isEmpty(i.helpId)||(d.helpId=i.helpId),s.on("items",o).on("close",o),s.open(d),window.document.getElementById("mediaGalleryFrame").contentWindow.focus()}return{open:function(e,a,n){n=n||{};var o=i[a],d={categoryName:a,tabsList:o.tabsList.open,socialNetworksList:o.socialNetworksList,mmgrParams:o.mmgrParams,helpId:o.helpId,canAddMedia:o.canAddMedia,canAddMultipleMedia:void 0===n.multiSelect?o.canAddMultipleMedia:n.multiSelect,canAddMediaBeforeEncodingComplete:o.canAddMediaBeforeEncodingComplete,canUploadMedia:o.canUploadMedia,manageMode:!1,path:n.path||t.MMGR_TABS_MAP[o.tabsList.default],translation:{},translationMap:o.translationMap,siteMediaToken:e.siteMediaToken,isEmailWithWixDomain:e.isEmailWithWixDomain,imageAnalysis:o.canUseImageAnalysis?n.imageAnalysis||null:null};n.translation&&(n.translation.title&&(d.translation.title=n.translation.title),n.translation.submitButton&&(d.translation.submitButton=n.translation.submitButton)),n.callback&&(d.callback=function(){n.callback.apply(null,arguments),window.focus()}),s(d)},presets:i,manage:function(a,n,d){d=d||{};var l=i[n],r={categoryName:n,tabsList:l.tabsList.manage,socialNetworksList:l.socialNetworksList,mmgrParams:l.mmgrParams,helpId:l.helpId,canAddMedia:!1,canAddMultipleMedia:!1,canAddMediaBeforeEncodingComplete:!1,canUploadMedia:l.canUploadMedia,manageMode:!0,path:d.path||t.MMGR_TABS_MAP[l.tabsList.default],translation:{},translationMap:l.translationMap,siteMediaToken:a.siteMediaToken,isEmailWithWixDomain:a.isEmailWithWixDomain,imageAnalysis:l.canUseImageAnalysis?d.imageAnalysis||null:null};d.translation&&d.translation.title&&(r.translation.title=d.translation.title),d.callback&&(r.callback=d.callback),e.isEmpty(r.tabsList)?o.log.error(n+" is an un-managed category"):s(r)},categories:function(){var a={};return e.forEach(e.keys(i),function(e){e=e.toUpperCase(),a[e]=e}),a}()}}),define("mediaServices",["lodash","constants","util","core","stateManagement","mediaServices/services/wixMediaManager/adapter","imageClientApi"],function(e,a,i,t,n,o,s){"use strict";var d=n.userPreferences.logic.setSessionUserPreferences,l=n.userPreferences.selectors.getMediaPath,r=a.IMAGE_DATA_KEYS,p=a.LEGACY_FIT_DISPLAY_MODE,c=a.CLIPART_DATA_KEYS,M=a.VECTOR_IMAGE_DEFAULTS,m=M.VECTOR_IMAGE_CATEGORY,_=M.VECTOR_SHAPE_DEFAULT_STYLE,u=M.VECTOR_SHAPE_COLOR_DEFAULT,A=M.VECTOR_SHAPE_DEFAULT_PATH,g=M.VECTOR_ART_DEFAULT_PATH;return{create:function(a){function n(t){var n=i.imageTransform.fittingTypes,o=a.components.data.get(t),p=a.store,c=p.dispatch,M=(0,p.getState)(),m=l(o.uri)(M);a.mediaServices.mediaManager.open(a.mediaServices.mediaManager.categories.IMAGE,{translation:{title:i.translate("Image_Media_Choose_Image"),submitButton:i.translate("MMGR_submitbutton_onstage_image_uploads_choose")},path:m,multiSelect:!1,callback:function(o,l){if(o){var p=a.components.layout.get(t),M=e.pick(o[0],r),m=a.components.properties.get(t).displayMode;M.uri=o[0].fileName,M.originalImageDataRef=null,M.crop=function(a,i,t,n,o){if(o===s.fittingTypes.SCALE_TO_FILL||o===s.fittingTypes.LEGACY_FULL){var d=Math.min(t/a,n/i),l=a*d,r=i*d,p={width:Math.round(l),height:Math.round(r),x:Math.round((t-l)/2),y:Math.round((n-r)/2)};return e.some(p)?p:null}return null}(p.width,p.height,M.width,M.height,m),M.title="",c(d(M.uri||"",l.path)),a.components.data.update(t,M,!0),m===i.imageTransform.fittingTypes.LEGACY_FULL&&a.components.properties.update(t,{displayMode:n.SCALE_TO_FILL},!0),a.history.add("Change Image")}}})}function M(t){var n=a.store.getState(),o=a.components.data.get(t),s=e.get(o,["svgId"]),r=a.media.vectorImage.getSvgInfoFromCache(s),c=r.svgType,M=a.components.design.get(t),E="shape"===c?A:g,I=l(s)(n)||E;a.mediaServices.mediaManager.open(a.mediaServices.mediaManager.categories[m],{multiSelect:!1,callback:function(n,s){if(!e.isEmpty(n)){var l=e.get(n,[0,"title"],""),c=e.get(n,[0,"uri"]);a.media.vectorImage.fetchSvg(c,e.noop),a.documentServices.waitForChangesApplied(function(){var n=e.assign({},o,{svgId:c,title:l}),s=e.get(a.media.vectorImage.getSvgInfoFromCache(c),"svgType"),d=e.assign({},M,function(a,i,t){var n=e.assign(e.omit(i,"svgType"),e.get(a,"overrideColors")),o=e.get(a,["shapeStyle"]),s=e.get(o,["opacity"],_.opacity),d=n.color1&&!n.color2?n.color1:u.color1,l=void 0;switch(t){case"shape":l={overrideColors:{color1:d},shapeStyle:e.defaults(o,_)};break;case"tint":l={overrideColors:{color1:d},shapeStyle:{opacity:s}};break;case"color":l={overrideColors:null,shapeStyle:{opacity:s}}}return l}(M,r,s));a.components.data.update(t,n,!0),a.components.design.update(t,d,!0),a.documentServices.waitForChangesApplied(function(){!function(e){var t=a.components.properties.get(e),n=i.imageTransform.fittingTypes;if(t.displayMode===n.SCALE_TO_FIT||t.displayMode===p){var o=a.media.vectorImage.getSvgOriginalAspectRatio(e);a.components.layout.resetCompLayoutToAspectRatio(e,o),a.components.properties.update(e,{displayMode:n.SCALE_TO_FIT},!0)}}(t),a.history.add("Change Vector Image")})}),a.store.dispatch(d("last_media_path_"+c,s.path||""))}},path:I})}var E={siteMediaToken:"",isEmailWithWixDomain:!1};return{mediaManager:{manage:o.manage.bind(null,E),open:o.open.bind(null,E),presets:o.presets,categories:o.categories},setSiteMediaToken:function(e){E.siteMediaToken=e||""},setIsEmailWithWixDomain:function(e){E.isEmailWithWixDomain=e},changeWPhoto:n,changeVectorImage:M,changeClipArt:function(t,n){var o=a.components.data.get(t),s=a.store.getState(),r=l(o.uri)(s);a.mediaServices.mediaManager.open(n,{multiSelect:!1,translation:{submitButton:i.translate("MMGR_submitbutton_onstage_clipart_freeclipart_choose")},path:r,callback:function(i,n){if(i){var o=e.pick(i[0],c);o.uri=i[0].fileName,o.originalImageDataRef=null,o.crop=null,a.store.dispatch(d("last_media_path_"+o.uri,n.path)),a.components.data.update(t,o,!0),a.history.add("Change Clipart")}}})},changeShape:function(n){var o=a.mediaServices;o.mediaManager.open(o.mediaManager.categories.SHAPE,{multiSelect:!1,callback:function(o){if(!e.isEmpty(o)){var s=i.svgUrlParser.parseSvgSkinFromUrl(o[0].fileUrl),d=a.components.style.getId(n),l=a.theme.styles.get(d);if(s!==l.skin){l.skin=s;var r=t.styleManager.getStyleIdByDef(a.theme,a.components,l,a.components.getType(n));a.components.style.setId(n,r),a.history.add("Change Shape")}}},translation:{submitButton:i.translate("Shape_Media_Change_Shape")}})}}}}});
//# sourceMappingURL=mediaServices.min.js.map